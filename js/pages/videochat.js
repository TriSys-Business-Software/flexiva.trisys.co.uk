var VideoChat={'Domain':'TriSys\x20Business\x20Software','Load':function(){VideoChat['Fit_iFrame'](),VideoChat['WireUpButtons']();},'WireUpButtons':function(){$('#videoChatButtons-button-leave')['off']()['on']('click',function(){var fnLeave=function(){return setTimeout(VideoChat['LeaveMeeting'],0xa),!![];},sMessage='Are\x20you\x20sure\x20that\x20you\x20wish\x20to\x20leave\x20this\x20meeting\x20room?'+'<br/><br/>\x20<strong>Room'+$('#videoChatRoomName')['text']()+'</strong>'+'<br/><br/>You\x20will\x20be\x20allowed\x20to\x20re-join\x20this\x20meeting\x20later.';TriSysApex['UI']['questionYesNo'](sMessage,'Leave\x20Meeting\x20Room','Yes',fnLeave,'No');}),$('#videoChatButtons-button-detach')['off']()['on']('click',function(){TriSysSDK['Browser']['OpenURL'](VideoChat['_LastStartedMeetingURL']),setTimeout(VideoChat['LeaveMeeting'],0xa);});var fnJoinButtonClick=function(){var fnJoin=function(options){var sFullName=TriSysApex['LoginCredentials']['UserCredentials']()['LoggedInUser']['CRMContact']['FullName'],lContactId=TriSysApex['LoginCredentials']['UserCredentials']()['LoggedInUser']['CRMContact']['ContactId'],fnAfterRecordingAttendee=function(){VideoChat['ShowRoomName'](options['RoomName']),VideoChat['StartMeeting'](options['URL'],sFullName);};VideoChat['AddAttendee'](options['MeetingId'],lContactId,sFullName,fnAfterRecordingAttendee);};VideoChat['ReadMeetingsAndPromptForSelection'](fnJoin);};$('#videoChatButtons-button-join')['off']()['on']('click',fnJoinButtonClick),$('#videoChatButtons-button-join2')['off']()['on']('click',fnJoinButtonClick),$('#videoChatButtons-button-invite')['off']()['on']('click',VideoChat['InviteColleague']),$('#videoChatButtons-button-add')['off']()['on']('click',function(){var fnAdded=function(CCreateMeetingResponse){TriSysApex['UI']['ShowMessage']('Created\x20meeting\x20room.');},fnIfAllowedToAddMoreMeetingRooms=function(){VideoChat['PromptForNewMeeting'](function(sName){VideoChat['ObtainMeetingDetailsFromWebAPI'](sName,fnAdded);});};VideoChat['CheckNewRoomCapability'](fnIfAllowedToAddMoreMeetingRooms);}),$('#videoChatButtons-button-delete')['off']()['on']('click',function(){var fnDelete=function(meeting){VideoChat['DeleteMeetingDetailsUsingWebAPI'](meeting['MeetingId'],function(){TriSysApex['UI']['ShowMessage']('Deleted\x20meeting:\x20'+meeting['MeetingId']+'<br/>'+meeting['URL']),VideoChat['LeaveMeeting']();});},options={'Title':'Choose\x20Meeting\x20Room\x20to\x20be\x20Deleted','OwnerOnly':!![]};VideoChat['ReadMeetingsAndPromptForSelection'](fnDelete,options);});},'PromptForNewMeeting':function(fnCallback){var fnNew=function(sName){if(!sName)return;return setTimeout(function(){fnCallback(sName);},0xa),!![];},sMessage='Add\x20New\x20Meeting\x20Room',options={'Label':'Name','SaveButtonText':'Create'};TriSysApex['ModalDialogue']['New']['Popup'](sMessage,'gi-facetime_video',fnNew,options);},'ReadMeetingsAndPromptForSelection':function(fnCallback,options){var payloadObject={};payloadObject['URL']='Meetings/ListMeetings';var bOwnerOnly=![];if(options&&options['OwnerOnly'])bOwnerOnly=!![];payloadObject['OutboundDataPacket']={'Domain':VideoChat['Domain'],'OwnerOnly':bOwnerOnly},payloadObject['InboundDataFunction']=function(CListMeetingsResponse){TriSysApex['UI']['HideWait']();if(CListMeetingsResponse){if(CListMeetingsResponse['Success']&&CListMeetingsResponse['Meetings']){VideoChat['PromptToSelectExistingMeeting'](CListMeetingsResponse['Meetings'],fnCallback,options);return;}}var sHyperlink='<a\x20href=\x22javascript:void(0)\x22\x20onclick=\x22TriSysApex.Advertising.ContactUs();\x22>contact\x20us</a>';TriSysApex['UI']['ShowMessage']('Please\x20'+sHyperlink+'\x20to\x20activate\x20your\x20video\x20conferencing\x20/\x20video\x20interviewing\x20service.');},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('VideoChat.ReadMeetingsAndPromptForSelection:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Loading\x20Meetings...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'PromptToSelectExistingMeeting':function(meetings,fnCallback,options){var entityParameters=new TriSysApex['ModalDialogue']['Selection']['SelectionParameters']();entityParameters['Title']=options?options['Title']:'Choose\x20a\x20Meeting\x20Room',entityParameters['PopulationByObject']=meetings,entityParameters['Columns']=[{'field':'RoomName','title':'Room','type':'string'},{'field':'FullContactName','title':'Owner','type':'string'},{'field':'Attendees','title':'Attendees','type':'string'}],meetings['forEach'](function(meeting){if(meeting['Attendees']){var sAttendees='';meeting['Attendees']['forEach'](function(attendee){if(sAttendees['length']>0x0)sAttendees+=',\x20';sAttendees+=attendee['FullName'];}),meeting['Attendees']=sAttendees;}else meeting['Attendees']='';}),entityParameters['CallbackFunction']=function(selectedRow){if(!selectedRow)return![];var sRoomName=selectedRow['RoomName'];if(sRoomName)return setTimeout(function(){fnCallback(selectedRow);},0xa),!![];},TriSysApex['ModalDialogue']['Selection']['Show'](entityParameters);},'Fit_iFrame':function(){var iFrameElement=$('#videoChatiFrame'),fHeightFactor=0xa8,iHeight=$(window)['height']()-fHeightFactor;iFrameElement['css']('height',iHeight+'px'),$('#videoChat-help-block')['css']('height',iHeight-0x1e+'px');var iDataSheetHeight=iHeight-0x82;$('#videoChatiFrameDatasheet')['css']('height',iDataSheetHeight+'px');var sDiv='videoChat-Introduction-Column',intro=$('#'+sDiv);intro['css']('height',iDataSheetHeight+'px'),TriSysSDK['EntityFormTabs']['AddVerticalScrollBar'](sDiv);},'CheckNewRoomCapability':function(fnCallback){var payloadObject={};payloadObject['URL']='Meetings/NewMeetingRoomCapability',payloadObject['OutboundDataPacket']={'Domain':VideoChat['Domain']},payloadObject['InboundDataFunction']=function(CNewMeetingRoomCapabilityResponse){TriSysApex['UI']['HideWait']();if(CNewMeetingRoomCapabilityResponse){if(CNewMeetingRoomCapabilityResponse['Success']){fnCallback();return;}}var sMessage='Unable\x20to\x20create\x20a\x20new\x20meeting\x20room.'+'<br/>'+'Your\x20current\x20plan\x20includes\x20one\x20company-wide\x20meeting\x20room\x20only.'+'<br/>'+'To\x20enable\x20additional\x20meeting\x20rooms,\x20please\x20contact\x20TriSys\x20Support.';TriSysApex['UI']['ShowMessage'](sMessage);},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('VideoChat.CheckNewRoomCapability:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Checking\x20Meeting\x20Room\x20Rules...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'ObtainMeetingDetailsFromWebAPI':function(sName,fnCallback){var payloadObject={};payloadObject['URL']='Meetings/CreateMeeting',payloadObject['OutboundDataPacket']={'Domain':VideoChat['Domain'],'Name':sName},payloadObject['InboundDataFunction']=function(CCreateMeetingResponse){TriSysApex['UI']['HideWait']();if(CCreateMeetingResponse){if(CCreateMeetingResponse['Success']){fnCallback(CCreateMeetingResponse);return;}}TriSysApex['UI']['ShowMessage']('Unable\x20to\x20create\x20a\x20meeting\x20room.');},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('VideoChat.ObtainMeetingDetailsFromWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Creating\x20Meeting\x20Room...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'ShowRoomName':function(sRoomName){if(sRoomName)sRoomName=':\x20'+sRoomName;$('#videoChatRoomName')['text'](sRoomName);},'_LastStartedMeetingURL':null,'StartMeeting':function(sURL,sFullName){var sRoomOptions='?embed&iframeSource=trisys&chat=on&screenshare=on',sLeaveRoomHand='&leaveButton=on',sPersonality='&personality=off',sBreakout='&breakout=on';sRoomOptions+=sPersonality+sBreakout;var sUser='&displayName='+sFullName;VideoChat['_LastStartedMeetingURL']=sURL,sURL+=sRoomOptions+sUser;var iFrameElement=$('#videoChatiFrame');iFrameElement['attr']('src',sURL),$('#videoChat-help-block')['hide'](),iFrameElement['show'](),$('#videoChatButtons-button-leave')['show'](),$('#videoChatButtons-button-detach')['show'](),$('#videoChatButtons-button-join')['hide'](),$('#videoChatButtons-button-invite')['show']();},'RemoveWherebyBranding':function(){var iFrameDOM=$('iframe#videoChatiFrame')['contents']();iFrameDOM['find']('.WatermarkBanner-2-PU')['remove']();},'DeleteMeetingDetailsUsingWebAPI':function(sMeetingId,fnCallback){var payloadObject={};payloadObject['URL']='Meetings/DeleteMeeting',payloadObject['OutboundDataPacket']={'Domain':VideoChat['Domain'],'MeetingId':sMeetingId},payloadObject['InboundDataFunction']=function(CDeleteMeetingResponse){TriSysApex['UI']['HideWait']();if(CDeleteMeetingResponse){if(CDeleteMeetingResponse['Success']){fnCallback(CDeleteMeetingResponse);return;}}TriSysApex['UI']['ShowMessage']('Unable\x20to\x20delete\x20meeting.');},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('VideoChat.DeleteMeetingDetailsUsingWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Deleting\x20Meeting...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'AddAttendee':function(sMeetingId,lContactId,sFullName,fnCallback){var payloadObject={};payloadObject['URL']='Meetings/AddAttendee',payloadObject['OutboundDataPacket']={'Domain':VideoChat['Domain'],'MeetingId':sMeetingId,'ContactId':lContactId,'FullName':sFullName},payloadObject['InboundDataFunction']=function(CAddAttendeeResponse){TriSysApex['UI']['HideWait']();if(CAddAttendeeResponse){if(CAddAttendeeResponse['Success']){fnCallback();return;}}TriSysApex['UI']['ShowMessage']('Unable\x20to\x20add\x20attendee.');},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('VideoChat.AddAttendee:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Adding\x20Attendee...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'LeaveMeeting':function(){var iFrameElement=$('#videoChatiFrame');iFrameElement['attr']('src',null),iFrameElement['hide'](),$('#videoChat-help-block')['show'](),$('#videoChatRoomName')['text'](''),$('#videoChatButtons-button-leave')['hide'](),$('#videoChatButtons-button-detach')['hide'](),$('#videoChatButtons-button-join')['show'](),$('#videoChatButtons-button-invite')['hide']();},'InviteColleague':function(){var fnSelectUser=function(lstFieldValues){if(!lstFieldValues)return;var lstUser=TriSysSDK['Grid']['MultiSelectGridFieldValuesToList'](lstFieldValues),userCredentials=TriSysApex['LoginCredentials']['UserCredentials'](),sFrom=userCredentials['LoggedInUser']['ForenameAndSurname'],fnSendPostItNote=function(){var lTaskId=-0x1*TriSysSDK['Miscellaneous']['RandomNumber'](0x186a0,0xf423f),postItNote={'TaskId':lTaskId,'StartDate':new Date()},sRoomName=$('#videoChatRoomName')['text']();sRoomName=sRoomName['replace'](':\x20','');var sFullName='',sEntityHyperlinkPrefix='<a\x20style=\x22cursor:pointer;\x22\x20onclick=\x22TriSysApex.VideoConferencing.MeetInRoom('+'\x27'+sRoomName+'\x27,\x20'+'\x27'+VideoChat['_LastStartedMeetingURL']+'\x27,\x20'+'\x27'+sFullName+'\x27'+')\x22>',sEntityHyperlinkSuffix='</a>\x20to\x20meet\x20now.'+'\x0a',sMessage=sFrom+'\x20has\x20invited\x20you\x20to\x20meet\x20in\x20room:\x0a'+sRoomName+'\x0a\x0a'+'Please\x20',sMessageHyperlink='click\x20here';postItNote['DisplayDescription']=sMessage+sEntityHyperlinkPrefix+sMessageHyperlink+sEntityHyperlinkSuffix,TriSysApex['PostItNotes']['OpenPostItNoteWindow'](postItNote),setTimeout(function(){var userIDWithTaskId=ctrlPostItNote['UsersID']+'-'+lTaskId,sUsers='';lstUser['forEach'](function(user){if(sUsers['length']>0x0)sUsers+=',\x20';sUsers+=user['FullName'];}),TriSysSDK['CShowForm']['SetSkillsInList'](userIDWithTaskId,sUsers),ctrlPostItNote['Send'](lTaskId),TriSysApex['Toasters']['Info'](lstUser['length']+'\x20colleague'+(lstUser['length']==0x1?'':'s')+'\x20have\x20been\x20invited\x20via\x20a\x20post-it\x20note.');},0x2ee);};return setTimeout(fnSendPostItNote,0x64),!![];},options={'Title':'Select\x20one\x20or\x20more\x20colleagues','NotLocked':!![],'MultiSelect':!![]};TriSysApex['ModalDialogue']['Users']['Select'](fnSelectUser,options);},'StartMeetingInRoom':function(sRoomName,sURL,sFullName){VideoChat['ShowRoomName'](sRoomName),VideoChat['StartMeeting'](sURL,sFullName);}};$(document)['ready'](function(){VideoChat['Load']();});