var ctrlTimesheetForm={'Load':function(){TriSysSDK['EntityFormTabs']['AddClickEventHandlers']('timesheet-form-tab-nav-horizontal',!![]),TriSysSDK['Controls']['Button']['Click']('timesheet-form-tab-hours');var hideMenuItemPrefixes=['file-menu-saveas'];if(TriSysApex['Device']['isPhone']())$('#timesheetForm-ActionsMenu')['hide']();else{var sCallbackFunction='ctrlTimesheetForm.ActionInvocation',sMasterEntityCallbackFunction='ctrlTimesheetForm.ActionInvocationMasterEntity';TriSysActions['Menus']['Draw']('timesheetForm-ActionsMenu','Timesheet',sCallbackFunction,sMasterEntityCallbackFunction);}var sGrid='timesheetForm-NotesHistoryGrid';TriSysSDK['FormMenus']['DrawGridMenu']('timesheetNotesHistoryGridMenu',sGrid),sGrid='timesheetForm-ScheduledTasksGrid',TriSysSDK['FormMenus']['DrawGridMenu']('timesheetScheduledTasksGridMenu',sGrid),TriSysSDK['CShowForm']['CustomFieldsTab']['Load']('timesheet-form-customfields','timesheet-form-tab-custom-caption','Timesheet'),TriSysSDK['CShowForm']['InitialiseFields']('Timesheet'),ctrlTimesheetForm['CustomLogic']();},'CustomLogic':function(){TriSysApex['LoginCredentials']['isLoggedInToSpecificCompanyAsRecruiter']('CoSector')&&($('#trisys-timesheet-miscellaneous-hours-reason-block')['show'](),$('#timesheet-form-original-row')['hide']());},'TabButtonCallback':function(sTabID){switch(sTabID){case'timesheet-form-panel-hours':break;case'timesheet-form-panel-attributes':if(TriSysApex['Forms']['EntityForm']['isGridPopulated']('Timesheet',sTabID))return;TriSysSDK['Attributes']['Load']('Timesheet',TriSysApex['Pages']['TimesheetForm']['TimesheetId'],'timesheet-form-attributes');break;case'timesheet-form-panel-documentlibrary':if(TriSysApex['Forms']['EntityForm']['isGridPopulated']('Timesheet',sTabID))return;TriSysSDK['DocumentLibrary']['Load']('Timesheet',TriSysApex['Pages']['TimesheetForm']['TimesheetId'],'timesheet-form-documentlibrary');break;case'timesheet-form-panel-noteshistory':TriSysApex['Pages']['TimesheetForm']['LoadNotesHistoryGrid']('timesheetForm-NotesHistoryGrid',null);break;case'timesheet-form-panel-scheduledtasks':TriSysApex['Pages']['TimesheetForm']['LoadScheduledTasksGrid']('timesheetForm-ScheduledTasksGrid',null);break;}},'FileMenuCallback':function(sFileMenuID){var fm=TriSysSDK['FormMenus']['Constants'];switch(sFileMenuID){case fm['File_New']:TriSysApex['Pages']['TimesheetForm']['NewRecord']();break;case fm['File_Open']:TriSysApex['Pages']['TimesheetForm']['OpenFindDialogue']();break;case fm['File_Save']:TriSysApex['Pages']['TimesheetForm']['SaveRecord']();break;case fm['File_Save_As']:TriSysApex['UI']['ShowMessage']('Save\x20Timesheet\x20As');break;case fm['File_Delete']:ctrlTimesheetForm['Delete']();break;case fm['File_Close']:TriSysApex['FormsManager']['CloseCurrentForm']();break;}},'NotesHistoryGridFileMenuCallback':function(sFileMenuID){ctrlTimesheetForm['TaskGridFileMenuCallback'](sFileMenuID,'timesheetForm-NotesHistoryGrid',![]);},'ScheduledTaskGridFileMenuCallback':function(sFileMenuID){ctrlTimesheetForm['TaskGridFileMenuCallback'](sFileMenuID,'timesheetForm-ScheduledTasksGrid',!![]);},'TaskGridFileMenuCallback':function(sFileMenuID,sGrid,bScheduled){var fm=TriSysSDK['FormMenus']['Constants'],lTaskId=null;switch(sFileMenuID){case fm['File_New']:ctrlTimesheetForm['NewTask'](bScheduled);break;case fm['File_Open']:lTaskId=TriSysApex['ModalDialogue']['Task']['GetSelectedSingletonTaskIdFromTaskGrid'](sGrid);if(lTaskId>0x0)TriSysApex['ModalDialogue']['Task']['QuickShow'](lTaskId);break;case fm['File_Delete']:lTaskId=TriSysApex['ModalDialogue']['Task']['GetSelectedSingletonTaskIdFromTaskGrid'](sGrid);if(lTaskId>0x0)TriSysApex['ModalDialogue']['Task']['DeleteTask'](lTaskId);break;}},'NewTask':function(bScheduled){var lTimesheetId=TriSysApex['Pages']['TimesheetForm']['TimesheetId'],lContactId=TriSysSDK['Controls']['ContactLookup']['ReadContactId']('Timesheet_Candidate'),sPlacement=$('#Timesheet_PlacementId')['val'](),sCandidate=TriSysSDK['Controls']['ContactLookup']['ReadContactName']('Timesheet_Candidate'),sContactType='Candidate',params=new TriSysApex['ModalDialogue']['Task']['ShowParameters']();params['Scheduled']=bScheduled;var candidateContact={'ContactId':lContactId,'FullName':sCandidate,'CompanyName':'','JobTitle':'','ContactType':sContactType};params['Contacts']['push'](candidateContact);var timesheetLink={'Name':'Timesheet','RecordId':lTimesheetId,'Description':'Timesheet:\x20'+lTimesheetId+',\x20'+sPlacement};params['Links']['push'](timesheetLink),TriSysApex['ModalDialogue']['Task']['Show'](params);},'ActionInvocation':function(sEntityName){switch(sEntityName){case'Timesheet':var timesheetIds=[TriSysApex['Pages']['TimesheetForm']['TimesheetId']];return timesheetIds;}},'ActionInvocationMasterEntity':function(){var masterEntity={'EntityName':'Timesheet','EntityId':TriSysApex['Pages']['TimesheetForm']['TimesheetId']};return masterEntity;},'ShowTimesheetSummary':function(lTimesheetId,lPlacementId){$('#trisys-timesheet-hours-grid')['empty']();var CTimesheetRequest={'TimesheetId':lTimesheetId,'PlacementId':lPlacementId},payloadObject={};payloadObject['URL']='Timesheet/Read',payloadObject['OutboundDataPacket']=CTimesheetRequest,payloadObject['InboundDataFunction']=function(CTimesheetResponse){TriSysApex['UI']['HideWait']();if(CTimesheetResponse&&CTimesheetResponse['Success']){var timesheet=CTimesheetResponse['Timesheet'];if(timesheet){var placement=CTimesheetResponse['Placement'];TriSysSDK['Controls']['ContactLookup']['WriteContactId']('Timesheet_Candidate',placement['CandidateContactId'],placement['CandidateName']);var sPlacement=placement['Reference']+':\x20'+placement['JobTitle']+':\x20'+placement['CompanyName'];$('#Timesheet_PlacementId')['val'](sPlacement),TriSysApex['Pages']['TimesheetForm']['PlacementId']=placement['PlacementId'],$('#Timesheet_Frequency')['val'](placement['TimesheetFrequency']);var periodList=null;if(lTimesheetId>0x0)periodList=placement['PeriodDescriptionsAll'];else periodList=placement['PeriodDescriptionsUnassignedToTimesheets'];if(!periodList){var fnGoToPlacement=function(){return TriSysApex['FormsManager']['OpenForm']('Placement',placement['PlacementId']),!![];},sMessage='Timesheet\x20periods\x20exhausted.'+'<br\x20/>'+'This\x20is\x20typically\x20because\x20your\x20placement\x20end\x20date\x20is\x20beyond\x20the\x20date\x20of\x20the\x20last\x20available\x20timesheet\x20period.'+'<br\x20/>'+'Please\x20ask\x20your\x20systems\x20administrator\x20to\x20generate\x20new\x20timesheet\x20periods.';TriSysApex['UI']['ShowMessage'](sMessage,null,fnGoToPlacement);return;}var sPeriodID='Timesheet_Period';TriSysSDK['CShowForm']['populateComboFromListOfString'](sPeriodID,periodList),TriSysSDK['CShowForm']['ComboEnabled'](sPeriodID,CTimesheetResponse['TimesheetId']==0x0);if(CTimesheetResponse['TimesheetId']>0x0)TriSysSDK['CShowForm']['SetTextInCombo'](sPeriodID,timesheet['Period']);else{timesheet['InputDate']=new Date();var fnPeriodSelectionEvent=function(sPeriod){ctrlTimesheetForm['PeriodSelectionEvent'](sPeriod,lPlacementId);};TriSysSDK['CShowForm']['addCallbackOnComboSelect'](sPeriodID,fnPeriodSelectionEvent);var sFirstPeriod=TriSysSDK['CShowForm']['GetTextFromCombo'](sPeriodID);fnPeriodSelectionEvent(sFirstPeriod,lPlacementId),TriSysSDK['CShowForm']['setDatePickerValue']('TimesheetConfigFields_InputDate',timesheet['InputDate']),TriSysSDK['CShowForm']['SetTextInCombo']('Timesheet_Type','Timesheet');}var bClientContact=![];TriSysWebJobs['Timesheet']['PopulateAmountsTable'](CTimesheetResponse['Rates'],![],!![]),TriSysWebJobs['Timesheet']['PopulateSummaryTable'](CTimesheetResponse,![],!![]);var bCanEdit=CTimesheetResponse['CanEdit'];TriSysWebJobs['Timesheet']['PopulateGrid'](CTimesheetResponse,'trisys-timesheet-hours-grid',bCanEdit);var bDisabled=!bCanEdit;$('#timesheetForm-save-button')['attr']('disabled',bDisabled),$('#timesheetForm-delete-button')['attr']('disabled',bDisabled);}else{TriSysApex['UI']['ShowMessage']('Unable\x20to\x20find\x20timesheet');return;}return!![];}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),alert('ctrlTimesheetForm.ShowTimesheetSummary:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Timesheet...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'PeriodSelectionEvent':function(sPeriod,lPlacementId){TriSysApex['UI']['ShowWait'](null,sPeriod+'...');var CTimesheetRequest={'TimesheetId':0x0,'PlacementId':lPlacementId,'Period':sPeriod},payloadObject={};payloadObject['URL']='Timesheet/Read',payloadObject['OutboundDataPacket']=CTimesheetRequest,payloadObject['InboundDataFunction']=function(CTimesheetResponse){TriSysApex['UI']['HideWait']();if(CTimesheetResponse){if(CTimesheetResponse['Success'])TriSysWebJobs['Timesheet']['PopulateGrid'](CTimesheetResponse,'trisys-timesheet-hours-grid',!![]);else TriSysApex['UI']['errorAlert'](CTimesheetResponse['ErrorMessage'],TriSysWebJobs['Constants']['ApplicationName']);}return!![];},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['ErrorHandlerRedirector']('ctrlTimesheetForm.PeriodSelectionEvent:\x20',request,status,error);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'SaveTimesheetHours':function(lTimesheetId,lPlacementId){var sPeriod=TriSysSDK['CShowForm']['GetTextFromCombo']('Timesheet_Period'),timesheetPeriodRatesHours=TriSysWebJobs['Timesheet']['ReadHoursGridData']('trisys-timesheet-hours-grid');if(!timesheetPeriodRatesHours)return;var fnCallback=function(lTimesheetId){TriSysSDK['CShowForm']['ComboEnabled']('Timesheet_Period',![]);};TriSysWebJobs['Timesheet']['SendHoursMatrixToServer'](lPlacementId,lTimesheetId,sPeriod,timesheetPeriodRatesHours,null,fnCallback);},'SetHoursAfterAction':function(hoursByDay){var elemGrid=$('#trisys-timesheet-hours-grid');for(var i=0x0;i<=0x6;i++){var dayItem=elemGrid['data']()['kendoGrid']['dataSource']['data']()[i],sDay=dayItem['period'],sDayStart=sDay['substring'](0x0,0x3),fDailyHours=0x0;for(var h=0x0;h<hoursByDay['length'];h++){var hoursByDayItem=hoursByDay[h];if(hoursByDayItem['Day']==sDayStart){fDailyHours=hoursByDayItem['Hours'];break;}}for(var propertyName in dayItem){if(propertyName['indexOf']('ID')==0x0){dayItem['set'](propertyName,fDailyHours);break;}}}},'Delete':function(){var lTimesheetId=TriSysApex['Pages']['TimesheetForm']['TimesheetId'];if(lTimesheetId<=0x0)return;var bAuthorised=TriSysSDK['CShowForm']['GetCheckBoxValue']('TimesheetConfigFields_PaymentAuthorised');if(bAuthorised){TriSysApex['UI']['ShowMessage']('You\x20are\x20not\x20permitted\x20to\x20delete\x20authorised\x20timesheets.');return;}var sMessage='Are\x20you\x20sure\x20that\x20you\x20wish\x20to\x20delete\x20timesheet:\x20'+TriSysSDK['Numbers']['Pad'](lTimesheetId,0x6)+'?',fnYes=function(){return ctrlTimesheetForm['DeleteTimesheetViaWebAPI'](lTimesheetId),!![];};TriSysApex['UI']['questionYesNo'](sMessage,'Delete\x20Timesheet','Yes',fnYes,'No');},'DeleteTimesheetViaWebAPI':function(lTimesheetId){var CDeleteTimesheetRequest={'TimesheetId':lTimesheetId},payloadObject={};payloadObject['URL']='Timesheet/Delete',payloadObject['OutboundDataPacket']=CDeleteTimesheetRequest,payloadObject['InboundDataFunction']=function(CDeleteTimesheetResponse){TriSysApex['UI']['HideWait']();if(CDeleteTimesheetResponse){if(CDeleteTimesheetResponse['Success']){TriSysApex['UI']['ShowMessage']('Timesheet\x20has\x20been\x20deleted.'),TriSysApex['FormsManager']['CloseForm']('Timesheet',![]);return;}else TriSysApex['UI']['ShowMessage'](CDeleteTimesheetResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['ErrorHandlerRedirector']('ctrlTimesheetForm.DeleteTimesheetViaWebAPI:\x20',request,status,error);},TriSysApex['UI']['ShowWait'](null,'Deleting\x20Timesheet...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'OpenAuthorisedByLink':function(){var lTimesheetId=TriSysApex['Pages']['TimesheetForm']['TimesheetId'];if(lTimesheetId<=0x0)return;var sAuthoriser=$('#TimesheetConfigFields_AuthorisedBy')['val']();if(sAuthoriser){var CReadTimesheetAuthorisationRequest={'TimesheetId':lTimesheetId},payloadObject={};payloadObject['URL']='Timesheet/ReadAuthorisation',payloadObject['OutboundDataPacket']=CReadTimesheetAuthorisationRequest,payloadObject['InboundDataFunction']=function(CReadTimesheetAuthorisationResponse){TriSysApex['UI']['HideWait']();if(CReadTimesheetAuthorisationResponse){if(CReadTimesheetAuthorisationResponse['Success']){TriSysApex['FormsManager']['OpenForm']('Contact',CReadTimesheetAuthorisationResponse['ContactId']);return;}else TriSysApex['UI']['ShowMessage'](CReadTimesheetAuthorisationResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['ErrorHandlerRedirector']('ctrlTimesheetForm.OpenAuthorisedByLink:\x20',request,status,error);},TriSysApex['UI']['ShowWait'](null,'Opening\x20Authoriser...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);}}};$(document)['ready'](function(){ctrlTimesheetForm['Load']();});