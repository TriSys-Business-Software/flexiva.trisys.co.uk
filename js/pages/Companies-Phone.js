var CompaniesPhone={'SearchTextCookieName':'CompaniesPhone-Text','Load':function(){var sText=TriSysAPI['Cookies']['getCookie'](CompaniesPhone['SearchTextCookieName']);sText&&($('#companies-form-lookup')['val'](sText),CompaniesPhone['LookupButtonClick']()),$('#companies-form-lookup')['keyup'](function(e){e['keyCode']==0xd&&CompaniesPhone['LookupButtonClick']();}),$('#companies-form-lookup-button')['click'](CompaniesPhone['LookupButtonClick']);},'LookupButtonClick':function(){var sText=$('#companies-form-lookup')['val']();TriSysAPI['Cookies']['setCookie'](CompaniesPhone['SearchTextCookieName'],sText),$('#companies-form-paged-list-container')['empty'](),CompaniesPhone['ShowFigures'](),CompaniesPhone['_CurrentPageNumber']=0x1,CompaniesPhone['WebAPISearch'](sText,CompaniesPhone['_CurrentPageNumber']);},'WebAPISearch':function(sWildcard,iPageNumber){var spinnerWait={'Div':'companies-form-paged-list-container'},CCompanySearchCriteria={'Wildcard':sWildcard,'PageNumber':iPageNumber,'RecordsPerPage':TriSysApex['UserOptions']['RecordsPerPage'](),'SortColumnName':'Company_Name','IncludeCompanyLogoURL':!![]},payloadObject={};payloadObject['URL']='Companies/Search',payloadObject['OutboundDataPacket']=CCompanySearchCriteria,payloadObject['InboundDataFunction']=function(CCompanySearchResults){TriSysSDK['Grid']['WaitSpinnerMode'](spinnerWait,![]);if(CCompanySearchResults){CompaniesPhone['ShowFigures'](CCompanySearchResults);if(CCompanySearchResults['Success'])CompaniesPhone['AppendRecordsToDOM'](CCompanySearchResults);else{}return;}TriSysApex['UI']['ShowError']('CompaniesPhone.WebAPISearch\x20Error:\x20null\x20response');},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysSDK['Grid']['WaitSpinnerMode'](spinnerWait,![]),TriSysApex['UI']['errorAlert']('CompaniesPhone.WebAPISearch:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysSDK['Grid']['WaitSpinnerMode'](spinnerWait,!![]),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'ShowFigures':function(CCompanySearchResults){var figures=$('#companies-form-lookup-figures');figures['html'](CCompanySearchResults?'No\x20records\x20found':'Searching...'),$('#companies-form-first-page-button')['hide'](),$('#companies-form-next-page-button')['hide']();if(CCompanySearchResults&&CCompanySearchResults['Success']){figures['html']('Showing\x20rows\x201\x20to\x20'+CCompanySearchResults['LastRowNumber']+'\x20of\x20'+CCompanySearchResults['TotalRecordCount']+'\x20records');if(CCompanySearchResults['LastRowNumber']>0x8)$('#companies-form-first-page-button')['show']();CompaniesPhone['_CurrentPageNumber']=CCompanySearchResults['PageNumber'];if(CCompanySearchResults['PageNumber']<CCompanySearchResults['TotalPageCount']){$('#companies-form-next-page-button')['show']();var iNextPage=parseInt(CCompanySearchResults['PageNumber'])+0x1;$('#companies-form-next-page-button-text')['html']('Next\x20Page\x20'+iNextPage+'\x20of\x20'+CCompanySearchResults['TotalPageCount']);}}},'AppendRecordsToDOM':function(CCompanySearchResults){if(CCompanySearchResults['TotalRecordCount']>0x0&&CCompanySearchResults['Companies']){for(var i=0x0;i<CCompanySearchResults['Companies']['length'];i++){var company=CCompanySearchResults['Companies'][i],sHTML=CompaniesPhone['BuildRecordFromTemplate'](company);$('#companies-form-paged-list-container')['append'](sHTML);}TriSysApex['Device']['FixTextEllipsesHack']('.truncated-companies-text');if(CompaniesPhone['_CurrentPageNumber']>0x1)setTimeout(CompaniesPhone['ScrollToBottom'],0xa);}},'BuildRecordFromTemplate':function(CCompany){var sHTML=$('#companies-form-template')['html']();sHTML=sHTML['replace']('#:CompanyId#',CCompany['CompanyId']),sHTML=sHTML['replace']('#:CompanyName#',CCompany['CompanyName']),sHTML=sHTML['replace']('#:Industry#',CCompany['Industry']),sHTML=sHTML['replace']('#:MainTelNo#',CCompany['MainTelNo']?CCompany['MainTelNo']:''),sHTML=sHTML['replace']('#:WebPage#',CCompany['WebPage']?CCompany['WebPage']:'');if(!CCompany['CompanyLogoURL'])CCompany['CompanyLogoURL']=TriSysApex['Constants']['DefaultCompanyImage'];return sHTML=sHTML['replace']('#:CompanyLogoURL#',CCompany['CompanyLogoURL']),sHTML;},'RowClick':function(thisRow){var lCompanyId=thisRow;TriSysApex['FormsManager']['OpenForm']('Company',lCompanyId,!![]);},'New':function(){TriSysApex['Pages']['CompanyForm']['NewRecord'](0x0);},'ScrollToTop':function(){$(document['body'])['scrollTop']($('#companies-form-top')['offset']()['top']-0x78);},'ScrollToBottom':function(){$(document['body'])['scrollTop']($('#companies-form-first-page-button')['offset']()['top']);},'_CurrentPageNumber':0x0,'NextPage':function(){var sText=$('#companies-form-lookup')['val']();CompaniesPhone['WebAPISearch'](sText,CompaniesPhone['_CurrentPageNumber']+0x1);}};$(document)['ready'](function(){CompaniesPhone['Load']();});