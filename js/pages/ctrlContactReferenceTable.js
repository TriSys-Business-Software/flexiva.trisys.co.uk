var ctrlContactReferenceTable={'DivId':null,'Load':function(sDivId){ctrlContactReferenceTable['DivId']=sDivId;},'LoadContactReferences':function(lContactId){var div=$('#'+ctrlContactReferenceTable['DivId']);div['empty']();var sTemplateHTML=TriSysApex['FormsManager']['getControlTemplateHTML']('ctrlContactReferenceTable.html');div['html'](sTemplateHTML),ctrlContactReferenceTable['_Data']=null;if(lContactId<=0x0)return;ctrlContactReferenceTable['GetData'](lContactId);},'GetData':function(lContactId,div){var CContactReferenceRequest={'ContactId':lContactId},payloadObject={};payloadObject['URL']='Contact/References',payloadObject['OutboundDataPacket']=CContactReferenceRequest,payloadObject['InboundDataFunction']=function(CContactReferenceResponse){if(CContactReferenceResponse){if(CContactReferenceResponse['Success']){var references=CContactReferenceResponse['References'];ctrlContactReferenceTable['_Data']=references;if(references){var sRowTemplateHTML=TriSysApex['FormsManager']['getControlTemplateHTML']('ctrlContactReferenceRecord.html');references['forEach'](function(reference,i){ctrlContactReferenceTable['LoadReference'](i+0x1,reference,sRowTemplateHTML);});}return;}else{TriSysApex['UI']['errorAlert'](CContactReferenceResponse['ErrorMessage']);return;}}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('ctrlContactReferenceTable.GetData:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'LoadReference':function(iIndex,referenceObject,sRowTemplateHTML){var sRow=sRowTemplateHTML['replace'](/{{ctrlContactReferenceRecordNumber}}/g,iIndex);sRow=sRow['replace']('{{ctrlContactReferenceRecordId}}',referenceObject['Id']),$('#'+ctrlContactReferenceTable['DivId']+'\x20table\x20>\x20tbody:last-child')['append'](sRow);var defaults={'HideFindButton':!![],'HideDeleteButton':!![],'CallbackOnlyOnDelete':!![]},bAllowDelete=![],userCredentials=TriSysApex['LoginCredentials']['UserCredentials']();if(userCredentials&&userCredentials['LoggedInUser']){var user=userCredentials['LoggedInUser'];if(TriSysApex['Cache']['UserGroupManager']['SystemAdministrator'](user['UserId']))bAllowDelete=!![];}if(bAllowDelete)defaults['HideDeleteButton']=![];var fnSelectedFile=function(sOperation,sFieldID,sFilePath){if(sOperation=='delete')ctrlContactReferenceTable['Delete'](sFieldID);};TriSysSDK['Controls']['FileReference']['Load']('ContactReference_File'+iIndex,null,fnSelectedFile,defaults),TriSysSDK['Controls']['FileReference']['SetFile']('ContactReference_File'+iIndex,referenceObject['File']);if(referenceObject['From']){var sDate=moment(new Date(referenceObject['From']))['format']('DD\x20MMM\x20YYYY');if(sDate!=='01\x20Jan\x200001')$('#ContactReference_From'+iIndex)['text'](sDate);}if(referenceObject['To']){var sDate=moment(new Date(referenceObject['To']))['format']('DD\x20MMM\x20YYYY');if(sDate!=='01\x20Jan\x200001')$('#ContactReference_To'+iIndex)['text'](sDate);}$('#ContactReference_Notes'+iIndex)['text'](referenceObject['Notes']),$('#ContactReference_EditButton'+iIndex)['off']()['on']('click',function(){ctrlContactReferenceTable['EditReference'](iIndex);});},'_Data':null,'EditReference':function(iIndex){var reference=ctrlContactReferenceTable['_Data'][iIndex-0x1];if(reference)ctrlContactReferenceTable['AddNew'](reference);},'Delete':function(sFieldID){var parts=sFieldID['split']('ContactReference_File'),iRecordNumber=parseInt(parts[0x1]),sTag='trisys-record'+iRecordNumber+'-id',sNotes=$('#ContactReference_Notes'+iRecordNumber)['text'](),iRecordId=0x0;$('#'+ctrlContactReferenceTable['DivId']+'\x20table')['find']('tr')['each'](function(){var sAttr=$(this)['attr'](sTag);if(sAttr)iRecordId=parseInt(sAttr);});if(iRecordId>0x0){var sMessage='Please\x20confirm\x20that\x20you\x20wish\x20to\x20remove\x20this\x20reference?'+'<br><br>'+sNotes;TriSysApex['UI']['questionYesNo'](sMessage,'Delete\x20Reference','Yes',function(){return setTimeout(function(){ctrlContactReferenceTable['DeleteReferenceConfirmed'](iRecordId);},0x64),!![];},'No');}},'DeleteReferenceConfirmed':function(id){var CDeleteReferenceRequest={'Id':id},payloadObject={};payloadObject['URL']='Contact/DeleteReference',payloadObject['OutboundDataPacket']=CDeleteReferenceRequest,payloadObject['InboundDataFunction']=function(CDeleteReferenceResponse){TriSysApex['UI']['HideWait']();if(CDeleteReferenceResponse){if(CDeleteReferenceResponse['Success']){TriSysSDK['References']['LoadContactReferences'](TriSysApex['Pages']['ContactForm']['ContactId']);return;}else TriSysApex['UI']['ShowMessage'](CDeleteReferenceResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlContactReferenceTable.DeleteReferenceConfirmed:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Deleting\x20Reference...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'AddNew':function(reference){var parametersObject=new TriSysApex['UI']['ShowMessageParameters']();parametersObject['Title']=(reference?'Edit':'Add')+'\x20Contact\x20Reference',parametersObject['Image']='gi-pen',parametersObject['ContentURL']=TriSysApex['Constants']['UserControlFolder']+'ctrlAddContactReference.html',parametersObject['OnLoadCallback']=function(){ctrlContactReferenceTable['LoadReferenceRecord'](reference);},parametersObject['ButtonRightText']='Cancel',parametersObject['ButtonRightVisible']=!![],parametersObject['ButtonLeftText']='Save',parametersObject['ButtonLeftVisible']=!![],parametersObject['ButtonLeftFunction']=function(){ctrlContactReferenceTable['SaveReferenceRecord'](reference);},TriSysApex['UI']['PopupMessage'](parametersObject);},'LoadReferenceRecord':function(reference){var sContactName=$('#Contact_Forenames')['val']()+'\x20'+$('#Contact_Surname')['val']();$('#ctrlAddContactReference-Contact')['val'](sContactName);var options={};TriSysSDK['Controls']['ContactLookup']['Load']('ctrlAddContactReference-Referee',options),TriSysSDK['CShowForm']['skillCombo']('ctrlAddContactReference-Type','CandidateReferenceType','Work'),TriSysSDK['CShowForm']['skillCombo']('ctrlAddContactReference-Method','CandidateReferenceMethod','Written'),TriSysSDK['Controls']['FileReference']['Load']('ctrlAddContactReference-Document'),TriSysSDK['CShowForm']['datePicker']('ctrlAddContactReference-ValidFrom'),TriSysSDK['CShowForm']['datePicker']('ctrlAddContactReference-ValidTo'),TriSysSDK['CShowForm']['datePicker']('ctrlAddContactReference-Requested'),TriSysSDK['CShowForm']['datePicker']('ctrlAddContactReference-Received');if(reference)TriSysSDK['Controls']['ContactLookup']['WriteContactId']('ctrlAddContactReference-Referee',reference['RefereeContactId'],reference['RefereeName']),TriSysSDK['Controls']['FileReference']['SetFile']('ctrlAddContactReference-Document',reference['File']),TriSysSDK['CShowForm']['setDatePickerValue']('ctrlAddContactReference-ValidFrom',reference['From']),TriSysSDK['CShowForm']['setDatePickerValue']('ctrlAddContactReference-ValidTo',reference['To']),TriSysSDK['CShowForm']['setDatePickerValue']('ctrlAddContactReference-Requested',reference['Requested']),TriSysSDK['CShowForm']['setDatePickerValue']('ctrlAddContactReference-Received',reference['Received']),TriSysSDK['CShowForm']['SetTextInCombo']('ctrlAddContactReference-Type',reference['Type']),TriSysSDK['CShowForm']['SetTextInCombo']('ctrlAddContactReference-Method',reference['Method']),$('#ctrlAddContactReference-Comments')['val'](reference['Comments']);else{if(TriSysApex['LoginCredentials']['isLoggedInToSpecificCompanyAsRecruiter']('Law\x20Absolute')){var lSelectedRefereeContactId=0x2,sName='Anonymous\x20Referee';TriSysSDK['Controls']['ContactLookup']['WriteContactId']('ctrlAddContactReference-Referee',lSelectedRefereeContactId,sName);}}setTimeout(TriSysProUI['kendoUI_Overrides'],0x3e8);},'SaveReferenceRecord':function(reference){var lSelectedRefereeContactId=TriSysSDK['Controls']['ContactLookup']['ReadContactId']('ctrlAddContactReference-Referee');if(lSelectedRefereeContactId==0x0){TriSysApex['UI']['ShowMessage']('Please\x20select\x20a\x20referee.');return;}var sFilePath=TriSysSDK['Controls']['FileReference']['GetFile']('ctrlAddContactReference-Document');if(!sFilePath){var bReportError=!![];if(TriSysApex['LoginCredentials']['isLoggedInToSpecificCompanyAsRecruiter']('Law\x20Absolute'))bReportError=![];if(bReportError){TriSysApex['UI']['ShowMessage']('Please\x20select\x20a\x20document.');return;}}var lContactId=TriSysApex['Pages']['ContactForm']['ContactId'],sType=TriSysSDK['CShowForm']['GetTextFromCombo']('ctrlAddContactReference-Type'),sMethod=TriSysSDK['CShowForm']['GetTextFromCombo']('ctrlAddContactReference-Method'),dtValidFrom=TriSysSDK['CShowForm']['getDatePickerValue']('ctrlAddContactReference-ValidFrom'),dtValidTo=TriSysSDK['CShowForm']['getDatePickerValue']('ctrlAddContactReference-ValidTo'),dtRequested=TriSysSDK['CShowForm']['getDatePickerValue']('ctrlAddContactReference-Requested'),dtReceived=TriSysSDK['CShowForm']['getDatePickerValue']('ctrlAddContactReference-Received'),sComments=$('#ctrlAddContactReference-Comments')['val'](),CAddContactReferenceRequest={'ContactId':lContactId,'RefereeId':lSelectedRefereeContactId,'FilePath':sFilePath,'Type':sType,'Method':sMethod,'ValidFrom':dtValidFrom,'ValidTo':dtValidTo,'Requested':dtRequested,'Received':dtReceived,'Comments':sComments};if(reference)CAddContactReferenceRequest['Id']=reference['Id'];ctrlContactReferenceTable['Write'](CAddContactReferenceRequest);},'Write':function(CAddContactReferenceRequest){var payloadObject={};payloadObject['URL']='Contact/AddReference',payloadObject['OutboundDataPacket']=CAddContactReferenceRequest,payloadObject['InboundDataFunction']=function(CAddContactReferenceResponse){TriSysApex['UI']['HideWait']();if(CAddContactReferenceResponse){if(CAddContactReferenceResponse['Success']){TriSysSDK['References']['LoadContactReferences'](CAddContactReferenceRequest['ContactId']),TriSysApex['UI']['CloseModalPopup']();return;}else TriSysApex['UI']['ShowMessage'](CAddContactReferenceResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlContactReferenceTable.Write:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Adding\x20Reference...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'AddRefereeContact':function(){TriSysApex['UI']['ShowMessage']('Add\x20Referee\x20Contact\x20TODO...');}};