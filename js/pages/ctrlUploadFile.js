var ctrlUploadFile={'MaximimUploadSizeMb':0x19,'Load':function(){ctrlUploadFile['CustomerSpecificUploadImage']();var cloud=$('#trisys-upload-cloud-storage-picker');cloud['on']('click',function(e){var client=filestack['init']('A70NMMP6bQx2Tl3g2sIAQz'),iMegabytes=ctrlUploadFile['MaximimUploadSizeMb'],iMaxSize=0x400*0x400*iMegabytes;TriSysApex['UI']['CloseModalPopup']();var lstService=['url','webcam','imagesearch'];try{client['pick']({'preferLinkOverStore':!![],'maxSize':iMaxSize,'maxFiles':0x1,'fromSources':lstService})['then'](function(result){if(result['filesUploaded']){if(result['filesUploaded']['length']>0x0)ctrlUploadFile['UploadFileURL'](result['filesUploaded'][0x0]);}});}catch(e){TriSysApex['Logging']['LogMessage'](TriSysApex['Logging']['CatchVariableToText'](e));}});var sThemedColour=TriSysProUI['ThemedColour']();$('#trisys-upload-dragandrophandler')['css']('border','2px\x20dotted\x20'+sThemedColour)['css']('border-radius','8px');var obj=$('#trisys-upload-dragandrophandler');obj['on']('click',function(e){$('#trisys-upload-file-picker')['focus']()['trigger']('click');}),obj['on']('dragenter',function(e){e['stopPropagation'](),e['preventDefault'](),$(this)['css']('border','2px\x20solid\x20'+sThemedColour);}),obj['on']('dragover',function(e){e['stopPropagation'](),e['preventDefault']();}),obj['on']('drop',function(e){$(this)['css']('border','2px\x20dotted\x20'+sThemedColour),e['preventDefault']();var files=e['originalEvent']['dataTransfer']['files'];ctrlUploadFile['ProcessHTMLFiles'](files);}),$('#trisys-upload-file-picker')['bind']('change',function(e){var files=this['files'];ctrlUploadFile['ProcessHTMLFiles'](files);}),TriSysPhoneGap['Enabled']()&&($('#trisys-upload-camera-block')['show'](),$('#trisys-upload-camera')['on']('click',function(e){ctrlUploadFile['TakePhotographUsingCamera']();}));},'UploadFiles':function(files){var trisysFile=files[0x0];ctrlUploadFile['UploadFile'](trisysFile);},'UploadFile':function(trisysFile){var fnCallback=function(sFile){TriSysSDK['Controls']['FileManager']['_UploadedFileRelativePath']=sFile,TriSysSDK['Controls']['FileManager']['SaveCallbackFunction'](sFile),TriSysApex['UI']['CloseModalPopup']();};TriSysSDK['Controls']['FileManager']['UploadFile'](trisysFile,fnCallback);},'UploadFileURL':function(pickedFile){var CFileUploadFileFromURLRequest={'Filename':pickedFile['filename'],'MimeType':pickedFile['mimetype'],'Size':pickedFile['size'],'URL':pickedFile['url']},payloadObject={};payloadObject['URL']='Files/UploadFileFromURL',payloadObject['OutboundDataPacket']=CFileUploadFileFromURLRequest,payloadObject['InboundDataFunction']=function(CFileUploadFileFromURLResponse){TriSysApex['UI']['HideWait']();if(CFileUploadFileFromURLResponse){if(CFileUploadFileFromURLResponse['Success']){var sFile=CFileUploadFileFromURLResponse['FolderFilePath'];TriSysSDK['Controls']['FileManager']['_UploadedFileRelativePath']=sFile,TriSysSDK['Controls']['FileManager']['SaveCallbackFunction'](sFile),ctrlUploadFile['RemoveFileAfterUpload'](pickedFile['url']);}else TriSysApex['UI']['errorAlert']('ctrlUploadFile.UploadFileURL\x20Error:\x20'+CFileUploadFileFromURLResponse['ErrorMessage']);return;}TriSysApex['UI']['ShowError']('ctrlUploadFile.UploadFileURL\x20Error:\x20null\x20response');},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlUploadFile.UploadFileURL:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Uploading\x20File...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'RemoveFileAfterUpload':function(sURL){return;var client=filestack['init']('AJAwvQkSwSIyXY5y0dmrMz'),handle=sURL['substr'](sURL['lastIndexOf']('/')+0x1);client['remove'](handle);return;var blob={'url':sURL};filepicker['remove'](blob,function(){TriSysApex['Logging']['LogMessage']('Removed'+pickedFile['url']+'\x20from\x20filepicker.io');});},'ProcessHTMLFiles':function(files){if(!files)return;if(files['length']<=0x0)return;var file=files[0x0],info=file['name'];if(file['size']>0x0){var MaxSizeInMb=ctrlUploadFile['MaximimUploadSizeMb'],iSizeOfFileInKb=file['size']/0x400,iSizeOfFileInMb=iSizeOfFileInKb/0x400,iSizeOfFileInGb=iSizeOfFileInMb/0x400;if(iSizeOfFileInMb>MaxSizeInMb){var sMessage='The\x20maximum\x20size\x20of\x20files\x20which\x20can\x20you\x20can\x20upload\x20is\x20currently\x20limited\x20to\x20'+MaxSizeInMb+'Mb.'+'<br\x20/>'+'If\x20you\x20wish\x20to\x20increase\x20this\x20limit,\x20please\x20contact\x20your\x20account\x20manager.';TriSysApex['UI']['errorAlert'](sMessage);return;}info+='\x20('+Math['ceil'](iSizeOfFileInKb)+'\x20KB)';}$('#trisys-upload-file-list')['html'](info),ctrlUploadFile['UploadFiles'](files);},'TakePhotographUsingCamera':function(){navigator['camera']['getPicture'](onSuccess,onFail,{'quality':0x64,'destinationType':Camera['DestinationType']['DATA_URL'],'correctOrientation':!![],'targetWidth':0x200,'targetHeight':0x200,'allowEdit':!![]});function onSuccess(imageData){var fnAfterSave=function(sFile){TriSysSDK['Controls']['FileManager']['_UploadedFileRelativePath']=sFile,TriSysSDK['Controls']['FileManager']['SaveCallbackFunction'](sFile),TriSysApex['UI']['CloseModalPopup']();};ctrlUploadFile['UploadPhotograph'](imageData,'.jpg',fnAfterSave);}function onFail(message){alert('Failed\x20because:\x20'+message);}},'UploadPhotograph':function(sBase64,sFileSuffix,fnCallback){var CFileStreamWriteRequest={'Base64Text':sBase64,'FileSuffix':sFileSuffix},payloadObject={};payloadObject['URL']='Files/UploadBase64Stream',payloadObject['OutboundDataPacket']=CFileStreamWriteRequest,payloadObject['InboundDataFunction']=function(CFileStreamWriteResponse){TriSysApex['UI']['HideWait']();if(CFileStreamWriteResponse){if(CFileStreamWriteResponse['Success']){fnCallback(CFileStreamWriteResponse['FilePath']);return;}else TriSysApex['UI']['ShowMessage'](CFileStreamWriteResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlUploadFile.UploadPhotograph:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Saving\x20Image...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'CustomerSpecificUploadImage':function(){if(typeof ApexCustomerModule!=TriSysApex['Constants']['Undefined']&&typeof ApexCustomerModule['UploadFileImageURL']!=TriSysApex['Constants']['Undefined'])try{var sID='trisys-upload-cloud-storage-picker',sImageHTML='<img\x20src=\x22'+ApexCustomerModule['UploadFileImageURL']+'\x22\x20id=\x22'+sID+'\x22'+'\x20style=\x22cursor:\x20pointer;\x20width:\x2064px;\x20height:\x2064px;\x22\x20title=\x22Choose\x20a\x20file\x20from\x20a\x20cloud\x20storage\x20provider.\x22>';$('#'+sID)['replaceWith'](sImageHTML);}catch(e){}}};$(document)['ready'](function(){ctrlUploadFile['Load']();});