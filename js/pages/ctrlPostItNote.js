var ctrlPostItNote={'UsersID':'ctrlPostItNote-Users','ContentID':'ctrlPostItNote-Content','TextEditID':'ctrlPostItNote-TextEdit','HideID':'ctrlPostItNote-Hide','HideAllID':'ctrlPostItNote-HideAll','ClearID':'ctrlPostItNote-Clear','ReplyID':'ctrlPostItNote-Reply','SendID':'ctrlPostItNote-Send','SnoozeID':'ctrlPostItNote-Snooze','FromLabelID':'ctrlPostItNote-FromLabel','FromID':'ctrlPostItNote-From','Separator':'\x0d\x0a\x0d\x0a-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x20-\x0d\x0a','Load':function(){var postItNote=null,currentWindow=$('#'+ctrlPostItNote['ContentID'])['closest']('[data-role=window]')['getKendoWindow']();if(currentWindow)postItNote=currentWindow['options']['content']['task'];ctrlPostItNote['LoadUserCombo'](postItNote),ctrlPostItNote['LoadPostItNote'](postItNote);var bNew=postItNote['TaskId']<=0x0;if(bNew){var textEditIDWithTaskId=ctrlPostItNote['TextEditID']+'-'+postItNote['TaskId'],sValue=postItNote['DisplayDescription']?postItNote['DisplayDescription']:'';$('#'+textEditIDWithTaskId)['val'](sValue),ctrlPostItNote['Reply'](postItNote['TaskId']);}else ctrlPostItNote['GetTaskFromDatabase'](postItNote);},'LoadUserCombo':function(postItNote){var userIDWithTaskId=ctrlPostItNote['UsersID']+'-'+postItNote['TaskId'];$('#'+ctrlPostItNote['UsersID'])['attr']('id',userIDWithTaskId),TriSysSDK['CShowForm']['MultiUserCombo'](userIDWithTaskId),TriSysSDK['CShowForm']['SetSkillsInList'](userIDWithTaskId,postItNote['SenderUserName']),ctrlPostItNote['ShowUserCombo'](postItNote['TaskId'],![]);},'ShowUserCombo':function(lTaskId,bShow){var userIDWithTaskId=ctrlPostItNote['UsersID']+'-'+lTaskId,cmb=$('#'+userIDWithTaskId)['parent']();if(bShow)TriSysSDK['CShowForm']['SetSkillsInList'](userIDWithTaskId,''),cmb['show']();else cmb['hide']();},'DisplayDescription':function(contentIDWithTaskId,sDisplay){var sDisplayHTML=sDisplay;sDisplayHTML&&(sDisplayHTML=sDisplayHTML['replace'](/\r\n/g,'<br\x20/>'),sDisplayHTML=sDisplayHTML['replace'](/\n/g,'<br\x20/>')),$('#'+contentIDWithTaskId)['html'](sDisplayHTML);},'LoadPostItNote':function(postItNote){var sDisplay=postItNote['DisplayDescription'],contentIDWithTaskId=ctrlPostItNote['ContentID']+'-'+postItNote['TaskId'];$('#'+ctrlPostItNote['ContentID'])['attr']('id',contentIDWithTaskId),ctrlPostItNote['DisplayDescription'](contentIDWithTaskId,sDisplay);var textEditIDWithTaskId=ctrlPostItNote['TextEditID']+'-'+postItNote['TaskId'];$('#'+ctrlPostItNote['TextEditID'])['attr']('id',textEditIDWithTaskId);var sReply=ctrlPostItNote['Separator']+sDisplay;$('#'+textEditIDWithTaskId)['val'](sReply);var hideIDWithTaskId=ctrlPostItNote['HideID']+'-'+postItNote['TaskId'];$('#'+ctrlPostItNote['HideID'])['attr']('id',hideIDWithTaskId),$('#'+hideIDWithTaskId)['on']('click',function(){TriSysApex['PostItNotes']['Hide'](postItNote['TaskId']);});var hideAllIDWithTaskId=ctrlPostItNote['HideAllID']+'-'+postItNote['TaskId'];$('#'+ctrlPostItNote['HideAllID'])['attr']('id',hideAllIDWithTaskId);var clearIDWithTaskId=ctrlPostItNote['ClearID']+'-'+postItNote['TaskId'];$('#'+ctrlPostItNote['ClearID'])['attr']('id',clearIDWithTaskId),$('#'+clearIDWithTaskId)['on']('click',function(){ctrlPostItNote['Clear'](postItNote['TaskId']);});var replyIDWithTaskId=ctrlPostItNote['ReplyID']+'-'+postItNote['TaskId'];$('#'+ctrlPostItNote['ReplyID'])['attr']('id',replyIDWithTaskId),$('#'+replyIDWithTaskId)['on']('click',function(){ctrlPostItNote['Reply'](postItNote['TaskId']);});var sendIDWithTaskId=ctrlPostItNote['SendID']+'-'+postItNote['TaskId'];$('#'+ctrlPostItNote['SendID'])['attr']('id',sendIDWithTaskId),$('#'+sendIDWithTaskId)['on']('click',function(){ctrlPostItNote['Send'](postItNote['TaskId']);});var snoozeIDWithTaskId=ctrlPostItNote['SnoozeID']+'-'+postItNote['TaskId'];$('#'+ctrlPostItNote['SnoozeID'])['attr']('id',snoozeIDWithTaskId),$('#'+snoozeIDWithTaskId)['on']('click',function(){ctrlPostItNote['Snooze'](postItNote['TaskId']);});var FromLabelIDWithTaskId=ctrlPostItNote['FromLabelID']+'-'+postItNote['TaskId'];$('#'+ctrlPostItNote['FromLabelID'])['attr']('id',FromLabelIDWithTaskId);var FromIDWithTaskId=ctrlPostItNote['FromID']+'-'+postItNote['TaskId'];$('#'+ctrlPostItNote['FromID'])['attr']('id',FromIDWithTaskId),$('#'+FromIDWithTaskId)['html'](postItNote['SenderUserName']);},'Clear':function(lTaskId){var CTaskClearMultipleRequest={'Tasks':[lTaskId],'PostItNote':!![]},payloadObject={};payloadObject['URL']='Task/Clear',payloadObject['OutboundDataPacket']=CTaskClearMultipleRequest,payloadObject['InboundDataFunction']=function(CTaskClearMultipleResponse){TriSysApex['UI']['HideWait']();if(CTaskClearMultipleResponse){if(CTaskClearMultipleResponse['Success']){TriSysApex['PostItNotes']['Hide'](lTaskId),TriSysApex['Toasters']['Warning']('Cleared\x20Post-It\x20Note.'),TriSysApex['ModalDialogue']['Task']['PostTaskUpdate'](null,![]);return;}else TriSysApex['UI']['ShowMessage'](CTaskClearMultipleResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['ShowMessage']('ctrlPostItNote.Clear:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Clearing\x20note...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'Reply':function(lTaskId){var FromLabelIDWithTaskId=ctrlPostItNote['FromLabelID']+'-'+lTaskId;$('#'+FromLabelIDWithTaskId)['html']('To:');var FromIDWithTaskId=ctrlPostItNote['FromID']+'-'+lTaskId,sFrom=$('#'+FromIDWithTaskId)['html']();$('#'+FromIDWithTaskId)['hide'](),ctrlPostItNote['ShowUserCombo'](lTaskId,!![]);var userIDWithTaskId=ctrlPostItNote['UsersID']+'-'+lTaskId;TriSysSDK['CShowForm']['SetSkillsInList'](userIDWithTaskId,sFrom);var contentIDWithTaskId=ctrlPostItNote['ContentID']+'-'+lTaskId;$('#'+contentIDWithTaskId)['hide']();var textEditIDWithTaskId=ctrlPostItNote['TextEditID']+'-'+lTaskId;$('#'+textEditIDWithTaskId)['show']();var sendIDWithTaskId=ctrlPostItNote['SendID']+'-'+lTaskId;$('#'+sendIDWithTaskId)['show']();var replyIDWithTaskId=ctrlPostItNote['ReplyID']+'-'+lTaskId;$('#'+replyIDWithTaskId)['hide']();var clearIDWithTaskId=ctrlPostItNote['ClearID']+'-'+lTaskId;$('#'+clearIDWithTaskId)['hide']();var snoozeIDWithTaskId=ctrlPostItNote['SnoozeID']+'-'+lTaskId;$('#'+snoozeIDWithTaskId)['hide']();var hideAllIDWithTaskId=ctrlPostItNote['HideAllID']+'-'+lTaskId;$('#'+hideAllIDWithTaskId)['hide']();var hideIDWithTaskId=ctrlPostItNote['HideID']+'-'+lTaskId;$('#'+hideIDWithTaskId)['html']('Cancel'),document['getElementById'](textEditIDWithTaskId)['focus'](),ctrlPostItNote['PositionCaretAtBeginningOfTextEdit'](textEditIDWithTaskId);},'Snooze':function(lTaskId){var fnCallback=function(){TriSysApex['PostItNotes']['Hide'](lTaskId);for(var i=TriSysApex['Alarms']['PostItNotes']['length']-0x1;i>=0x0;i--){var piNote=TriSysApex['Alarms']['PostItNotes'][i];if(piNote['TaskId']==lTaskId)TriSysApex['Alarms']['PostItNotes']['splice'](i,0x1);}TriSysApex['Alarms']['DisplayPostItNoteMetric']();};TriSysApex['Alarms']['Snooze']['Popup']([lTaskId],![],fnCallback);},'Send':function(lTaskId){var userIDWithTaskId=ctrlPostItNote['UsersID']+'-'+lTaskId,userList=TriSysSDK['CShowForm']['GetSelectedSkillsFromList'](userIDWithTaskId);if(!userList){TriSysApex['UI']['ShowMessage']('Please\x20choose\x20one\x20or\x20more\x20users\x20to\x20send\x20to.');return;}var textEditIDWithTaskId=ctrlPostItNote['TextEditID']+'-'+lTaskId,sText=$('#'+textEditIDWithTaskId)['val']();if(!sText){TriSysApex['UI']['ShowMessage']('Please\x20enter\x20some\x20text.');return;}ctrlPostItNote['SendToWebAPI'](lTaskId,userList,sText);},'SendToWebAPI':function(lTaskId,userList,sText){var CPostItNoteRequest={'TaskId':lTaskId,'Recipients':userList,'Text':sText},payloadObject={};payloadObject['URL']='Task/PostItNote',payloadObject['OutboundDataPacket']=CPostItNoteRequest,payloadObject['InboundDataFunction']=function(CPostItNoteResponse){TriSysApex['UI']['HideWait']();if(CPostItNoteResponse){if(CPostItNoteResponse['Success']){TriSysApex['PostItNotes']['Hide'](lTaskId),TriSysApex['Toasters']['Warning']('Sent\x20Post-It\x20Note.'),TriSysApex['ModalDialogue']['Task']['PostTaskUpdate'](null,![]),lTaskId=CPostItNoteResponse['TaskId'],ctrlPostItNote['InformAllRecipients'](lTaskId,userList);return;}else TriSysApex['UI']['ShowMessage'](CPostItNoteResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['ShowMessage']('ctrlPostItNote.SendToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Sending\x20Note...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'PositionCaretAtBeginningOfTextEdit':function(sID){!HTMLInputElement['prototype']['setSelectionRange']&&(HTMLInputElement['prototype']['setSelectionRange']=function(start,end){if(this['createTextRange']){var range=this['createTextRange']();this['collapse'](!![]),this['moveEnd']('character',start),this['moveStart']('character',end),this['select']();}}),$('#'+sID)['scrollTop'](0x0),document['getElementById'](sID)['setSelectionRange'](0x0,0x0);},'InformAllRecipients':function(lTaskId,userFullNames){var taskObject={'TaskId':lTaskId,'Type':TriSysApex['SignalR']['Communication']['MessageType']['TaskUpdate']},sJSON=JSON['stringify'](taskObject),userList=userFullNames['split'](',');for(var i=0x0;i<userList['length'];i++){var sUserFullName=userList[i]['trim'](),user=TriSysApex['Cache']['UsersManager']['UserFromFullName'](sUserFullName);if(user){var sRecipientLoginName=user['LoginName'];TriSysApex['SignalR']['Communication']['Send'](sRecipientLoginName,sJSON);}}},'GetTaskFromDatabase':function(postItNote){var dataPacket={'TaskId':postItNote['TaskId']},payloadObject={};payloadObject['URL']='Task/Read',payloadObject['OutboundDataPacket']=dataPacket,payloadObject['InboundDataFunction']=function(CTaskReadResponse){if(CTaskReadResponse){if(CTaskReadResponse['Success']){var task=CTaskReadResponse['Task'],contentIDWithTaskId=ctrlPostItNote['ContentID']+'-'+postItNote['TaskId'];ctrlPostItNote['DisplayDescription'](contentIDWithTaskId,task['Description']);var textEditIDWithTaskId=ctrlPostItNote['TextEditID']+'-'+postItNote['TaskId'],sDisplay=task['Description'];sDisplay=ctrlPostItNote['Separator']+sDisplay,$('#'+textEditIDWithTaskId)['val'](sDisplay);return;}}},TriSysAPI['Data']['PostToWebAPI'](payloadObject);}};$(document)['ready'](function(){ctrlPostItNote['Load']();});