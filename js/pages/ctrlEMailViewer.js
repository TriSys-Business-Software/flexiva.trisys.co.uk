var ctrlEMailViewer={'Load':function(CConvertMSGtoHTMLResponse,sGDrivePath){var sPrefix='#ctrlEMailViewer-';$('#ctrlEMailView-Header')['off']()['on']('click',function(){TriSysSDK['Blocks']['toggleBlockSize']($(this),'ctrlEMailView-EMail-Header'),ctrlEMailViewer['ResizeIframe']();});var topBlock=$('#ctrlEMailView-EMail-Header-Block');topBlock['css']('background-color',TriSysProUI['GroupBackColour']()),topBlock['parent']()['css']('overflow-y','hidden');var sDate=moment(CConvertMSGtoHTMLResponse['EMail']['DateSent'])['format']('dddd\x20DD\x20MMMM\x20YYYY\x20@\x20HH:mm');$(sPrefix+'Date')['text'](sDate),$(sPrefix+'Subject')['text'](CConvertMSGtoHTMLResponse['EMail']['Subject']),$('#ctrlEMailView-HeaderText')['html']('<strong>'+CConvertMSGtoHTMLResponse['EMail']['Subject']+'</strong>'),$('#ctrlEMailView-HeaderText-FarRight')['text'](sDate),$(sPrefix+'From')['text'](CConvertMSGtoHTMLResponse['EMail']['Sender']);if(CConvertMSGtoHTMLResponse['EMail']['Attachments']){for(var i=0x0;i<CConvertMSGtoHTMLResponse['EMail']['Attachments']['length'];i++){var sAttachment=CConvertMSGtoHTMLResponse['EMail']['Attachments'][i],sHTML='<a\x20href=\x22javascript:void(0)\x22\x20class=\x22btn\x20btn-alt\x20btn-sm\x20btn-default\x22'+'\x20\x20style=\x22height:\x2028px;\x20margin-bottom:\x2010px;\x20margin-right:\x2010px;\x20padding-top:\x203px;\x20padding-left:\x2010px;\x20padding-right:\x2010px;\x22'+'\x20\x20\x20onclick=\x22ctrlEMailViewer.OpenAttachment(\x27'+sAttachment+'\x27,\x20\x27'+ctrlEMailViewer['ServerfyPath'](sGDrivePath)+'\x27)\x22>'+'\x20\x20\x20\x20<img\x20src=\x22'+TriSysSDK['Controls']['FileManager']['ImagePath'](sAttachment)+'\x22\x20style=\x22width:\x2020px;\x20height:\x2020px;\x22\x20alt=\x22File\x20Image\x22>'+'\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20&nbsp;\x20'+sAttachment+'</a>';$(sPrefix+'Attachments')['append'](sHTML);}if(CConvertMSGtoHTMLResponse['EMail']['Attachments']['length']==0x0)$(sPrefix+'Attachments-tr')['hide']();}if(CConvertMSGtoHTMLResponse['EMail']['ToRecipients']){var sTo='';for(var i=0x0;i<CConvertMSGtoHTMLResponse['EMail']['ToRecipients']['length'];i++){if(i>0x0)sTo+=';\x20';sTo+=CConvertMSGtoHTMLResponse['EMail']['ToRecipients'][i];}$(sPrefix+'To')['text'](sTo);}if(CConvertMSGtoHTMLResponse['EMail']['CcRecipients']){var sTo='';for(var i=0x0;i<CConvertMSGtoHTMLResponse['EMail']['CcRecipients']['length'];i++){if(i>0x0)sTo+=';\x20';sTo+=CConvertMSGtoHTMLResponse['EMail']['CcRecipients'][i];}$(sPrefix+'Cc')['text'](sTo);}if(CConvertMSGtoHTMLResponse['EMail']['BccRecipients']){var sTo='';for(var i=0x0;i<CConvertMSGtoHTMLResponse['EMail']['BccRecipients']['length'];i++){if(i>0x0)sTo+=';\x20';sTo+=CConvertMSGtoHTMLResponse['EMail']['BccRecipients'][i];}$(sPrefix+'Bcc')['text'](sTo);}var src='ctrlEMailViewer-iFrame',elem=$('#'+src);elem['attr']('src',CConvertMSGtoHTMLResponse['URL']),ctrlEMailViewer['ResizeIframe']();},'OpenAttachment':function(sAttachment,sGDrivePath){sGDrivePath=ctrlEMailViewer['ClientifyPath'](sGDrivePath);var payloadObject={};payloadObject['URL']='Files/ReadMSGAttachment',payloadObject['OutboundDataPacket']={'FilePath':sGDrivePath,'Attachment':sAttachment},payloadObject['InboundDataFunction']=function(CReadMSGAttachmentResponse){TriSysApex['UI']['HideWait']();if(CReadMSGAttachmentResponse){if(CReadMSGAttachmentResponse['Success']){if(CReadMSGAttachmentResponse['URL'])TriSysSDK['Browser']['OpenURL'](CReadMSGAttachmentResponse['URL']);}else TriSysApex['UI']['ShowMessage'](CReadMSGAttachmentResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlEMailViewer.OpenAttachment:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Attachment...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'ResizeIframe':function(){var src='ctrlEMailViewer-iFrame',elem=$('#'+src),lHeight=$(window)['height'](),iHeaderHeight=0x28+($('#ctrlEMailView-EMail-Header')['css']('display')=='none'?0x0:$('#ctrlEMailView-EMail-Header')['height']()),iConstant=0x140,iFrameHeight=lHeight-iConstant-iHeaderHeight;elem['height'](iFrameHeight);},'ServerfyPath':function(sWindowsPath){return sWindowsPath=sWindowsPath['replace'](/\\/g,'/'),sWindowsPath;},'ClientifyPath':function(sURL){return sURL=sURL['replace'](/\//g,'\x5c'),sURL;}};