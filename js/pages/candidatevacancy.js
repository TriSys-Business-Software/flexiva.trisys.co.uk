var CandidateVacancy={'LoadFromURL':function(sParameters){TriSysWebJobs['Vacancies']['RequirementId']=TriSysApex['Pages']['Controller']['ParseLoadRecordURLParameter'](sParameters,0x0,!![]),CandidateVacancy['Load'](TriSysWebJobs['Vacancies']['RequirementId']);},'Load':function(lRequirementId){$('#webjobs-customer-name')['html'](TriSysWebJobs['Agency']['CustomerName']),CandidateVacancy['ShowVacancySummary'](lRequirementId),TriSysWebJobs['Frame']['ApplyDynamicFeaturesAndStyleAfterFormLoaded']();},'ShowVacancySummary':function(lRequirementId){$('#trisys-api-results')['html']('Authenticated.');var CVacancySummaryRequest={'RequirementId':lRequirementId},payloadObject={};payloadObject['URL']='Vacancy/Summary',payloadObject['OutboundDataPacket']=CVacancySummaryRequest,payloadObject['InboundDataFunction']=function(CVacancySummaryResponse){TriSysApex['UI']['HideWait']();if(CVacancySummaryResponse['Success']){var sDisplay=JSON['stringify'](CVacancySummaryResponse);$('#trisys-api-results')['html'](sDisplay),$('#trisys-vacancy-reference')['html'](CVacancySummaryResponse['Reference']),$('#trisys-vacancy-type')['html'](CVacancySummaryResponse['Type']),$('#trisys-vacancy-jobtitle')['html'](CVacancySummaryResponse['JobTitle']),$('#trisys-vacancy-location')['html'](CVacancySummaryResponse['Location']);var sSummary=CVacancySummaryResponse['Reference']+'\x20&bull;\x20'+CVacancySummaryResponse['JobTitle']+'\x20&bull;\x20'+CVacancySummaryResponse['Location'];$('#trisys-vacancy-summary')['html'](sSummary);var sDescription=CVacancySummaryResponse['JobDescription'];if(sDescription)sDescription=sDescription['split']('\x0a')['join']('<br\x20/>');var sPayType='Rate',sRemuneration=CVacancySummaryResponse['PayRateSummary'];CVacancySummaryResponse['Type']=='Permanent'?(sPayType='Salary',sRemuneration=CVacancySummaryResponse['MaximumSalaryRate']):($('#trisys-vacancy-durationweeks-group')['show'](),$('#trisys-vacancy-durationweeks')['html'](CVacancySummaryResponse['DurationInWeeks']));if(sRemuneration)sRemuneration=sRemuneration['replace'](/\n/g,'<br\x20/>');$('#trisys-vacancy-remunerationtype')['html'](sPayType),$('#trisys-vacancy-remuneration')['html'](sRemuneration);if(CVacancySummaryResponse['StartDate']){var sStartDate=moment(CVacancySummaryResponse['StartDate'])['format']('dddd\x20DD\x20MMMM\x20YYYY');$('#trisys-vacancy-startdate')['html'](sStartDate);}$('#trisys-vacancy-jobdescription')['html'](sDescription),$('#trisys-vacancy-username')['html'](CVacancySummaryResponse['UserName']),fnGetUser(CVacancySummaryResponse['UserId'],CVacancySummaryResponse['Reference'],CVacancySummaryResponse['JobTitle']);if(CVacancySummaryResponse['Shortlisted'])$('#CandidateVacancy-Menu-Apply')['addClass']('disabled');if(CVacancySummaryResponse['Favourited'])$('#CandidateVacancy-Menu-AddToFavourites')['addClass']('disabled');CandidateVacancy['DisplaySimilarVacancies'](CVacancySummaryResponse['UserId'],CVacancySummaryResponse['JobTitle']);if(CVacancySummaryResponse['Custom']&&CVacancySummaryResponse['Custom']['HealthAndSafety']){var sHealthAndSafety=CVacancySummaryResponse['Custom']['HealthAndSafety'];if(sHealthAndSafety)sHealthAndSafety=sHealthAndSafety['split']('\x0a')['join']('<br\x20/>');$('#trisys-vacancy-health-and-safety')['html'](sHealthAndSafety);}return!![];}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),alert('CandidateVacancy.ShowVacancySummary:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Vacancy...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);var fnGetUser=function(lUserId,sReference,sJobTitle){if(lUserId>0x0){var CReadUserAccountRequest={'UserId':lUserId},payloadObject={};payloadObject['URL']='Users/ReadUserAccount',payloadObject['OutboundDataPacket']=CReadUserAccountRequest,payloadObject['InboundDataFunction']=function(CReadUserAccountResponse){TriSysApex['UI']['HideWait']();var user=CReadUserAccountResponse['UserAccount'];if(user){var contact=user['Contact'];if(contact){$('#trisys-vacancy-user-name')['html'](contact['FullName']),$('#trisys-vacancy-user-company')['html'](contact['CompanyName']),$('#trisys-vacancy-user-jobtitle')['html'](contact['JobTitle']),$('#trisys-vacancy-user-worktelno')['html'](contact['WorkTelNo']),$('#trisys-vacancy-user-mobiletelno')['html'](contact['WorkMobileTelNo']);if(user['Photo'])$('#trisys-vacancy-userphoto')['attr']('src',user['Photo'])['show']();$('#trisys-vacancy-user-email')['attr']('href','mailto:'+contact['WorkEMail']+'?subject='+sReference+':\x20'+sJobTitle),$('#trisys-vacancy-user-email')['html'](contact['WorkEMail']),$('#trisys-vacancy-similar')['html'](contact['Forenames']+'\x27s');var elemLinkedIn=$('#trisys-vacancy-user-linkedin');if(elemLinkedIn&&contact['LinkedIn'])elemLinkedIn['attr']('href',contact['LinkedIn']);return!![];}}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),alert('CandidateVacancy.ShowVacancySummary.fnGetUser:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Contact\x20Details...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);}};},'Apply':function(){var lRequirementId=TriSysWebJobs['Vacancies']['RequirementId'];if(!lRequirementId||lRequirementId<=0x0)return;var lstRequirementId=[lRequirementId],sReference=$('#trisys-vacancy-reference')['html'](),sJobTitle=$('#trisys-vacancy-jobtitle')['html']();TriSysWebJobs['VacancyApplications']['ApplyToMultipleVacancies'](lstRequirementId,sReference,sJobTitle);},'AddToFavourites':function(){TriSysWebJobs['Vacancies']['AddToFavourites'](null,TriSysWebJobs['Vacancies']['AfterAddToFavourite'],TriSysWebJobs['Vacancies']['RequirementId']);},'RemoveFromFavourites':function(){TriSysApex['UI']['ShowMessage']('RemoveFromFavourites');},'SendToFriend':function(){var lRequirementId=TriSysWebJobs['Vacancies']['RequirementId'];if(!lRequirementId||lRequirementId<=0x0)return;var lstRequirementId=[lRequirementId],sReference=$('#trisys-vacancy-reference')['html'](),sJobTitle=$('#trisys-vacancy-jobtitle')['html']();TriSysWebJobs['Vacancies']['SendMultipleVacanciesToFriend'](lstRequirementId,sReference,sJobTitle);},'DisplaySimilarVacancies':function(lUserId,sJobTitle){var CVacancySearchCriteria={'PageNumber':0x1,'RecordsPerPage':TriSysApex['UserOptions']['RecordsPerPage'](),'Status':'Active','SortColumnName':'StartDate','SortAscending':![]},bMatchUserId=!![];if(bMatchUserId)CVacancySearchCriteria['UserId']=lUserId;else CVacancySearchCriteria['JobTitle']=sJobTitle;var payloadObject={};payloadObject['URL']='Vacancies/Search',payloadObject['OutboundDataPacket']=CVacancySearchCriteria,payloadObject['InboundDataFunction']=function(CVacancySearchResponse){return CandidateVacancy['RenderSimilarVacancies'](CVacancySearchResponse['Vacancies']),!![];},payloadObject['ErrorHandlerFunction']=function(request,status,error){console['log']('CandidateVacancy.DisplaySimilarVacancies\x20:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'RenderSimilarVacancies':function(vacancies){var vacancyData=[];for(var i=0x0;i<vacancies['length'];i++){var vacancy=vacancies[i],sStartDate=moment(vacancy['StartDate'])['format']('dddd\x20DD\x20MMMM\x20YYYY'),vacancyObject={'RequirementId':vacancy['RequirementId'],'Reference':vacancy['Reference'],'JobTitle':vacancy['JobTitle'],'Location':vacancy['Location'],'SalaryRate':vacancy['Salary'],'StartDate':sStartDate,'Permanent':vacancy['Permanent'],'Contract':vacancy['Contract'],'Temporary':vacancy['Temp'],'DateFavourited':vacancy['DateFavourited'],'DateShortlisted':vacancy['DateShortlisted']};vacancyData['push'](vacancyObject);}var directives={'hyperlink':{'onclick':function(params){return'TriSysWebJobs.Vacancies.DrillIntoRequirement('+this['RequirementId']+')';}},'Type':{'text':function(params){var sType='Temp';if(this['Permanent'])sType='Perm';else{if(this['Contract'])sType='Contract';}return sType;},'class':function(params){var sLabel='label\x20label-';if(this['Permanent'])sLabel+='info';else{if(this['Contract'])sLabel+='danger';else{if(this['Temporary'])sLabel+='warning';}}return sLabel;}}};$('.similar-vacancies')['render'](vacancyData,directives);},'ViewAllLiveVacancies':function(){TriSysApex['FormsManager']['OpenForm'](TriSysWebJobs['Constants']['CandidateVacancySearchForm'],0x0,!![]);}};