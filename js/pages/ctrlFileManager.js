var ctrlFileManager={'CanvasID':'ctrlFileManager-Canvas','FolderType':'CFolder','_Instances':{'List':[],'Add':function(sID,instance){for(var i=ctrlFileManager['_Instances']['List']['length']-0x1;i>=0x0;i--){var anInstance=ctrlFileManager['_Instances']['List'][i];if(anInstance['ID']==sID)ctrlFileManager['_Instances']['List']['splice'](i,0x1);}var myInstance={'ID':sID,'Instance':instance};ctrlFileManager['_Instances']['List']['push'](myInstance);},'Get':function(sID){var myInstance=null;return ctrlFileManager['_Instances']['List']['forEach'](function(anInstance){if(anInstance['ID']==sID)myInstance=anInstance['Instance'];}),myInstance;}},'Load':function(sID,instance){ctrlFileManager['_Instances']['Add'](sID,instance);var sSuffix='-'+sID,sFolderTreeID=sID;$('#'+ctrlFileManager['CanvasID'])['attr']('id',sFolderTreeID),ctrlFileManager['LoadFolders'](sFolderTreeID),setTimeout(function(){ctrlFileManager['DragAndDropFileHandler'](sFolderTreeID);},0x3e8);},'LoadFolders':function(sFolderTreeID){var fnAfterInitialTreePopulation=function(sFolder){var myInstance=ctrlFileManager['_Instances']['Get'](sFolderTreeID);ctrlFileManager['AfterInitialTreePopulation'](sFolder,sFolderTreeID,myInstance);};ctrlFileManager['_FolderPopulatedCallbacks']['push'](fnAfterInitialTreePopulation),ctrlFileManager['TriSysWebAPIPopulation'](sFolderTreeID);},'AfterInitialTreePopulation':function(sFolder,sFolderTreeID,myInstance){myInstance&&myInstance['AutoSelectFilePath']&&ctrlFileManager['SelectTreeNodeWithFilePath'](sFolderTreeID,myInstance['AutoSelectFilePath'],{'ForceLoad':!![],'ExpandNode':myInstance['AutoSelectAndExpandFolder']});},'TriSysWebAPIPopulation':function(sTreeID){var myInstance=ctrlFileManager['_Instances']['Get'](sTreeID),homogeneous=new kendo['data']['HierarchicalDataSource']({'transport':{'read':function(options){var sFolder=options['data']['FullPath'];if(!sFolder){var gDriveFolders=[{'Name':myInstance['RootPathForTreeView'],'FullPath':myInstance['RootPathForTreeView'],'TreeViewType':ctrlFileManager['FolderType'],'SubFolders':['to\x20be\x20dynamically\x20loaded'],'spriteCssClass':'rootfolder'}];options['success'](gDriveFolders);var fnForceExpansion=function(){var treeView=$('#'+sTreeID)['data']('kendoTreeView');treeView['select']('.k-first'),treeView['expand']('.k-item');};setTimeout(fnForceExpansion,0x64);return;}else{if(sFolder==myInstance['RootPathForTreeView'])sFolder=null;}var bRecursive=!![],dataPacket={'RootFolder':sFolder,'Recursion':bRecursive,'RecursionDepth':0x1},payloadObject={};payloadObject['URL']=myInstance['WebAPIFunction'],payloadObject['OutboundDataPacket']=dataPacket,payloadObject['InboundDataFunction']=function(CFolders){if(CFolders){if(CFolders['Success']){var sRootDrive=CFolders['RootDriveLetter'];if(sRootDrive)ctrlFileManager['SetRootText'](sTreeID,sRootDrive);var items=[];CFolders['Folders']&&CFolders['Folders']['forEach'](function(folder){folder['spriteCssClass']='folder',items['push'](folder);}),CFolders['Files']&&CFolders['Files']['forEach'](function(file){file['spriteCssClass']='file';var sSuffix=TriSysApex['Pages']['FileManagerForm']['FileSuffix'](file['FullPath']);if(sSuffix)switch(sSuffix['toLowerCase']()){case'html':case'pdf':case'txt':case'json':case'js':file['spriteCssClass']=sSuffix;break;case'form':file['spriteCssClass']='json';break;case'gif':case'jpg':case'jpeg':case'png':file['spriteCssClass']='image';break;case'doc':case'docx':case'dot':case'dotx':file['spriteCssClass']='word';break;case'xls':case'xlsx':case'csv':file['spriteCssClass']='excel';break;case'mp4':case'mov':case'mpg':case'mpeg':case'avi':file['spriteCssClass']='movie';break;}items['push'](file);}),options['success'](items),ctrlFileManager['FolderPopulated'](sFolder);}}return!![];},payloadObject['ErrorHandlerFunction']=function(request,status,error){options['error'](status);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);}},'schema':{'model':{'id':'FullPath','hasChildren':function(folder){var bFolders=folder['SubFolders'];return bFolders;}}}}),fnSelectFolderFromDataItem=function(sTreeID,dataItem){var sFullPath=dataItem['FullPath'],myInstance=ctrlFileManager['_Instances']['Get'](sTreeID);if(!myInstance)return;var sDisplayPath=sFullPath==myInstance['RootPathForTreeView']?'':sFullPath;if(myInstance['FileSelectionCallback']&&!dataItem['hasChildren'])myInstance['FileSelectionCallback'](sDisplayPath);},fnSelectFolder=function(e,thisThing,sTreeID){var dataItem=thisThing['dataItem'](e['node']);if(!dataItem)return;fnSelectFolderFromDataItem(sTreeID,dataItem);},fnExpandFolder=function(e,thisThing,sTreeID){var expandedNode=e['node'];thisThing['select'](expandedNode);var dataItem=thisThing['dataItem'](expandedNode);if(!dataItem)return;fnSelectFolderFromDataItem(sTreeID,dataItem);};$('#'+sTreeID)['kendoTreeView']({'loadOnDemand':!![],'dataSource':homogeneous,'dataTextField':'Name','select':function(e){fnSelectFolder(e,this,sTreeID);},'expand':function(e){fnExpandFolder(e,this,sTreeID);}});},'GetRootText':function(sFolderTreeID){var treeView=$('#'+sFolderTreeID)['data']('kendoTreeView'),sText=treeView['text']('.k-item:first');return sText;},'SetRootText':function(sFolderTreeID,sText){var treeView=$('#'+sFolderTreeID)['data']('kendoTreeView');treeView['text']('.k-item:first',sText);},'FolderPopulated':function(sFolder){var iCallbackIndex=0x0;ctrlFileManager['_FolderPopulatedCallbacks']['forEach'](function(fnCallback){fnCallback(sFolder),ctrlFileManager['_FolderPopulatedCallbacks']['splice'](0x0,0x1),iCallbackIndex+=0x1;});},'_FolderPopulatedCallbacks':[],'SelectTreeNodeWithFilePath':function(sFolderTreeID,sFilePath,options){var bForceLoad=![],bExpandNode=![],bFireFileSelectionCallback=!![];if(options){bForceLoad=options['ForceLoad'],bExpandNode=options['ExpandNode'];if(!TriSysAPI['Operators']['isEmpty'](options['FireFileSelectionCallback']))bFireFileSelectionCallback=options['FireFileSelectionCallback'];}var treeView=$('#'+sFolderTreeID)['data']('kendoTreeView'),dataitem=treeView['dataSource']['get'](sFilePath);if(dataitem){var node=treeView['findByUid'](dataitem['uid']);if(node){treeView['select'](node);if(bExpandNode)treeView['expand'](node);else{if(!dataitem['hasChildren']&&bFireFileSelectionCallback){var myInstance=ctrlFileManager['_Instances']['Get'](sFolderTreeID);if(myInstance&&myInstance['FileSelectionCallback'])myInstance['FileSelectionCallback'](sFilePath);}}return;}}bForceLoad&&ctrlFileManager['DynamicallyLoadTreeUntilFileFound'](sFolderTreeID,sFilePath,bExpandNode);},'DynamicallyLoadTreeUntilFileFound':function(sFolderTreeID,sFilePath,bExpandNode){var sFolderSeparator='\x5c',parts=sFilePath['split'](sFolderSeparator),sRootFolder=parts[0x0]+sFolderSeparator+parts[0x1];for(var i=0x2;i<parts['length'];i++){sRootFolder+=sFolderSeparator+parts[i];var bFoundFolder=ctrlFileManager['isFilePathInFolder'](sFolderTreeID,sRootFolder);if(bFoundFolder)break;}ctrlFileManager['ForcedRecursionToFocusOnPath'](sFolderTreeID,sRootFolder,sFilePath,bExpandNode);},'ForcedRecursionToFocusOnPath':function(sFolderTreeID,sRootFolder,sPath,bExpandNode){var sSelectedPath=ctrlFileManager['GetSelectedPath'](sFolderTreeID);if(sSelectedPath!==sPath){var sFolderSeparator='\x5c';if(sSelectedPath==sRootFolder){var sToTraversePath=sPath['replace'](sRootFolder+sFolderSeparator,''),parts=sToTraversePath['split'](sFolderSeparator);sRootFolder+=sFolderSeparator+parts[0x0];}var fnFocusOnSpecificFilePathOrFolder=function(sFolderPath){ctrlFileManager['SelectTreeNodeWithFilePath'](sFolderTreeID,sPath,{'ForceLoad':![],'ExpandNode':bExpandNode}),setTimeout(function(){ctrlFileManager['ForcedRecursionToFocusOnPath'](sFolderTreeID,sRootFolder,sPath,bExpandNode);},0x1f4);};ctrlFileManager['_FolderPopulatedCallbacks']['push'](fnFocusOnSpecificFilePathOrFolder);var bForceLoad=![],bExpand=!![];ctrlFileManager['SelectTreeNodeWithFilePath'](sFolderTreeID,sRootFolder,{'ForceLoad':bForceLoad,'ExpandNode':bExpand});}},'isFilePathInFolder':function(sFolderTreeID,sFilePath){var bFileFound=![],treeView=$('#'+sFolderTreeID)['data']('kendoTreeView'),dataitem=treeView['dataSource']['get'](sFilePath);if(dataitem){var node=treeView['findByUid'](dataitem['uid']);if(node)bFileFound=!![];}return bFileFound;},'GetSelectedFileOrFolderPath':function(sFolderTreeID){var treeView=$('#'+sFolderTreeID)['data']('kendoTreeView'),selectedNode=treeView['select']();if(selectedNode){var dataItem=treeView['dataItem'](selectedNode);if(dataItem){var sPath=dataItem['FullPath'],sType=dataItem['TreeViewType'],pathObject={'FullPath':sPath,'Folder':sType==ctrlFileManager['FolderType']};return pathObject;}}},'GetSelectedFolderPath':function(sFolderTreeID){var pathObject=ctrlFileManager['GetSelectedFileOrFolderPath'](sFolderTreeID);if(pathObject&&pathObject['Folder'])return pathObject['FullPath'];},'GetSelectedFilePath':function(sFolderTreeID,bShowMessageIfNotFound){var pathObject=ctrlFileManager['GetSelectedFileOrFolderPath'](sFolderTreeID);if(pathObject&&!pathObject['Folder'])return pathObject['FullPath'];if(bShowMessageIfNotFound)TriSysApex['UI']['ShowMessage']('No\x20file\x20selected.');},'GetSelectedPath':function(sFolderTreeID){var pathObject=ctrlFileManager['GetSelectedFileOrFolderPath'](sFolderTreeID);if(pathObject)return pathObject['FullPath'];},'GetSelectedNodeDataItemTreeViewType':function(sFolderTreeID){var treeView=$('#'+sFolderTreeID)['data']('kendoTreeView'),selectedNode=treeView['select']();if(selectedNode){var dataItem=treeView['dataItem'](selectedNode);if(dataItem){var sType=dataItem['TreeViewType'];return sType;}}},'GetSelectedNodeText':function(sFolderTreeID){var treeView=$('#'+sFolderTreeID)['data']('kendoTreeView'),selectedNode=treeView['select']();if(selectedNode){var dataItem=treeView['dataItem'](selectedNode);if(dataItem){var sName=dataItem['Name'];return sName;}}},'GetSelectedFolder':function(sFolderTreeID,bRemoveTrailingSlash,bParentFolderIfFileSelected){var sFolderPath=ctrlFileManager['GetSelectedFolderPath'](sFolderTreeID);if(!sFolderPath){if(bParentFolderIfFileSelected){var sFilePath=ctrlFileManager['GetSelectedFilePath'](sFolderTreeID),sParentFolder=TriSysSDK['Controls']['FileManager']['GetFolderPathFromFile'](sFilePath,'\x5c');sFolderPath=sParentFolder;}}if(sFolderPath){if(bRemoveTrailingSlash){if(sFolderPath['lastIndexOf']('\x5c')==sFolderPath['length']-0x1)sFolderPath=sFolderPath['substring'](0x0,sFolderPath['length']-0x1);}}return sFolderPath;},'GetSelectedFolderText':function(sFolderTreeID){var sFolderPath=ctrlFileManager['GetSelectedFolder'](sFolderTreeID);if(sFolderPath){var sName=ctrlFileManager['GetSelectedNodeText'](sFolderTreeID);return sName;}},'DragAndDropFileHandler':function(sFolderTreeID){var obj=$('#'+sFolderTreeID);obj['on']('dragenter',function(e){e['stopPropagation'](),e['preventDefault']();}),obj['on']('dragover',function(e){e['stopPropagation'](),e['preventDefault']();}),obj['on']('drop',function(e){e['preventDefault']();var fileCollection=e['originalEvent']['dataTransfer']['files'],lstFiles=[];for(var i=0x0;i<fileCollection['length'];i++){var sFilePath=fileCollection[i];lstFiles['push'](sFilePath);}ctrlFileManager['PopDraggedFilesOffStackAndUpload'](lstFiles,sFolderTreeID);});},'PopDraggedFilesOffStackAndUpload':function(lstFiles,sFolderTreeID){if(!lstFiles)return;if(lstFiles['length']==0x0)return;var sCopyToFolder=ctrlFileManager['GetSelectedFolder'](sFolderTreeID);if(!sCopyToFolder){var sSelectedFile=ctrlFileManager['GetSelectedFilePath'](sFolderTreeID,![]);if(sSelectedFile)sCopyToFolder=TriSysSDK['Controls']['FileManager']['GetFolderPathFromFile'](sSelectedFile,'\x5c');}if(!sCopyToFolder)return;var myInstance=ctrlFileManager['_Instances']['Get'](sFolderTreeID);if(myInstance['FileDragDropCallback'])myInstance['FileDragDropCallback'](lstFiles,sCopyToFolder);}};