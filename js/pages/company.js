var companyForm={'Load':function(){TriSysSDK['EntityFormTabs']['AddClickEventHandlers']('company-form-tab-nav-horizontal',!![]);var hideMenuItemPrefixes=['file-menu-saveas'];if(TriSysApex['Device']['isPhone']())$('#companyForm-ActionsMenu')['hide'](),$('#companyAddressesActionsMenu')['hide'](),$('#companyRequirementsActionsMenu')['hide'](),$('#companyPlacementsActionsMenu')['hide']();else{var sCallbackFunction='companyForm.ActionInvocation';TriSysActions['Menus']['Draw']('companyForm-ActionsMenu','Company',sCallbackFunction),TriSysActions['Menus']['Draw']('companyAddressesActionsMenu','Contact',sCallbackFunction),TriSysActions['Menus']['Draw']('companyRequirementsActionsMenu','Requirement',sCallbackFunction),TriSysActions['Menus']['Draw']('companyPlacementsActionsMenu','Placement',sCallbackFunction);const fnResizeActionsMenus=function(){$('#companyForm-ActionsMenu\x20.dropdown-menu.dropdown-custom\x20>\x20li')['css']('max-height',$(window)['height']()-0x64+'px');const lstActionsMenus=['companyAddressesActionsMenu','companyRequirementsActionsMenu','companyPlacementsActionsMenu'];lstActionsMenus['forEach'](function(sMenuID){var iHeightFactor=$('#company-form-tab-panel-buttons')['position']()['top']+0x78;$('#'+sMenuID+'\x20.dropdown-menu.dropdown-custom\x20>\x20li')['css']('max-height',$(window)['height']()-iHeightFactor+'px');});};setTimeout(fnResizeActionsMenus,0x7d0);}TriSysSDK['FormMenus']['DrawDropDownMenuFromTemplate']('companyContactMenu','companyForm','ctrlCompanyContactMenu.html',companyForm['AddressesGridContactMenuCallback'],'company-contact-menu'),TriSysSDK['FormMenus']['DrawDropDownMenuFromTemplate']('companyAddressMenu','companyForm','ctrlCompanyAddressMenu.html',companyForm['AddressesGridAddressMenuCallback'],'company-address-menu');var sGrid='companyForm-AddressesGrid';TriSysSDK['FormMenus']['DrawGridMenu']('companyAddressesGridMenu',sGrid),sGrid='companyForm-RequirementsGrid',TriSysSDK['FormMenus']['DrawGridMenu']('companyRequirementsGridMenu',sGrid),sGrid='companyForm-PlacementsGrid',TriSysSDK['FormMenus']['DrawGridMenu']('companyPlacementsGridMenu',sGrid),sGrid='companyForm-NotesHistoryGrid',TriSysSDK['FormMenus']['DrawGridMenu']('companyNotesHistoryGridMenu',sGrid),sGrid='companyForm-ScheduledTasksGrid',TriSysSDK['FormMenus']['DrawGridMenu']('companyScheduledTasksGridMenu',sGrid);var entityFormFieldDescriptionModifications=[{'TableName':'CompanyConfigFields','TableFieldName':'CompanyLogo','Callback':function(sOperation,divTag,sFilePath){TriSysSDK['Images']['FieldDescriptionImageCallback'](sOperation,divTag,sFilePath,'CompanyConfigFields_CompanyLogo-Thumbnail','CompanyConfigFields_CompanyLogo-Thumbnail2');},'ImageClickEventTargets':['CompanyConfigFields_CompanyLogo-Thumbnail','CompanyConfigFields_CompanyLogo-Thumbnail2']}],sFormName='Company';TriSysSDK['CShowForm']['CustomFieldsTab']['Load']('company-form-customfields','company-form-tab-custom-caption',sFormName),TriSysSDK['CShowForm']['InitialiseFields'](sFormName,entityFormFieldDescriptionModifications),companyForm['HoverLogoFunctionality']();},'TabButtonCallback':function(sTabID){switch(sTabID){case'company-form-panel-addresses':TriSysApex['Pages']['CompanyForm']['LoadAddressesAndContactsGrid']('companyForm-AddressesGrid',null);break;case'company-form-panel-organogram':if(TriSysApex['Forms']['EntityForm']['isGridPopulated']('Company',sTabID))return;TriSysSDK['CompanyOrganogram']['Load'](TriSysApex['Pages']['CompanyForm']['CompanyId'],'company-form-organogram');break;case'company-form-panel-ratecard':if(TriSysApex['Forms']['EntityForm']['isGridPopulated']('Company',sTabID))return;TriSysSDK['ContractRates']['Load']('Company',TriSysApex['Pages']['CompanyForm']['CompanyId'],'company-form-contract-rates');break;case'company-form-panel-attributes':if(TriSysApex['Forms']['EntityForm']['isGridPopulated']('Company',sTabID))return;TriSysSDK['Attributes']['Load']('Company',TriSysApex['Pages']['CompanyForm']['CompanyId'],'company-form-attributes');break;case'company-form-panel-requirements':TriSysApex['Pages']['CompanyForm']['LoadRequirementsGrid']('companyForm-RequirementsGrid',null);break;case'company-form-panel-placements':TriSysApex['Pages']['CompanyForm']['LoadPlacementsGrid']('companyForm-PlacementsGrid',null);break;case'company-form-panel-documentlibrary':if(TriSysApex['Forms']['EntityForm']['isGridPopulated']('Company',sTabID))return;TriSysSDK['DocumentLibrary']['Load']('Company',TriSysApex['Pages']['CompanyForm']['CompanyId'],'company-form-documentlibrary');break;case'company-form-panel-noteshistory':TriSysApex['Pages']['CompanyForm']['LoadNotesHistoryGrid']('companyForm-NotesHistoryGrid',null);break;case'company-form-panel-scheduledtasks':TriSysApex['Pages']['CompanyForm']['LoadScheduledTasksGrid']('companyForm-ScheduledTasksGrid',null);break;case'company-form-panel-relationships':TriSysSDK['Relationships']['Load']('company-relationships-grid-container','Company',function(){TriSysSDK['Relationships']['LoadRelationships']('Company',TriSysApex['Pages']['CompanyForm']['CompanyId']);});break;case'company-form-panel-backoffice':TriSysSDK['BackOffice']['Load']('company-form-bank-details','Company',function(){TriSysSDK['BackOffice']['LoadBankDetails']('Company',TriSysApex['Pages']['CompanyForm']['CompanyId']);});break;}},'AddressesGridContactMenuCallback':function(sMenuItemID){var sPrefix='company-contact-menu-',sSuffix='-companyForm';switch(sMenuItemID){case sPrefix+'new-contact'+sSuffix:TriSysApex['Pages']['CompanyForm']['NewContact']();break;case sPrefix+'open-contact'+sSuffix:TriSysApex['Pages']['CompanyForm']['OpenContact']();break;case sPrefix+'delete-contact'+sSuffix:TriSysApex['Pages']['CompanyForm']['DeleteContact']();break;}},'AddressesGridAddressMenuCallback':function(sMenuItemID){var sPrefix='company-address-menu-',sSuffix='-companyForm';switch(sMenuItemID){case sPrefix+'new-address'+sSuffix:TriSysApex['Pages']['CompanyForm']['NewAddress']();break;case sPrefix+'edit-address'+sSuffix:TriSysApex['Pages']['CompanyForm']['EditAddress']();break;case sPrefix+'delete-address'+sSuffix:TriSysApex['Pages']['CompanyForm']['DeleteAddress']();break;}},'FileMenuCallback':function(sFileMenuID){var fm=TriSysSDK['FormMenus']['Constants'];switch(sFileMenuID){case fm['File_New']:TriSysApex['Pages']['CompanyForm']['NewRecord']();break;case fm['File_Open']:TriSysApex['Pages']['CompanyForm']['OpenFindDialogue']();break;case fm['File_Save']:TriSysApex['Pages']['CompanyForm']['SaveRecord']();break;case fm['File_Save_As']:TriSysApex['UI']['ShowMessage']('Save\x20Company\x20As');break;case fm['File_Delete']:var lCompanyId=TriSysApex['Pages']['CompanyForm']['CompanyId'],sCompanyName=$('#Company_Name')['val'](),fnCallback=function(){TriSysApex['Pages']['CompanyForm']['NewRecord']();};TriSysApex['Pages']['CompanyForm']['DeleteRecord'](lCompanyId,sCompanyName,fnCallback);break;case fm['File_Close']:TriSysApex['FormsManager']['CloseCurrentForm']();break;}},'RequirementGridFileMenuCallback':function(sFileMenuID){var fm=TriSysSDK['FormMenus']['Constants'],sGrid='companyForm-RequirementsGrid',sCompany=$('#Company_Name')['val'](),lRequirementId=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid'](sGrid,'Requirement_RequirementId','requirement',![]);switch(sFileMenuID){case fm['File_New']:var fnSelectCompanyContact=function(selectedRow){if(!selectedRow)return;var lContactId=selectedRow['ContactId'];return TriSysApex['Pages']['RequirementForm']['NewRecord'](lContactId),!![];};TriSysApex['ModalDialogue']['CompanyContacts']['Select'](TriSysApex['Pages']['CompanyForm']['CompanyId'],sCompany,0x0,fnSelectCompanyContact);break;case fm['File_Open']:if(lRequirementId>0x0)TriSysApex['FormsManager']['OpenForm']('Requirement',lRequirementId);break;case fm['File_Delete']:if(lRequirementId>0x0){var sReference=TriSysSDK['Grid']['GetSelectedSingletonRowFieldValueFromGrid'](sGrid,'Requirement_RequirementReference'),sCompany=TriSysSDK['Grid']['GetSelectedSingletonRowFieldValueFromGrid'](sGrid,'RequirementCompany_Name'),sJobTitle=TriSysSDK['Grid']['GetSelectedSingletonRowFieldValueFromGrid'](sGrid,'Requirement_JobTitle'),fnAfterDelete=function(){TriSysSDK['Grid']['ClearCheckedRows'](sGrid),TriSysSDK['Grid']['RefreshData'](sGrid);};TriSysApex['Pages']['RequirementForm']['DeleteRecord'](lRequirementId,sReference,sCompany,sJobTitle,fnAfterDelete);}break;}},'PlacementGridFileMenuCallback':function(sFileMenuID){var fm=TriSysSDK['FormMenus']['Constants'],sGrid='companyForm-PlacementsGrid',sCompany=$('#Company_Name')['val'](),lPlacementId=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid'](sGrid,'Placement_PlacementId','placement',![]);switch(sFileMenuID){case fm['File_New']:var fnSelectCompanyContact=function(selectedRow){if(!selectedRow)return;var lContactId=selectedRow['ContactId'];return TriSysApex['Pages']['PlacementForm']['NewRecord'](lContactId),!![];};TriSysApex['ModalDialogue']['CompanyContacts']['Select'](TriSysApex['Pages']['CompanyForm']['CompanyId'],sCompany,0x0,fnSelectCompanyContact);break;case fm['File_Open']:if(lPlacementId>0x0)TriSysApex['FormsManager']['OpenForm']('Placement',lPlacementId);break;case fm['File_Delete']:if(lPlacementId>0x0){var sReference=TriSysSDK['Grid']['GetSelectedSingletonRowFieldValueFromGrid'](sGrid,'Placement_Reference'),sCompany=TriSysSDK['Grid']['GetSelectedSingletonRowFieldValueFromGrid'](sGrid,'PlacementCompany_Name'),sCandidate=TriSysSDK['Grid']['GetSelectedSingletonRowFieldValueFromGrid'](sGrid,'CandidateContact_FullName'),sJobTitle=TriSysSDK['Grid']['GetSelectedSingletonRowFieldValueFromGrid'](sGrid,'Placement_JobTitle'),fnAfterDelete=function(){TriSysSDK['Grid']['ClearCheckedRows'](sGrid),TriSysSDK['Grid']['RefreshData'](sGrid);};TriSysApex['Pages']['PlacementForm']['DeleteRecord'](lPlacementId,sReference,sCompany,sCandidate,sJobTitle,fnAfterDelete);}break;}},'NotesHistoryGridFileMenuCallback':function(sFileMenuID){companyForm['TaskGridFileMenuCallback'](sFileMenuID,'companyForm-NotesHistoryGrid',![]);},'ScheduledTaskGridFileMenuCallback':function(sFileMenuID){companyForm['TaskGridFileMenuCallback'](sFileMenuID,'companyForm-ScheduledTasksGrid',!![]);},'TaskGridFileMenuCallback':function(sFileMenuID,sGrid,bScheduled){var fm=TriSysSDK['FormMenus']['Constants'],lTaskId=null;switch(sFileMenuID){case fm['File_New']:companyForm['NewTask'](bScheduled);break;case fm['File_Open']:lTaskId=TriSysApex['ModalDialogue']['Task']['GetSelectedSingletonTaskIdFromTaskGrid'](sGrid);if(lTaskId>0x0)TriSysApex['ModalDialogue']['Task']['QuickShow'](lTaskId);break;case fm['File_Delete']:lTaskId=TriSysApex['ModalDialogue']['Task']['GetSelectedSingletonTaskIdFromTaskGrid'](sGrid);if(lTaskId>0x0)TriSysApex['ModalDialogue']['Task']['DeleteTask'](lTaskId);break;}},'NewTask':function(bScheduled){var fnPopulationByFunction={'API':'Company/ListAddressesAndContacts','Parameters':function(request){request['CompanyId']=TriSysApex['Pages']['CompanyForm']['CompanyId'];},'DataTableFunction':function(response){return response['List'];}},fnProcessDataTable=function(dataTable){TriSysApex['UI']['HideWait']();if(dataTable){var params=new TriSysApex['ModalDialogue']['Task']['ShowParameters']();params['Scheduled']=bScheduled;for(var i=0x0;i<dataTable['length'];i++){var dr=dataTable[i],lContactId=dr['ContactId'];if(lContactId>0x0){var contact={'ContactId':dr['ContactId'],'FullName':dr['Contact_Forenames']+'\x20'+dr['Contact_Surname'],'CompanyName':$('#Company_Name')['val'](),'JobTitle':dr['JobTitle'],'ContactType':dr['Contact_ContactType']};params['Contacts']['push'](contact);}}TriSysApex['ModalDialogue']['Task']['Show'](params);}};TriSysApex['UI']['ShowWait'](null,'Reading\x20Company\x20Contacts...'),TriSysSDK['Database']['GetDataSetFromFunction'](fnPopulationByFunction,fnProcessDataTable);},'ActionInvocation':function(sEntityName){switch(sEntityName){case'Contact':var contactIds=TriSysSDK['Grid']['GetSelectedMultipleRowsFromGrid']('companyForm-AddressesGrid','ContactId');return contactIds;case'Company':var companyIds=[TriSysApex['Pages']['CompanyForm']['CompanyId']];return companyIds;case'Requirement':var requirementIds=TriSysSDK['Grid']['GetSelectedMultipleRowsFromGrid']('companyForm-RequirementsGrid','Requirement_RequirementId');return requirementIds;case'Placement':var placementIds=TriSysSDK['Grid']['GetSelectedMultipleRowsFromGrid']('companyForm-PlacementsGrid','Placement_PlacementId');return placementIds;}},'EditComments':function(){var txt=$('#Company_Comments'),sComments=txt['val'](),fnEditedComments=function(sText){return txt['val'](sText),!![];},options={'Label':'Comments','Value':sComments};TriSysApex['ModalDialogue']['BigEdit']['Popup']('Edit\x20Company\x20'+options['Label'],'gi-pen',fnEditedComments,options);},'HoverLogoFunctionality':function(){try{var sJQueryId='#company-form-logo-hovered-buttons-widget',elemFileRow=$('#company-form-logo-hovered-buttons-table-row'),elemPhotoFileWidget=$('#CompanyConfigFields_CompanyLogo'),elemPhotoFilePathWidget=$('#CompanyConfigFields_CompanyLogo-FileReference_FileName'),elemPhotoFileWidgetParentPrevious=elemPhotoFilePathWidget['parent']()['prev'](),fnEnter=function(){elemPhotoFileWidgetParentPrevious['css']('width','100%'),elemPhotoFileWidgetParentPrevious['css']('float','middle'),elemPhotoFilePathWidget['parent']()['hide'](),elemPhotoFileWidget['detach']()['appendTo'](sJQueryId),elemFileRow['show']();},fnLeave=function(){elemPhotoFileWidget['detach']()['appendTo']('#company-form-logo-file-tr'),elemPhotoFileWidgetParentPrevious['css']('width','120px'),elemPhotoFileWidgetParentPrevious['css']('float','right'),elemPhotoFilePathWidget['parent']()['show'](),elemFileRow['hide']();};$('#company-form-logo-column')['hover'](fnEnter,fnLeave);}catch(e){TriSysApex['Logging']['LogMessage'](TriSysApex['Logging']['CatchVariableToText'](e));}}};$(document)['ready'](function(){companyForm['Load']();});