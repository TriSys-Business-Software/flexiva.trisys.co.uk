var ClientTimesheets={'Period_All':'All','Load':function(){$('#webjobs-customer-name')['html'](TriSysWebJobs['Agency']['CustomerName']),ClientTimesheets['LoadTimesheetPeriods'](),TriSysSDK['FormMenus']['DrawGridMenu']('ClientTimesheetsGridMenu','divTimesheetsGrid'),ClientTimesheets['CustomerSpecificConfiguration']();},'LoadTimesheetPeriods':function(){var payloadObject={};payloadObject['URL']='Timesheets/ClientTimesheetPeriods',payloadObject['InboundDataFunction']=function(CClientTimesheetPeriodsResponse){if(CClientTimesheetPeriodsResponse['Success'])ClientTimesheets['PopulateTimesheetPeriodCombo'](CClientTimesheetPeriodsResponse['Periods']);else TriSysApex['UI']['ShowMessage']('No\x20timesheet\x20periods\x20found.');return!![];},payloadObject['ErrorHandlerFunction']=function(request,status,error){console['log']('ClientTimesheets.LoadTimesheets\x20:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'PopulateTimesheetPeriodCombo':function(periods){if(periods)periods['unshift'](ClientTimesheets['Period_All']);var fnSelectPeriod=function(sPeriodDescription){ClientTimesheets['Persistence']['WritePeriod'](sPeriodDescription),ClientTimesheets['LoadTimesheets'](sPeriodDescription);},sPeriod=ClientTimesheets['Persistence']['ReadPeriod']();if(!sPeriod)sPeriod=ClientTimesheets['Period_All'];TriSysSDK['CShowForm']['populateComboFromListOfString']('timesheetPeriods',periods,sPeriod,fnSelectPeriod),fnSelectPeriod(sPeriod);},'LoadTimesheets':function(sPeriod){var fnPopulationByFunction={'API':'Timesheets/ClientTimesheets','Parameters':function(request){request['Period']=sPeriod==ClientTimesheets['Period_All']?'':sPeriod,ClientTimesheets['CustomerSpecificRequest'](request);},'DataTableFunction':function(response){var timesheets=response['Timesheets'];if(timesheets)for(var i=0x0;i<timesheets['length'];i++){var timesheet=timesheets[i],placement=timesheet['Placement'];timesheet['Reference']=placement['Reference'],timesheet['CandidateName']=placement['CandidateName'],timesheet['JobTitle']=placement['JobTitle'],timesheet['TotalTimeWorked']=timesheet['Timesheet']['TotalTimeWorked'],timesheet['NetPay']=timesheet['Timesheet']['NetPay'],timesheet['Payrolled']=timesheet['Timesheet']['Payrolled'],timesheet['InputDate']=timesheet['Timesheet']['InputDate'],timesheet['Authorised']=timesheet['AuthorisedBy']?'Yes':'No',timesheet['Paid']=timesheet['Timesheet']['Payrolled']?'Yes':'No';var iYear=moment(timesheet['AuthorisationRequested'])['year']();if(iYear<0x76c)timesheet['AuthorisationRequested']=null;timesheet['AuthorisationRequested']=timesheet['AuthorisationRequested'];}return timesheets;}};ClientTimesheets['PopulateTimesheetGrid'](fnPopulationByFunction);},'PopulateTimesheetGrid':function(fnPopulationByFunction){var sGridDiv='divTimesheetsGrid',columns=TriSysWebJobs['Timesheets']['ClientTimesheetsColumns'],mobileVisibleColumns=[{'field':'Reference','title':'Timesheet'}],mobileRowTemplate=TriSysWebJobs['Timesheets']['MobileRowTemplate'],gridLayout={'Div':sGridDiv,'ID':sGridDiv+'grd','Title':'Timesheets','RecordsPerPage':TriSysApex['UserOptions']['RecordsPerPage'](),'PopulationByFunction':fnPopulationByFunction,'Columns':columns,'MobileVisibleColumns':mobileVisibleColumns,'MobileRowTemplate':mobileRowTemplate,'KeyColumnName':'TimesheetId','DrillDownFunction':function(rowData){TriSysWebJobs['Timesheet']['Open'](rowData['TimesheetId'],!![]);},'MultiRowSelect':!![],'Grouping':![],'ColumnFilters':!![],'OpenButtonCaption':'View'};TriSysSDK['Grid']['VirtualMode'](gridLayout);},'EditSelected':function(){var lstItems=TriSysSDK['Grid']['GetSelectedMultipleRowsFromGrid']('divTimesheetsGrid','TimesheetId');if(lstItems)ClientTimesheets['ListOfSelectedTimesheetId']=lstItems,TriSysApex['FormsManager']['OpenForm']('ClientEditTimesheets');else TriSysApex['UI']['ShowMessage']('Please\x20select\x20one\x20or\x20more\x20timesheets.');},'ListOfSelectedTimesheetId':null,'AuthoriseSelected':function(){var lstItems=TriSysSDK['Grid']['GetSelectedMultipleRowsFromGrid']('divTimesheetsGrid','TimesheetId');if(lstItems){var sMessage='Please\x20confirm\x20that\x20you\x20wish\x20to\x20authorise\x20'+lstItems['length']+'\x20selected\x20timesheets?'+'<br\x20/>Note\x20that\x20each\x20candidate\x20will\x20receive\x20a\x20confirmation\x20e-mail\x20and\x20will\x20be\x20unable\x20to\x20'+'make\x20further\x20changes\x20to\x20their\x20timesheet.',fnYes=function(){return setTimeout(function(){ClientTimesheets['AuthoriseInteractively'](lstItems);},0x32),!![];};TriSysApex['UI']['questionYesNo'](sMessage,'Authorise\x20Timesheets','Yes',fnYes,'No');}else TriSysApex['UI']['ShowMessage']('Please\x20select\x20one\x20or\x20more\x20timesheets.');},'AuthoriseInteractively':function(lstItems){var lLastTimesheetId=lstItems[lstItems['length']-0x1],fnConfirmed=function(lTimesheetId){if(lTimesheetId==lLastTimesheetId){var sPeriod=TriSysSDK['CShowForm']['GetTextFromCombo']('timesheetPeriods');ClientTimesheets['LoadTimesheets'](sPeriod);}};$['each'](lstItems,function(index,lTimesheetId){TriSysWebJobs['Timesheet']['AuthoriseRequest'](lTimesheetId,fnConfirmed);});},'CustomerSpecificConfiguration':function(){TriSysWebJobs['Agency']['CustomerIDMatch']('CoSector')&&($('#clientTimesheets-EditSelected')['html']('Review\x20and\x20Authorise\x20Selected'),$('#clientTimesheets-AwaitingAuthorisation-tr')['show'](),$('#clientTimesheets-AwaitingAuthorisation')['click'](function(){var bChecked=$(this)['is'](':checked'),sPeriodDescription=TriSysSDK['CShowForm']['GetTextFromCombo']('timesheetPeriods');ClientTimesheets['LoadTimesheets'](sPeriodDescription);}));},'CustomerSpecificRequest':function(request){TriSysWebJobs['Agency']['CustomerIDMatch']('CoSector')&&(request['AwaitingAuthorisationOnly']=TriSysSDK['CShowForm']['GetCheckBoxValue']('clientTimesheets-AwaitingAuthorisation'));},'Persistence':{'WritePeriod':function(sPeriod){ClientTimesheets['Persistence']['PutCookie'](sPeriod);},'ReadPeriod':function(){var sPeriod=ClientTimesheets['Persistence']['GetCookie']();return sPeriod;},'CookiePrefix':'ClientTimesheets-Period','GetCookie':function(){var sPeriod=TriSysAPI['Cookies']['getCookie'](ClientTimesheets['Persistence']['CookiePrefix']);return sPeriod;},'PutCookie':function(sPeriod){TriSysAPI['Cookies']['setCookie'](ClientTimesheets['Persistence']['CookiePrefix'],sPeriod);}}};$(document)['ready'](function(){ClientTimesheets['Load']();});