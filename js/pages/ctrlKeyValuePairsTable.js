var ctrlKeyValuePairsTable={'Loaded':function(options){if(options['ObjectName']){const spanInsideButton=$('#'+options['ID']+'\x20button[type=\x22submit\x22]:first\x20span');spanInsideButton['text']('Add\x20'+options['ObjectName']);}var div=document['getElementById'](options['ID']);const sBase64Options=btoa(JSON['stringify'](options));div['setAttribute'](TriSysFlexiva['Settings']['Constants']['ControlDataTag'],sBase64Options),options['Data']&&options['Data']['forEach'](function(item){ctrlKeyValuePairsTable['AddRow'](options,item);}),options['ReadOnly']&&ctrlKeyValuePairsTable['SetReadOnly'](options,!![]),options['ColumnLabelFunction']&&ctrlKeyValuePairsTable['AllowReLabelling']($(div),options['ColumnLabelFunction']),ctrlKeyValuePairsTable['ConfiguredFieldBehaviours'](options);},'ConfiguredFieldBehaviours'(options){if(options['ColumnFieldFunction']){const rootTableElement=$('#'+options['ID']);ctrlKeyValuePairsTable['EnumerateRowConfiguration'](rootTableElement,options['ColumnFieldFunction']);}},'EnumerateRowConfiguration':function(rootControlElement,fnCallback){const fieldRows=ctrlKeyValuePairsTable['EnumerateRowsMatchingClass'](rootControlElement,'column-field-');fieldRows['forEach'](function(rowData,iRowIndex){rowData['fields']&&rowData['fields']['forEach'](function(fieldElement,iColumnIndex){TriSysApex['DynamicClasses']['CallFunction'](fnCallback,iRowIndex,iColumnIndex,fieldElement);});});},'EnumerateRowsMatchingClass':function(rootControlElement,sClassPrefix){var results=[],rows=rootControlElement['find']('tr[id^=\x27ctrlKeyValuePairsTableRow-\x27]');return rows['each'](function(){var row=$(this),fieldElements=[];row['find']('[class*=\x27'+sClassPrefix+'\x27]')['each'](function(){var column=$(this),childElements=column['children']();childElements['each'](function(){fieldElements['push']($(this));});}),fieldElements['length']>0x0&&results['push']({'fields':fieldElements});}),results;},'EnumerateElementsMatchingClass':function(rootControlElement,sClassPrefix){var allElements=rootControlElement['find']('*');const matchingElements=[];return allElements['each'](function(){var classes=$(this)['attr']('class');if(!classes)return;var classArray=classes['split']('\x20');for(var i=0x0;i<classArray['length'];i++){classArray[i]['startsWith'](sClassPrefix)&&matchingElements['push']($(this));}}),matchingElements;},'AllowReLabelling':function(rootControlElement,fnCallback){const columnHeaderElements=ctrlKeyValuePairsTable['EnumerateElementsMatchingClass'](rootControlElement,'column-header-');var iIndex=0x0;columnHeaderElements['forEach'](function(element){const sNewLabel=fnCallback(iIndex);iIndex++,sNewLabel&&element['text'](sNewLabel);});},'AddButtonClicked':function(clickedElement){const options=ctrlKeyValuePairsTable['GetControlOptions'](clickedElement);if(!options)return;options['AddRowCallback']?TriSysApex['DynamicClasses']['CallFunction'](options['AddRowCallback'],options):ctrlKeyValuePairsTable['AddRow'](options,null);},'DeleteRowButtonClicked':function(clickedElement){const options=ctrlKeyValuePairsTable['GetControlOptions'](clickedElement);if(!options)return;const row=clickedElement['closest']('tr');if(!row)return;const rowID=row['attr']('id'),sMessage='Are\x20you\x20sure\x20you\x20want\x20to\x20delete\x20this\x20'+options['ObjectName']+'?';TriSysApex['UI']['questionYesNo'](sMessage,'Delete\x20'+options['ObjectName'],'Yes',function(){return $('#'+rowID)['remove'](),ctrlKeyValuePairsTable['SendUpdatedDataToHostingForm'](options),!![];},'No');},'GetControlOptions':function(clickedElement){const parentWithData=clickedElement['closest']('['+TriSysFlexiva['Settings']['Constants']['ControlDataTag']+']');if(parentWithData['length']>0x0){const sBase64=parentWithData['attr'](TriSysFlexiva['Settings']['Constants']['ControlDataTag']);if(!sBase64)return null;const sOptionsJSON=atob(sBase64),options=JSON['parse'](sOptionsJSON);return options;}else return console['log']('No\x20parent\x20with\x20'+TriSysFlexiva['Settings']['Constants']['ControlDataTag']+'\x20found'),null;},'AddRow':function(options,item){var sRowHTML=TriSysApex['FormsManager']['getControlTemplateHTML']('ctrlKeyValuePairsTableRow.html');if(!item)item={};if(!item['RowGUID'])item['RowGUID']=TriSysSDK['Miscellaneous']['GUID']();sRowHTML=sRowHTML['replaceAll']('{{ctrlKeyValuePairsTableRow-Id}}',item['RowGUID']);const table=$('#'+options['ID']+'\x20table\x20tbody');table['append'](sRowHTML);const sRowID='ctrlKeyValuePairsTableRow-'+item['RowGUID'];TriSysSDK['CShowForm']['HTMLFieldsCodeInjection']({'rootElementId':sRowID}),ctrlKeyValuePairsTable['ConfiguredFieldBehaviours'](options,table),$('#'+sRowID+'-Key')['val'](item['Key']),$('#'+sRowID+'-Value')['val'](item['Value']),$('#'+sRowID+'-Description')['val'](item['Description']);if(options['ReadOnly']){$('#'+sRowID+'-Key')['prop']('readonly',!![]),$('#'+sRowID+'-Value')['prop']('readonly',!![]),$('#'+sRowID+'-Description')['prop']('readonly',!![]),$('#'+sRowID+'\x20button[type=\x22submit\x22]')['prop']('disabled',!![]);return;}$('#'+sRowID+'-Key')['on']('input',function(e){const sValue=$(this)['val'](),sEscapedValue=TriSysSDK['Miscellaneous']['EscapeJSONField'](sValue);if(sValue!=sEscapedValue){const cursorPos=this['selectionStart'];$(this)['val'](sEscapedValue);const newPos=Math['min'](cursorPos,sEscapedValue['length']);this['setSelectionRange'](newPos,newPos);}});options['PostAddRowCallback']&&TriSysApex['DynamicClasses']['CallFunction'](options['PostAddRowCallback'],sRowID);const fnValueChangedEventHandler=function(e){const id=$(this)['attr']('id'),value=$(this)['val']();console['log']('Event\x20type:',e['type'],'ID:',id,'New\x20value:',value),ctrlKeyValuePairsTable['SendUpdatedDataToHostingForm'](options);},lstField=['Key','Value','Description'];lstField['forEach'](function(sField){const elem=$('#'+sRowID+'-'+sField);elem['on']('change',fnValueChangedEventHandler);});},'SendUpdatedDataToHostingForm':function(options){if(options['SaveFunctionCallback']){const data=ctrlKeyValuePairsTable['ReadData'](options['ID']);console['log']('SendUpdatedDataToHostingForm:\x20calling\x20'+options['SaveFunctionCallback']),TriSysApex['DynamicClasses']['CallFunction'](options['SaveFunctionCallback'],data);}},'ReadData':function(sID){const rows=[];return $('#'+sID+'\x20table\x20tbody\x20tr:not(:first)')['each'](function(){const row=$(this),rowId=row['attr']('id');if(rowId){const keyValue=$('#'+rowId+'-Key')['val'](),value=$('#'+rowId+'-Value')['val'](),description=$('#'+rowId+'-Description')['val']();if(keyValue||value||description){const sPersistedRowId=rowId['replace']('ctrlKeyValuePairsTableRow-','');rows['push']({'RowGUID':sPersistedRowId,'Key':keyValue||'','Value':value||'','Description':description||''});}}}),rows;},'SetReadOnly':function(options,bReadOnly){$('#'+options['ID']+'\x20button[type=\x22submit\x22]:first')['hide']();}};