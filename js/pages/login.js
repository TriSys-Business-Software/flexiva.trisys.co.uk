var loginPage={'Load':function(){var parts,sGUID;loginPage['HideSocialNetworkLoginButtons'](),loginPage['WhiteLabel']();try{if(window['location']['hash']==='#register'||window['location']['hash']==='#freetrial'){TriSysApex['FormsManager']['OpenForm'](TriSysApex['Constants']['RegistrationForm'],0x0,!![]);return;}var sActivatePrefix='#activate~';if(window['location']['hash']&&window['location']['hash']['indexOf'](sActivatePrefix)>=0x0){parts=window['location']['hash']['split'](sActivatePrefix);if(parts['length']==0x2){sGUID=parts[0x1],loginPage['ActivatePrompt'](sGUID);return;}}var sCustomerPrefix='#customer~';if(window['location']['hash']&&window['location']['hash']['indexOf'](sCustomerPrefix)>=0x0){parts=window['location']['hash']['split'](sCustomerPrefix);if(parts['length']==0x2){sGUID=parts[0x1],loginPage['SubmitCustomerConfirmationRequest'](sGUID);return;}}var sResetPrefix='#resetpassword~';if(window['location']['hash']&&window['location']['hash']['indexOf'](sResetPrefix)>=0x0){parts=window['location']['hash']['split'](sResetPrefix);if(parts['length']==0x2){sGUID=parts[0x1],TriSysApex['Forms']['Login']['ValidateResetPassword'](sGUID);return;}}var sSupportLoginPrefix='#supportlogin~';if(window['location']['hash']&&window['location']['hash']['indexOf'](sSupportLoginPrefix)>=0x0){parts=window['location']['hash']['split'](sSupportLoginPrefix);if(parts['length']==0x2){var sEMailAndPassword=parts[0x1];loginPage['SupportLogin'](sEMailAndPassword);return;}}var sAPIKeyPrefix='#apikey~';window['location']['hash']&&window['location']['hash']['indexOf'](sAPIKeyPrefix)>=0x0&&(parts=window['location']['hash']['split'](sAPIKeyPrefix),parts['length']==0x2&&(TriSysApex['Constants']['DeveloperSiteKey']=parts[0x1],TriSysAPI['Session']['SetDeveloperSiteKey'](TriSysApex['Constants']['DeveloperSiteKey'])));var sURL=window['location']['href'],bAutoLogin=![],iIndexOfContactPreviewPrefix=sURL['toLowerCase']()['indexOf'](TriSysApex['Constants']['ContactPreviewPrefix']);if(iIndexOfContactPreviewPrefix>0x0){TriSysApex['Forms']['Configuration']['Pages']['forEach'](function(page){if(page['PostLoginPageForUser'])page['PostLoginPageForUser']=![];});var sContactPreviewModeFormName='ContactPreviewMode';TriSysApex['Forms']['Configuration']['Pages']['push']({'FormName':sContactPreviewModeFormName,'EntityName':null,'ImagePath':'fa\x20fa-plug','Caption':'Contact\x20Preview','ViewName':sContactPreviewModeFormName+'.html','MustBeLoggedIn':![],'ShowWhenLoggedIn':![],'Visible':!![],'Style':'display:\x20none;','HideWhenNotLoggedIn':!![],'ParentNavBarMenuID':'navBar-Help','PostLoginPageForUser':!![]});var sBase64=sURL['substr'](iIndexOfContactPreviewPrefix+TriSysApex['Constants']['ContactPreviewPrefix']['length']),jsonObject=JSON['parse']($['base64']['decode'](sBase64));TriSysApex['EntityPreview']['Contact']['_MostRecentContactId']=jsonObject['ContactId'],TriSysApex['EntityPreview']['Contact']['_MostRecentSearchCriteriaJson']=jsonObject['SearchCriteriaJson'],TriSysAPI['Session']['SetDataServicesKey'](jsonObject['DataServicesKey']),TriSysAPI['Session']['SetDeveloperSiteKey'](jsonObject['SiteKey']),TriSysAPI['Constants']['SecureURL']=jsonObject['SecureURL'];debugger;TriSysApex['EntityPreview']['Contact']['Data']['BrowserExtension']=jsonObject['BrowserExtension'],$('#app-caption-fixed-top')['hide'](),TriSysApex['UI']['ShowWait'](null,'Loading\x20Contact\x20Preview...'),TriSysApex['FormsManager']['OpenForm'](sContactPreviewModeFormName);return;}loginPage['LoadIfNotURLDirectives']();}catch(err){alert(err);}},'HideSocialNetworkLoginButtons':function(){var fnHideSocials=function(){$('#social-login-buttons')['hide']();},fnTest=function(){var bInChromeAppMode=TriSysApex['Environment']['isChromeStandaloneApp'](),bWindowsStoreApp=TriSysApex['Environment']['isWindowsStoreApp'](),bPhoneApp=TriSysApex['Device']['isPhone']();if(bInChromeAppMode||bWindowsStoreApp||bPhoneApp)fnHideSocials();};if(TriSysApex['Constants']['WhiteLabelled']||TriSysPhoneGap['Enabled']())fnHideSocials();else setTimeout(fnTest,0x3e8);if(TriSysPhoneGap['Enabled']())$('#login-form-top-block')['hide']();},'LoadIfNotURLDirectives':function(){$('#txtLoginPassword')['keyup'](function(e){e['keyCode']==0xd&&TriSysWeb['Security']['LoginButtonClick']();}),setTimeout(loginPage['Social']['AddEventHandlers'],0xa),setTimeout(TriSysWeb['Pages']['Login']['Load'],0x32);},'ActivatePrompt':function(sGUID){TriSysApex['LoginCredentials']['ClearCachedCredentials'](),TriSysApex['Cache']['Clear']();var payloadObject={},ActivateUserAccountPromptRequest={'GUID':sGUID};payloadObject['URL']='Users/ActivateUserAccountPrompt',payloadObject['OutboundDataPacket']=ActivateUserAccountPromptRequest,payloadObject['InboundDataFunction']=function(ActivateUserAccountPromptResponse){TriSysApex['UI']['HideWait']();if(ActivateUserAccountPromptResponse){if(ActivateUserAccountPromptResponse['Success']){loginPage['ActivationPopup'](sGUID,ActivateUserAccountPromptResponse['EMail'],ActivateUserAccountPromptResponse['Trial']);return;}}var fnLogin=function(){return loginPage['LoadIfNotURLDirectives'](),!![];},sMessage='Invalid\x20activation\x20code.'+'<br\x20/>'+'Would\x20you\x20like\x20to\x20login?';fnLogin();},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('loginPage.Activate:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Activating...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'ActivationEMail':null,'GUID':null,'ActivationPopup':function(sGUID,sEMail,bTrial){loginPage['GUID']=sGUID,loginPage['ActivationEMail']=sEMail;var fnLogin=function(sNewPassword){var CChangeLoginCredentials={'EMail':sEMail,'NewPassword':sNewPassword,'Activate':!![],'GUID':sGUID};return loginPage['SubmitUserActivationCompletionRequest'](CChangeLoginCredentials),!![];},fnCancel=function(){return!![];},sWhat=bTrial?'Free\x20Trial':'Live\x20Subscription',fnCallback=function(){var CChangeLoginCredentials=ctrlChangeLoginCredentials['Validate'](!![]);if(CChangeLoginCredentials)return fnLogin(CChangeLoginCredentials['NewPassword']),!![];};TriSysApex['Forms']['Login']['resetPasswordData']={'GUID':sGUID,'EMail':sEMail};var parametersObject=new TriSysApex['UI']['ShowMessageParameters']();parametersObject['Title']=sWhat,parametersObject['Image']='gi-lock',parametersObject['ContentURL']=TriSysApex['Constants']['UserControlFolder']+'ctrlChangeLoginCredentials.html',parametersObject['ButtonRightText']='Cancel',parametersObject['ButtonRightVisible']=!![],parametersObject['ButtonRightFunction']=fnCancel,parametersObject['ButtonLeftText']='Save',parametersObject['ButtonLeftVisible']=!![],parametersObject['ButtonLeftFunction']=fnCallback,TriSysApex['UI']['PopupMessage'](parametersObject);},'OnSaveButtonClick':function(){return ctrlChangeLoginCredentials['ActivateUserAccountButtonClick'](loginPage['SubmitUserActivationCompletionRequest']),![];},'SubmitUserActivationCompletionRequest':function(CChangeLoginCredentials){var payloadObject={};CChangeLoginCredentials['GUID']=loginPage['GUID'],CChangeLoginCredentials['Activate']=!![],payloadObject['URL']='Users/ActivateUserAccountConfirmation',payloadObject['OutboundDataPacket']=CChangeLoginCredentials,payloadObject['InboundDataFunction']=function(CActivateUserAccountConfirmationResponse){TriSysApex['UI']['HideWait']();if(CActivateUserAccountConfirmationResponse){if(CActivateUserAccountConfirmationResponse['Success']){TriSysApex['UI']['CloseModalPopup'](),setTimeout(function(){loginPage['CommenceAutoLoginSequenceAfterActivation'](CActivateUserAccountConfirmationResponse);},0x32);return;}else TriSysApex['UI']['ShowMessage'](CActivateUserAccountConfirmationResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('loginPage.SubmitUserActivationCompletionRequest:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Activating...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'SubmitCustomerConfirmationRequest':function(sGUID){loginPage['ConfirmCustomerRegistrationRequest'](sGUID);},'ConfirmCustomerRegistrationRequest':function(sGUID){var payloadObject={},ConfirmCustomerRegistrationRequest={'GUID':sGUID};payloadObject['URL']='Users/ConfirmCustomerRegistrationRequest',payloadObject['OutboundDataPacket']=ConfirmCustomerRegistrationRequest,payloadObject['InboundDataFunction']=function(ConfirmCustomerRegistrationResponse){TriSysApex['UI']['HideWait']();if(ConfirmCustomerRegistrationResponse){var bSuccess=ConfirmCustomerRegistrationResponse['Success'];if(!bSuccess&&ConfirmCustomerRegistrationResponse['ErrorMessage']['indexOf']('Activation\x20code\x20expired\x20or\x20not\x20found')>=0x0){TriSysWeb['Pages']['Login']['Load']();return;}if(bSuccess){var bResourcer=ConfirmCustomerRegistrationResponse['Plan']=='Resourcer';bResourcer?setTimeout(function(){loginPage['CommenceProvisioningAfterConfirmingRegistration'](sGUID,ConfirmCustomerRegistrationResponse,'Resourcer\x20Registration\x20Confirmed');},0x32):setTimeout(function(){loginPage['CommencePaymentCaptureAfterConfirmingRegistration'](sGUID,ConfirmCustomerRegistrationResponse);},0x32);}else TriSysApex['UI']['ShowMessage'](ConfirmCustomerRegistrationResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('loginPage.ConfirmCustomerRegistrationRequest:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Confirming\x20Registration...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'SubmitCustomerFreeTrialConfirmationRequest':function(sGUID){var payloadObject={},CCustomerFreeTrialConfirmationRequest={'GUID':sGUID};payloadObject['URL']='Users/CustomerFreeTrialConfirmation',payloadObject['OutboundDataPacket']=CCustomerFreeTrialConfirmationRequest,payloadObject['InboundDataFunction']=function(CCustomerFreeTrialConfirmationResponse){TriSysApex['UI']['HideWait']();if(CCustomerFreeTrialConfirmationResponse){var bSuccess=CCustomerFreeTrialConfirmationResponse['Success'];if(!bSuccess&&CCustomerFreeTrialConfirmationResponse['ErrorMessage']['indexOf']('Activation\x20code\x20expired\x20or\x20not\x20found')>=0x0){TriSysWeb['Pages']['Login']['Load']();return;}if(bSuccess){setTimeout(function(){loginPage['CommenceAutoLoginSequenceAfterActivation'](CCustomerFreeTrialConfirmationResponse);},0x32);return;}else TriSysApex['UI']['ShowMessage'](CCustomerFreeTrialConfirmationResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('loginPage.SubmitCustomerFreeTrialConfirmationRequest:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Activating...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'CommenceAutoLoginSequenceAfterActivation':function(CActivateUserAccountConfirmationResponse){var sEMail=CActivateUserAccountConfirmationResponse['EMail'],sPassword=CActivateUserAccountConfirmationResponse['Password'];$('#txtLoginEMail')['val'](sEMail),$('#txtLoginPassword')['val'](sPassword),TriSysWeb['Security']['LoginButtonClick']();},'LoginButtonClick':function(){TriSysWeb['Security']['LoginButtonClick']();},'ForgottenPassword':function(){TriSysApex['FormsManager']['OpenForm'](TriSysApex['Constants']['ForgottenPasswordForm'],0x0,!![]);},'Register':function(){TriSysApex['FormsManager']['OpenForm'](TriSysApex['Constants']['RegistrationForm'],0x0,!![]);},'SupportLogin':function(sEMailAndPassword){TriSysApex['LoginCredentials']['ClearCachedCredentials'](),TriSysApex['Cache']['Clear'](),eMailAndPassword=TriSysWeb['Security']['DecryptBase64Credentials'](sEMailAndPassword),$('#txtLoginEMail')['val'](eMailAndPassword['EMail']),$('#txtLoginPassword')['val'](eMailAndPassword['Password']),TriSysWeb['Security']['LoginButtonClick']();},'Social':{'AddEventHandlers':function(){if(TriSysApex['Constants']['WhiteLabelled']||TriSysPhoneGap['Enabled']())return;TriSysWebJobs['SocialNetwork']['CurrentNetworks']=TriSysWebJobs['SocialNetwork']['AllNetworks'];var fnLoadControlHTML=function(){TriSysApex['FormsManager']['loadControlIntoDiv']('loginPage-SocialNetworkButtons','ctrlSocialNetworkLoginButtons.html',function(response,status,xhr){ctrlSocialNetworkLoginButtons['OnSuccessfulLoginFunction']=loginPage['Social']['SendToWebAPI'];});};TriSysApex['WhiteLabelling']['LoadJavascriptFile']('js/pages/ctrlSocialNetworkLoginButtons.js',null,fnLoadControlHTML);},'SendToWebAPI':function(provider_name,connection_token,user_token){debugger;var CSocialNetworkLoginParameters={'ProviderName':provider_name,'ConnectionToken':connection_token,'UserToken':user_token};TriSysWeb['Security']['LoginButtonClick'](CSocialNetworkLoginParameters);}},'WhiteLabel':function(){var bInDev=![];if(TriSysApex['Constants']['WhiteLabelled']||bInDev){var bResourcer=TriSysApex['Resourcer']['isResourcerWebSite']();if(!bResourcer)$('#btn-register')['hide']();try{ApexCustomPostLoadModule['LoginFormLoaded']();}catch(e){}}},'CommencePaymentCaptureAfterConfirmingRegistration':function(sGUID,ConfirmCustomerRegistrationResponse){var parametersObject=new TriSysApex['UI']['ShowMessageParameters']();parametersObject['Title']='Subscription\x20Provisioning',parametersObject['Image']='gi-gbp',parametersObject['Maximize']=!![],parametersObject['CloseTopRightButton']=!![],parametersObject['ContentURL']=TriSysApex['CustomFormsAndComponents']['UserControlPath']('ctrlPaymentGateway.html'),parametersObject['OnLoadCallback']=function(){ctrlPaymentGateway['Load'](sGUID,ConfirmCustomerRegistrationResponse),loginPage['FixModalPositioning']();},parametersObject['ButtonLeftVisible']=!![],parametersObject['ButtonLeftText']='Cancel',parametersObject['ButtonLeftFunction']=function(){return!![];},TriSysApex['UI']['PopupMessage'](parametersObject);},'CommenceProvisioningAfterConfirmingRegistration':function(sGUID,ConfirmCustomerRegistrationResponse,sTitle){var parametersObject=new TriSysApex['UI']['ShowMessageParameters']();parametersObject['Title']=sTitle,parametersObject['Image']='fa-check',parametersObject['Maximize']=![],parametersObject['CloseTopRightButton']=!![];var iWidth=$(window)['width']();if(!TriSysApex['Device']['isPhone']())iWidth/=0x2;parametersObject['Width']=iWidth,parametersObject['Draggable']=!![],parametersObject['ContentURL']=TriSysApex['CustomFormsAndComponents']['UserControlPath']('ctrlProvisioningProgress.html'),parametersObject['OnLoadCallback']=function(){ctrlProvisioningProgress['Load'](sGUID,ConfirmCustomerRegistrationResponse),loginPage['FixModalPositioning']();},parametersObject['ButtonLeftVisible']=!![],parametersObject['ButtonLeftText']='Cancel',parametersObject['ButtonLeftFunction']=function(){return!![];},TriSysApex['UI']['PopupMessage'](parametersObject);},'FixModalPositioning':function(){var regular=$('#trisys-modal-regular'),modal=$('#trisys-modal-dialogue'),bDraggable=regular['hasClass']('ui-draggable');if(bDraggable)modal['css']('top','950px');else modal['css']('top','0px');}};$(document)['ready'](function(){loginPage['Load']();});