var ctrlContractRates={'PostLoad':function(sEntityName,lRecordId,parentDiv){var sIDSuffix='-'+parentDiv,controls=['trisys-contract-rates-block','ContractRatesFileMenu','ContractRatesGridMenu','trisys-contract-rates-grid','trisys-contract-rates-chart'];for(var i in controls){$('#'+controls[i])['attr']('id',controls[i]+sIDSuffix);}var sGrid='trisys-contract-rates-grid'+sIDSuffix,sKeyField='EntityId',sWhat='pay/charge\x20rate';$('#ContractRates-Add')['attr']('id','ContractRates-Add'+sIDSuffix),$('#ContractRates-Add'+sIDSuffix)['click'](function(){TriSysApex['ModalDialogue']['ContractRates']['Show'](sEntityName,lRecordId,sGrid,0x0);}),$('#ContractRates-Open')['attr']('id','ContractRates-Open'+sIDSuffix),$('#ContractRates-Open'+sIDSuffix)['click'](function(){lRateId=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid'](sGrid,sKeyField,sWhat);if(lRateId>0x0)TriSysApex['ModalDialogue']['ContractRates']['Show'](sEntityName,lRecordId,sGrid,lRateId);}),$('#ContractRates-Delete')['attr']('id','ContractRates-Delete'+sIDSuffix),$('#ContractRates-Delete'+sIDSuffix)['click'](function(){lRateId=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid'](sGrid,sKeyField,sWhat);if(lRateId>0x0)ctrlContractRates['Delete'](sEntityName,lRecordId,sGrid,lRateId);}),TriSysSDK['FormMenus']['DrawGridMenu']('ContractRatesGridMenu'+sIDSuffix,sGrid),ctrlContractRates['PopulateGrid'](sEntityName,lRecordId,sGrid),setTimeout(TriSysProUI['kendoUI_Overrides'],0x1f4);},'PopulateGrid':function(sEntityName,lEntityId,sGrid){var fnPopulationByFunction={'API':'Rates/List','Parameters':function(request){request['EntityName']=sEntityName,request['RecordId']=lEntityId;},'DataTableFunction':function(response){return response['List'];}};ctrlContractRates['PopulateGridWithAPI'](sEntityName,lEntityId,sGrid,fnPopulationByFunction);},'PopulateGridWithAPI':function(sEntityName,lRecordId,sGrid,fnPopulationByFunction){var sDisplay=sEntityName=='Company'?'_Display':'',sKeyField='EntityId',columns=[{'field':sKeyField,'title':'ID','type':'number','width':0x46,'hidden':!![]},{'field':'RateType','title':'Rate\x20Type','type':'string'},{'field':'PayRate'+sDisplay,'title':'Pay\x20Rate','type':'string'},{'field':'ChargeRate'+sDisplay,'title':'Charge\x20Rate','type':'string','width':0xb4},{'field':'Notes','title':'Notes','type':'string'}],sMobileRowTemplatePrefix='';if(sEntityName=='Company'){var companyColumn1={'field':'JobTitle','title':'Job\x20Title','type':'string'},companyColumn2={'field':'CompanyAddress','title':'Address','type':'string'};columns['splice'](0x1,0x0,companyColumn1),columns['splice'](0x2,0x0,companyColumn2),sMobileRowTemplatePrefix='<strong>#:\x20JobTitle\x20#</strong><br\x20/>';}var fnPostPopulationCallback=function(lRecordCount){ctrlContractRates['DrawChart'](sGrid);};TriSysSDK['Grid']['VirtualMode']({'Div':sGrid,'ID':'grdContractRates-'+sGrid,'Title':'Contract\x20Rates','RecordsPerPage':TriSysApex['UserOptions']['RecordsPerPage'](),'PopulationByFunction':fnPopulationByFunction,'Columns':columns,'MobileVisibleColumns':[{'field':'RateType','title':'Rate\x20Type','type':'string'}],'MobileRowTemplate':'<td\x20colspan=\x221\x22>'+sMobileRowTemplatePrefix+'#:\x20RateType\x20#:\x20Pay\x20<i>#:\x20PayRate'+sDisplay+'\x20#</i>,\x20Charge\x20<i>#:\x20ChargeRate'+sDisplay+'\x20#</i></td>','KeyColumnName':sKeyField,'DrillDownFunction':function(rowData){var lRateId=rowData[sKeyField];if(rowData['RequirementId'])lRecordId=rowData['RequirementId'];else{if(rowData['PlacementId'])lRecordId=rowData['PlacementId'];}TriSysApex['ModalDialogue']['ContractRates']['Show'](sEntityName,lRecordId,sGrid,lRateId);},'MultiRowSelect':!![],'Grouping':![],'ColumnFilters':![],'OpenButtonCaption':'Edit','PostPopulationCallback':fnPostPopulationCallback,'HyperlinkedColumns':['RateType']});},'FileMenuCallback':function(sFileMenuID,sEntityName,lRecordId,sGrid){var fm=TriSysSDK['FormMenus']['Constants'],lRateId=0x0,sKeyField='EntityId',sWhat='pay/charge\x20rate';switch(sFileMenuID){case fm['File_New']:TriSysApex['ModalDialogue']['ContractRates']['Show'](sEntityName,lRecordId,sGrid,lRateId);break;case fm['File_Open']:lRateId=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid'](sGrid,sKeyField,sWhat);if(lRateId>0x0)TriSysApex['ModalDialogue']['ContractRates']['Show'](sEntityName,lRecordId,sGrid,lRateId);break;case fm['File_Delete']:lRateId=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid'](sGrid,sKeyField,sWhat);if(lRateId>0x0)ctrlContractRates['Delete'](sEntityName,lRecordId,sGrid,lRateId);break;}},'Delete':function(sEntityName,lRecordId,sGrid,lRateId){var fnDelete=function(){return ctrlContractRates['DeleteRecord'](sEntityName,lRecordId,sGrid,lRateId),!![];};TriSysApex['UI']['questionYesNo']('Delete\x20Pay\x20&amp;\x20Charge\x20Rate?',TriSysApex['Copyright']['ShortProductName'],'Yes',fnDelete,'No');},'DeleteRecord':function(sEntityName,lEntityId,sGrid,lRateId){var CDeleteRateRequest={'EntityName':sEntityName,'EntityId':lEntityId,'RateId':lRateId},payloadObject={};payloadObject['URL']='Rates/Delete',payloadObject['OutboundDataPacket']=CDeleteRateRequest,payloadObject['InboundDataFunction']=function(data){TriSysApex['UI']['HideWait']();var CDeleteRateResponse=data;if(CDeleteRateResponse){if(CDeleteRateResponse['Success']){TriSysSDK['Grid']['ClearCheckedRows'](sGrid),TriSysSDK['Grid']['RefreshData'](sGrid);return;}else TriSysApex['UI']['ShowMessage'](CDeleteRateResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlContractRates.DeleteRecord:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Deleting\x20Rate...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DrawChart':function(sGrid){var gridData=TriSysSDK['Grid']['ReadGridContents'](sGrid);if(!gridData)return;var sChart=sGrid['replace']('-grid','-chart'),iRowCount=gridData['rows']['length'],iColumnCount=gridData['columns']['length'];if(iRowCount<=0x0||iColumnCount<=0x0){$('#'+sChart)['hide']();return;}else $('#'+sChart)['show']();var payData=[],chargeData=[],categories=[],gridRows=gridData['rows'];for(var iRow=0x0;iRow<gridRows['length'];iRow++){var row=gridRows[iRow],sRateType=row['RateType'],sPayRate=row['PayRate_Display'],sChargeRate=row['ChargeRate_Display'];if(!sPayRate)sPayRate=row['PayRate'];if(!sChargeRate)sChargeRate=row['ChargeRate'];var fPayRate=TriSysSDK['Controls']['CurrencyAmountPeriod']['ParseAmount'](sPayRate),fChargeRate=TriSysSDK['Controls']['CurrencyAmountPeriod']['ParseAmount'](sChargeRate);payData['push'](fPayRate),chargeData['push'](fChargeRate),categories['push'](sRateType);}var labelParameters={'PreSymbol':TriSysSDK['Controls']['CurrencyAmount']['DefaultCurrencySymbol'](),'PostSymbol':null,'DecimalPlaces':0x0,'Skip':0x1,'Step':null};$('#'+sChart)['kendoChart']({'chartArea':{'height':0xfa},'legend':{'position':'top','labels':{'font':TriSysSDK['KendoUICharts']['Font']}},'seriesDefaults':{'type':'column'},'series':[{'name':'Pay','data':payData},{'name':'Charge','data':chargeData}],'seriesColors':[TriSysProUI['NavBarInverseColour'](),TriSysProUI['BackColour']()],'valueAxis':TriSysSDK['KendoUICharts']['ValueAxes']['Get'](labelParameters),'categoryAxis':{'categories':categories,'line':{'visible':![]},'labels':{'padding':{'top':0x0},'font':TriSysSDK['KendoUICharts']['Font']}},'tooltip':{'visible':!![],'format':TriSysSDK['Controls']['CurrencyAmount']['DefaultCurrencySymbol']()+'#,0'}});}};