var ClientPlacement={'Load':function(){$('#webjobs-customer-name')['html'](TriSysWebJobs['Agency']['CustomerName']);var lPlacementId=TriSysWebJobs['Placement']['PlacementId'];ClientPlacement['ShowPlacementSummary'](lPlacementId);},'ShowPlacementSummary':function(lPlacementId){var CPlacementRequest={'PlacementId':lPlacementId},payloadObject={};payloadObject['URL']='Placement/Read',payloadObject['OutboundDataPacket']=CPlacementRequest,payloadObject['InboundDataFunction']=function(CPlacementResponse){TriSysApex['UI']['HideWait']();if(CPlacementResponse['Success']){$('#trisys-placement-reference')['html'](CPlacementResponse['Reference']),$('#trisys-placement-candidate')['html'](CPlacementResponse['CandidateName']),$('#trisys-placement-linemanager')['html'](CPlacementResponse['LineManagerName']),$('#trisys-placement-type')['html'](CPlacementResponse['Type']),$('#trisys-placement-jobtitle')['html'](CPlacementResponse['JobTitle']);var sLocation=CPlacementResponse['Location'];if(sLocation)sLocation=sLocation['replace'](/\n/g,'<br\x20/>');$('#trisys-placement-location')['html'](sLocation),$('#trisys-placement-company')['html'](CPlacementResponse['CompanyName']);var sDescription=CPlacementResponse['Description'],sPayType='Charge\x20Rate(s)',sRemuneration=CPlacementResponse['ChargeRate'];CPlacementResponse['Type']=='Permanent'&&(sPayType='Salary',sRemuneration=CPlacementResponse['Salary'],$('#trisys-placement-enddate-formgroup')['hide']());if(sRemuneration)sRemuneration=sRemuneration['replace'](/\n/g,'<br\x20/>');$('#trisys-placement-remunerationtype')['html'](sPayType),$('#trisys-placement-remuneration')['html'](sRemuneration);var sStartDate=moment(CPlacementResponse['StartDate'])['format']('dddd\x20DD\x20MMMM\x20YYYY');$('#trisys-placement-startdate')['html'](sStartDate);if(CPlacementResponse['EndDate']){var sEndDate=moment(CPlacementResponse['EndDate'])['format']('dddd\x20DD\x20MMMM\x20YYYY');$('#trisys-placement-enddate')['html'](sEndDate);}$('#trisys-placement-jobdescription')['html'](sDescription);if(!sDescription)$('#trisys-placement-jobdescription-formgroup')['hide']();$('#trisys-placement-username')['html'](CPlacementResponse['UserName']),fnGetUser(CPlacementResponse['UserId'],CPlacementResponse['Reference'],CPlacementResponse['JobTitle']);var clientContact=CPlacementResponse['ClientContact'];$('#trisys-placement-client-name')['html'](clientContact['FullName']),$('#trisys-placement-client-company')['html'](clientContact['CompanyName']);var sAddress=clientContact['CompanyAddressStreet'];sAddress&&(sAddress=sAddress['replace'](/\r\n/g,'<br\x20/>'),sAddress=sAddress['replace'](/\n/g,'<br\x20/>'));sAddress+='<br\x20/>'+clientContact['CompanyAddressCity']+'<br\x20/>'+clientContact['CompanyAddressCounty']+'<br\x20/>'+clientContact['CompanyAddressPostCode'];if(clientContact['CompanyAddressCountry'])sAddress+='<br\x20/>'+clientContact['CompanyAddressCountry'];$('#trisys-placement-client-address')['html'](sAddress),$('#trisys-placement-client-jobtitle')['html'](clientContact['JobTitle']),$('#trisys-placement-client-worktelno')['html'](clientContact['WorkTelNo']),$('#trisys-placement-client-mobiletelno')['html'](clientContact['WorkMobileTelNo']);if(CPlacementResponse['ClientCompanyLogoURL'])$('#trisys-placement-companylogo')['attr']('src',CPlacementResponse['ClientCompanyLogoURL'])['show']();$('#trisys-placement-client-email')['attr']('href','mailto:'+clientContact['WorkEMail']+'?subject='+CPlacementResponse['Reference']+':\x20'+CPlacementResponse['JobTitle']),$('#trisys-placement-client-email')['html'](clientContact['WorkEMail']);if(CPlacementResponse['Custom']&&CPlacementResponse['Custom']['IdentificationLink']){var sTitle='Candidate\x20ID';$('#trisys-placement-IdentificationLink')['click'](function(){TriSysSDK['Controls']['FileManager']['GetOpenFileURLFromWebService'](sTitle,CPlacementResponse['Custom']['IdentificationLink'],sTitle);}),$('#trisys-placement-IdentificationLink')['html']('Click\x20to\x20Open');}ClientPlacement['LoadTimesheets'](lPlacementId,CPlacementResponse['Type']);if(CPlacementResponse['Custom']&&CPlacementResponse['Custom']['SpecialConditions']){var sSpecialConditions=CPlacementResponse['Custom']['SpecialConditions'];if(sSpecialConditions)sSpecialConditions=sSpecialConditions['split']('\x0a')['join']('<br\x20/>');$('#trisys-placement-health-and-safety')['html'](sSpecialConditions);}return!![];}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),alert('ClientPlacement.ShowPlacementSummary:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Placement...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);var fnGetUser=function(lUserId,sReference,sJobTitle){if(lUserId>0x0){var CReadUserAccountRequest={'UserId':lUserId},payloadObject={};payloadObject['URL']='Users/ReadUserAccount',payloadObject['OutboundDataPacket']=CReadUserAccountRequest,payloadObject['InboundDataFunction']=function(CReadUserAccountResponse){TriSysApex['UI']['HideWait']();var user=CReadUserAccountResponse['UserAccount'],contact=user['Contact'];$('#trisys-placement-user-name')['html'](contact['FullName']),$('#trisys-placement-user-company')['html'](contact['CompanyName']),$('#trisys-placement-user-jobtitle')['html'](contact['JobTitle']),$('#trisys-placement-user-worktelno')['html'](contact['WorkTelNo']),$('#trisys-placement-user-mobiletelno')['html'](contact['WorkMobileTelNo']);if(user['Photo'])$('#trisys-placement-userphoto')['attr']('src',user['Photo'])['show']();return $('#trisys-placement-user-email')['attr']('href','mailto:'+contact['WorkEMail']+'?subject='+sReference+':\x20'+sJobTitle),$('#trisys-placement-user-email')['html'](contact['WorkEMail']),!![];},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),alert('ClientPlacement.ShowVacancySummary.fnGetUser:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Contact\x20Details...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);};};},'LoadTimesheets':function(lPlacementId,sType){var bPermanent=sType=='Permanent',block=$('#placement-form-timesheets-block');if(bPermanent){block['hide']();return;}var fnPopulationByFunction={'API':'Timesheets/ClientTimesheets','Parameters':function(request){request['PlacementId']=lPlacementId;},'DataTableFunction':function(response){var timesheets=response['Timesheets'];if(timesheets)for(var i=0x0;i<timesheets['length'];i++){var timesheet=timesheets[i],placement=timesheet['Placement'];timesheet['Reference']=placement['Reference'],timesheet['Company']=placement['CompanyName'],timesheet['JobTitle']=placement['JobTitle'],timesheet['TotalTimeWorked']=timesheet['Timesheet']['TotalTimeWorked'],timesheet['NetPay']=timesheet['Timesheet']['NetPay'],timesheet['Payrolled']=timesheet['Timesheet']['Payrolled'],timesheet['InputDate']=timesheet['Timesheet']['InputDate'],timesheet['Authorised']=timesheet['AuthorisedBy']?'Yes':'No',timesheet['Paid']=timesheet['Timesheet']['Payrolled']?'Yes':'No';}return timesheets;}};ClientPlacement['PopulatePlacementsGrid'](fnPopulationByFunction,'divClientPlacementTimesheetsGrid');},'PopulatePlacementsGrid':function(fnPopulationByFunction,sGridDiv){var columns=[{'field':'TimesheetId','title':'ID','type':'number','hidden':!![]},{'field':'Period','title':'Period','type':'string','width':0xc8},{'field':'InputDate','title':'Input\x20Date','type':'date','format':'{0:dd\x20MMM\x20yyyy}','width':0x82},{'field':'TotalTimeWorked','title':'Total\x20Time\x20Worked','type':'number','format':'{0:n}','width':0x96},{'field':'Authorised','title':'Authorised','type':'string'},{'field':'Paid','title':'Paid','type':'string'}],mobileVisibleColumns=[{'field':'Period','title':'Details'}],mobileRowTemplate='<td\x20colspan=\x221\x22><strong>#:\x20Period\x20#\x20</strong><br\x20/>#:\x20Input\x20#<br\x20/><i>#:\x20kendo.format(\x22{0:dd\x20MMM\x20yyyy}\x22,\x20InputDate)\x20#</i><br\x20/>'+'Time:\x20#:\x20TotalTimeWorked\x20#<br\x20/>Authorised:\x20#:\x20Authorised\x20#<br\x20/>Paid:\x20#:\x20Paid\x20#<hr></td>',gridLayout={'Div':sGridDiv,'ID':sGridDiv+'grd','Title':'Timesheets','RecordsPerPage':TriSysApex['UserOptions']['RecordsPerPage'](),'PopulationByFunction':fnPopulationByFunction,'Columns':columns,'MobileVisibleColumns':mobileVisibleColumns,'MobileRowTemplate':mobileRowTemplate,'KeyColumnName':'TimesheetId','DrillDownFunction':function(rowData){TriSysWebJobs['Timesheet']['Open'](rowData['TimesheetId'],!![]);},'MultiRowSelect':!![],'Grouping':![],'ColumnFilters':![],'OpenButtonCaption':'View'};TriSysSDK['Grid']['VirtualMode'](gridLayout);}};$(document)['ready'](function(){ClientPlacement['Load']();});