var ctrlEntityFormCustomTab={'EntityName':null,'FieldsGridID':'ctrlEntityFormCustomTab-Fields','Load':function(sEntityName){ctrlEntityFormCustomTab['EntityName']=sEntityName,TriSysSDK['CShowForm']['HTMLFieldsCodeInjection']();var customTab=TriSysSDK['CShowForm']['CustomFieldsTab']['Data']['CustomTab'](sEntityName);customTab&&(TriSysSDK['CShowForm']['writeFieldValueToWidget']('ctrlEntityFormCustomTab-Caption',customTab['Caption'],{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['Text']}),TriSysSDK['CShowForm']['writeFieldValueToWidget']('ctrlEntityFormCustomTab-ColumnCount',customTab['ColumnCount'],{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['Integer']}),TriSysSDK['CShowForm']['writeFieldValueToWidget']('ctrlEntityFormCustomTab-LabelWidth',customTab['LabelWidth'],{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['Integer']})),TriSysSDK['FormMenus']['DrawGridMenu']('ctrlEntityFormCustomTab-GridMenu',ctrlEntityFormCustomTab['FieldsGridID']),ctrlEntityFormCustomTab['LoadFieldsGrid'](sEntityName),setTimeout(TriSysProUI['kendoUI_Overrides'],0xc8);},'RefreshFieldsGrid':function(){ctrlEntityFormCustomTab['LoadFieldsGrid'](ctrlEntityFormCustomTab['EntityName']);},'LoadFieldsGrid':function(sEntityName){var cachedFieldDescriptions=[],customTab=TriSysSDK['CShowForm']['CustomFieldsTab']['Data']['CustomTab'](sEntityName);if(customTab)cachedFieldDescriptions=customTab['FieldDescriptions'];var fieldDescriptionsForGridArray=JSON['parse'](JSON['stringify'](cachedFieldDescriptions)),columns=[{'field':'FieldId','title':'FieldId','type':'number','width':0x46,'hidden':!![]},{'field':'TableName','title':'TableName','type':'string','hidden':!![]},{'field':'TableFieldName','title':'Field\x20Name','type':'string'},{'field':'FieldLabel','title':'Field\x20Label','type':'string'},{'field':'FieldTypeId','title':'FieldTypeId','type':'number','hidden':!![]},{'field':'FieldTypeName','title':'Field\x20Type','type':'string'}];TriSysSDK['Grid']['VirtualMode']({'Div':ctrlEntityFormCustomTab['FieldsGridID'],'ID':ctrlEntityFormCustomTab['FieldsGridID'],'Title':'Fields','RecordsPerPage':TriSysApex['UserOptions']['RecordsPerPage'](),'SQL':null,'PopulationByObject':fieldDescriptionsForGridArray,'Columns':columns,'MultiRowSelect':!![],'Grouping':![],'ColumnFilters':!![],'KeyColumnName':'FieldId'});return;grid['setOptions']({'scrollable':![]}),grid['table']['kendoSortable']({'filter':'>tbody\x20>tr','hint':function(element){var table=$('<table\x20style=\x22width:\x20600px;\x22\x20class=\x22k-grid\x20k-widget\x22></table>'),hint;return table['append'](element['clone']()),table['css']('opacity',0.7),table;},'cursor':'move','placeholder':function(element){return $('<tr\x20colspan=\x227\x22\x20class=\x22placeholder\x22></tr>');},'change':function(e){var skip=grid['dataSource']['skip'](),oldIndex=e['oldIndex']+skip,newIndex=e['newIndex']+skip,data=grid['dataSource']['data'](),dataItem=grid['dataSource']['getByUid'](e['item']['data']('uid'));grid['dataSource']['remove'](dataItem),grid['dataSource']['insert'](newIndex,dataItem);}});return;var grid=$('#'+ctrlEntityFormCustomTab['FieldsGridID'])['data']('kendoGrid');grid['table']['kendoDraggable']({'filter':'tbody\x20>\x20tr','group':'gridGroup','hint':function(e){return $('<div\x20class=\x22k-grid\x20k-widget\x22><table><tbody><tr>'+e['html']()+'</tr></tbody></table></div>');}}),grid['table']['kendoDropTarget']({'group':'gridGroup','drop':function(e){var target=dataSource['get']($(e['draggable']['currentTarget'])['data']('FieldId')),dest=$(e['target']);if(dest['is']('th'))return;dest=dataSource['get'](dest['parent']()['data']('FieldId'));if(target['get']('FieldId')!==dest['get']('FieldId')){var tmp=target['get']('Position');target['set']('Position',dest['get']('Position')),dest['set']('Position',tmp),dataSource['sort']({'field':'Position','dir':'asc'});}}});},'SelectedRows':function(bShowWarningIfNonSelected){var selectedRows=TriSysSDK['Grid']['GetCheckedRows'](ctrlEntityFormCustomTab['FieldsGridID']);if(!selectedRows||selectedRows['length']==0x0){if(bShowWarningIfNonSelected)TriSysApex['UI']['ShowMessage']('Please\x20select\x20one\x20or\x20more\x20fields.');}return selectedRows;},'AddField':function(){var sEntityName=ctrlEntityFormCustomTab['EntityName'],fieldDescriptions=TriSysApex['Cache']['FieldDescriptions'](),displayedFieldDescriptions=[],customTab=TriSysSDK['CShowForm']['CustomFieldsTab']['Data']['CustomTab'](sEntityName);if(customTab)displayedFieldDescriptions=customTab['FieldDescriptions'];fieldDescriptions=JSON['parse'](JSON['stringify'](fieldDescriptions));for(var i=fieldDescriptions['length']-0x1;i>=0x0;i--){var fieldDescription=fieldDescriptions[i];if(fieldDescription['TableName']['indexOf'](sEntityName)<0x0)fieldDescriptions['splice'](i,0x1);}fieldDescriptions['sort'](function(a,b){var x=a['TableName']['toLowerCase']()+'_'+a['TableFieldName']['toLowerCase'](),y=b['TableName']['toLowerCase']()+'_'+b['TableFieldName']['toLowerCase']();return x<y?-0x1:x>y?0x1:0x0;});for(var i=fieldDescriptions['length']-0x1;i>=0x0;i--){var fieldDescription=fieldDescriptions[i],bEliminate=![];displayedFieldDescriptions['forEach'](function(fd){if(fd['FieldId']==fieldDescription['FieldId'])bEliminate=!![];});if(!bEliminate)bEliminate=!ctrlEntityFormCustomTab['isConfigFieldWhichCanBeShownOnCustomTab'](fieldDescription);if(bEliminate)fieldDescriptions['splice'](i,0x1);}var fnPicked=function(fieldDescription){displayedFieldDescriptions['push'](fieldDescription);var customTab=ctrlEntityFormCustomTab['TabSettings']();return customTab['FieldDescriptions']=displayedFieldDescriptions,TriSysSDK['CShowForm']['CustomFieldsTab']['Data']['AddedCustomTab'](sEntityName,customTab),ctrlEntityFormCustomTab['RefreshFieldsGrid'](),!![];},fieldParameters=new TriSysApex['ModalDialogue']['Selection']['SelectionParameters']();fieldParameters['Title']='Select\x20Field',fieldParameters['PopulationByObject']=fieldDescriptions,fieldParameters['Columns']=[{'field':'FieldId','title':'FieldId','type':'number','width':0x46,'hidden':!![]},{'field':'TableName','title':'TableName','type':'string'},{'field':'TableFieldName','title':'TableFieldName','type':'string'},{'field':'FieldTypeName','title':'Field\x20Type','type':'string'},{'field':'Lookup','title':'Lookup','type':'string','template':'#\x20if(Lookup\x20==\x20\x22true\x22){#Yes#}else{#No#}\x20#'},{'field':'Description','title':'Description','type':'string'}],fieldParameters['CallbackFunction']=fnPicked,TriSysApex['ModalDialogue']['Selection']['Show'](fieldParameters);},'isConfigFieldWhichCanBeShownOnCustomTab':function(fieldDescription){var sFullName=fieldDescription['TableName']+'_'+fieldDescription['TableFieldName'],bConfigField=fieldDescription['TableName']['indexOf']('ConfigFields')>0x0,lstAllowedFieldTypes=[TriSysSDK['Controls']['FieldTypes']['Text'],TriSysSDK['Controls']['FieldTypes']['Integer'],TriSysSDK['Controls']['FieldTypes']['Float'],TriSysSDK['Controls']['FieldTypes']['Percent'],TriSysSDK['Controls']['FieldTypes']['Currency'],TriSysSDK['Controls']['FieldTypes']['YesNo'],TriSysSDK['Controls']['FieldTypes']['Date'],TriSysSDK['Controls']['FieldTypes']['FileReference'],TriSysSDK['Controls']['FieldTypes']['Image'],TriSysSDK['Controls']['FieldTypes']['EMail'],TriSysSDK['Controls']['FieldTypes']['Internet'],TriSysSDK['Controls']['FieldTypes']['Telephone'],TriSysSDK['Controls']['FieldTypes']['User'],TriSysSDK['Controls']['FieldTypes']['Contact'],TriSysSDK['Controls']['FieldTypes']['Company'],TriSysSDK['Controls']['FieldTypes']['CurrencyLink'],TriSysSDK['Controls']['FieldTypes']['WebPage'],TriSysSDK['Controls']['FieldTypes']['RichTextBox'],TriSysSDK['Controls']['FieldTypes']['Video'],TriSysSDK['Controls']['FieldTypes']['CurrencyAmountPeriod'],TriSysSDK['Controls']['FieldTypes']['FolderReference'],TriSysSDK['Controls']['FieldTypes']['JobTitle'],TriSysSDK['Controls']['FieldTypes']['Password'],TriSysSDK['Controls']['FieldTypes']['TextDropDown'],TriSysSDK['Controls']['FieldTypes']['MultiSelectList']],bAllowedFieldType=lstAllowedFieldTypes['indexOf'](fieldDescription['FieldTypeId'])>=0x0,lstNoNoFields=['ContactConfigFields_CRBCheck','ContactConfigFields_CVLastUpdated','ContactConfigFields_Expiry','ContactConfigFields_FormattedCV1LastUpdated','ContactConfigFields_FormattedCV2LastUpdated','ContactConfigFields_FormattedCV3LastUpdated','ContactConfigFields_FormattedCV4LastUpdated','ContactConfigFields_FormattedCVFileRef1','ContactConfigFields_FormattedCVFileRef2','ContactConfigFields_FormattedCVFileRef3','ContactConfigFields_FormattedCVFileRef4','ContactConfigFields_Identification','ContactConfigFields_IdentificationComments','ContactConfigFields_IdentificationLink','ContactConfigFields_IdentificationLink2','ContactConfigFields_Link3','ContactConfigFields_Link4','ContactConfigFields_Link5','ContactConfigFields_Link6','ContactConfigFields_Nationality','ContactConfigFields_Status','ContactConfigFields_TypeOfWorkRequired','ContactConfigFields_UmbrellaReference','ContactConfigFields_AddedBy','ContactConfigFields_ContactPhoto','ContactConfigFields_ContactSource','ContactConfigFields_ContactTempPeriod','ContactConfigFields_Gender','ContactConfigFields_RequiredRemunerationTemporary','ContactConfigFields_RequiredRemunerationPermanent','ContactConfigFields_RequiredRemunerationContract','CompanyConfigFields_AdditionalDoc1','CompanyConfigFields_AdditionalDoc2','CompanyConfigFields_AdditionalDoc3','CompanyConfigFields_AdditionalDoc4','CompanyConfigFields_CompanyDivision','CompanyConfigFields_CompanyLogo','CompanyConfigFields_CompanyStatus','CompanyConfigFields_Source','RequirementConfigFields_ActiveSearchingLastRun','RequirementConfigFields_BenefitsValue','RequirementConfigFields_Bonus','RequirementConfigFields_CarValue','RequirementConfigFields_DateInitiated','RequirementConfigFields_DaysPerWeek','RequirementConfigFields_EarliestStartDate','RequirementConfigFields_ExpectedRevenueDate','RequirementConfigFields_Fee','RequirementConfigFields_FeePercentage','RequirementConfigFields_HoursPerDay','RequirementConfigFields_IncludeCarInFee','RequirementConfigFields_JobDescription','RequirementConfigFields_JobTitle','RequirementConfigFields_MaximumSalary','RequirementConfigFields_MinimumSalary','RequirementConfigFields_MeritRequirementReference','RequirementConfigFields_NumberRequired','RequirementConfigFields_ProbabilityToFill','RequirementConfigFields_RequirementStatus','RequirementConfigFields_SiteAddressId','RequirementConfigFields_SiteAddress','RequirementConfigFields_TotalPackageValue','PlacementConfigFields_AttachmentsUsed','PlacementConfigFields_AvailableTemplates','PlacementConfigFields_BenefitsValue','PlacementConfigFields_Bonus','PlacementConfigFields_Candidate','PlacementConfigFields_CandidateEMail','PlacementConfigFields_CandidateSourceTemplate','PlacementConfigFields_Car','PlacementConfigFields_CarValue','PlacementConfigFields_ChargeRatesList','PlacementConfigFields_ClientContractDoc','PlacementConfigFields_DateCandidateContractIssued','PlacementConfigFields_DateInitiated','PlacementConfigFields_DaysPerWeek','PlacementConfigFields_DurationInWeeks','PlacementConfigFields_EndDate','PlacementConfigFields_DurationInWeeks','PlacementConfigFields_Fee','PlacementConfigFields_FeePercentage','PlacementConfigFields_FixedTermDurationWeeks','PlacementConfigFields_FollowUpTime','PlacementConfigFields_HoursPerDay','PlacementConfigFields_InterviewDay','PlacementConfigFields_InterviewLocation','PlacementConfigFields_InterviewStage','PlacementConfigFields_InvoiceContact','PlacementConfigFields_JobTitle','Placement_Note/History\x20Duration','PlacementConfigFields_PlacementIncludeCarInFee','PlacementConfigFields_PlacementStatus','PlacementConfigFields_Salary','PlacementConfigFields_SetInScopeToNo','PlacementConfigFields_StartDate','PlacementConfigFields_TotalPackageValue','TimesheetConfigFields_AuthorisationRequested','TimesheetConfigFields_AuthorisedBy','TimesheetConfigFields_AuthorisedDate','TimesheetConfigFields_AuthorisedIPAddress','TimesheetConfigFields_BarCode','TimesheetConfigFields_ChargeVAT','TimesheetConfigFields_InputDate','TimesheetConfigFields_RateSelectionText','TimesheetConfigFields_TimesheetLink','Last_One_Without_Trailing_Comma'],bFound=lstNoNoFields['indexOf'](sFullName)>=0x0,bFieldCanBeShownOnCustomTab=bConfigField&&bAllowedFieldType&&!bFound;return bFieldCanBeShownOnCustomTab;},'DeleteField':function(){var selectedRows=ctrlEntityFormCustomTab['SelectedRows'](!![]);if(!selectedRows||selectedRows['length']==0x0)return;var fieldDescriptions=[],customTab=TriSysSDK['CShowForm']['CustomFieldsTab']['Data']['CustomTab'](ctrlEntityFormCustomTab['EntityName']);if(customTab)fieldDescriptions=customTab['FieldDescriptions'];for(var i=fieldDescriptions['length']-0x1;i>=0x0;i--){var fieldDescription=fieldDescriptions[i];selectedRows['forEach'](function(row){if(row['FieldId']==fieldDescription['FieldId'])fieldDescriptions['splice'](i,0x1);});}ctrlEntityFormCustomTab['RefreshFieldsGrid']();},'MoveFieldUp':function(){ctrlEntityFormCustomTab['MoveFields'](!![]);},'MoveFieldDown':function(){ctrlEntityFormCustomTab['MoveFields'](![]);},'MoveFields':function(bUp){var selectedRows=ctrlEntityFormCustomTab['SelectedRows'](!![]);if(!selectedRows||selectedRows['length']==0x0)return;var fnArrayMove=function(arr,old_index,new_index){while(old_index<0x0){old_index+=arr['length'];}while(new_index<0x0){new_index+=arr['length'];}if(new_index>=arr['length']){k=new_index-arr['length'];while(k--+0x1){arr['push'](undefined);}}return arr['splice'](new_index,0x0,arr['splice'](old_index,0x1)[0x0]),arr;},fieldDescriptions=[],customTab=TriSysSDK['CShowForm']['CustomFieldsTab']['Data']['CustomTab'](ctrlEntityFormCustomTab['EntityName']);if(customTab)fieldDescriptions=customTab['FieldDescriptions'];var lstMoveInstructions=[];for(var i=fieldDescriptions['length']-0x1;i>=0x0;i--){var fieldDescription=fieldDescriptions[i];selectedRows['forEach'](function(row){row['FieldId']==fieldDescription['FieldId']&&(bUp?i>0x0&&lstMoveInstructions['push']({'from':i,'to':i-0x1}):i<fieldDescriptions['length']-0x1&&lstMoveInstructions['push']({'from':i,'to':i+0x1}));});}if(bUp)for(var i=lstMoveInstructions['length']-0x1;i>=0x0;i--){var instruction=lstMoveInstructions[i];fieldDescriptions=fnArrayMove(fieldDescriptions,instruction['from'],instruction['to']);}else for(var i=0x0;i<lstMoveInstructions['length'];i++){var instruction=lstMoveInstructions[i];fieldDescriptions=fnArrayMove(fieldDescriptions,instruction['from'],instruction['to']);}ctrlEntityFormCustomTab['RefreshFieldsGrid']();},'Save':function(sEntityName){var displayedFieldDescriptions=[],customTab=TriSysSDK['CShowForm']['CustomFieldsTab']['Data']['CustomTab'](sEntityName);if(customTab)displayedFieldDescriptions=customTab['FieldDescriptions'];var newCustomTab=ctrlEntityFormCustomTab['TabSettings']();return customTab&&(customTab['Caption']=newCustomTab['Caption'],customTab['ColumnCount']=newCustomTab['ColumnCount'],customTab['LabelWidth']=newCustomTab['LabelWidth']),newCustomTab['Fields']=[],displayedFieldDescriptions['forEach'](function(fieldDescription){newCustomTab['Fields']['push']({'FieldId':fieldDescription['FieldId']});}),ctrlEntityFormCustomTab['SendToWebAPI'](newCustomTab),![];},'SendToWebAPI':function(CWriteApexEntityFormCustomFieldsTabRequest){var payloadObject={};payloadObject['URL']='EntityCustomTab/Write',payloadObject['OutboundDataPacket']=CWriteApexEntityFormCustomFieldsTabRequest,payloadObject['InboundDataFunction']=function(CWriteApexEntityFormCustomFieldsTabResponse){TriSysApex['UI']['HideWait']();if(CWriteApexEntityFormCustomFieldsTabResponse){if(CWriteApexEntityFormCustomFieldsTabResponse['Success'])TriSysApex['UI']['CloseModalPopup']();else TriSysApex['UI']['ShowMessage'](CWriteApexEntityFormCustomFieldsTabResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlEntityFormCustomTab.SendToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Saving\x20Custom\x20Fields...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'TabSettings':function(){var customTab={'EntityName':ctrlEntityFormCustomTab['EntityName'],'Caption':TriSysSDK['CShowForm']['readFieldValueFromWidget']('ctrlEntityFormCustomTab-Caption',TriSysSDK['Controls']['FieldTypes']['Text']),'ColumnCount':TriSysSDK['CShowForm']['readFieldValueFromWidget']('ctrlEntityFormCustomTab-ColumnCount',TriSysSDK['Controls']['FieldTypes']['Integer']),'LabelWidth':TriSysSDK['CShowForm']['readFieldValueFromWidget']('ctrlEntityFormCustomTab-LabelWidth',TriSysSDK['Controls']['FieldTypes']['Integer'])};return customTab;}};