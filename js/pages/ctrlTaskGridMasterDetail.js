var ctrlTaskGridMasterDetail={'NativeControlPrefix':'ctrlTaskGridMasterDetail','Load':function(options){if(!options)return;ctrlTaskGridMasterDetail['Data']['Clear'](options['ControlID']);var sControlID=options['ControlID'];if($('#'+sControlID)['length']==0x0)return;TriSysApex['FormsManager']['loadControlIntoDiv'](sControlID,ctrlTaskGridMasterDetail['NativeControlPrefix']+'.html',function(response,status,xhr){ctrlTaskGridMasterDetail['DrawAfterLoad'](options);});},'ShowActiveTabKludge':function(options){var sTabID=$('#'+options['ControlID']+'-taskForm-tabs')['find']('li.active\x20a')['parent']()[0x0]['id'],sMakeActiveID='#'+sTabID['replace']('taskForm-tab','task-tabs');$(sMakeActiveID)['addClass']('active')['show']();},'tabClick':function(thisObject){var parentLIid=thisObject['parent']()[0x0]['id'],sControlID=ctrlTaskGridMasterDetail['ControlIDFromForm'](null,parentLIid),sTabID=parentLIid,sMakeActiveID='#'+sTabID['replace']('taskForm-tab','task-tabs');$('#'+sControlID+'-taskForm-tabs\x20li')['each'](function(){$(this)['removeClass']('active');}),$(sTabID)['addClass']('active')['show'](),$('#'+sControlID+'\x20.tab-pane')['hide']()['removeClass']('active'),$(sMakeActiveID)['addClass']('active')['show']();},'DrawAfterLoad':function(options){var iFudgeFactor=0x131,lHeight=$(window)['height']()-iFudgeFactor;$('#'+ctrlTaskGridMasterDetail['NativeControlPrefix']+'-Splitter-vertical')['height'](lHeight)['css']('border-radius','8px'),$('#grid-pane')['height'](lHeight),$('#'+ctrlTaskGridMasterDetail['NativeControlPrefix']+'-Splitter-vertical')['kendoSplitter']({'orientation':'vertical','panes':[{'collapsible':![]}]});var lWidth=$('#grid-pane')['width']()/0x2;$('#'+ctrlTaskGridMasterDetail['NativeControlPrefix']+'-Splitter-horizontal')['kendoSplitter']({'panes':[{'collapsible':![],'size':lWidth+'px'},{'collapsible':![]}]}),TriSysApex['FormsManager']['loadControlReplacingDiv'](ctrlTaskGridMasterDetail['NativeControlPrefix']+'-TaskPanel','ctrlTaskDetail.html',function(response,status,xhr){ctrlTaskGridMasterDetail['LoadTaskFormWidgets'](options),TriSysSDK['Controls']['General']['ReplaceDivTagsOfDynamicallyLoadedUserControl'](options['ControlID']);var sDefaultType=options['Scheduled']?'ToDo':'Note';TriSysActions['Forms']['TaskType']['Load'](options['ControlID']+'-taskForm-TaskType',options['ControlID']+'-taskForm-selected-TaskType-Image',sDefaultType),TriSysSDK['Controls']['Duration']['Initialise'](options['ControlID']+'-taskForm-Duration'),$('#'+options['ControlID']+'-taskForm-set-alarm')['change'](function(){var bSetAlarm=$(this)['is'](':checked');if(bSetAlarm)$('#'+options['ControlID']+'-taskForm-alarm-lead-time-tr')['show']();else $('#'+options['ControlID']+'-taskForm-alarm-lead-time-tr')['hide']();}),ctrlTaskGridMasterDetail['LoadDocumentWidgets'](options);var sContainer=options['ControlID']+'-ctrlTaskGridMasterDetail-Options-ControlID';$('#'+sContainer)['text'](options['ControlID']),ctrlTaskGridMasterDetail['AdjustHeights'](options['ControlID']),$('a[href^=\x22#task-tabs\x22]')['each'](function(){var currentHref=$(this)['attr']('href'),newHref=currentHref['replace'](/^#task-tabs/,'#'+options['ControlID']+'-task-tabs');$(this)['attr']('href',newHref);}),$('[data-toggle=\x22tabs\x22]\x20a,\x20.enable-tabs\x20a')['click'](function(e){e['preventDefault'](),$(this)['tab']('show');});var sGridCaption=options['EntityName']+'\x20'+(options['Scheduled']?'Scheduled\x20Tasks':'Notes/History');$('#'+options['ControlID']+'-task-grid-caption')['text'](sGridCaption);if(options['CallbackFunctionOnLoad'])options['CallbackFunctionOnLoad'](options);});},'AdjustHeights':function(sControlID){var elemTaskPane=$('#'+sControlID+'-task-pane'),elemTaskTabs=$('#'+sControlID+'-taskForm-tabs'),iHeight=elemTaskPane['height']()-elemTaskTabs['height']()-0x82;$('#'+sControlID+'-taskForm-Description')['height'](iHeight-0xc8),$('#'+sControlID+'-taskForm-contacts-list-container')['height'](iHeight),$('#'+sControlID+'-taskForm-users-list-container')['height'](iHeight),$('#'+sControlID+'-taskForm-links-list-container')['height'](iHeight);},'Populate':function(options){var bScheduled=options['Scheduled'],sGridID=options['ControlID']+'-ctrlTaskGridMasterDetail-Grid',fnParameters=function(request){switch(options['EntityName']){case'Contact':request['ContactId']=options['RecordId'];break;case'Company':request['CompanyId']=options['RecordId'];break;case'Requirement':request['RequirementId']=options['RecordId'];break;case'Placement':request['PlacementId']=options['RecordId'];break;case'Timesheet':request['TimesheetId']=options['RecordId'];break;}},fnPostPopulationCallback=null,fnDrillDownClickCallback=function(lTaskId){ctrlTaskGridMasterDetail['LoadTask'](lTaskId,options);},gridOptions={'DrillDownClickCallback':fnDrillDownClickCallback,'SingleClickRowHandler':fnDrillDownClickCallback,'HideOpenButton':options['HideOpenButton']};TriSysApex['Forms']['EntityForm']['LoadTaskGrid'](options['EntityName'],sGridID,fnParameters,bScheduled,fnPostPopulationCallback,gridOptions);},'ControlIDFromForm':function(sLookAboveID,thisObject){var $allSpans=$('span[id$=\x22-Options-ControlID\x22]'),$startElement=sLookAboveID?$('#'+sLookAboveID):$(thisObject),$closestSpan=$allSpans['eq'](0x0),closestDistance=Infinity;$allSpans['each'](function(){var distance=$(this)['closest']($startElement)['length'];distance<closestDistance&&(closestDistance=distance,$closestSpan=$(this));});var text=$closestSpan['text']();return text;},'LoadTaskFormWidgets':function(options){ctrlTaskGridMasterDetail['ConsiderSmallFormFactors']('');var fnChangeStartDateTime=function(dtStart){var dtEnd=new Date(TriSysSDK['CShowForm']['getDateTimePickerValue']('taskForm-EndDateTime'));if(dtStart>dtEnd)TriSysSDK['CShowForm']['setDateTimePickerValue']('taskForm-EndDateTime',moment(dtStart)['add'](0.25,'hours'));},fnChangeEndDateTime=function(dtEnd){var dtStart=new Date(TriSysSDK['CShowForm']['getDateTimePickerValue']('taskForm-StartDateTime'));if(dtEnd<dtStart)TriSysSDK['CShowForm']['setDateTimePickerValue']('taskForm-StartDateTime',moment(dtEnd)['add'](-0.25,'hours'));};TriSysSDK['CShowForm']['dateTimePicker']('taskForm-StartDateTime',fnChangeStartDateTime),TriSysSDK['CShowForm']['dateTimePicker']('taskForm-EndDateTime',fnChangeEndDateTime),TriSysSDK['CShowForm']['datePicker']('taskForm-StartDate'),TriSysSDK['CShowForm']['datePicker']('taskForm-EndDate'),$('#taskForm-all-day-task')['change'](function(){ctrlTaskGridMasterDetail['AllDayTaskCheckBoxChangeEvent'](this,options['ControlID']+'-');}),TriSysSDK['FormMenus']['DrawGridMenu']('taskForm-contactsGrid-GridMenu','taskForm-ContactGrid'),TriSysSDK['FormMenus']['DrawGridMenu']('taskForm-usersGrid-GridMenu','taskForm-UserGrid'),TriSysSDK['FormMenus']['DrawDropDownMenuFromTemplate']('taskForm-linksGrid-Menu','taskForm','ctrlTaskLinksGridMenu.html',function(sMenuItemID){ctrlTaskGridMasterDetail['LinksGridMenuCallback'](sMenuItemID,options);},'taskForm-linksGrid-menu'),TriSysSDK['FormMenus']['DrawGridMenu']('taskForm-linksGrid-GridMenu','taskForm-LinksGrid'),TriSysSDK['Attributes']['Load']('Task',0x0,'task-form-attributes');},'LoadDocumentWidgets':function(options){var sAttachmentFileRef=options['ControlID']+'-taskForm-Attachment-File-Reference',fnFileAttachmentCallback=function(sOperation,divTag,sFilePath,options){switch(sOperation){case'find':TriSysApex['Pages']['FileManagerForm']['FileOpenDrillDown'](sFilePath);break;case'delete':break;}},fieldDescription={'TableFieldName':'Task\x20Attachment','TableName':'Task'};TriSysSDK['Controls']['FileReference']['Load'](sAttachmentFileRef,fieldDescription,fnFileAttachmentCallback,options);},'AllDayTaskCheckBoxChangeEvent':function(e,sPrefix){var bCheckedAllDayTask=$(e)['is'](':checked');if(bCheckedAllDayTask){$('#'+sPrefix+'taskForm-StartTimeLabel')['hide'](),$('#'+sPrefix+'taskForm-EndTimeLabel')['hide'](),$('#'+sPrefix+'taskForm-StartDateTimeSpan')['hide'](),$('#'+sPrefix+'taskForm-EndDateTimeSpan')['hide'](),$('#'+sPrefix+'taskForm-StartDateSpan')['show'](),$('#'+sPrefix+'taskForm-EndDateSpan')['show']();var dtStart=TriSysSDK['CShowForm']['getDateTimePickerValue'](sPrefix+'taskForm-StartDateTime'),dtEnd=TriSysSDK['CShowForm']['getDateTimePickerValue'](sPrefix+'taskForm-EndDateTime');TriSysSDK['CShowForm']['setDatePickerValue'](sPrefix+'taskForm-StartDate',dtStart),TriSysSDK['CShowForm']['setDatePickerValue'](sPrefix+'taskForm-EndDate',dtEnd),dtStart=moment(dtStart)['set']('hour',0x0)['set']('minute',0x0),dtEnd=moment(dtEnd)['set']('hour',0x17)['set']('minute',0x3b),TriSysSDK['CShowForm']['setDateTimePickerValue'](sPrefix+'taskForm-StartDateTime',dtStart),TriSysSDK['CShowForm']['setDateTimePickerValue'](sPrefix+'taskForm-EndDateTime',dtEnd);}else $('#'+sPrefix+'taskForm-StartTimeLabel')['show'](),$('#'+sPrefix+'taskForm-EndTimeLabel')['show'](),$('#'+sPrefix+'taskForm-StartDateTimeSpan')['show'](),$('#'+sPrefix+'taskForm-EndDateTimeSpan')['show'](),$('#'+sPrefix+'taskForm-StartDateSpan')['hide'](),$('#'+sPrefix+'taskForm-EndDateSpan')['hide']();},'ConsiderSmallFormFactors':function(sPrefix){sPrefix='#'+sPrefix+'-taskForm-';var lWidth=$(sPrefix+'-top-block')['width'](),iMinimumWidthForFullDateTimeVisibility=0x226;lWidth<iMinimumWidthForFullDateTimeVisibility&&($(sPrefix+'TaskTypeContainerForSmallFormFactor-tr')['show'](),$(sPrefix+'TaskType')['detach']()['appendTo'](sPrefix+'TaskTypeContainerForSmallFormFactor'),$(sPrefix+'TaskTypeContainerForSmallFormFactor')['append']('&nbsp;<br\x20/>'),$(sPrefix+'Scheduled-group')['detach']()['appendTo'](sPrefix+'TaskTypeContainerForSmallFormFactor'),$(sPrefix+'StartDateContainerForSmallFormFactor-tr')['show'](),$(sPrefix+'StartDateTimeSpan')['detach']()['appendTo'](sPrefix+'StartDateContainerForSmallFormFactor'),$(sPrefix+'StartDateSpan')['detach']()['appendTo'](sPrefix+'StartDateContainerForSmallFormFactor'),$(sPrefix+'EndDateContainerForSmallFormFactor-tr')['show'](),$(sPrefix+'EndDateTimeSpan')['detach']()['appendTo'](sPrefix+'EndDateContainerForSmallFormFactor'),$(sPrefix+'EndDateSpan')['detach']()['appendTo'](sPrefix+'EndDateContainerForSmallFormFactor'),$(sPrefix+'EndDateContainerForSmallFormFactor')['append']('&nbsp;<br\x20/>'),$(sPrefix+'AllDayTask-group')['detach']()['appendTo'](sPrefix+'EndDateContainerForSmallFormFactor'));},'ContactsGridMenuCallback':function(sMenuItemID,thisObject){var sControlID=ctrlTaskGridMasterDetail['ControlIDFromForm'](null,thisObject['id']),sPrefix='taskForm-contactsGrid-file-menu-',sSuffix='';switch(sMenuItemID){case sPrefix+'add-contact'+sSuffix:var fnSelectContact=function(selectedRow){if(!selectedRow)return;var lContactId=selectedRow['Contact_ContactId'],contact={'ContactId':lContactId,'FullName':selectedRow['Contact_Christian']+'\x20'+selectedRow['Contact_Surname'],'CompanyName':selectedRow['Contact_Company'],'JobTitle':selectedRow['Contact_JobTitle'],'ContactType':selectedRow['Contact_ContactType']};return ctrlTaskGridMasterDetail['AddContactToGrid'](contact,!![],sControlID),!![];};TriSysApex['ModalDialogue']['Contacts']['Select'](fnSelectContact);break;case sPrefix+'open-contact'+sSuffix:var lContactId=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid']('taskForm-ContactGrid','ContactId','contact');lContactId>0x0&&(TriSysApex['UI']['CloseModalPopup'](),TriSysApex['FormsManager']['OpenForm']('Contact',lContactId));break;case sPrefix+'delete-contact'+sSuffix:var selectedRows=TriSysSDK['Grid']['GetCheckedRows']('taskForm-ContactGrid');if(selectedRows&&selectedRows['length']>=0x1&&ctrlTask['Data']['Contacts']()){for(var i=0x0;i<selectedRows['length'];i++){var lContactId=selectedRows[i]['ContactId'];for(var c=0x0;c<ctrlTask['Data']['Contacts']()['length'];c++){var contact=ctrlTask['Data']['Contacts']()[c];if(contact['ContactId']==lContactId){ctrlTask['Data']['Contacts']()['splice'](c,0x1);break;}}}ctrlTaskGridMasterDetail['LoadContactsGrid'](![],sControlID);}break;}},'AddContactToGrid':function(contact,bShowWait,sControlID){if(ctrlTaskGridMasterDetail['Data']['DuplicateContactCheck'](contact,sControlID))return;var CContactReadRequest={'ContactId':contact['ContactId']},payloadObject={};payloadObject['URL']='Contact/Read',payloadObject['OutboundDataPacket']=CContactReadRequest,payloadObject['InboundDataFunction']=function(CContactReadResponse){if(bShowWait)TriSysApex['UI']['HideWait']();CContactReadResponse&&(CContactReadResponse['Success']&&(ctrlTaskGridMasterDetail['Data']['AddContact'](CContactReadResponse['Contact'],sControlID),ctrlTaskGridMasterDetail['LoadContactsGrid'](![],sControlID)));},payloadObject['ErrorHandlerFunction']=function(request,status,error){if(bShowWait)TriSysApex['UI']['HideWait']();TriSysApex['UI']['errorAlert']('ctrlTaskGridMasterDetail.AddContactToGrid:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);};if(bShowWait)TriSysApex['UI']['ShowWait'](null,'Reading\x20Contact...');TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'AddUserToGrid':function(user,sControlID){ctrlTaskGridMasterDetail['Data']['AddUser'](user,sControlID),ctrlTaskGridMasterDetail['LoadUsersGrid'](sControlID);},'DeleteContactFromTaskGrid':function(lContactId,thisObject){if(lContactId>0x0){var sControlID=ctrlTaskGridMasterDetail['ControlIDFromForm'](null,thisObject['id']);ctrlTaskGridMasterDetail['Data']['DeleteContact'](lContactId,sControlID),ctrlTaskGridMasterDetail['LoadContactsGrid'](![],sControlID);}},'OpenContactFromTaskGrid':function(lContactId){if(lContactId>0x0){setTimeout(TriSysApex['UI']['CloseModalPopup'],0xa);var fnOpen=function(){TriSysApex['FormsManager']['OpenForm']('Contact',lContactId);};setTimeout(fnOpen,0xfa);}},'OpenCompany':function(lCompanyId){setTimeout(TriSysApex['UI']['CloseModalPopup'],0xa);var fnOpen=function(){TriSysApex['FormsManager']['OpenForm']('Company',lCompanyId);};setTimeout(fnOpen,0xfa);},'LoadContactsGrid':function(bGetFullContactRecord,sControlID){var contactList=ctrlTaskGridMasterDetail['Data']['Contacts'](sControlID);if(bGetFullContactRecord){var sJSON=JSON['stringify'](contactList);ctrlTask['Data']['_Task']['Contacts']=[],contactList=JSON['parse'](sJSON);for(var i=0x0;i<contactList['length'];i++){var contact=contactList[i];ctrlTaskGridMasterDetail['AddContactToGrid'](contact,![]);}return;}var lstElem=$('#'+sControlID+'-taskForm-contacts-list-container');lstElem['empty']();if(contactList){contactList['sort'](function(a,b){return a['Surname']>b['Surname'];});var fnBuildFromTemplate=function(CContact){var bClientContact=CContact['ContactType']['indexOf']('Client')==0x0||CContact['ContactType']['indexOf']('User')==0x0,bCandidateContact=CContact['ContactType']['indexOf']('Candidate')>=0x0,sHTML=$('#taskForm-contacts-template')['html']();if(!sHTML)return;sHTML=sHTML['replace'](/#:ContactId#/g,CContact['ContactId']),sHTML=sHTML['replace']('#:FullName#',CContact['FullName']),sHTML=sHTML['replace']('#:Type#',CContact['ContactType']),sHTML=sHTML['replace']('#:JobTitle#',CContact['JobTitle']?CContact['JobTitle']:''),sHTML=sHTML['replace']('#:CompanyName#',CContact['CompanyName']?CContact['CompanyName']:''),sHTML=sHTML['replace']('#:CompanyId#',CContact['CompanyId']);if(!CContact['ContactPhotoURL'])CContact['ContactPhotoURL']=TriSysApex['Constants']['DefaultContactImage'];sHTML=sHTML['replace']('#:ContactPhotoURL#',CContact['ContactPhotoURL']);var workPhoneId='{{taskForm-contacts-worktelno-tr}}',sStyle='display:\x20none;';bClientContact&&CContact['WorkTelNo']&&(sStyle='',sHTML=sHTML['replace'](/{{taskForm-contacts-worktelno}}/g,CContact['WorkTelNo']));sHTML=sHTML['replace'](workPhoneId,sStyle);var workMobilePhoneId='{{taskForm-contacts-workmobiletelno-tr}}',sStyle='display:\x20none;';bClientContact&&CContact['WorkMobileTelNo']&&(sStyle='',sHTML=sHTML['replace'](/{{taskForm-contacts-workmobiletelno}}/g,CContact['WorkMobileTelNo']));sHTML=sHTML['replace'](workMobilePhoneId,sStyle);var workEMailId='{{taskForm-contacts-workemail-tr}}',sStyle='display:\x20none;';bClientContact&&CContact['WorkEMail']&&(sStyle='',sHTML=sHTML['replace'](/{{taskForm-contacts-workemail}}/g,CContact['WorkEMail']));sHTML=sHTML['replace'](workEMailId,sStyle);var homePhoneId='{{taskForm-contacts-hometelno-tr}}',sStyle='display:\x20none;';bCandidateContact&&CContact['HomeAddressTelNo']&&(sStyle='',sHTML=sHTML['replace'](/{{taskForm-contacts-hometelno}}/g,CContact['HomeAddressTelNo']));sHTML=sHTML['replace'](homePhoneId,sStyle);var personalMobilePhoneId='{{taskForm-contacts-personalmobiletelno-tr}}',sStyle='display:\x20none;';bCandidateContact&&CContact['MobileTelNo']&&(sStyle='',sHTML=sHTML['replace'](/{{taskForm-contacts-personalmobiletelno}}/g,CContact['MobileTelNo']));sHTML=sHTML['replace'](personalMobilePhoneId,sStyle);var personalEMailId='{{taskForm-contacts-personalemail-tr}}',sStyle='display:\x20none;';return bCandidateContact&&CContact['PersonalEMail']&&(sStyle='',sHTML=sHTML['replace'](/{{taskForm-contacts-personalemail}}/g,CContact['PersonalEMail'])),sHTML=sHTML['replace'](personalEMailId,sStyle),sHTML;};for(var i=0x0;i<contactList['length'];i++){var contact=contactList[i],sHTML=fnBuildFromTemplate(contact);lstElem['append'](sHTML);}TriSysProUI['kendoUI_Overrides'](),$('#'+sControlID+'-taskForm-contacts-label')['html'](contactList['length']+'\x20Task\x20Contact'+(contactList['length']==0x1?'':'s'));}},'UsersGridMenuCallback':function(sMenuItemID,thisObject){var sControlID=ctrlTaskGridMasterDetail['ControlIDFromForm'](null,thisObject['id']),sPrefix='taskForm-usersGrid-file-menu-',sSuffix='';switch(sMenuItemID){case sPrefix+'add-user'+sSuffix:var fnSelectUser=function(selectedRow){if(!selectedRow)return;var lUserId=selectedRow['UserId'],user={'UserId':lUserId,'FullName':selectedRow['FullName'],'LoginName':selectedRow['LoginName'],'JobTitle':selectedRow['JobTitle'],'TelNo':selectedRow['TelNo']};return ctrlTaskGridMasterDetail['AddUserToGrid'](user,sControlID),!![];};TriSysApex['ModalDialogue']['Users']['Select'](fnSelectUser,{'NotLocked':!![]});break;case sPrefix+'delete-user'+sSuffix:var selectedRows=TriSysSDK['Grid']['GetCheckedRows']('taskForm-UserGrid');if(selectedRows&&selectedRows['length']>=0x1&&TriSysApex['ModalDialogue']['Parameters']['Users']){for(var i=0x0;i<selectedRows['length'];i++){var lUserId=selectedRows[i]['UserId'];for(var u=0x0;u<TriSysApex['ModalDialogue']['Parameters']['Users']['length'];u++){var user=TriSysApex['ModalDialogue']['Parameters']['Users'][u];if(user['UserId']==lUserId){TriSysApex['ModalDialogue']['Parameters']['Users']['splice'](u,0x1);break;}}}ctrlTaskGridMasterDetail['LoadUsersGrid'](sControlID);}break;}},'DeleteUserFromTaskGrid':function(lUserId,thisObject){if(lUserId>0x0){var sControlID=ctrlTaskGridMasterDetail['ControlIDFromForm'](null,thisObject['id']);ctrlTaskGridMasterDetail['Data']['DeleteUser'](lUserId,sControlID),ctrlTaskGridMasterDetail['LoadUsersGrid'](sControlID);}},'SetOwner':function(lUserId,thisObject){var sControlID=ctrlTaskGridMasterDetail['ControlIDFromForm'](null,thisObject['id']),task=ctrlTaskGridMasterDetail['Data']['Task'](sControlID);task&&(task['OwnerUserId']=lUserId,ctrlTaskGridMasterDetail['LoadUsersGrid'](sControlID));},'LoadUsersGrid':function(sControlID){var userList=ctrlTaskGridMasterDetail['Data']['Users'](sControlID),lstElem=$('#'+sControlID+'-taskForm-users-list-container');lstElem['empty']();if(userList){userList['sort'](function(a,b){return a['FullName']>b['FullName'];});var fnBuildFromTemplate=function(user){var sUserOwnerLabel=user['isOwner']?'(Owner)':'',sHTML=$('#taskForm-users-template')['html']();return sHTML=sHTML['replace'](/#:UserId#/g,user['UserId']),sHTML=sHTML['replace']('#:FullName#',user['FullName']),sHTML=sHTML['replace']('#:OwnerUser#',sUserOwnerLabel),sHTML=sHTML['replace']('#:TelNo#',user['TelNo']?user['TelNo']:'\x20&nbsp;'),sHTML;};for(var i=0x0;i<userList['length'];i++){var user=userList[i];user['isOwner']=![];var task=ctrlTaskGridMasterDetail['Data']['Task'](sControlID);if(task){if(user['UserId']==task['OwnerUserId'])user['isOwner']=!![];}var sHTML=fnBuildFromTemplate(user);lstElem['append'](sHTML);}TriSysProUI['kendoUI_Overrides'](),$('#'+sControlID+'-taskForm-users-label')['html'](userList['length']+'\x20Task\x20User'+(userList['length']==0x1?'':'s'));}},'LinksGridMenuCallback':function(sMenuItemID,options){var sPrefix='taskForm-linksGrid-menu-',sSuffix='-taskForm';switch(sMenuItemID){case sPrefix+'link-requirement'+sSuffix:var fnSelectRequirement=function(selectedRow){if(!selectedRow)return;var entity={'Name':'Requirement','RecordId':selectedRow['Requirement_RequirementId'],'Description':selectedRow['Requirement_RequirementReference']+':\x20'+selectedRow['Requirement_JobTitle']+'\x20at\x20'+selectedRow['RequirementCompany_Name']+'\x20with\x20'+selectedRow['RequirementContact_FullName']};return ctrlTaskGridMasterDetail['AddEntityLinkToGrid'](entity,options),!![];};TriSysApex['ModalDialogue']['Requirements']['Select'](fnSelectRequirement);break;case sPrefix+'link-placement'+sSuffix:var fnSelectPlacement=function(selectedRow){if(!selectedRow)return;var entity={'Name':'Placement','RecordId':selectedRow['Placement_PlacementId'],'Description':selectedRow['Placement_Reference']+':\x20'+selectedRow['CandidateContact_FullName']+',\x20'+selectedRow['Placement_JobTitle']+'\x20at\x20'+selectedRow['PlacementCompany_Name']};return ctrlTaskGridMasterDetail['AddEntityLinkToGrid'](entity,options),!![];};TriSysApex['ModalDialogue']['Placements']['Select'](fnSelectPlacement);break;case sPrefix+'link-timesheet'+sSuffix:var fnSelectTimesheet=function(selectedRow){if(!selectedRow)return;var entity={'Name':'Timesheet','RecordId':selectedRow['TimesheetId'],'Description':selectedRow['Reference']+':\x20'+selectedRow['Candidate']+',\x20'+selectedRow['JobTitle']+'\x20at\x20'+selectedRow['Company']+',\x20period:\x20'+selectedRow['Period']};return ctrlTaskGridMasterDetail['AddEntityLinkToGrid'](entity,options),!![];};TriSysApex['ModalDialogue']['Timesheets']['Select'](fnSelectTimesheet);break;}},'OpenLinkFromTaskGrid':function(sEntity,lRecordId){TriSysApex['FormsManager']['OpenForm'](sEntity,lRecordId);},'LoadLinksGrid':function(options){var linkList=ctrlTaskGridMasterDetail['Data']['Links'](options),lstElem=$('#'+options['ControlID']+'-taskForm-links-list-container');lstElem['empty']();if(linkList){var fnBuildFromTemplate=function(link){var sHTML=$('#taskForm-links-template')['html']();return sHTML=sHTML['replace'](/#:Entity#/g,link['Name']),sHTML=sHTML['replace'](/#:RecordId#/g,link['RecordId']),sHTML=sHTML['replace'](/#:Description#/g,link['Description']),sHTML;};for(var i=0x0;i<linkList['length'];i++){var link=linkList[i],sHTML=fnBuildFromTemplate(link);lstElem['append'](sHTML);}TriSysProUI['kendoUI_Overrides'](),$('#'+options['ControlID']+'-taskForm-links-label')['html'](linkList['length']+'\x20Task\x20Link'+(linkList['length']==0x1?'':'s'));}},'AddEntityLinkToGrid':function(entity,options){ctrlTaskGridMasterDetail['Data']['AddLink'](entity,options),ctrlTaskGridMasterDetail['LoadLinksGrid'](options);},'DeleteLinkFromTaskGrid':function(sEntity,lRecordId,thisObject){if(sEntity&&lRecordId>0x0){var sControlID=ctrlTaskGridMasterDetail['ControlIDFromForm'](null,thisObject['id']);ctrlTaskGridMasterDetail['Data']['DeleteLink'](sEntity,lRecordId,sControlID),ctrlTaskGridMasterDetail['LoadLinksGrid']({'ControlID':sControlID});}},'LoadTask':function(lTaskId,options){var sPrefix=options['ControlID']+'-',sTaskDescriptionID=sPrefix+'taskForm-Description',elemTaskDescription=$('#'+sTaskDescriptionID);elemTaskDescription['val'](''),ctrlTaskGridMasterDetail['Data']['DeleteContacts'](options['ControlID']),ctrlTaskGridMasterDetail['LoadContactsGrid'](![],options['ControlID']),ctrlTaskGridMasterDetail['Data']['DeleteUsers'](options['ControlID']),ctrlTaskGridMasterDetail['LoadUsersGrid'](options['ControlID']),ctrlTaskGridMasterDetail['Data']['DeleteLinks'](options['ControlID']),ctrlTaskGridMasterDetail['LoadLinksGrid']({'ControlID':options['ControlID']}),TriSysSDK['Controls']['FileReference']['SetFile'](sPrefix+'taskForm-Attachment-File-Reference',''),$('#'+sPrefix+'taskForm-Attachment-Description')['val'](''),TriSysSDK['Attributes']['Load']('Task',0x0,sPrefix+'task-form-attributes');if(lTaskId>0x0){var dataPacket={'TaskId':lTaskId},payloadObject={};payloadObject['URL']='Task/Read',payloadObject['OutboundDataPacket']=dataPacket,payloadObject['InboundDataFunction']=function(data){TriSysApex['UI']['HideWait']();var CTaskReadResponse=data;if(CTaskReadResponse){if(CTaskReadResponse['Success']){var task=CTaskReadResponse['Task'];ctrlTaskGridMasterDetail['Data']['SetTask'](task,options['ControlID']),TriSysSDK['CShowForm']['SetCheckBoxValue'](sPrefix+'taskForm-scheduled',task['Scheduled']);var sTitle=TriSysApex['ModalDialogue']['Task']['GetModalTitleText'](task['Scheduled'],task['TaskId']),sImage=TriSysApex['ModalDialogue']['Task']['GetModalImage'](task['Scheduled']);TriSysSDK['CShowForm']['SetTaskTypeComboValue'](sPrefix+'taskForm-TaskType',task['TaskType']),TriSysActions['Forms']['TaskType']['Icon'](sPrefix+'taskForm-TaskType',sPrefix+'taskForm-selected-TaskType-Image'),elemTaskDescription['val'](task['Description']),elemTaskDescription['focus']();task['Description']&&(document['getElementById'](sTaskDescriptionID)['selectionStart']=0x0,document['getElementById'](sTaskDescriptionID)['selectionEnd']=0x0,elemTaskDescription['scrollTop'](0x0));TriSysSDK['CShowForm']['setDateTimePickerValue'](sPrefix+'taskForm-StartDateTime',task['StartDate']),TriSysSDK['CShowForm']['setDateTimePickerValue'](sPrefix+'taskForm-EndDateTime',task['EndDate']),TriSysSDK['CShowForm']['SetCheckBoxValue'](sPrefix+'taskForm-set-alarm',task['Alarmed']);if(task['Alarmed']&&task['LeadTime'])TriSysSDK['Controls']['Duration']['Set'](sPrefix+'taskForm-Duration',task['LeadTime']);else $('#'+sPrefix+'taskForm-alarm-lead-time-tr')['hide']();task['Contacts']&&task['Contacts']['forEach'](function(contact){ctrlTaskGridMasterDetail['Data']['AddContact'](contact,options['ControlID']);});ctrlTaskGridMasterDetail['LoadContactsGrid'](![],options['ControlID']);task['Users']&&task['Users']['forEach'](function(user){ctrlTaskGridMasterDetail['Data']['AddUser'](user,options['ControlID']);});ctrlTaskGridMasterDetail['LoadUsersGrid'](options['ControlID']);task['Links']&&task['Links']['forEach'](function(link){ctrlTaskGridMasterDetail['Data']['AddLink'](link,options);});ctrlTaskGridMasterDetail['LoadLinksGrid']({'ControlID':options['ControlID']});if(task['Attachments']){if(task['Attachments']['length']>0x0){var attachment=task['Attachments'][0x0];TriSysSDK['Controls']['FileReference']['SetFile'](sPrefix+'taskForm-Attachment-File-Reference',attachment['DocumentPath']);if(attachment['Description'])$('#'+sPrefix+'taskForm-Attachment-Description')['val'](attachment['Description']);TriSysSDK['Controls']['FileReference']['OpenButtonVisible'](sPrefix+'taskForm-Attachment-File-Reference',!![]);}}TriSysSDK['Attributes']['Load']('Task',lTaskId,sPrefix+'task-form-attributes');return;}else TriSysApex['UI']['ShowMessage'](CTaskReadResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlTaskGridMasterDetail.LoadTask:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Task...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);}},'GetGridID':function(thisObject){var sControlID=ctrlTaskGridMasterDetail['ControlIDFromForm'](null,thisObject['id']),sGridID=sControlID+'-ctrlTaskGridMasterDetail-Grid';return sGridID;},'ExportToExcel':function(thisObject){TriSysSDK['Grid']['ExportToExcel'](ctrlTaskGridMasterDetail['GetGridID'](thisObject));},'TaskGridFileMenuCallback':function(sMenuInstruction,thisObject){var fm=TriSysSDK['FormMenus']['Constants'],lTaskId=null,sGrid=ctrlTaskGridMasterDetail['GetGridID'](thisObject);switch(sFileMenuID){case fm['File_Open']:lTaskId=TriSysApex['ModalDialogue']['Task']['GetSelectedSingletonTaskIdFromTaskGrid'](sGrid);if(lTaskId>0x0)TriSysApex['ModalDialogue']['Task']['QuickShow'](lTaskId);break;case fm['File_Delete']:lTaskId=TriSysApex['ModalDialogue']['Task']['GetSelectedSingletonTaskIdFromTaskGrid'](sGrid);if(lTaskId>0x0)TriSysApex['ModalDialogue']['Task']['DeleteTask'](lTaskId);break;}},'Data':{'Clear':function(sControlID){if(!TriSysApex['TaskGridMasterDetailData'])TriSysApex['TaskGridMasterDetailData']={'Contacts':[],'Users':[],'Links':[],'TaskId':[]};for(var i=TriSysApex['TaskGridMasterDetailData']['Contacts']['length']-0x1;i>=0x0;i--){var object=TriSysApex['TaskGridMasterDetailData']['Contacts'][i];if(object['ControlID']==sControlID)TriSysApex['TaskGridMasterDetailData']['Contacts']['splice'](i,0x1);}for(var i=TriSysApex['TaskGridMasterDetailData']['Users']['length']-0x1;i>=0x0;i--){var object=TriSysApex['TaskGridMasterDetailData']['Users'][i];if(object['ControlID']==sControlID)TriSysApex['TaskGridMasterDetailData']['Users']['splice'](i,0x1);}for(var i=TriSysApex['TaskGridMasterDetailData']['Links']['length']-0x1;i>=0x0;i--){var object=TriSysApex['TaskGridMasterDetailData']['Links'][i];if(object['ControlID']==sControlID)TriSysApex['TaskGridMasterDetailData']['Links']['splice'](i,0x1);}for(var i=TriSysApex['TaskGridMasterDetailData']['TaskId']['length']-0x1;i>=0x0;i--){var object=TriSysApex['TaskGridMasterDetailData']['TaskId'][i];if(object['ControlID']==sControlID)TriSysApex['TaskGridMasterDetailData']['TaskId']['splice'](i,0x1);}},'Links':function(options){var lstLinks=[];return TriSysApex['TaskGridMasterDetailData']&&TriSysApex['TaskGridMasterDetailData']['Links']&&TriSysApex['TaskGridMasterDetailData']['Links']['forEach'](function(link){if(link['ControlID']==options['ControlID'])lstLinks['push'](link['Entity']);}),lstLinks;},'Link':function(options){if(TriSysApex['TaskGridMasterDetailData']&&TriSysApex['TaskGridMasterDetailData']['Links']){var iIndex=TriSysApex['TaskGridMasterDetailData']['Links']['indexOf'](options['ControlID']);if(iIndex>=0x0)return TriSysApex['TaskGridMasterDetailData']['Links'][iIndex];}},'AddLink':function(entity,options){var lnkFound=ctrlTaskGridMasterDetail['Data']['Link'](options);if(lnkFound)lnkFound['Entity']=entity;else lnkFound={'ControlID':options['ControlID'],'Entity':entity},TriSysApex['TaskGridMasterDetailData']['Links']['push'](lnkFound);},'DeleteLink':function(sEntity,lRecordId,sControlID){for(var i=TriSysApex['TaskGridMasterDetailData']['Links']['length']-0x1;i>=0x0;i--){var object=TriSysApex['TaskGridMasterDetailData']['Links'][i];if(object['ControlID']==sControlID&&lRecordId==object['Entity']['RecordId']&&sEntity==object['Entity']['Name'])TriSysApex['TaskGridMasterDetailData']['Links']['splice'](i,0x1);}},'DeleteLinks':function(sControlID){for(var i=TriSysApex['TaskGridMasterDetailData']['Links']['length']-0x1;i>=0x0;i--){var object=TriSysApex['TaskGridMasterDetailData']['Links'][i];if(object['ControlID']==sControlID)TriSysApex['TaskGridMasterDetailData']['Links']['splice'](i,0x1);}},'Contacts':function(sControlID){var lstContacts=[];return TriSysApex['TaskGridMasterDetailData']['Contacts']['forEach'](function(contact){if(contact['ControlID']==sControlID)lstContacts['push'](contact['Contact']);}),lstContacts;},'Contact':function(lContactId,sControlID){var lstContacts=ctrlTaskGridMasterDetail['Data']['Contacts'](sControlID),foundContact=null;return lstContacts['forEach'](function(contact){if(contact['ContactId']==lContactId)return foundContact=contact,!![];}),foundContact;},'AddContact':function(contact,sControlID){var contactFound=ctrlTaskGridMasterDetail['Data']['Contact'](contact['ContactId'],sControlID);if(!contactFound){var contactObject={'ControlID':sControlID,'Contact':contact};TriSysApex['TaskGridMasterDetailData']['Contacts']['push'](contactObject);}},'DeleteContact':function(lContactId,sControlID){for(var i=TriSysApex['TaskGridMasterDetailData']['Contacts']['length']-0x1;i>=0x0;i--){var object=TriSysApex['TaskGridMasterDetailData']['Contacts'][i];if(object['ControlID']==sControlID&&lContactId==object['Contact']['ContactId'])TriSysApex['TaskGridMasterDetailData']['Contacts']['splice'](i,0x1);}},'DeleteContacts':function(sControlID){for(var i=TriSysApex['TaskGridMasterDetailData']['Contacts']['length']-0x1;i>=0x0;i--){var object=TriSysApex['TaskGridMasterDetailData']['Contacts'][i];if(object['ControlID']==sControlID)TriSysApex['TaskGridMasterDetailData']['Contacts']['splice'](i,0x1);}},'Users':function(sControlID){var lstUsers=[];return TriSysApex['TaskGridMasterDetailData']['Users']['forEach'](function(user){if(user['ControlID']==sControlID)lstUsers['push'](user['User']);}),lstUsers;},'User':function(lUserId,sControlID){var lstUsers=ctrlTaskGridMasterDetail['Data']['Users'](sControlID),foundUser=null;return lstUsers['forEach'](function(user){if(user['UserId']==lUserId)return foundUser=user,!![];}),foundUser;},'AddUser':function(user,sControlID){var userFound=ctrlTaskGridMasterDetail['Data']['User'](user['UserId'],sControlID);if(!userFound){var userObject={'ControlID':sControlID,'User':user};TriSysApex['TaskGridMasterDetailData']['Users']['push'](userObject);}},'DeleteUser':function(lUserId,sControlID){for(var i=TriSysApex['TaskGridMasterDetailData']['Users']['length']-0x1;i>=0x0;i--){var object=TriSysApex['TaskGridMasterDetailData']['Users'][i];if(object['ControlID']==sControlID&&lUserId==object['User']['UserId'])TriSysApex['TaskGridMasterDetailData']['Users']['splice'](i,0x1);}},'DeleteUsers':function(sControlID){for(var i=TriSysApex['TaskGridMasterDetailData']['Users']['length']-0x1;i>=0x0;i--){var object=TriSysApex['TaskGridMasterDetailData']['Users'][i];if(object['ControlID']==sControlID)TriSysApex['TaskGridMasterDetailData']['Users']['splice'](i,0x1);}},'Task':function(sControlID){var foundTask=null;return TriSysApex['TaskGridMasterDetailData']['TaskId']['forEach'](function(task){if(task['ControlID']==sControlID)foundTask=task;}),foundTask;},'SetTask':function(task,sControlID){var foundTask=ctrlTaskGridMasterDetail['Data']['Task'](sControlID);if(!foundTask){var taskObject={'ControlID':sControlID,'Task':task};TriSysApex['TaskGridMasterDetailData']['TaskId']['push'](taskObject);}else foundTask['Task']=task;},'DuplicateContactCheck':function(contact,sControlID){var lstContacts=ctrlTaskGridMasterDetail['Data']['Contacts'](sControlID);lstContacts&&lstContacts['forEach'](function(lContactId){if(lContactId==contact['ContactId'])return!![];});}}};