var ctrlEnableTwoFactorAuthentication={'_ConfirmButton':null,'_LoginMode':![],'_PinCodeAttemptCounter':0x0,'_MaximumPinCodeAttempts':0x3,'AuthenticatorAppName':'TriSys','Load':function(options,fnConfirmed){ctrlEnableTwoFactorAuthentication['_ConfirmButton']=$('#trisys-modal-warning'),ctrlEnableTwoFactorAuthentication['_ConfirmButton']['hide'](),$('#login-instructions-AuthenticatorAppName')['text'](options['AuthenticatorAppName']),$('#login-instructions-AuthenticatorAppName2')['text'](options['AuthenticatorAppName']),$('#unlock-code')['keyup'](function(e){this['value']['length']==0x6&&ctrlEnableTwoFactorAuthentication['ConfirmCode'](fnConfirmed,options);});options['Login']||options['Unlock']?ctrlEnableTwoFactorAuthentication['EnterCodeMode']():(ctrlEnableTwoFactorAuthentication['PromptForQRCode'](options),$('#app-instructions')['show'](),$('#button-instructions')['show']());var iHeight=$(window)['height']()-0xfa,div=$('#enable2FAcontainerDiv');if(iHeight<0x294)div['css']('height',iHeight);else div['css']('overflow-y','hidden');},'PromptForQRCode':function(options){var CObtainQRCodeRequest={'ApplicationName':ctrlEnableTwoFactorAuthentication['AuthenticatorAppName']};if(options){if(options['ApplicationName'])CObtainQRCodeRequest['ApplicationName']=options['ApplicationName'];}var payloadObject={};payloadObject['URL']='TwoFactorAuthentication/ObtainQRCode',payloadObject['OutboundDataPacket']=CObtainQRCodeRequest,payloadObject['InboundDataFunction']=function(CObtainQRCodeResponse){if(CObtainQRCodeResponse){if(CObtainQRCodeResponse['Success']){$('#login-instructions-AuthenticatorAppName')['text'](CObtainQRCodeResponse['AuthenticatorAppName']),$('#login-instructions-AuthenticatorAppName2')['text'](CObtainQRCodeResponse['AuthenticatorAppName']);CObtainQRCodeResponse['AlreadyAssigned']?ctrlEnableTwoFactorAuthentication['EnterCodeMode']():$('#qr-code-2fa')['attr']('src',CObtainQRCodeResponse['URL']);return;}else TriSysApex['UI']['ShowMessage'](CObtainQRCodeResponse['ErrorMessage'],TriSysApex['Copyright']['ShortProductName']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('ctrlEnableTwoFactorAuthentication.Load:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'EnterCodeMode':function(){$('#qr-code-para')['hide'](),$('#auth-code')['show'](),$('#unlock-code')['focus'](),$('#app-instructions')['hide'](),$('#button-instructions')['hide'](),$('#login-instructions-para')['show']();var button=$('#trisys-modal-success');button['hide'](),ctrlEnableTwoFactorAuthentication['_ConfirmButton']['show']();},'ConfirmCode':function(fnConfirmed,options){var sCode=$('#unlock-code')['val']();$('#unlock-code')['prop']('disabled',!![]);var sError=null,Error='Please\x20enter\x20a\x206-digit\x20numeric\x20code.';if(!sCode)sError=Error;else{if(sCode['length']!=0x6)sError=Error;}if(sError){var fnRetry=function(){return setTimeout(function(){$('#unlock-code')['prop']('disabled',![]),$('#unlock-code')['focus']();},0xa),!![];};TriSysApex['UI']['ShowMessage'](sError,'Two\x20Factor\x20Authentication',fnRetry,'OK');}else ctrlEnableTwoFactorAuthentication['ConfirmViaWebAPI'](sCode,fnConfirmed,options);},'ConfirmViaWebAPI':function(sCode,fnConfirmed,options){var CValidateCodeRequest={'ApplicationName':ctrlEnableTwoFactorAuthentication['AuthenticatorAppName'],'Pin':sCode,'Login':ctrlEnableTwoFactorAuthentication['_LoginMode']};if(options){if(options['ApplicationName'])CValidateCodeRequest['ApplicationName']=options['ApplicationName'];}var payloadObject={};payloadObject['URL']='TwoFactorAuthentication/ValidateCode',payloadObject['OutboundDataPacket']=CValidateCodeRequest,payloadObject['InboundDataFunction']=function(CValidateCodeResponse){if(CValidateCodeResponse){if(CValidateCodeResponse['Success']){var fnOK=function(){fnConfirmed(!![]);};setTimeout(fnOK,0xa),TriSysApex['UI']['CloseModalPopup']();}else{ctrlEnableTwoFactorAuthentication['_PinCodeAttemptCounter']+=0x1;var iRemainingAttempts=ctrlEnableTwoFactorAuthentication['_MaximumPinCodeAttempts']-ctrlEnableTwoFactorAuthentication['_PinCodeAttemptCounter'],sMessage='Invalid\x20code.'+'<br\x20/>'+'Please\x20try\x20again.'+'<br\x20/>'+'You\x20have\x20'+iRemainingAttempts+'\x20remaining\x20attempt'+(iRemainingAttempts==0x1?'':'s')+'\x20to\x20enter\x20a\x20valid\x20code\x20before\x20you\x20are\x20logged\x20out.';if(iRemainingAttempts==0x0){sMessage='You\x20have\x20failed\x20to\x20enter\x20a\x20valid\x20code\x20after\x20'+ctrlEnableTwoFactorAuthentication['_MaximumPinCodeAttempts']+'\x20attempts\x20so\x20you\x20will\x20now\x20be\x20logged\x20out.';var fnLogout=function(){location['reload'](!![]);};setTimeout(fnLogout,0x1388);}var fnRetry=function(){return setTimeout(function(){$('#unlock-code')['val'](''),$('#unlock-code')['prop']('disabled',![])['focus']();},0xa),iRemainingAttempts==0x0&&(setTimeout(TriSysApex['UI']['CloseModalPopup'],0x64),setTimeout(function(){TriSysApex['FormsManager']['CloseAllForms'](!![],!![]);},0xfa)),!![];};TriSysApex['UI']['ShowMessage'](sMessage,'Two\x20Factor\x20Authentication',fnRetry,'OK');}}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('ctrlEnableTwoFactorAuthentication.ConfirmViaWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DisableAuthentication':function(options){var CDisableRequest={'ApplicationName':ctrlEnableTwoFactorAuthentication['AuthenticatorAppName']};if(options){if(options['ApplicationName'])CDisableRequest['ApplicationName']=options['ApplicationName'];}var payloadObject={};payloadObject['URL']='TwoFactorAuthentication/Disable',payloadObject['OutboundDataPacket']=CDisableRequest,payloadObject['InboundDataFunction']=function(CDisableResponse){if(CDisableResponse){if(CDisableResponse['Success']){}else TriSysApex['UI']['ShowMessage'](CDisableResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('ctrlEnableTwoFactorAuthentication.DisableAuthentication:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'isEnabled':function(bLogin,fnCallback,options){var bWeAreTheRemoteBrowserPopup=typeof ContactPreviewMode!==TriSysApex['Constants']['Undefined'];if(TriSysApex['Device']['isPhone']()||bWeAreTheRemoteBrowserPopup){fnCallback(![]);return;}var CEnabledStatusRequest={'ApplicationName':ctrlEnableTwoFactorAuthentication['AuthenticatorAppName'],'Login':bLogin};if(options){if(options['ApplicationName'])CEnabledStatusRequest['ApplicationName']=options['ApplicationName'];}var payloadObject={};payloadObject['URL']='TwoFactorAuthentication/EnabledStatus',payloadObject['OutboundDataPacket']=CEnabledStatusRequest,payloadObject['InboundDataFunction']=function(CEnabledStatusResponse){CEnabledStatusResponse&&(CEnabledStatusResponse['Success']?fnCallback(CEnabledStatusResponse['Enabled'],CEnabledStatusResponse['Locked'],CEnabledStatusResponse['HasAuthenticatedPreviously'],CEnabledStatusResponse['AuthenticatorAppName']):TriSysApex['UI']['ShowMessage'](CEnabledStatusResponse['ErrorMessage'],TriSysApex['Copyright']['ShortProductName']));},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('ctrlEnableTwoFactorAuthentication.isEnabled:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'PromptForTwoFactorAuthentication':function(options,fnAuthenticationCallback){var sTitle='Enable',fnConfirmed=function(bConfirmed){var sMessage='Two\x20Factor\x20Authentication\x20is\x20now\x20operational.'+'<br/>'+'You\x20will\x20be\x20prompted\x20for\x20a\x20new\x20code\x20each\x20time\x20you\x20login\x20in\x20future.';TriSysApex['UI']['ShowMessage'](sMessage);};if(options['Login']||options['Unlock'])sTitle='Login\x20via';(options['Login']||options['Unlock']||options['PreLogin'])&&(fnConfirmed=function(bConfirmed){if(bConfirmed)fnAuthenticationCallback(!![]);});ctrlEnableTwoFactorAuthentication['_LoginMode']=options['Login'],ctrlEnableTwoFactorAuthentication['_PinCodeAttemptCounter']=0x0;if(options['Unlock'])sTitle='Unlock\x20via';var parametersObject=new TriSysApex['UI']['ShowMessageParameters']();parametersObject['Title']=sTitle+'\x20Two\x20Factor\x20Authentication',parametersObject['Image']='gi-lock',parametersObject['ContentURL']=TriSysApex['Constants']['UserControlFolder']+'ctrlEnableTwoFactorAuthentication.html',parametersObject['OnLoadCallback']=function(){ctrlEnableTwoFactorAuthentication['Load'](options,fnConfirmed);},parametersObject['ButtonLeftText']='Authenticate',parametersObject['ButtonLeftVisible']=!![],parametersObject['ButtonLeftFunction']=function(){ctrlEnableTwoFactorAuthentication['EnterCodeMode']();},parametersObject['ButtonCentreText']='Confirm',parametersObject['ButtonCentreVisible']=!![],parametersObject['ButtonCentreFunction']=function(){ctrlEnableTwoFactorAuthentication['ConfirmCode'](fnConfirmed);},parametersObject['ButtonRightText']='Cancel',parametersObject['ButtonRightVisible']=!![],parametersObject['ButtonRightFunction']=function(){return fnAuthenticationCallback(![]),!![];},TriSysApex['UI']['PopupMessage'](parametersObject);}};