var ctrlAlarms={'GridID':'ctrlAlarms-TaskGrid','SpinnerID':'ctrlAlarms-wait-spinner','Load':function(){TriSysSDK['WaitSpinner']['Load'](ctrlAlarms['SpinnerID'],0xc8),TriSysApex['Alarms']['ModalPopupTaskAlarmsOptions']&&TriSysApex['Alarms']['ModalPopupTaskAlarmsOptions']['AllOutstandingAlarmedTasks']?ctrlAlarms['DisplayAllAlarmedTasks'](TriSysApex['Alarms']['ModalPopupTaskAlarmsOptions']['SecondsBeforeAlarmDateTime']):ctrlAlarms['ReadDisplayAlarmedTasks'](![],TriSysApex['Alarms']['ModalPopupTaskAlarmsOptions']['SecondsBeforeAlarmDateTime']),TriSysSDK['FormMenus']['DrawGridMenu']('ctrlAlarms-TaskGridMenu',ctrlAlarms['GridID']),setTimeout(TriSysProUI['kendoUI_Overrides'],0x1f4);},'ShowTitleCount':function(){var sTitle=null;if(TriSysApex['Alarms']['ModalPopupTaskAlarms'])sTitle=TriSysSDK['Numbers']['ThousandsSeparator'](TriSysApex['Alarms']['TaskAlarms']['length'])+'\x20Task\x20Alarms';else sTitle=TriSysSDK['Numbers']['ThousandsSeparator'](TriSysApex['Alarms']['PostItNotes']['length'])+'\x20Post-It\x20Notes';$('#ctrlAlarms-Title')['html'](sTitle);},'PopulateTaskGrid':function(sDivTag,tasks){var bMobile=TriSysApex['Device']['isPhone'](),sGridName=sDivTag+'-grid',iRecordsPerPage=bMobile?0xa:TriSysApex['UserOptions']['RecordsPerPage'](),columns=TriSysApex['Activities']['TaskSummaryGridColumns'],bMobile=TriSysApex['Device']['isPhone']();bMobile&&(columns=[{'field':'DisplayDescription','title':'Description','type':'string'},{'field':'StartDate','type':'date','hidden':!![]}]);var fnHideTaskTypeImageColumnMenu=function(gridLayout){var grid=$('#'+gridLayout['Div'])['data']('kendoGrid');grid['thead']['find']('[data-field=Image]>.k-header-column-menu')['remove']();};$('#'+ctrlAlarms['SpinnerID'])['hide'](),TriSysSDK['Grid']['VirtualMode']({'Div':sDivTag,'ID':sGridName,'Title':'Tasks','RecordsPerPage':iRecordsPerPage,'PopulationByObject':tasks,'Columns':columns,'MobileVisibleColumns':columns,'MobileRowTemplate':'<td\x20>'+'\x20\x20\x20<img\x20src=\x22images/trisys/16x16/tasktype/#=TaskType#.png\x22\x20style=\x22width:\x2024px;\x20height:\x2024px;\x22\x20alt=\x22#=TaskType#\x22>\x20&nbsp;'+'\x20\x20\x20<strong>#:\x20TaskType\x20#</strong>\x20&nbsp;\x20#:\x20kendo.format(\x22{0:dd\x20MMM\x20yyyy}\x22,\x20StartDate)\x20#\x20<br\x20/>'+'#:\x20DisplayDescription\x20#'+'<hr\x20style=\x22padding:\x200px;\x20margin:\x2010px;\x22\x20/>'+'</td>','KeyColumnName':'TaskId','DrillDownFunction':function(rowData){var lTaskId=rowData['TaskId'];if(lTaskId>0x0)ctrlAlarms['DrillDownIntoTask'](lTaskId);},'MultiRowSelect':!bMobile,'Grouping':![],'ColumnFilters':![],'AfterLoadEvent':fnHideTaskTypeImageColumnMenu});if(bMobile)$('#ctrlAlarms-Toolbar-Buttons')['hide']();},'DrillDownIntoTask':function(lTaskId){TriSysApex['UI']['CloseModalPopup'](),TriSysApex['ModalDialogue']['Task']['QuickShow'](lTaskId);},'OpenSelectedTask':function(){lTaskId=TriSysApex['ModalDialogue']['Task']['GetSelectedSingletonTaskIdFromTaskGrid'](ctrlAlarms['GridID']);if(lTaskId>0x0)ctrlAlarms['DrillDownIntoTask'](lTaskId);},'ClearSelectedAlarm':function(){ctrlAlarms['ClearSelectedTasks'](!![]);},'ClearSelectedTask':function(){ctrlAlarms['ClearSelectedTasks'](![]);},'ClearSelectedTasks':function(bAlarmOnly){var taskIds=TriSysSDK['Grid']['GetSelectedMultipleRowsFromGrid'](ctrlAlarms['GridID'],'TaskId');if(!taskIds||taskIds['length']==0x0){TriSysApex['UI']['ShowMessage']('Please\x20select\x20one\x20or\x20more\x20tasks.');return;}var sMessage='Please\x20confirm\x20that\x20you\x20wish\x20to\x20clear\x20'+taskIds['length']+'\x20'+(TriSysApex['Alarms']['ModalPopupTaskAlarms']?'task':'post-it\x20note')+(bAlarmOnly?'\x20alarms':'s')+'?',fnYes=function(){if(bAlarmOnly)ctrlAlarms['ClearMultipleTaskAlarms'](taskIds);else ctrlAlarms['ClearMultipleTasks'](taskIds);return!![];},sTitle='Clear\x20'+(TriSysApex['Alarms']['ModalPopupTaskAlarms']?'Task':'Post-It\x20Note')+(bAlarmOnly?'\x20Alarms':'s');TriSysApex['UI']['questionYesNo'](sMessage,sTitle,'Yes',fnYes,'No');},'ClearMultipleTaskAlarms':function(taskIds){var CClearTaskAlarmRequest={'Tasks':taskIds},payloadObject={};payloadObject['URL']='Task/ClearAlarm',payloadObject['OutboundDataPacket']=CClearTaskAlarmRequest,payloadObject['InboundDataFunction']=function(CClearTaskAlarmResponse){TriSysApex['UI']['HideWait']();if(CClearTaskAlarmResponse){if(CClearTaskAlarmResponse['Success']){ctrlAlarms['PostTaskOperation'](taskIds);return;}else TriSysApex['UI']['ShowMessage'](CClearTaskAlarmResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['ShowMessage']('ctrlAlarms.ClearMultipleTaskAlarms:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Clearing\x20alarms...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'ClearMultipleTasks':function(taskIds){var CTaskClearMultipleRequest={'Tasks':taskIds},payloadObject={};payloadObject['URL']='Task/Clear',payloadObject['OutboundDataPacket']=CTaskClearMultipleRequest,payloadObject['InboundDataFunction']=function(CTaskClearMultipleResponse){TriSysApex['UI']['HideWait']();if(CTaskClearMultipleResponse){if(CTaskClearMultipleResponse['Success']){ctrlAlarms['PostTaskOperation'](taskIds);return;}else TriSysApex['UI']['ShowMessage'](CTaskClearMultipleResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['ShowMessage']('ctrlAlarms.ClearMultipleTasks:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Clearing\x20tasks...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'SnoozeSelectedTasks':function(){var taskIds=TriSysSDK['Grid']['GetSelectedMultipleRowsFromGrid'](ctrlAlarms['GridID'],'TaskId');if(!taskIds||taskIds['length']==0x0){TriSysApex['UI']['ShowMessage']('Please\x20select\x20one\x20or\x20more\x20tasks.');return;}var fnCallback=function(){ctrlAlarms['PostTaskOperation'](taskIds);};TriSysApex['Alarms']['Snooze']['Popup'](taskIds,!![],fnCallback);},'PostTaskOperation':function(taskIds){for(var i=TriSysApex['Alarms']['TaskAlarms']['length']-0x1;i>=0x0;i--){var task=TriSysApex['Alarms']['TaskAlarms'][i];if(taskIds['indexOf'](task['TaskId'])>=0x0)TriSysApex['Alarms']['TaskAlarms']['splice'](i,0x1);}ctrlAlarms['PopulateTaskGrid'](ctrlAlarms['GridID'],TriSysApex['Alarms']['TaskAlarms']),ctrlAlarms['ShowTitleCount'](),TriSysApex['Alarms']['DisplayTaskAlarmMetric'](TriSysApex['Alarms']['TaskAlarms']['length']);if(TriSysApex['Alarms']['TaskAlarms']['length']==0x0)TriSysApex['UI']['CloseModalPopup']();},'DisplayAllAlarmedTasks':function(iSecondsBeforeAlarmDateTime){ctrlAlarms['ReadDisplayAlarmedTasks'](!![],iSecondsBeforeAlarmDateTime);},'ReadDisplayAlarmedTasks':function(bAllOutstandingAlarmedTasks,iSecondsBeforeAlarmDateTime){TriSysApex['Alarms']['Check'](![],null,{'CustomParameterCallback':function(CTaskAlarmsRequest){CTaskAlarmsRequest['AllOutstandingAlarmedTasks']=bAllOutstandingAlarmedTasks,CTaskAlarmsRequest['SecondsBeforeAlarmDateTime']=iSecondsBeforeAlarmDateTime;},'CustomCallback':function(CTaskAlarmsResponse){if(CTaskAlarmsResponse['Success']){TriSysApex['Alarms']['TaskAlarms']=CTaskAlarmsResponse['TaskAlarms'];!bAllOutstandingAlarmedTasks&&TriSysApex['Alarms']['DisplayTaskAlarmMetric'](TriSysApex['Alarms']['TaskAlarms']['length']);var sTitle=TriSysSDK['Numbers']['ThousandsSeparator'](TriSysApex['Alarms']['TaskAlarms']['length'])+(bAllOutstandingAlarmedTasks?'\x20Outstanding\x20Alarmed\x20Tasks':'\x20Task\x20Alarms');$('#ctrlAlarms-Title')['html'](sTitle),ctrlAlarms['PopulateTaskGrid'](ctrlAlarms['GridID'],TriSysApex['Alarms']['TaskAlarms']);return;}}});}};$(document)['ready'](function(){ctrlAlarms['Load']();});