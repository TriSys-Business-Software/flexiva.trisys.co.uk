var ClientEditTimesheets={'Load':function(){var lstSelectedTimesheetId=ClientTimesheets['ListOfSelectedTimesheetId'];TriSysApex['UI']['ShowWait'](null,'Loading\x20'+lstSelectedTimesheetId['length']+'\x20Timesheets...');var fnCreated=function(iIndex,lTimesheetId){if(iIndex>=lstSelectedTimesheetId['length'])TriSysApex['UI']['HideWait']();},sTemplateHTML=$('#clientTimesheetTemplate')['html']();sTemplateHTML=sTemplateHTML['replace']('style=\x22display:\x20none;\x22',''),$['each'](lstSelectedTimesheetId,function(index,lTimesheetId){ClientEditTimesheets['CreateTimesheet'](index+0x1,lstSelectedTimesheetId['length'],lTimesheetId,sTemplateHTML,fnCreated);});},'CreateTimesheet':function(iIndex,iCount,lTimesheetId,sTemplateHTML,fnCreated){var sHTML=sTemplateHTML['replace']('{{SelectedTimesheetIndex}}',iIndex);sHTML=sHTML['replace']('{{NumberOfSelectedTimesheets}}',iCount);var sID=TriSysSDK['Numbers']['Pad'](lTimesheetId,0x6);sHTML=sHTML['replace'](/{{TimesheetId}}/g,sID),$('#lstClientTimesheets')['append'](sHTML);var sTimesheetDetails='timesheet-details-'+sID;$('#hide-timesheet-block-'+sID)['on']('click',function(){TriSysSDK['Blocks']['toggleBlockSize']($(this),sTimesheetDetails);}),ClientEditTimesheets['PopulateTimesheetViaWebAPI'](lTimesheetId,'-'+sID,function(){fnCreated(iIndex,lTimesheetId);});},'PopulateTimesheetViaWebAPI':function(lTimesheetId,sSuffix,fnPopulated){var CTimesheetRequest={'TimesheetId':lTimesheetId},payloadObject={};payloadObject['URL']='Timesheet/Read',payloadObject['OutboundDataPacket']=CTimesheetRequest,payloadObject['InboundDataFunction']=function(CTimesheetResponse){if(CTimesheetResponse&&CTimesheetResponse['Success']){var timesheet=CTimesheetResponse['Timesheet'];if(timesheet){var placement=CTimesheetResponse['Placement'],sHyperlink='<a\x20href=\x22javascript:void(0)\x22\x20onclick=\x22TriSysWebJobs.Placement.Open('+placement['PlacementId']+',\x20true)\x22>'+placement['Reference']+'</a>';$('#trisys-timesheet-reference'+sSuffix)['html'](sHyperlink),$('#trisys-timesheet-candidate'+sSuffix)['html'](placement['CandidateName']),$('#trisys-timesheet-linemanager'+sSuffix)['html'](placement['LineManagerName']),$('#trisys-timesheet-type'+sSuffix)['html'](placement['Type']),$('#trisys-timesheet-jobtitle'+sSuffix)['html'](placement['JobTitle']);var sLocation=placement['Location'];if(sLocation)sLocation=sLocation['replace'](/\n/g,'<br\x20/>');$('#trisys-timesheet-location'+sSuffix)['html'](sLocation),$('#trisys-timesheet-company'+sSuffix)['html'](placement['CompanyName']);var sStartDate=moment(placement['StartDate'])['format']('dddd\x20DD\x20MMMM\x20YYYY');$('#trisys-timesheet-startdate'+sSuffix)['html'](sStartDate);if(placement['EndDate']){var bNoEndDate=moment(placement['EndDate'])['year']()<=0x76c,sEndDate=bNoEndDate?'':moment(placement['EndDate'])['format']('dddd\x20DD\x20MMMM\x20YYYY');$('#trisys-timesheet-enddate'+sSuffix)['html'](sEndDate);}$('#trisys-timesheet-id'+sSuffix)['html'](TriSysSDK['Numbers']['Pad'](CTimesheetResponse['TimesheetId'],0x6)),$('#trisys-timesheet-period'+sSuffix)['html'](timesheet['Period']),$('#trisys-timesheet-inputdate'+sSuffix)['html'](moment(timesheet['InputDate'])['format']('dddd\x20DD\x20MMMM\x20YYYY'));var bAuthorised=timesheet['PaymentAuthorised'];$('#trisys-timesheet-status'+sSuffix)['html']((bAuthorised?'':'Not\x20')+'Authorised');bAuthorised&&($('#trisys-timesheet-authorised'+sSuffix)['html'](moment(timesheet['AuthorisedDate'])['format']('dddd\x20DD\x20MMMM\x20YYYY')),$('#trisys-timesheet-authorised-form-group'+sSuffix)['show'](),$('#trisys-timesheet-authorisedby'+sSuffix)['html'](timesheet['AuthorisedBy']),$('#trisys-timesheet-authorisedby-form-group'+sSuffix)['show']());var bPaid=timesheet['Payrolled'];bPaid&&($('#trisys-timesheet-paid'+sSuffix)['html'](bPaid?'Yes':'No'),$('#trisys-timesheet-paid-form-group'+sSuffix)['show']());if(placement['Custom']&&placement['Custom']['IdentificationLink']){var sTitle='Candidate\x20ID';$('#trisys-timesheet-IdentificationLink'+sSuffix)['click'](function(){TriSysSDK['Controls']['FileManager']['GetOpenFileURLFromWebService'](sTitle,placement['Custom']['IdentificationLink'],sTitle);}),$('#trisys-timesheet-IdentificationLink'+sSuffix)['html']('Click\x20to\x20Open');}$('#timesheet-candidate'+sSuffix)['html'](placement['CandidateName']),$('#timesheet-period'+sSuffix)['html'](timesheet['Period']);var bClientContact=!![];TriSysWebJobs['Timesheet']['PopulateAmountsTable'](CTimesheetResponse['Rates'],bClientContact,![],sSuffix),TriSysWebJobs['Timesheet']['PopulateSummaryTable'](CTimesheetResponse,bClientContact,![],sSuffix);var bCanEdit=!![];TriSysWebJobs['Timesheet']['PopulateGrid'](CTimesheetResponse,'trisys-timesheet-hours-grid'+sSuffix,bCanEdit,sSuffix),$('#ClientEditTimesheets-Menu-Save'+sSuffix)['attr']('disabled',bAuthorised),$('#ClientEditTimesheets-Menu-Authorise'+sSuffix)['attr']('disabled',bAuthorised),ClientEditTimesheets['CustomerSpecificConfiguration'](lTimesheetId,sSuffix),fnPopulated();}else{TriSysApex['UI']['ShowMessage']('Unable\x20to\x20find\x20timesheet');return;}return!![];}},payloadObject['ErrorHandlerFunction']=function(request,status,error){alert('ClientEditTimesheets.ShowTimesheetSummary:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'Save':function(sTimesheetId){var sSuffix='-'+sTimesheetId,lTimesheetId=parseInt(sTimesheetId);if(ClientEditTimesheets['CustomSaveFunction'](lTimesheetId))return;var timesheetPeriodRatesHours=TriSysWebJobs['Timesheet']['ReadHoursGridData']('trisys-timesheet-hours-grid'+sSuffix);if(!timesheetPeriodRatesHours)return;var fnCallback=function(lTimesheetId){var sMessage=TriSysSDK['Resources']['Message']('TriSysWeb.Pages.Timesheet.SendHoursMatrixToServer.SavedTimesheetId')+TriSysSDK['Numbers']['Pad'](lTimesheetId,0x6)+TriSysSDK['Resources']['Message']('TriSysWeb.Pages.Timesheet.SendHoursMatrixToServer.AuthorisationReminder');TriSysApex['UI']['ShowMessage'](sMessage,TriSysWebJobs['Constants']['ApplicationName']);},lPlacementId=0x0,sPeriod='';TriSysWebJobs['Timesheet']['SendHoursMatrixToServer'](lPlacementId,lTimesheetId,sPeriod,timesheetPeriodRatesHours,null,fnCallback);},'Authorise':function(sTimesheetId){var sSuffix='-'+sTimesheetId,lTimesheetId=parseInt(sTimesheetId),timesheetPeriodRatesHours=TriSysWebJobs['Timesheet']['ReadHoursGridData']('trisys-timesheet-hours-grid'+sSuffix);if(!timesheetPeriodRatesHours)return;var lPlacementId=0x0,sPeriod='',fnCallback=null;TriSysWebJobs['Timesheet']['SendHoursMatrixToServer'](lPlacementId,lTimesheetId,sPeriod,timesheetPeriodRatesHours,null,fnCallback);var fnConfirmed=function(lTimesheetId){$('#ClientEditTimesheets-Menu-Save'+sSuffix)['attr']('disabled',!![]),$('#ClientEditTimesheets-Menu-Authorise'+sSuffix)['attr']('disabled',!![]),setTimeout(function(){var sMessage=TriSysSDK['Resources']['Message']('TriSysWeb.Pages.Timesheet.ConfirmedAuthorisationCallback.Message');TriSysApex['UI']['ShowMessage'](sMessage,TriSysWebJobs['Constants']['ApplicationName']);},0x64);},fnAuthoriseRequest=function(){return TriSysWebJobs['Timesheet']['AuthoriseRequest'](lTimesheetId,fnConfirmed),!![];},sCaption=TriSysSDK['Resources']['Message']('TriSysWeb.Pages.Timesheet.Authorise.PromptCaption'),sMessage=TriSysSDK['Resources']['Message']('TriSysWeb.Pages.Timesheet.Authorise.PromptMessage');TriSysApex['UI']['questionYesNo'](sMessage,sCaption,'Yes',fnAuthoriseRequest,'No',null);},'CustomerSpecificConfiguration':function(lTimesheetId,sSuffix){if(TriSysWebJobs['Agency']['CustomerIDMatch']('CoSector')){$('#trisys-timesheet-hours-rates-amounts'+sSuffix)['html']('Hours\x20and\x20Rates');var bIntern=$('#trisys-timesheet-type'+sSuffix)['html']()=='Intern';if(bIntern)$('#trisys-timesheet-hours-rates-amounts-summary-group'+sSuffix)['hide']();$('#trisys-timesheet-hours-grid-beneath'+sSuffix)['show'](),$('#ClientEditTimesheets_Menu-SaveButtonText'+sSuffix)['html']('Decline');}},'CustomSaveFunction':function(lTimesheetId){var bDecline=TriSysWebJobs['Agency']['CustomerIDMatch']('CoSector');if(bDecline){var sID=TriSysSDK['Numbers']['Pad'](lTimesheetId,0x6),sSuffix='-'+sID,timesheetDetails={'TimesheetId':lTimesheetId};timesheetDetails['Period']=$('#trisys-timesheet-period'+sSuffix)['html'](),timesheetDetails['Candidate']=$('#timesheet-candidate'+sSuffix)['html'](),timesheetDetails['CompanyName']=$('#trisys-timesheet-company'+sSuffix)['html'](),timesheetDetails['ClientFullName']=$('#trisys-timesheet-linemanager'+sSuffix)['html']();var fnAfterDecline=function(){$('#ClientEditTimesheets-Menu-Save'+sSuffix)['attr']('disabled',!![]),$('#ClientEditTimesheets-Menu-Authorise'+sSuffix)['attr']('disabled',!![]);};return TriSysWebJobs['Timesheet']['ClientDecline'](timesheetDetails,fnAfterDecline),!![];}}};$(document)['ready'](function(){ClientEditTimesheets['Load']();});