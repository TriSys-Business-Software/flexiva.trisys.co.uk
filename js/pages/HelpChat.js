var HelpChat={'OtherUserId':0x0,'Load':function(){TriSysSDK['EntityFormTabs']['AddClickEventHandlers']('help-chat-tab-nav-horizontal'),TriSysSDK['EntityFormTabs']['AddHorizontalScrollBar']('help-chat-tab-panel-buttons'),HelpChat['AddUsers'](),HelpChat['ResetStyle'](),setTimeout(TriSysProUI['kendoUI_Overrides'],0x3e8);var iHeightFactor=0x19a,lHeight=window['innerHeight']-iHeightFactor;$('#trisys-chat-talk')['height'](lHeight);var iWidthFactor=0x96,lWidth=TriSysApex['Pages']['Index']['FormWidth']()-iWidthFactor;$('.chat-talk-messages\x20.chat-talk-msg')['width'](lWidth),$('.trisys-chat-date')['width'](lWidth),$('.trisys-chat-date')['css']('color',TriSysProUI['BackColour']());var chatMessages=$('.chat-talk-messages'),chatScrollingContainer=$('#trisys-chat-talk'),chatMsg='',textEditor=$('#kendoTextEditor');textEditor['css']('border','1px\x20solid\x20'+TriSysProUI['BackColour']()),HelpChat['SetupTextEditor']('kendoTextEditor'),$('#HelpChat-Send')['on']('click',HelpChat['SendChatMessageToRecipient']),$('#HelpChat-Attachment')['on']('click',HelpChat['InsertAttachment']),$('#HelpChat-Smiley')['on']('click',HelpChat['InsertSmiley']),$('#HelpChat-LinkToRecord')['on']('click',HelpChat['LinkToRecord']),$('#HelpChat-EditOrDelete')['on']('click',HelpChat['EditMessage']),$('#help-chat-remove-history')['on']('click',HelpChat['ClearHistory']),$('#help-chat-add-user')['on']('click',HelpChat['AddUserPreference']),$('#help-chat-remove-user')['on']('click',HelpChat['RemoveUserPreference']),HelpChat['Messenger']['RegisterNotificationsOnIncomingMessages']();},'SetupTextEditor':function(sID){var textEditor=$('#'+sID);textEditor['kendoEditor']({'tools':['bold','italic','underline','strikethrough','insertUnorderedList','insertOrderedList','indent','outdent','createLink','unlink','fontName','fontSize','foreColor','backColor']});var editor=textEditor['data']('kendoEditor');return editor;},'SendChatMessageToRecipient':function(){var editor=$('#kendoTextEditor')['data']('kendoEditor'),sHTML=editor['value']();if(sHTML){var msg=HelpChat['CreateNewMessageObject'](sHTML),sJSON=JSON['stringify'](msg),sRecipientLoginName=HelpChat['Data']['Participants'][0x0];TriSysApex['SignalR']['Communication']['Send'](sRecipientLoginName,sJSON),HelpChat['PushSentMessageOntoDisplay'](msg,!![]),editor['value']('');}},'CreateNewMessageObject':function(sMessage){var msg=new HelpChat['Data']['Message']();msg['MessageId']=TriSysSDK['Miscellaneous']['GUID'](),msg['Message']=sMessage,msg['Date']=moment()['format']('dddd\x20DD\x20MMMM\x20YYYY'),msg['Time']=moment()['format']('HH:mm');var userCredentials=TriSysApex['LoginCredentials']['UserCredentials']();userCredentials&&userCredentials['LoggedInUser']&&(msg['LoginName']=userCredentials['LoggedInUser']['LoginName'],msg['UserImage']=$('#imgLoggedInUserImage')['attr']('src'));msg['Participants']=HelpChat['Data']['Participants'];var bShowDate=!![],bShowUserDetails=!![],data=HelpChat['Data']['Messages'];if(data&&data['length']>0x0){var previousMessage=data[data['length']-0x1];msg['ShowDate']=previousMessage['Date']!=msg['Date'],msg['ShowUserDetails']=previousMessage['LoginName']!=msg['LoginName']||msg['ShowDate'];}return msg['CurrentUser']=!![],msg;},'PushSentMessageOntoDisplay':function(msg,bCurrentUser,sSenderLoginName,sSenderPhoto,participants){sSenderLoginName&&(msg['LoginName']=sSenderLoginName,msg['UserImage']=sSenderPhoto);if(participants)msg['Participants']=participants;msg['CurrentUser']=bCurrentUser,HelpChat['Data']['Messages']['push'](msg),HelpChat['Data']['SaveHistory']();var bShowMessageInList=bCurrentUser;if(!bCurrentUser){var sParticipantLoginName1=HelpChat['Data']['Participants'][0x0];if(sParticipantLoginName1['toLowerCase']()==msg['LoginName']['toLowerCase']())bShowMessageInList=!![];}bShowMessageInList&&(HelpChat['ShowMessageInList'](msg),HelpChat['ScrollEditorToBottom'](),HelpChat['ResetStyle']());},'InsertAttachment':function(){var fnAttachFile=function(sFilePath){var payloadObject={};payloadObject['URL']='Files/MoveUploadedFileToPublicURL';var MoveUploadedFileToPublicURLRequest={'UploadedFilePath':sFilePath,'SubFolder':'Chat'};payloadObject['OutboundDataPacket']=MoveUploadedFileToPublicURLRequest,payloadObject['InboundDataFunction']=function(CMoveUploadedFileToPublicURLResponse){TriSysApex['UI']['HideWait']();if(CMoveUploadedFileToPublicURLResponse){if(CMoveUploadedFileToPublicURLResponse['Success']){var sFilePath=CMoveUploadedFileToPublicURLResponse['PublicFilePath'];HelpChat['AttachFile'](sFilePath,'kendoTextEditor');}else TriSysApex['UI']['errorAlert'](CMoveUploadedFileToPublicURLResponse['ErrorMessage']);}else{}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['ErrorHandlerRedirector']('HelpChat.InsertAttachment:\x20',request,status,error);},TriSysApex['UI']['ShowWait'](null,'Uploading\x20File...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);};TriSysSDK['Controls']['FileManager']['FindFileUpload']('Attach\x20File',fnAttachFile);},'_TestingInterval':![],'InsertSmiley':function(){if(HelpChat['_TestingInterval'])clearInterval(HelpChat['_TestingInterval']),HelpChat['_TestingInterval']=null;else{var fnTest=function(){var editor=$('#kendoTextEditor')['data']('kendoEditor'),sSnippetHTML='This\x20is\x20test\x20generated\x20content\x20at\x20'+moment()['format']('HH:mm:ss')+'\x20on\x20'+moment()['format']('dddd\x20DD\x20MMMM\x20YYYY');editor['paste'](sSnippetHTML),HelpChat['SendChatMessageToRecipient']();};HelpChat['_TestingInterval']=setInterval(fnTest,0x3e8);}},'LinkToRecord':function(){HelpChat['LinkToDatabaseRecord']('kendoTextEditor');},'LinkToDatabaseRecord':function(sEditorID){var fnEntitySelection=function(selectedRow){if(!selectedRow)return![];var sEntity=selectedRow['Entity'];if(!sEntity)return![];return setTimeout(function(){HelpChat['SelectEntityRecord'](sEntity,sEditorID);},0xa),!![];};TriSysApex['ModalDialogue']['Entity']['Select'](fnEntitySelection);},'SelectEntityRecord':function(sEntity,sEditorID){var sName=null,sFunction=null,sIcon=null,fnInsertLink=function(sNameParameter,sFunctionParameter,sIconParameter){setTimeout(function(){sIconParameter='<i\x20class=\x22'+sIconParameter+'\x20pull-left\x20themed-color\x22\x20style=\x22padding-top:\x204px;\x22></i>\x20&nbsp;';var sSnippetHTML='<a\x20href=\x22javascript:void(0)\x22\x20onclick=\x22'+sFunctionParameter+'\x22>'+sIconParameter+sNameParameter+'</a>',editor=$('#'+sEditorID)['data']('kendoEditor');editor['paste'](sSnippetHTML);},0xa);};switch(sEntity){case'Contact':var fnSelectContact=function(selectedRow){if(!selectedRow)return;var lContactId=selectedRow['Contact_ContactId'],sName=sEntity+':\x20'+selectedRow['Contact_Christian']+'\x20'+selectedRow['Contact_Surname'];return sFunction='TriSysApex.FormsManager.OpenForm(\x27Contact\x27,\x20'+lContactId+')',sIcon='gi\x20gi-parents',fnInsertLink(sName,sFunction,sIcon),!![];};TriSysApex['ModalDialogue']['Contacts']['Select'](fnSelectContact);break;case'Company':var fnSelectedCompany=function(selectedRow){if(!selectedRow)return;var lCompanyId=selectedRow['Company_CompanyId'],sName=sEntity+':\x20'+selectedRow['Company_Name'];return sFunction='TriSysApex.FormsManager.OpenForm(\x27Company\x27,\x20'+lCompanyId+')',sIcon='gi\x20gi-building',fnInsertLink(sName,sFunction,sIcon),!![];};TriSysApex['ModalDialogue']['Companies']['Select'](fnSelectedCompany);break;case'Requirement':var fnSelectedRequirement=function(selectedRow){if(!selectedRow)return;var lRequirementId=selectedRow['Requirement_RequirementId'],sName=sEntity+':\x20'+selectedRow['Requirement_RequirementReference']+':\x20'+selectedRow['Requirement_JobTitle']+'\x20at\x20'+selectedRow['RequirementCompany_Name'];return sFunction='TriSysApex.FormsManager.OpenForm(\x27Requirement\x27,\x20'+lRequirementId+')',sIcon='gi\x20gi-user_add',fnInsertLink(sName,sFunction,sIcon),!![];};TriSysApex['ModalDialogue']['Requirements']['Select'](fnSelectedRequirement);break;case'Placement':var fnSelectedPlacement=function(selectedRow){if(!selectedRow)return;var lPlacementId=selectedRow['Placement_PlacementId'],sName=sEntity+':\x20'+selectedRow['Placement_Reference']+':\x20'+selectedRow['CandidateContact_FullName']+',\x20'+selectedRow['Placement_JobTitle']+'\x20at\x20'+selectedRow['PlacementCompany_Name'];return sFunction='TriSysApex.FormsManager.OpenForm(\x27Placement\x27,\x20'+lPlacementId+')',sIcon='gi\x20gi-gbp',fnInsertLink(sName,sFunction,sIcon),!![];};TriSysApex['ModalDialogue']['Placements']['Select'](fnSelectedPlacement);break;case'User':var fnSelectUser=function(selectedRow){if(!selectedRow)return;var lUserId=selectedRow['UserId'],user=TriSysApex['Cache']['UsersManager']['UserFromId'](lUserId);return sName=sEntity+':\x20'+user['FullName'],sFunction='TriSysApex.FormsManager.OpenForm(\x27Contact\x27,\x20'+user['ContactId']+')',sIcon='gi\x20gi-parents',fnInsertLink(sName,sFunction,sIcon),!![];};TriSysApex['ModalDialogue']['Users']['Select'](fnSelectUser,{'NotLocked':!![]});break;}},'AttachFile':function(sFilePathURL,sEditorID){var sSnippetHTML='',sName=TriSysSDK['Controls']['FileManager']['GetFileNameFromPath'](sFilePathURL),sOpenViewer='TriSysSDK.Controls.FileManager.OpenDocumentViewer(\x27'+sName+'\x27,\x20\x27'+sFilePathURL+'\x27,\x20\x27'+sName+'\x27);';if(TriSysSDK['Controls']['FileManager']['isImageFile'](sFilePathURL))sSnippetHTML='<img\x20src=\x22'+sFilePathURL+'\x22\x20style=\x22padding-top:\x2010px;\x20padding-bottom:\x2010px;\x20max-height:\x20200px;\x20max-width:\x20200px;\x22'+'\x20id=\x22help-chat-image\x22\x20'+'onclick=\x22'+sOpenViewer+'\x22\x20/>';else{var sName=TriSysSDK['Controls']['FileManager']['GetFileNameFromPath'](sFilePathURL);sSnippetHTML='<a\x20href=\x22'+sFilePathURL+'\x22\x20target=\x22_blank\x22>'+sName+'</a>';}var editor=$('#'+sEditorID)['data']('kendoEditor');editor['paste'](sSnippetHTML);},'EditMessage':function(){TriSysApex['UI']['ShowMessage']('Edit/Delete\x20Message');},'ClearHistory':function(){if(HelpChat['Data']['Messages']['length']==0x0)return;var userCredentials=TriSysApex['LoginCredentials']['UserCredentials'](),sMyLoginName=userCredentials['LoggedInUser']['LoginName'],deleteMessages=[];for(var i=0x0;i<HelpChat['Data']['Messages']['length'];i++){var msg=HelpChat['Data']['Messages'][i];if(msg['CurrentUser']){var sJSON=JSON['stringify'](msg),msgCopy=JSON['parse'](sJSON);deleteMessages['push'](msg);}}if(deleteMessages['length']==0x0){TriSysApex['UI']['ShowMessage']('You\x20do\x20not\x20have\x20any\x20of\x20your\x20own\x20messages\x20in\x20this\x20thread.');return;}var fnAfterSave=function(){HelpChat['LoadMessagesForParticipants']();var otherUser=TriSysApex['Cache']['UsersManager']['UserFromId'](HelpChat['OtherUserId']),sRecipientLoginName=otherUser['LoginName'],deleteThreadObject={'Type':HelpChat['Messenger']['MessageType']['BulkDeletedThreadMessages'],'UserId':userCredentials['LoggedInUser']['UserId']},sJSON=JSON['stringify'](deleteThreadObject);TriSysApex['SignalR']['Communication']['Send'](sRecipientLoginName,sJSON);},fnRemove=function(){for(var i=0x0;i<deleteMessages['length'];i++){var msg=deleteMessages[i];HelpChat['Data']['DeleteMessage'](msg['MessageId'],![]);}return deleteMessages=[],HelpChat['Data']['SaveHistory'](fnAfterSave),!![];},sMessage='Are\x20you\x20sure\x20you\x20wish\x20to\x20delete\x20all\x20of\x20your\x20messages\x20in\x20this\x20thread?'+'<br\x20/>Note\x20that\x20those\x20messages\x20sent\x20to\x20you\x20can\x20only\x20be\x20deleted\x20by\x20the\x20sender.';TriSysApex['UI']['questionYesNo'](sMessage,TriSysApex['Copyright']['ShortProductName'],'Yes',fnRemove,'No');},'AddUserPreference':function(){var fnSelectUser=function(selectedRow){if(!selectedRow)return![];var lUserId=selectedRow['UserId'];if(lUserId<=0x0)return![];HelpChat['Data']['AddAllowedUser'](lUserId),HelpChat['Data']['DeleteHiddenUser'](lUserId),HelpChat['AddUsers']();var sID='chat-select-user-a-'+lUserId;return $('#'+sID)['trigger']('click'),!![];};TriSysApex['ModalDialogue']['Users']['Select'](fnSelectUser,{'NotLocked':!![]});},'RemoveUserPreference':function(){if(HelpChat['OtherUserId']==0x0){var sMessage='Are\x20you\x20sure\x20that\x20you\x20wish\x20to\x20remove\x20all\x20users\x20from\x20your\x20list?';TriSysApex['UI']['questionYesNo'](sMessage,TriSysApex['Copyright']['ShortProductName'],'Yes',function(){return HelpChat['RemoveAllUsers'](),!![];},'No');return;}var fnRemove=function(){HelpChat['Data']['DeleteAllowedUser'](HelpChat['OtherUserId']),HelpChat['Data']['AddHiddenUser'](HelpChat['OtherUserId']);var chatMessages=$('.chat-talk-messages');return chatMessages['empty'](),$('#help-chat-instructions')['show'](),$('#trisys-chat-talk')['hide'](),$('#user-chat-form')['hide'](),$('#chat-user-name')['html'](''),HelpChat['AddUsers'](),!![];},otherUser=TriSysApex['Cache']['UsersManager']['UserFromId'](HelpChat['OtherUserId']),sMessage='Are\x20you\x20sure\x20that\x20you\x20wish\x20to\x20remove\x20'+otherUser['FullName']+'\x20from\x20your\x20list?';TriSysApex['UI']['questionYesNo'](sMessage,TriSysApex['Copyright']['ShortProductName'],'Yes',fnRemove,'No');},'RemoveAllUsers':function(){HelpChat['Data']['DeleteAllUsers'](),HelpChat['AddUsers']();},'ResetStyle':function(){$('.chat-talk-messages\x20.chat-talk-msg')['css']('background',TriSysProUI['BlockTitleBackColour']()),$('.chat-form')['css']('background-color','white'),$('.trisys-chat-date')['css']('color',TriSysProUI['BackColour']()),$('#trisys-chat-talk-waiting-spinner-image')['css']('color',TriSysProUI['BackColour']()),TriSysProUI['kendoUI_Overrides']();},'ScrollEditorToBottom':function(){var chatScrollingContainer=$('#trisys-chat-talk');setTimeout(function(){chatScrollingContainer['animate']({'scrollTop':chatScrollingContainer['prop']('scrollHeight')},0x1f4);},0x64);},'ShowMessageInList':function(msg){var divTag='msg-'+msg['MessageId'],sDivHTML='<div\x20id=\x22'+divTag+'\x22></div>',chatMessages=$('.chat-talk-messages');chatMessages['append'](sDivHTML),HelpChat['LoadMessage'](msg,divTag);},'LoadMessage':function(msg,divTag){var sPath='ctrlChatMessage.html';TriSysApex['FormsManager']['loadControlReplacingDiv'](divTag,sPath,function(response,status,xhr){ctrlChatMessage['Load'](msg,divTag);});},'ShowChatDataEntryForm':function(bShow){var form=$('#user-chat-form'),elems=$('[id^=\x22ctrlChatMessage-EditOrDelete\x22]');bShow?(form['show'](),elems['show']()):(form['hide'](),elems['hide']()),$('[id^=\x22content_\x22]')['hide']();},'TabClickEvent':function(sTabID){$('#help-chat-instructions')['hide'](),$('#trisys-chat-talk')['show'](),$('#user-chat-form')['show']();var sOtherUserLogin=sTabID['replace']('help-chat-panel-',''),otherUser=TriSysApex['Cache']['UsersManager']['UserFromLoginName'](sOtherUserLogin);HelpChat['OtherUserId']=otherUser['UserId'],$('#chat-user-name')['html'](':\x20'+otherUser['FullName']);var userCredentials=TriSysApex['LoginCredentials']['UserCredentials']();userCredentials&&userCredentials['LoggedInUser']&&(HelpChat['Data']['Participants']=[sOtherUserLogin,userCredentials['LoggedInUser']['LoginName']],HelpChat['LoadMessagesForParticipants']());},'LoadMessagesForParticipants':function(){var chatMessages=$('.chat-talk-messages');chatMessages['empty'](),chatMessages['hide']();var msgCounter=$('#trisys-chat-talk-waiting-spinner-message');msgCounter['html']('Reading\x20Messages');var waiting=$('#trisys-chat-talk-waiting');waiting['show']();var fnPopulate=function(messages){var myLoginName=null,userCredentials=TriSysApex['LoginCredentials']['UserCredentials']();if(userCredentials&&userCredentials['LoggedInUser'])myLoginName=userCredentials['LoggedInUser']['LoginName'];msgCounter['html']('Loading\x20'+messages['length']+'\x20Messages');for(var i=0x0;i<messages['length'];i++){var msg=messages[i];msg['ShowDate']=!![],msg['ShowUserDetails']=!![];if(i>0x0){var previousMessage=messages[i-0x1];msg['ShowDate']=previousMessage['Date']!=msg['Date'],msg['ShowUserDetails']=previousMessage['LoginName']['toLowerCase']()!=msg['LoginName']['toLowerCase']()||msg['ShowDate'];}msg['CurrentUser']=msg['LoginName']['toLowerCase']()==myLoginName['toLowerCase'](),HelpChat['ShowMessageInList'](msg);}var iMilliSecondsPerMessage=0x3,iAllowTimeMilliSeconds=messages['length']*iMilliSecondsPerMessage;setTimeout(function(){waiting['hide'](),chatMessages['show'](),HelpChat['ScrollEditorToBottom'](),HelpChat['ResetStyle']();},iAllowTimeMilliSeconds);};HelpChat['Data']['MessagesForParticipants'](fnPopulate);},'AddUsers':function(){var payloadObject={};payloadObject['URL']='Users/SubscriberUserList',payloadObject['InboundDataFunction']=function(CSubscriberUserListResponse){CSubscriberUserListResponse&&(CSubscriberUserListResponse['Success']&&HelpChat['AddUsersUsingSubscriberList'](CSubscriberUserListResponse['Users']));},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('HelpChat.AddUsers:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'AddUsersUsingSubscriberList':function(lstSubscribers){HelpChat['OtherUserId']=0x0;var elem=$('#help-chat-tab-nav-horizontal');elem['empty']();var lstIgnoreUserLoginNames=['SuperUser'['toLowerCase'](),'StandardUser'['toLowerCase'](),'v10.trial'['toLowerCase']()],userCredentials=TriSysApex['LoginCredentials']['UserCredentials']();if(userCredentials&&userCredentials['LoggedInUser'])lstIgnoreUserLoginNames['push'](userCredentials['LoggedInUser']['LoginName']['toLowerCase']());var fnIsActiveSubscriber=function(sLoginName,lst){var bActive=![];return $['each'](lst,function(index,subscriber){if(sLoginName['toLowerCase']()==subscriber['LoginName']['toLowerCase']()&&subscriber['Active'])bActive=!![];}),bActive;},iCount=0x0;$['each'](TriSysApex['Cache']['Users'](),function(index,user){var bExistsInIgnored=lstIgnoreUserLoginNames['indexOf'](user['LoginName']['toLowerCase']())>=0x0,bAllowed=!![],allowed=HelpChat['Data']['GetAllowedUsers']();if(allowed)bAllowed=allowed['indexOf'](user['UserId'])>=0x0;var bDisallowed=![],disallowed=HelpChat['Data']['GetHiddenUsers']();if(disallowed)bDisallowed=disallowed['indexOf'](user['UserId'])>=0x0;var bActiveUserAccount=!user['Locked'];if(bActiveUserAccount)bActiveUserAccount=fnIsActiveSubscriber(user['LoginName'],lstSubscribers);if(bActiveUserAccount){if(!bExistsInIgnored&&(bAllowed||!bDisallowed)){iCount+=0x1;var bActive=iCount==0x1;bActive=![],HelpChat['AddUser'](user,bActive);}}});},'AddUser':function(user,bActive,bPrepend){var sPhoto=TriSysApex['Constants']['DefaultContactGreyImage'];if(user['Photo']&&!user['Locked'])sPhoto=user['Photo'];else{if(user['locked'])return;}var sActive=bActive?'\x20class=\x22active\x22':'',sID='chat-select-user-a-'+user['UserId'],sLi='<li'+sActive+'>'+'\x20<a\x20href=\x22javascript:void(0)\x22\x20onclick=\x22TriSysSDK.EntityFormTabs.TabClickEvent(\x27help-chat-panel-\x27,'+'\x27'+user['LoginName']+'\x27,\x20\x27help-chat-tab-nav-horizontal\x27,\x20HelpChat.TabClickEvent);\x22\x20id=\x22'+sID+'\x22'+'\x20style=\x22border-radius:\x208px;\x22'+'\x20>'+'<img\x20src=\x22'+sPhoto+'\x22\x20height=\x2232\x22\x20width=\x2232\x22\x20style=\x22margin-bottom:\x207px;\x20border-radius:\x205px;\x22\x20/>'+'<br\x20/>'+user['FullName']+'</a>'+'</li>',elem=$('#help-chat-tab-nav-horizontal');if(bPrepend)elem['prepend'](sLi);else elem['append'](sLi);},'UpdatedByEditor':function(msg){msg['Type']=HelpChat['Messenger']['MessageType']['Update'];var sJSON=JSON['stringify'](msg),sRecipientLoginName=HelpChat['Data']['Participants'][0x0];TriSysApex['SignalR']['Communication']['Send'](sRecipientLoginName,sJSON),HelpChat['Data']['SaveHistory']();},'DeletedByEditor':function(msg){msg['Type']=HelpChat['Messenger']['MessageType']['Delete'];var sJSON=JSON['stringify'](msg),sRecipientLoginName=HelpChat['Data']['Participants'][0x0];TriSysApex['SignalR']['Communication']['Send'](sRecipientLoginName,sJSON);},'Data':{'TriSysSupportLoginName':'trisys.support','Message':function(){this['Type']=HelpChat['Messenger']['MessageType']['New'],this['Participants']=[],this['MessageId']=0x0,this['Message']=null,this['Date']=moment()['format']('dddd\x20DD\x20MMMM\x20YYYY'),this['Time']=moment()['format']('HH:mm'),this['ShowDate']=!![],this['ShowUserDetails']=!![],this['LoginName']=null,this['UserImage']=TriSysApex['Constants']['DefaultContactImage'],this['CurrentUser']=!![];},'Messages':[],'MessagesForParticipants':function(fnPopulate){var CChatReadMessageHistoryRequest={'UserId':HelpChat['OtherUserId']},payloadObject={};payloadObject['URL']='Chat/ReadMessageHistory',payloadObject['OutboundDataPacket']=CChatReadMessageHistoryRequest,payloadObject['InboundDataFunction']=function(CChatReadMessageHistoryResponse){HelpChat['Data']['Messages']=[],CChatReadMessageHistoryResponse&&(CChatReadMessageHistoryResponse['Success']&&(CChatReadMessageHistoryResponse['JSON']&&(HelpChat['Data']['Messages']=JSON['parse'](CChatReadMessageHistoryResponse['JSON'])))),fnPopulate(HelpChat['Data']['Messages']);},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('HelpChat.Data.MessagesForParticipants:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'Participants':[],'AddMessage':function(msg){HelpChat['Data']['Messages']['push'](msg),HelpChat['Data']['SaveHistory']();},'DeleteMessage':function(lMessageId,bSaveHistory){if(TriSysAPI['Operators']['isEmpty'](bSaveHistory))bSaveHistory=!![];for(var i=0x0;i<HelpChat['Data']['Messages']['length'];i++){var msg=HelpChat['Data']['Messages'][i];if(msg['MessageId']==lMessageId){HelpChat['Data']['Messages']['splice'](i,0x1);bSaveHistory&&HelpChat['Data']['SaveHistory']();return;}}},'GetMessage':function(lMessageId){for(var i=0x0;i<HelpChat['Data']['Messages']['length'];i++){var msg=HelpChat['Data']['Messages'][i];if(msg['MessageId']==lMessageId)return msg;}},'SaveHistory':function(fnCallback){var sJSON=JSON['stringify'](HelpChat['Data']['Messages']),CChatWriteMessageHistoryRequest={'UserId':HelpChat['OtherUserId'],'JSON':sJSON},payloadObject={};payloadObject['URL']='Chat/WriteMessageHistory',payloadObject['OutboundDataPacket']=CChatWriteMessageHistoryRequest,payloadObject['InboundDataFunction']=function(CChatWriteMessageHistoryResponse){if(CChatWriteMessageHistoryResponse){if(CChatWriteMessageHistoryResponse['Success']){if(fnCallback)fnCallback();}}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('HelpChat.Data.SaveHistory:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'CookiePrefix':'Help-Chat-','ReadCookie':function(sWhat){var lst=[],sKey=HelpChat['Data']['CookiePrefix']+sWhat,sJSON=TriSysAPI['Cookies']['getCookie'](sKey);if(sJSON)lst=JSON['parse'](sJSON);return lst;},'WriteCookie':function(sWhat,lst){var sKey=HelpChat['Data']['CookiePrefix']+sWhat,sJSON=JSON['stringify'](lst);TriSysAPI['Cookies']['setCookie'](sKey,sJSON);},'AddAllowedUser':function(lUserId){var lst=HelpChat['Data']['GetAllowedUsers']();lst['push'](lUserId),HelpChat['Data']['WriteCookie']('Allowed',lst);},'AddHiddenUser':function(lUserId){var lst=HelpChat['Data']['GetHiddenUsers']();lst['push'](lUserId),HelpChat['Data']['WriteCookie']('Hidden',lst);},'DeleteAllowedUser':function(lUserId){var lst=HelpChat['Data']['GetAllowedUsers'](),iIndex=lst['indexOf'](lUserId);iIndex>=0x0&&(lst['splice'](iIndex,0x1),HelpChat['Data']['WriteCookie']('Allowed',lst));},'DeleteHiddenUser':function(lUserId){var lst=HelpChat['Data']['GetHiddenUsers'](),iIndex=lst['indexOf'](lUserId);iIndex>=0x0&&(lst['splice'](iIndex,0x1),HelpChat['Data']['WriteCookie']('Hidden',lst));},'GetAllowedUsers':function(){return HelpChat['Data']['ReadCookie']('Allowed');},'GetHiddenUsers':function(){return HelpChat['Data']['ReadCookie']('Hidden');},'DeleteAllUsers':function(){HelpChat['Data']['WriteCookie']('Allowed',[]);var lstIgnoreUserLoginNames=[];$['each'](TriSysApex['Cache']['Users'](),function(index,user){lstIgnoreUserLoginNames['push'](user['UserId']);}),HelpChat['Data']['WriteCookie']('Hidden',lstIgnoreUserLoginNames);},'LoadDummyData':function(){var userCredentials=TriSysApex['LoginCredentials']['UserCredentials']();if(userCredentials&&userCredentials['LoggedInUser']){var participants=[HelpChat['Data']['TriSysSupportLoginName'],userCredentials['LoggedInUser']['LoginName']],dataObject1=new HelpChat['Data']['Message']();dataObject1['Participants']=participants,dataObject1['MessageId']=0x1,dataObject1['Message']='Dummy\x20data\x20message\x20#1\x20from\x20technical\x20support\x20department',dataObject1['Date']='Monday\x2008\x20February\x202016',dataObject1['Time']='12:34',dataObject1['CurrentUser']=![],dataObject1['LoginName']=HelpChat['Data']['TriSysSupportLoginName'],dataObject1['UserImage']='https://www.trisys.co.uk/img/CorporateLogos/t-icon-512x512-with-5px-margin.png',HelpChat['Data']['Messages']['push'](dataObject1);var dataObject2=new HelpChat['Data']['Message']();dataObject2['Participants']=participants,dataObject2['MessageId']=0x2,dataObject2['Message']='Dummy\x20data\x20message\x20#2\x20from\x20technical\x20support\x20department',dataObject2['Date']='Monday\x2008\x20February\x202016',dataObject2['Time']='12:37',dataObject2['CurrentUser']=![],dataObject2['LoginName']=HelpChat['Data']['TriSysSupportLoginName'],dataObject2['UserImage']='https://www.trisys.co.uk/img/CorporateLogos/t-icon-512x512-with-5px-margin.png',dataObject2['ShowDate']=![],dataObject2['ShowUserDetails']=![],HelpChat['Data']['Messages']['push'](dataObject2);var sLoggedInUserImage=$('#imgLoggedInUserImage')['attr']('src'),dataObject3=new HelpChat['Data']['Message']();dataObject3['Participants']=participants,dataObject3['MessageId']=0x3,dataObject3['Message']='Logged\x20in\x20user\x20message\x20from\x20me,\x20'+userCredentials['LoggedInUser']['LoginName']+'\x20with\x20photo:\x20'+sLoggedInUserImage,dataObject3['Date']='\x20Tuesday\x2009\x20February\x202016',dataObject3['Time']='09:01',dataObject3['CurrentUser']=!![],dataObject3['LoginName']=userCredentials['LoggedInUser']['LoginName'],dataObject3['UserImage']=sLoggedInUserImage,dataObject3['ShowDate']=!![],dataObject3['ShowUserDetails']=!![],HelpChat['Data']['Messages']['push'](dataObject3);}HelpChat['ScrollEditorToBottom']();}},'Messenger':{'MessageType':{'New':'New-Chat-Message','Update':'Update-Chat-Message','Delete':'Delete-Chat-Message','BulkDeletedThreadMessages':'Bulk-Deleted-Chat-Thread-Messages'},'RegisterNotificationsOnIncomingMessages':function(){TriSysApex['SignalR']['Communication']['Callbacks']['Register'](HelpChat['Messenger']['MessageType']['New'],HelpChat['Messenger']['NewChatMessage']),TriSysApex['SignalR']['Communication']['Callbacks']['Register'](HelpChat['Messenger']['MessageType']['Update'],HelpChat['Messenger']['UpdateChatMessage']),TriSysApex['SignalR']['Communication']['Callbacks']['Register'](HelpChat['Messenger']['MessageType']['Delete'],HelpChat['Messenger']['DeleteChatMessage']),TriSysApex['SignalR']['Communication']['Callbacks']['Register'](HelpChat['Messenger']['MessageType']['BulkDeletedThreadMessages'],HelpChat['Messenger']['BulkDeletedThreadMessages']);},'NewChatMessage':function(userSender,messageObject){var sLoggedInUserLoginName=TriSysApex['LoginCredentials']['UserCredentials']()['LoggedInUser']['LoginName'],participants=[userSender['LoginName'],sLoggedInUserLoginName];HelpChat['PushSentMessageOntoDisplay'](messageObject,![],userSender['LoginName'],userSender['Photo'],participants);},'UpdateChatMessage':function(userSender,messageObject){var msgExisting=HelpChat['Data']['GetMessage'](messageObject['MessageId']);msgExisting['Message']=messageObject['Message'];var sIDSuffix='-msg-'+messageObject['MessageId'];$('#ctrlChatMessage-HTML'+sIDSuffix)['html'](messageObject['Message']);},'DeleteChatMessage':function(userSender,messageObject){HelpChat['Data']['DeleteMessage'](messageObject['MessageId']);var sIDSuffix='-msg-'+messageObject['MessageId'];$('#ctrlChatMessage-ID'+sIDSuffix)['remove']();},'BulkDeletedThreadMessages':function(userSender,deleteThreadObject){deleteThreadObject['UserId']==HelpChat['OtherUserId']&&HelpChat['LoadMessagesForParticipants']();}}};$(document)['ready'](function(){HelpChat['Load']();});