var ctrlDocumentLibrary={'PostLoad':function(sEntityName,lRecordId,parentDiv){var sIDSuffix='-'+parentDiv,controls=['documentlibrary-grid-container','DocumentLibraryFileMenu','DocumentLibraryGridMenu','documentLibrary-Title','documentlibrary-Grid'];for(var i in controls){$('#'+controls[i])['attr']('id',controls[i]+sIDSuffix);}$('#documentLibrary-Title'+sIDSuffix)['html'](sEntityName);var sGrid='documentlibrary-Grid'+sIDSuffix,lDocumentId=0x0;$('#DocumentLibrary-Add')['attr']('id','DocumentLibrary-Add'+sIDSuffix),$('#DocumentLibrary-Add'+sIDSuffix)['click'](function(){TriSysApex['ModalDialogue']['DocumentLibrary']['Show'](sEntityName,lRecordId,sGrid,0x0);}),$('#DocumentLibrary-Open')['attr']('id','DocumentLibrary-Open'+sIDSuffix),$('#DocumentLibrary-Open'+sIDSuffix)['click'](function(){lDocumentId=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid'](sGrid,'DocumentID','document\x20library');if(lDocumentId>0x0)TriSysApex['ModalDialogue']['DocumentLibrary']['Show'](sEntityName,lRecordId,sGrid,lDocumentId);}),$('#DocumentLibrary-Delete')['attr']('id','DocumentLibrary-Delete'+sIDSuffix),$('#DocumentLibrary-Delete'+sIDSuffix)['click'](function(){lDocumentId=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid'](sGrid,'DocumentID','document\x20library');if(lDocumentId>0x0)ctrlDocumentLibrary['Delete'](sEntityName,lRecordId,sGrid,lDocumentId);}),TriSysSDK['FormMenus']['DrawGridMenu']('DocumentLibraryGridMenu'+sIDSuffix,sGrid),ctrlDocumentLibrary['PopulateGrid'](sEntityName,lRecordId,sGrid),setTimeout(TriSysProUI['kendoUI_Overrides'],0x3e8),setTimeout(function(){ctrlDocumentLibrary['DragAndDropFileHandler'](sEntityName,lRecordId,sGrid);},0x3e8);},'PopulateGrid':function(sEntityName,lRecordId,sGrid){var fnPopulationByFunction={'API':'DocumentLibrary/List','Parameters':function(request){request['EntityName']=sEntityName,request['RecordId']=lRecordId;},'DataTableFunction':function(response){return response['List'];}},columns=[{'field':'DocumentID','title':'ID','type':'number','width':0x46,'hidden':!![]},{'field':'Image','title':'\x20','template':'<img\x20src=\x22images/trisys/16x16/tasktype/#=\x20TaskType\x20#.png\x22\x20style=\x22width:\x2024px;\x20height:\x2024px;\x22\x20alt=\x22#=\x20TaskType\x20#\x22>','width':0x2d,'filterable':![],'sortable':![],'attributes':{'style':'text-overflow:\x20clip;'}},{'field':'FileName','title':'File','type':'string'},{'field':'Description','title':'Description','type':'string'},{'field':'Owner','title':'Owner','type':'string','width':0xb4},{'field':'DateAdded','title':'Date\x20Added','type':'date','format':'{0:dd\x20MMM\x20yyyy}','width':0x78},{'field':'Expiry','title':'Expiry','type':'date','format':'{0:dd\x20MMM\x20yyyy}','width':0x78,'hidden':!![]}],fnHideTaskTypeImageColumnMenu=function(iTotalRecordCount){var grid=$('#'+sGrid)['data']('kendoGrid');grid['thead']['find']('[data-field=Image]>.k-header-column-menu')['remove']();};TriSysSDK['Grid']['VirtualMode']({'Div':sGrid,'ID':'grdDocumentLibrary','Title':'Document\x20Library','RecordsPerPage':TriSysApex['UserOptions']['RecordsPerPage'](),'PopulationByFunction':fnPopulationByFunction,'Columns':columns,'MobileVisibleColumns':[{'field':'FileName'}],'MobileRowTemplate':'<td\x20colspan=\x221\x22><strong>#:\x20FileName\x20#</strong><br\x20/>'+'<i>#:\x20Description\x20#</i></td>','KeyColumnName':'DocumentID','DrillDownFunction':function(rowData){TriSysApex['ModalDialogue']['DocumentLibrary']['Show'](sEntityName,lRecordId,sGrid,rowData['DocumentID']);},'MultiRowSelect':!![],'Grouping':!![],'ColumnFilters':!![],'OpenButtonCaption':'Edit','PostPopulationCallback':fnHideTaskTypeImageColumnMenu,'HyperlinkedColumns':['FileName']});},'FileMenuCallback':function(sFileMenuID,sEntityName,lRecordId,sGrid){var fm=TriSysSDK['FormMenus']['Constants'],lDocumentId=0x0;switch(sFileMenuID){case fm['File_New']:TriSysApex['ModalDialogue']['DocumentLibrary']['Show'](sEntityName,lRecordId,sGrid,lDocumentId);break;case fm['File_Open']:lDocumentId=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid'](sGrid,'DocumentID','document\x20library');if(lDocumentId>0x0)TriSysApex['ModalDialogue']['DocumentLibrary']['Show'](sEntityName,lRecordId,sGrid,lDocumentId);break;case fm['File_Delete']:lDocumentId=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid'](sGrid,'DocumentID','document\x20library');if(lDocumentId>0x0)ctrlDocumentLibrary['Delete'](sEntityName,lRecordId,sGrid,lDocumentId);break;}},'Delete':function(sEntityName,lRecordId,sGrid,lDocumentId){var sMessage='Delete\x20'+sEntityName+'\x20document?',fnDelete=function(){return ctrlDocumentLibrary['SubmitDocumentDeletion'](sGrid,lDocumentId),!![];};TriSysApex['UI']['questionYesNo'](sMessage,TriSysApex['Copyright']['ShortProductName'],'Yes',fnDelete,'No');},'SubmitDocumentDeletion':function(sGrid,lDocumentId){var CDeleteDocumentRequest={'DocumentId':lDocumentId},payloadObject={};payloadObject['URL']='DocumentLibrary/DeleteDocument',payloadObject['OutboundDataPacket']=CDeleteDocumentRequest,payloadObject['InboundDataFunction']=function(data){TriSysApex['UI']['HideWait']();var CDeleteDocumentResponse=data;if(CDeleteDocumentResponse){if(CDeleteDocumentResponse['Success']){TriSysSDK['Grid']['ClearCheckedRows'](sGrid),TriSysSDK['Grid']['RefreshData'](sGrid);return;}else TriSysApex['UI']['ShowMessage'](CDeleteDocumentResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlDocumentLibrary.SubmitDocumentDeletion:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Deleting\x20Document...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DragAndDropFileHandler':function(sEntityName,lRecordId,sGridID){var obj=$('#'+sGridID);obj['on']('dragenter',function(e){e['stopPropagation'](),e['preventDefault']();}),obj['on']('dragover',function(e){e['stopPropagation'](),e['preventDefault']();}),obj['on']('drop',function(e){e['preventDefault']();var fileCollection=e['originalEvent']['dataTransfer']['files'],lstFiles=[];for(var i=0x0;i<fileCollection['length'];i++){var sFilePath=fileCollection[i];lstFiles['push'](sFilePath);}ctrlDocumentLibrary['PopDraggedFilesOffStackAndUpload'](lstFiles,sEntityName,lRecordId,sGridID);});},'PopDraggedFilesOffStackAndUpload':function(lstFiles,sEntityName,lRecordId,sGridID){if(!lstFiles)return;if(lstFiles['length']==0x0)return;if(TriSysApex['LoginCredentials']['isLoggedInToSpecificCompanyAsRecruiter']('TQS\x20Blu\x20Limited')){var file={};file['Files']=lstFiles,file['TypeName']='Placement\x20Document',file['Description']='';var sFormat='YYYY/MM/DD\x20HH:mm',dtNow=moment(new Date())['format'](sFormat);file['DateAdded']=dtNow;var userCredentials=TriSysApex['LoginCredentials']['UserCredentials'](),sOwner=userCredentials['LoggedInUser']['ForenameAndSurname'];file['OwnerName']=sOwner,file['EntityName']=sEntityName,file['EntityId']=lRecordId,ctrlDocumentLibrary['SendMultipleFiles'](file,sGridID);return;}var context=TriSysApex['ModalDialogue']['DocumentLibrary']['Context'];context['EntityName']=sEntityName,context['Files']=lstFiles;var parametersObject=new TriSysApex['UI']['ShowMessageParameters']();parametersObject['Title']='Upload\x20'+lstFiles['length']+'\x20'+sEntityName+'\x20Library\x20Document'+(lstFiles['length']==0x1?'':'s'),parametersObject['Image']='fa-folder-o',parametersObject['Maximize']=!![],parametersObject['ContentURL']=TriSysApex['CustomFormsAndComponents']['UserControlPath']('ctrlOpenLibraryDocument.html'),parametersObject['ButtonRightText']='Cancel',parametersObject['ButtonRightVisible']=!![],parametersObject['ButtonLeftText']='Upload',parametersObject['ButtonLeftVisible']=!![],parametersObject['ButtonLeftFunction']=function(){return ctrlDocumentLibrary['UploadDocuments'](lstFiles,sEntityName,lRecordId,sGridID),!![];},TriSysApex['UI']['PopupMessage'](parametersObject);},'UploadDocuments':function(lstFiles,sEntityName,lRecordId,sGridID){var file={};file['Files']=lstFiles,file['TypeName']=TriSysSDK['CShowForm']['GetTaskTypeFromCombo']('openLibraryDocument-TaskType'),file['Description']=$('#openLibraryDocument-Description')['val'](),file['DateAdded']=TriSysSDK['CShowForm']['getDateTimePickerValue']('openLibraryDocument-DateAdded'),file['OwnerName']=$('#openLibraryDocument-Owner')['val'](),file['EntityName']=sEntityName,file['EntityId']=lRecordId,setTimeout(function(){ctrlDocumentLibrary['SendMultipleFiles'](file,sGridID);},0x32);},'SendMultipleFiles':function(fileSpecifications,sGridID){var sTitle='Uploading\x20'+fileSpecifications['Files']['length']+'\x20'+'\x20Library\x20Document'+(fileSpecifications['Files']['length']==0x1?'':'s')+'...';TriSysApex['UI']['ShowWait'](null,sTitle);var fnCompletedAllUploads=function(){TriSysSDK['Grid']['ClearCheckedRows'](sGridID),TriSysSDK['Grid']['RefreshData'](sGridID),TriSysApex['UI']['HideWait']();};ctrlDocumentLibrary['UploadNextFile'](fileSpecifications,fnCompletedAllUploads);},'UploadNextFile':function(fileSpecifications,fnCallback){var sFilePath=fileSpecifications['Files'][0x0],fnAfterFileUploadCallback=function(sFilePathOnServer){var nextFile={'FilePath':sFilePathOnServer,'TypeName':fileSpecifications['TypeName'],'Description':fileSpecifications['Description'],'DateAdded':fileSpecifications['DateAdded'],'OwnerName':fileSpecifications['OwnerName'],'EntityName':fileSpecifications['EntityName'],'EntityId':fileSpecifications['EntityId']},CWriteDocumentRequest={'File':nextFile},payloadObject={};payloadObject['URL']='DocumentLibrary/WriteDocument',payloadObject['OutboundDataPacket']=CWriteDocumentRequest,payloadObject['InboundDataFunction']=function(CWriteDocumentResponse){if(CWriteDocumentResponse){if(CWriteDocumentResponse['Success']){fileSpecifications['Files']['splice'](0x0,0x1);if(fileSpecifications['Files']['length']>0x0)ctrlDocumentLibrary['UploadNextFile'](fileSpecifications,fnCallback);else fnCallback();}else TriSysApex['UI']['ShowMessage'](CWriteDocumentResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('ctrlDocumentLibrary.UploadNextFile:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);};TriSysSDK['Controls']['FileManager']['UploadFileAndMoveToG'](sFilePath,fnAfterFileUploadCallback,{'ShowProgressWait':![]});}};