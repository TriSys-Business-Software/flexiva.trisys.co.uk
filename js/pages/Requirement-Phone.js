var RequirementPhone={'_RequirementId':0x0,'LoadRequirement':function(lRequirementId){RequirementPhone['_RequirementId']=lRequirementId,RequirementPhone['HideFieldsBeforeDisplay']();if(lRequirementId<=0x0){var options={'IgnorePhoneGap':!![]};TriSysApex['FormsManager']['OpenForm']('Requirement',-0x1,![],options);return;}var spinnerWait={'Div':'requirement-phone-summary-top'};TriSysSDK['Grid']['WaitSpinnerMode'](spinnerWait,!![]);var fnCallbackSummary=function(CRequirementReadResponse,bSuccess){TriSysSDK['Grid']['WaitSpinnerMode'](spinnerWait,![]);if(bSuccess){if(CRequirementReadResponse['Success']){RequirementPhone['DisplayRequirement'](CRequirementReadResponse['Requirement']);var spinnerWait2={'Div':'requirement-form-shortlist-container'};TriSysSDK['Grid']['WaitSpinnerMode'](spinnerWait2,!![]);var fnShortlist=function(CRequirementReadResponse,bSuccess){TriSysSDK['Grid']['WaitSpinnerMode'](spinnerWait2,![]);if(bSuccess)RequirementPhone['DisplayRequirementShortlist'](CRequirementReadResponse['Requirement']['Shortlist']);};RequirementPhone['ReadRequirementFromWebAPI'](lRequirementId,!![],![],fnShortlist);}}};RequirementPhone['ReadRequirementFromWebAPI'](lRequirementId,![],![],fnCallbackSummary);},'ReadRequirementFromWebAPI':function(lRequirementId,bShortlist,bPlacements,fnCallback){var CRequirementReadRequest={'RequirementId':lRequirementId,'Shortlist':bShortlist,'Placements':bPlacements},payloadObject={};payloadObject['URL']='Requirement/Read',payloadObject['OutboundDataPacket']=CRequirementReadRequest,payloadObject['InboundDataFunction']=function(CRequirementReadResponse){fnCallback(CRequirementReadResponse,!![]);},payloadObject['ErrorHandlerFunction']=function(request,status,error){fnCallback(null,![]),TriSysApex['UI']['errorAlert']('RequirementPhone.ReadRequirementFromWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'HideFieldsBeforeDisplay':function(){var sFieldPrefix='#requirement-phone-';$(sFieldPrefix+'type-footer')['html'](''),$(sFieldPrefix+'reference')['html'](''),$(sFieldPrefix+'jobtitle')['html'](''),$('[id^='+sFieldPrefix['replace']('#','')+']')['filter']('[id*=-tr]')['each'](function(){$(this)['hide']();}),$(sFieldPrefix+'summary-dates')['hide'](),$(sFieldPrefix+'placements-table')['hide'](),$('#requirement-form-shortlist-container')['empty']();},'DisplayRequirement':function(CRequirementSummaryRead){RequirementPhone['ScrollToTop']();var sFieldPrefix='#requirement-phone-';$(sFieldPrefix+'type-footer')['html'](CRequirementSummaryRead['Type']),$(sFieldPrefix+'reference')['html'](CRequirementSummaryRead['Reference']),$(sFieldPrefix+'jobtitle')['html'](CRequirementSummaryRead['JobTitle']),$(sFieldPrefix+'type')['html'](CRequirementSummaryRead['Type']),$(sFieldPrefix+'startdate')['html'](moment(CRequirementSummaryRead['EarliestStartDate'])['format']('dddd\x20DD\x20MMMM\x20YYYY')),$(sFieldPrefix+'consultant')['html'](CRequirementSummaryRead['Consultant']),$(sFieldPrefix+'summary-dates')['show']();var sCompanyLogoURL=CRequirementSummaryRead['Company']['CompanyLogoURL'];if(!sCompanyLogoURL)sCompanyLogoURL=TriSysApex['Constants']['DefaultCompanyImage'];$(sFieldPrefix+'companylogourl')['attr']('src',sCompanyLogoURL),TriSysPhoneGap['ShowAndActivateCompany'](sFieldPrefix+'company',CRequirementSummaryRead['Company']['CompanyId']),$(sFieldPrefix+'companyname')['html'](CRequirementSummaryRead['Company']['CompanyName']),$(sFieldPrefix+'industry')['html'](CRequirementSummaryRead['Company']['Industry']);var sContactPhotoURL=CRequirementSummaryRead['ClientContact']['ContactPhotoURL'];if(!sContactPhotoURL)sContactPhotoURL=TriSysApex['Constants']['DefaultContactImage'];$(sFieldPrefix+'contactphotourl')['attr']('src',sContactPhotoURL),TriSysPhoneGap['ShowAndActivateContact'](sFieldPrefix+'contact',CRequirementSummaryRead['ClientContact']['ContactId']),$(sFieldPrefix+'contactname')['html'](CRequirementSummaryRead['ClientContact']['FullName']),$(sFieldPrefix+'contact-jobtitle')['html'](CRequirementSummaryRead['ClientContact']['JobTitle']);if(CRequirementSummaryRead['SiteAddressObject']){var addresss=CRequirementSummaryRead['SiteAddressObject'];TriSysPhoneGap['ShowAndActivateMap'](sFieldPrefix+'siteaddress',addresss['Street'],addresss['City'],addresss['County'],addresss['PostCode'],addresss['Country']);}$(sFieldPrefix+'comments')['html'](CRequirementSummaryRead['Comments']),$(sFieldPrefix+'webtext')['html'](CRequirementSummaryRead['WebText']);var bPermanent=CRequirementSummaryRead['Type']=='Permanent',sSalaryRateDescription=bPermanent?'Salary':CRequirementSummaryRead['Type']+'\x20Rates';$(sFieldPrefix+'salary-description')['html'](sSalaryRateDescription);var sSalary=CRequirementSummaryRead['Salary'];!bPermanent&&(sSalary='Pay:\x20'+CRequirementSummaryRead['PayRate']+'<br\x20/>Charge:\x20'+sSalary);$(sFieldPrefix+'salary')['html'](sSalary),$(sFieldPrefix+'salary-tr')['show'](),$(sFieldPrefix+'required')['html'](CRequirementSummaryRead['NumberRequired']),$(sFieldPrefix+'required-tr')['show'](),$(sFieldPrefix+'status')['html'](CRequirementSummaryRead['Status']),$(sFieldPrefix+'status-tr')['show']();CRequirementSummaryRead['Comments']&&($(sFieldPrefix+'comments')['html'](CRequirementSummaryRead['Comments']),$(sFieldPrefix+'comments-tr')['show']());CRequirementSummaryRead['WebText']&&($(sFieldPrefix+'webtext')['html'](CRequirementSummaryRead['WebTextStripped']),$(sFieldPrefix+'webtext-tr')['show']());if(CRequirementSummaryRead['JobDescription']){var sFileName=TriSysSDK['Controls']['FileManager']['GetFileNameFromPath'](CRequirementSummaryRead['JobDescription']);$(sFieldPrefix+'jobdescription')['html'](sFileName),TriSysPhoneGap['ShowAndActivateDocument'](sFieldPrefix+'jobdescription',CRequirementSummaryRead['JobDescription'],sFileName,'Job\x20Description');}CRequirementSummaryRead['WebJobsURL']&&($(sFieldPrefix+'webjobs')['html'](CRequirementSummaryRead['WebJobsURL']),TriSysPhoneGap['ShowAndActivateWebSite'](sFieldPrefix+'webjobs',CRequirementSummaryRead['WebJobsURL']));if(CRequirementSummaryRead['PlacementCount']>0x0){var sPlacements=CRequirementSummaryRead['PlacementCount']+'\x20Placement'+(CRequirementSummaryRead['PlacementCount']==0x1?'':'s');$(sFieldPrefix+'placements-table')['show'](),$(sFieldPrefix+'placementcount')['html'](sPlacements);var sFunction='RequirementPhone.LoadPlacements('+CRequirementSummaryRead['RequirementId']+')';TriSysPhoneGap['ShowAndActivateFunction'](sFieldPrefix+'placements',null,sFunction);}TriSysApex['BrowserHistory']['Menu']['Add']('Requirement',CRequirementSummaryRead['RequirementId'],CRequirementSummaryRead['Reference']);},'DisplayRequirementShortlist':function(lstCRequirementShortlistedCandidate){if(lstCRequirementShortlistedCandidate){var sContactHTML='';lstCRequirementShortlistedCandidate['forEach'](function(shortlistedContact){var sHTML=RequirementPhone['BuildShortlistedCandidateFromTemplates'](shortlistedContact);if(sHTML)sContactHTML+=sHTML;});var sContainerHTML=$('#requirement-form-shortlist-template')['html']();sContainerHTML=sContainerHTML['replace']('{{requirement-form-shortlist-contact-list}}',sContactHTML),$('#requirement-form-shortlist-container')['append'](sContainerHTML);}},'BuildShortlistedCandidateFromTemplates':function(shortlistedContact){var sHTML=$('#requirement-form-shortlisted-candidate')['html']();sHTML=sHTML['replace']('{{requirement-phone-shortlisted-contactid}}',shortlistedContact['ContactId']),sHTML=sHTML['replace']('{{FullName}}',shortlistedContact['FullName']),sHTML=sHTML['replace']('{{JobTitle}}',shortlistedContact['JobTitle']),sHTML=sHTML['replace']('{{Source}}',shortlistedContact['Source']),sHTML=sHTML['replace']('{{ShortlistedDate}}',moment(shortlistedContact['DateShortlisted'])['format']('DD\x20MMM\x20YYYY')),sContactPhotoURL=shortlistedContact['ContactPhotoURL'];if(!sContactPhotoURL)sContactPhotoURL=TriSysApex['Constants']['DefaultContactImage'];sHTML=sHTML['replace']('{{ContactPhotoURL}}',sContactPhotoURL);var sHistory=RequirementPhone['AppendShortlistHistory'](shortlistedContact['DateInterested'],'Interested')+RequirementPhone['AppendShortlistHistory'](shortlistedContact['DateCalled'],'Called')+RequirementPhone['AppendShortlistHistory'](shortlistedContact['DateCVSent'],'CV\x20Sent')+RequirementPhone['AppendShortlistHistory'](shortlistedContact['DateTelephoneInterview'],'Tel.\x20Interview')+RequirementPhone['AppendShortlistHistory'](shortlistedContact['Date1stInterview'],'1st\x20Interview')+RequirementPhone['AppendShortlistHistory'](shortlistedContact['Date2ndInterview'],'2nd\x20Interview')+RequirementPhone['AppendShortlistHistory'](shortlistedContact['Date3rdInterview'],'3rd\x20Interview')+RequirementPhone['AppendShortlistHistory'](shortlistedContact['Date4thInterview'],'4th\x20Interview')+RequirementPhone['AppendShortlistHistory'](shortlistedContact['Date5thInterview'],'5th\x20Interview')+RequirementPhone['AppendShortlistHistory'](shortlistedContact['DateOfferMade'],'Offer\x20Made')+RequirementPhone['AppendShortlistHistory'](shortlistedContact['DateOfferAccepted'],'Offer\x20Accepted')+RequirementPhone['AppendShortlistHistory'](shortlistedContact['DateOfferRejected'],'Offer\x20Rejected')+RequirementPhone['AppendShortlistHistory'](shortlistedContact['DateOfferWithdrawn'],'Offer\x20Withdrawn')+RequirementPhone['AppendShortlistHistory'](shortlistedContact['DateRejected'],'Rejected')+RequirementPhone['AppendShortlistHistory'](shortlistedContact['DatePlaced'],'Placed');return sHTML=sHTML['replace']('{{History}}',sHistory),sHTML;},'AppendShortlistHistory':function(dtIn,sLabel){var iMinYear=0x7c6,sHistory='',dt=new Date(moment(dtIn));if(dt['getFullYear']()>=iMinYear)sHistory='<br\x20/>'+sLabel+':\x20'+moment(dt)['format']('DD\x20MMM\x20YYYY');return sHistory;},'ScrollToTop':function(){$(document['body'])['scrollTop']($('#requirement-form-top')['offset']()['top']-0x78);},'EditRequirement':function(){var options={'IgnorePhoneGap':!![]};TriSysApex['FormsManager']['OpenForm']('Requirement',RequirementPhone['_RequirementId'],!![],options);},'LoadPlacements':function(lRequirementId){var sSearchText='{Requirement:'+lRequirementId+'}';TriSysApex['FormsManager']['OpenForm']('Placements',sSearchText,!![]);}};