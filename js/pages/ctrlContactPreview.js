var ctrlContactPreview={'SplitterID':'ctrlContactPreview-splitter','ContactNameID':'ctrlContactPreview-contactname','Load':function(){var fnCallback=null,currentWindow=$('#'+ctrlContactPreview['SplitterID'])['closest']('[data-role=window]')['getKendoWindow']();if(currentWindow)fnCallback=currentWindow['options']['content']['callback'];$('#'+ctrlContactPreview['SplitterID'])['kendoSplitter']({'orientation':'vertical','panes':[{'collapsible':![],'resizable':![],'size':'70px'},{'collapsible':![]},{'collapsible':![],'resizable':![],'size':'45px'}]});var dialog=$('#'+ctrlContactPreview['SplitterID'])['closest']('[data-role=window]')['data']('kendoWindow'),outerSplitter=$('#'+ctrlContactPreview['SplitterID'])['data']('kendoSplitter'),resizeSplitter=function(){if(dialog&&outerSplitter['wrapper'])try{var iFactor=0x140,lNewHeight=$('#'+ctrlContactPreview['SplitterID'])['closest']('[data-role=window]')['height']()-iFactor;$('#contact-details')['css']('max-height',lNewHeight+'px')['height'](lNewHeight),$('#cv-preview')['css']('max-height',lNewHeight+'px')['height'](lNewHeight),$('#requirements')['css']('max-height',lNewHeight+'px')['height'](lNewHeight),$('#placements')['css']('max-height',lNewHeight+'px')['height'](lNewHeight),$('#notes')['css']('max-height',lNewHeight+'px')['height'](lNewHeight),$('#scheduled')['css']('max-height',lNewHeight+'px')['height'](lNewHeight);}catch(e){}};resizeSplitter(),currentWindow&&(currentWindow['bind']('resize',resizeSplitter),currentWindow['bind']('close',function(){ctrlContactPreview['CurrentContact']=null,ctrlContactPreview['ContactCache']=null;})),TriSysApex['FormsManager']['loadControlIntoDiv']('cv-preview-control','ctrlCVPreview.html',function(){}),TriSysSDK['CShowForm']['datePicker']('contact-preview-availability-date'),setTimeout(TriSysProUI['kendoUI_Overrides'],0x64),fnCallback(),ctrlContactPreview['TabVisibility']();},'TabVisibility':function(){var bRecruitmentDatabase=TriSysAPI['Operators']['stringToBoolean'](TriSysApex['Cache']['UserSettingManager']['GetValue']('RecruitmentDatabase',![]));!bRecruitmentDatabase&&($('#trisys-contact-preview-div-cv')['hide'](),$('#trisys-contact-preview-div-requirements')['hide'](),$('#trisys-contact-preview-div-placements')['hide'](),$('#ctrlContactPreview-OpenCV')['hide'](),$('#contact-preview-availability-date-tr')['hide']()),TriSysApex['LoginCredentials']['isLoggedInToSpecificCompanyAsRecruiter']('Law\x20Absolute')&&($('#ctrlContactPreview-facebook')['hide'](),$('#ctrlContactPreview-twitter')['hide']());},'Open':function(lContactId,sSearchCriteriaJson,options){var contact=ctrlContactPreview['ReadFromCache'](lContactId,sSearchCriteriaJson,options);if(!contact)return;ctrlContactPreview['CallTriSysWebAPIToReadContactSecondaryDetails'](contact['ContactId'],sSearchCriteriaJson),ctrlContactPreview['DisplayContact'](contact);if(options&&options['PostLogin'])ctrlContactPreview['SendSocketIOMessageToBrowserExtension']();},'DisplayContact':function(contact){if(!contact)return;debugger;ctrlContactPreview['CurrentContact']=contact,ctrlContactPreview['DisplayContactSavedStatus'](contact['ContactId']);var sCompanyName='',sStreet='',sCity='',sCounty='',sPostCode='',sAddressType='Home\x20Address',sTelNo='',sEMail='';contact['ContactType']=='Client'?(sCompanyName=contact['CompanyName']+'<br\x20/>',contact['CompanyAddressStreet']&&(sStreet=contact['CompanyAddressStreet']['replace'](/\r\n/g,'<br\x20/>'),sStreet=sStreet['replace'](/\n/g,'<br\x20/>')),sCity=contact['CompanyAddressCity'],sCounty=contact['CompanyAddressCounty'],sPostCode=contact['CompanyAddressPostCode'],sTelNo=contact['WorkTelNo'],sEMail=contact['WorkEMail'],sAddressType='Work\x20Address'):(contact['HomeAddressStreet']&&(sStreet=contact['HomeAddressStreet']['replace'](/\r\n/g,'<br\x20/>'),sStreet=sStreet['replace'](/\n/g,'<br\x20/>')),sCity=contact['HomeAddressCity'],sCounty=contact['HomeAddressCounty'],sPostCode=contact['HomeAddressPostCode'],sTelNo=contact['HomeAddressTelNo'],sEMail=contact['PersonalEMail']);var sContactName=contact['FullName']?contact['FullName']:'';$('#'+ctrlContactPreview['ContactNameID'])['html'](sContactName),TriSysSDK['ContactTypes']['SetClass']('ctrlContactPreview-type',contact['ContactType']);var sAtCompany='';if(contact['CompanyName']){var sCompanyHyperlink='<a\x20href=\x22\x22\x20onclick=\x22ctrlContactPreview.OpenEntityFormRecord(\x27Company\x27,\x20'+contact['CompanyId']+');\x20return\x20false;\x22>'+contact['CompanyName']+'</a>';sAtCompany='\x20at\x20<b><i>'+sCompanyHyperlink+'</i></b>';}$('#ctrlContactPreview-jobtitle')['html']((contact['JobTitle']?contact['JobTitle']:'')+sAtCompany),ctrlContactPreview['ShowContactPhoto'](contact),$('#ctrlContactPreview-companyname')['html'](sCompanyName),$('#ctrlContactPreview-addresstype')['html'](sAddressType);if(sCounty)sCounty+='<br\x20/>';if(sPostCode)sPostCode+='<br\x20/>';$('#ctrlContactPreview-street')['html'](sStreet),$('#ctrlContactPreview-city')['html'](sCity),$('#ctrlContactPreview-county')['html'](sCounty),$('#ctrlContactPreview-postcode')['html'](sPostCode),$('#ctrlContactPreview-telno')['html'](contact['HomeAddressTelNo']);var sMailTo=sEMail?'mailto:'+sEMail:'';$('#ctrlContactPreview-email')['attr']('href',sMailTo),$('#ctrlContactPreview-email')['html'](sEMail),$('#contact-preview-work-email')['val'](contact['WorkEMail']),$('#contact-preview-work-email-hyperlink')['attr']('href','mailto:'+contact['WorkEMail']),$('#contact-preview-personal-email')['val'](contact['PersonalEMail']),$('#contact-preview-personal-email-hyperlink')['attr']('href','mailto:'+contact['PersonalEMail']),$('#contact-preview-work-telno')['val'](contact['WorkTelNo']),$('#contact-preview-personal-mobile-telno')['val'](contact['MobileTelNo']),$('#contact-preview-work-mobile-telno')['val'](contact['WorkMobileTelNo']),$('#contact-preview-home-telno')['val'](contact['HomeAddressTelNo']),TriSysSDK['CShowForm']['setDatePickerValue']('contact-preview-availability-date',contact['AvailabilityDate']);var sAddressSummary='';contact['ContactType']=='Candidate'?sAddressSummary=contact['HomeAddressCity']+(contact['HomeAddressCounty']?',\x20'+contact['HomeAddressCounty']:'')+(contact['HomeAddressCountry']?',\x20'+contact['HomeAddressCountry']:''):sAddressSummary=contact['CompanyAddressCity']+(contact['CompanyAddressCounty']?',\x20'+contact['CompanyAddressCounty']:'')+(contact['CompanyAddressCountry']?',\x20'+contact['CompanyAddressCountry']:''),sAddressSummary&&(sAddressSummary=sAddressSummary['replace']('null',''),sAddressSummary=sAddressSummary['replace']('undefined','')),$('#contact-preview-address-summary')['html'](sAddressSummary?sAddressSummary:''),$('#contact-preview-comments')['val'](contact['Comments']);},'DisplayContactSavedStatus':function(lContactId){if(TriSysApex['EntityPreview']['Contact']['Data']['BrowserExtension']){var sPrefix='#contact-preview-record-status-';$(sPrefix+'row')['show']();var sRecordStatus='Contact\x20'+(lContactId>0x0?'\x20('+lContactId+')\x20exists':'does\x20not\x20exist')+'\x20in\x20your\x20database',sColour=lContactId>0x0?'green':'red';$(sPrefix+'text')['text'](sRecordStatus)['css']('color',sColour);var sHTML='<i\x20class=\x22fa\x20fa-'+(lContactId>0x0?'check':'times')+'\x22\x20style=\x22color:\x20'+sColour+';\x22></i>';$(sPrefix+'icon')['html'](sHTML);var bRecruitmentDatabase=TriSysAPI['Operators']['stringToBoolean'](TriSysApex['Cache']['UserSettingManager']['GetValue']('RecruitmentDatabase',![])),bRecordExists=lContactId>0x0;if(bRecruitmentDatabase){var elemCVAccordion=$('#trisys-contact-preview-div-cv');bRecordExists?elemCVAccordion['show']():elemCVAccordion['hide']();var elemRequirementsAccordion=$('#trisys-contact-preview-div-requirements');bRecordExists?elemRequirementsAccordion['show']():elemRequirementsAccordion['hide']();var elemPlacementsAccordion=$('#trisys-contact-preview-div-placements');bRecordExists?elemPlacementsAccordion['show']():elemPlacementsAccordion['hide']();}var elemNotesHistoryAccordion=$('#trisys-contact-preview-div-noteshistory');bRecordExists?elemNotesHistoryAccordion['show']():elemNotesHistoryAccordion['hide']();var elemSchedultedTasksAccordion=$('#trisys-contact-preview-div-scheduledtasks');bRecordExists?elemSchedultedTasksAccordion['show']():elemSchedultedTasksAccordion['hide']();var elemOpenContactButton=$('#ctrlContactPreview-Open');bRecordExists?elemOpenContactButton['show']():elemOpenContactButton['hide']();}},'ReadFromWebAPI':function(lContactId,sSearchCriteriaJson,options){ctrlContactPreview['ShowWaitingInThePhoto'](!![]);var CReadContactRequest={'ContactRecord':{'ContactId':lContactId}},payloadObject={};payloadObject['URL']='Contacts/ReadContact',payloadObject['OutboundDataPacket']=CReadContactRequest,payloadObject['InboundDataFunction']=function(CReadContactResponse){ctrlContactPreview['ShowWaitingInThePhoto'](![]);if(CReadContactResponse){if(CReadContactResponse['Success']){var contact=CReadContactResponse['ContactRecord'];const bContactExists=!![];bContactExists&&(ctrlContactPreview['AddToCache'](contact),ctrlContactPreview['Open'](contact['ContactId'],sSearchCriteriaJson,options));return;}else TriSysApex['UI']['ShowMessage'](CReadContactResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('ctrlContactPreview.ReadFromWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'CallTriSysWebAPIToReadContactSecondaryDetails':function(lContactId,sJson){var CReadContactSummaryForExtensionRequest={'ContactId':lContactId,'SearchTreeJson':sJson},payloadObject={};payloadObject['URL']='Contacts/ReadContactSummaryForExtension',payloadObject['OutboundDataPacket']=CReadContactSummaryForExtensionRequest,payloadObject['InboundDataFunction']=function(CReadContactSummaryForExtensionResponse){if(CReadContactSummaryForExtensionResponse){var contactSummaryDetails={};CReadContactSummaryForExtensionResponse['Success']&&(contactSummaryDetails=CReadContactSummaryForExtensionResponse),ctrlContactPreview['DisplaySecondaryContactDetails'](contactSummaryDetails);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('ctrlContactPreview.CallTriSysWebAPIToReadContactSecondaryDetails:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'ReadFromCache':function(lContactId,sSearchCriteriaJson,options){if(lContactId<=0x0){ctrlContactPreview['ShowWaitingInThePhoto'](![]);return;}if(ctrlContactPreview['ContactCache'])for(var i=0x0;i<ctrlContactPreview['ContactCache']['length'];i++){var contact=ctrlContactPreview['ContactCache'][i];if(contact['ContactId']==lContactId)return contact;}return ctrlContactPreview['ReadFromWebAPI'](lContactId,sSearchCriteriaJson,options),null;},'RemoveFromCache':function(lContactId){if(ctrlContactPreview['ContactCache'])for(var i=ctrlContactPreview['ContactCache']['length']-0x1;i>=0x0;i--){var contact=ctrlContactPreview['ContactCache'][i];if(contact['ContactId']==lContactId)ctrlContactPreview['ContactCache']['splice'](i,0x1);}},'AddToCache':function(contact){if(!ctrlContactPreview['ContactCache'])ctrlContactPreview['ContactCache']=[];TriSysApex['EntityPreview']['Contact']['Data']['BrowserExtension']&&(ctrlContactPreview['ContactCache']=[]),ctrlContactPreview['ContactCache']['push'](contact);},'ContactCache':null,'CurrentContact':null,'Social':function(sNetwork){if(!ctrlContactPreview['CurrentContact'])return;var eSocialNetwork=TriSysSDK['SocialNetworks']['LinkedIn'];switch(sNetwork){case'facebook':eSocialNetwork=TriSysSDK['SocialNetworks']['Facebook'];break;case'twitter':eSocialNetwork=TriSysSDK['SocialNetworks']['Twitter'];break;};TriSysSDK['SocialNetworks']['OpenSocialNetworkProfile'](eSocialNetwork,ctrlContactPreview['CurrentContact']['ContactId']);},'ShowContactPhoto':function(contact){var sID='#ctrlContactPreview-contactphoto',sURL=TriSysApex['Constants']['DefaultContactGreyImage'];if(contact['PhotoURL'])sURL=contact['PhotoURL'];else{if(contact['ContactPhoto']){var fnShowExistingPhoto=function(sFileURL){contact['PhotoURL']=sFileURL,$(sID)['attr']('src',sFileURL);};TriSysSDK['Controls']['FileManager']['GetFileReferenceServerFilePathToExternalFilePath'](contact['ContactPhoto'],fnShowExistingPhoto);return;}}$(sID)['attr']('src',sURL);},'ShowWaitingInThePhoto':function(bShow){var sID='#ctrlContactPreview-contactphoto',sURL=bShow?'https://apex.trisys.co.uk/images/Spinner-1s-extension-65px.gif':TriSysApex['Constants']['DefaultContactGreyImage'];$(sID)['attr']('src',sURL);},'OpenContact':function(){debugger;if(ctrlContactPreview['CurrentContact']){var bWeAreTheRemoteBrowserPopup=typeof ContactPreviewMode!==TriSysApex['Constants']['Undefined'];if(bWeAreTheRemoteBrowserPopup){if(!ctrlContactPreview['CurrentContact']['ContactId']||ctrlContactPreview['CurrentContact']['ContactId']==0x0){debugger;var sPhotoURL=ctrlContactPreview['CurrentContact']['PhotoURL'];if(sPhotoURL)TriSysApex['Pages']['FileManagerForm']['OpenDocumentViewer'](sPhotoURL,ctrlContactPreview['CurrentContact']['FullName'],'image');return;}TriSysApex['EntityPreview']['Contact']['SendContactPreviewModeSignalRMessage'](ctrlContactPreview['CurrentContact']['ContactId'],TriSysApex['SignalR']['Communication']['MessageType']['OpenEntityRecord']);}else TriSysApex['FormsManager']['OpenForm']('Contact',ctrlContactPreview['CurrentContact']['ContactId']),TriSysApex['EntityPreview']['CloseWindow']('Contact');}},'OpenCV':function(){if(ctrlContactPreview['CurrentContact']){if(ctrlContactPreview['CurrentContact']['CVFileRef']){var bWeAreTheRemoteBrowserPopup=typeof ContactPreviewMode!==TriSysApex['Constants']['Undefined'];bWeAreTheRemoteBrowserPopup?TriSysApex['EntityPreview']['Contact']['SendContactPreviewModeSignalRMessage'](ctrlContactPreview['CurrentContact']['ContactId'],TriSysApex['SignalR']['Communication']['MessageType']['OpenCV']):TriSysApex['Pages']['FileManagerForm']['FileOpenDrillDown'](ctrlContactPreview['CurrentContact']['CVFileRef']);}}},'Actions':function(){var fnCallbackRunAction=function(actionID){var action=TriSysActions['Data']['Action'](actionID);action&&(TriSysActions['Invocation']['InvokedActionID']=action['ID'],TriSysActions['Data']['RecordIdentifierList']=[ctrlContactPreview['CurrentContact']['ContactId']],TriSysActions['Data']['EntityName']='Contact',TriSysActions['Data']['MasterEntityName']=null,TriSysActions['Data']['MasterEntityId']=0x0,TriSysActions['Invocation']['OpenActionForm'](action));},ignoreActions=TriSysApex['Constants']['ContactPreviewIgnoreActions'];TriSysActions['Menus']['Popup']('Contact',fnCallbackRunAction,ignoreActions);},'ReadMapDataFromWebAPI':function(sPostCode){if(!sPostCode){ctrlContactPreview['DrawMap'](null);return;}if(ctrlContactPreview['CurrentContact']['MapData']){ctrlContactPreview['DrawMap'](ctrlContactPreview['CurrentContact']['MapData']);return;};var CAddressPostCodeMapDataRequest={'PostCode':sPostCode},payloadObject={};payloadObject['URL']='Address/MapData',payloadObject['OutboundDataPacket']=CAddressPostCodeMapDataRequest,payloadObject['InboundDataFunction']=function(CAddressPostCodeMapDataResponse){if(CAddressPostCodeMapDataResponse){if(CAddressPostCodeMapDataResponse['Success'])ctrlContactPreview['CurrentContact']['MapData']=CAddressPostCodeMapDataResponse,ctrlContactPreview['DrawMap'](ctrlContactPreview['CurrentContact']['MapData']);else TriSysApex['UI']['errorAlert'](CAddressPostCodeMapDataResponse['ErrorMessage'],TriSysWeb['Constants']['ApplicationName']);}return!![];},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['ErrorHandlerRedirector']('ctrlContactPreview.ReadMapDataFromWebAPI:\x20',request,status,error);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DrawMap':function(mapData){var sDiv='ctrlContactPreview-map',mapDiv=$('#'+sDiv);if(!mapData)mapDiv['hide']();else{var iWest=0x0,iEast=0x0,iNorth=0x0,iSouth=0x0;if(mapData['Latitude']!==0x0&&mapData['Longitude']!==0x0){if(iWest===0x0||iWest>mapData['Latitude'])iWest=mapData['Latitude'];if(iEast===0x0||iEast<mapData['Latitude'])iEast=mapData['Latitude'];if(iNorth===0x0||iNorth>mapData['Longitude'])iNorth=mapData['Longitude'];if(iSouth===0x0||iSouth<mapData['Longitude'])iSouth=mapData['Longitude'];}var iLatitude=(iWest+iEast)/0x2,iLongitude=(iNorth+iSouth)/0x2,centrePosition=null;try{centrePosition=new google['maps']['LatLng'](iLatitude,iLongitude);}catch(err){TriSysApex['UI']['ShowError'](err,'Google\x20Maps\x20Error');return;}var mapOptions={'center':centrePosition,'zoom':0x7},mapObject=new google['maps']['Map'](document['getElementById'](sDiv),mapOptions),markerPosition=new google['maps']['LatLng'](mapData['Latitude'],mapData['Longitude']),sTitle=mapData['PostCode'],marker=new google['maps']['Marker']({'position':markerPosition,'map':mapObject,'title':sTitle});mapDiv['show']();}},'DisplaySecondaryContactDetails':function(contactDetails,bDoNotCheckBrowserPopup){ctrlCVPreview['Open'](contactDetails['CVurl']);var fZoomFactor=0.95;ctrlCVPreview['Zoom'](fZoomFactor,0x320),ctrlContactPreview['DisplayRequirements'](contactDetails['Requirements']),ctrlContactPreview['DisplayPlacements'](contactDetails['Placements']),ctrlContactPreview['DisplayTasks'](contactDetails['NotesHistory'],contactDetails['TotalNotesHistoryRecords'],'trisys-noteshistory-tbody','trisys-noteshistory-more'),ctrlContactPreview['DisplayTasks'](contactDetails['ScheduledTasks'],contactDetails['TotalScheduledTaskRecords'],'trisys-scheduledtasks-tbody','trisys-scheduledtasks-more');if(bDoNotCheckBrowserPopup)return;var bWeAreTheRemoteBrowserPopup=typeof ContactPreviewMode!==TriSysApex['Constants']['Undefined'];bWeAreTheRemoteBrowserPopup&&ContactPreviewMode['ContactLoadedInPreview'](contactDetails['ContactId']);},'DisplayRequirements':function(requirements){var tbody=$('.trisys-requirements-tbody');if(!requirements||requirements['length']==0x0){tbody['hide']();return;}var requirementsData=[];for(var i=0x0;i<requirements['length'];i++){var requirement=requirements[i],requirementObject=JSON['parse'](JSON['stringify'](requirement));requirementObject['EarliestStartDate']=moment(requirement['EarliestStartDate'])['format']('dddd\x20DD\x20MMMM\x20YYYY'),requirementsData['push'](requirementObject);}var directives={'hyperlink':{'onclick':function(params){return'ctrlContactPreview.OpenEntityFormRecord(\x27Requirement\x27,\x20'+this['RequirementId']+')';}}};tbody['render'](requirementsData,directives),tbody['show']();},'DisplayPlacements':function(placements){var tbody=$('.trisys-placements-tbody');if(!placements||placements['length']==0x0){tbody['hide']();return;}var placementsData=[];for(var i=0x0;i<placements['length'];i++){var placement=placements[i],placementObject=JSON['parse'](JSON['stringify'](placement));placementObject['StartDate']=moment(placement['StartDate'])['format']('dddd\x20DD\x20MMMM\x20YYYY'),placementsData['push'](placementObject);}var directives={'hyperlink':{'onclick':function(params){return'ctrlContactPreview.OpenEntityFormRecord(\x27Placement\x27,\x20'+this['PlacementId']+')';}}};tbody['render'](placementsData,directives),tbody['show']();},'DisplayTasks':function(tasks,iTotalTasks,sTableID,sMoreIDPrefix){var sHyperLink=sMoreIDPrefix+'-hyperlink';if(!tasks||tasks['length']==0x0){$('.'+sTableID)['hide'](),$('#'+sHyperLink)['hide']();return;}var taskData=[];for(var i=0x0;i<tasks['length'];i++){var task=tasks[i],taskObject=JSON['parse'](JSON['stringify'](task));taskObject['StartDate']=moment(task['StartDate'])['format']('dddd\x20DD\x20MMMM\x20YYYY'),taskObject['TaskTypeText']=task['TaskType'],taskData['push'](taskObject);}var directives={'hyperlink':{'onclick':function(params){return'ctrlContactPreview.OpenEntityFormRecord(\x27Task\x27,\x20'+this['TaskId']+')';}},'TaskType':{'src':function(params){return'images/trisys/16x16/tasktype/'+this['TaskType']+'.png';}}};$('.'+sTableID)['render'](taskData,directives),$('.'+sTableID)['show']();var iTotalRemaining=iTotalTasks-taskData['length'],sCountText=sMoreIDPrefix+'-text';iTotalRemaining>0x0?($('#'+sCountText)['html']('Click\x20to\x20view\x20'+iTotalRemaining+'\x20additional\x20tasks'),$('#'+sHyperLink)['show']()):$('#'+sHyperLink)['hide']();},'ViewNoteHistoryTasks':function(){ctrlContactPreview['OpenContact']();},'ViewScheduledTasks':function(){ctrlContactPreview['OpenContact']();},'OpenEntityFormRecord':function(sEntityName,lRecordId,bOnlyOpenIfRemoteApp){if(!sEntityName||!lRecordId)return;var bWeAreTheRemoteBrowserPopup=typeof ContactPreviewMode!==TriSysApex['Constants']['Undefined'];if(bWeAreTheRemoteBrowserPopup){var bOnlyOpenEntityRecordIfAlreadyLoaded=!![];TriSysApex['EntityPreview']['SendEntityPreviewModeSignalRMessage'](sEntityName,lRecordId,bOnlyOpenEntityRecordIfAlreadyLoaded);}else{if(!bOnlyOpenIfRemoteApp)switch(sEntityName){case'Task':TriSysApex['ModalDialogue']['Task']['QuickShow'](lRecordId);break;default:TriSysApex['FormsManager']['OpenForm'](sEntityName,lRecordId);break;}}},'ViewComments':function(){var txt=$('#contact-preview-comments'),sComments=txt['val'](),fnEditedComments=function(sText){return txt['val'](sText),!![];},options={'Label':'Comments','Value':sComments,'ReadOnly':![]};TriSysApex['ModalDialogue']['BigEdit']['Popup']('Edit\x20Contact\x20'+options['Label'],'gi-pen',fnEditedComments,options);},'SaveContactDetails':function(bConfirmed){var txt=$('#contact-preview-comments'),sComments=txt['val'](),sWorkEMail=$('#contact-preview-work-email')['val']();if(sWorkEMail)sWorkEMail=sWorkEMail['trim']();var sPersonalEMail=$('#contact-preview-personal-email')['val']();if(sPersonalEMail)sPersonalEMail=sPersonalEMail['trim']();var sWorkTelNo=$('#contact-preview-work-telno')['val']();if(sWorkTelNo)sWorkTelNo=sWorkTelNo['trim']();var sPersonalMobile=$('#contact-preview-personal-mobile-telno')['val']();if(sPersonalMobile)sPersonalMobile=sPersonalMobile['trim']();var sWorkMobile=$('#contact-preview-work-mobile-telno')['val']();if(sWorkMobile)sWorkMobile=sWorkMobile['trim']();var sHomeTelNo=$('#contact-preview-home-telno')['val']();if(sHomeTelNo)sHomeTelNo=sHomeTelNo['trim']();var dtAvailabilityDate=TriSysSDK['CShowForm']['getDatePickerValue']('contact-preview-availability-date'),CWriteContactPreviewDataRequest={'ContactId':ctrlContactPreview['CurrentContact']['ContactId'],'Comments':sComments,'WorkEMail':sWorkEMail,'PrivateEMail':sPersonalEMail,'WorkTelNo':sWorkTelNo,'MobileTelNo':sPersonalMobile,'WorkMobileTelNo':sWorkMobile,'HomeTelNo':sHomeTelNo,'AvailabilityDate':dtAvailabilityDate},sCompany='';if(TriSysApex['EntityPreview']['Contact']['Data']['BrowserExtension']){CWriteContactPreviewDataRequest['FullName']=$('#ctrlContactPreview-contactname')['text'](),CWriteContactPreviewDataRequest['JobTitle']=$('#ctrlContactPreview-jobtitle')['text'](),CWriteContactPreviewDataRequest['PhotoURL']=$('#ctrlContactPreview-contactphoto')['attr']('src'),CWriteContactPreviewDataRequest['LinkedIn']=ctrlContactPreview['Data']['URL'];var sJobTitle=CWriteContactPreviewDataRequest['JobTitle'];if(sJobTitle){var parts=sJobTitle['split']('\x20at\x20');if(parts['length']>0x1){CWriteContactPreviewDataRequest['JobTitle']=parts[0x0],sCompany=parts[0x1];if(sCompany){var parts=sCompany['split']('|');if(parts['length']>0x1)sCompany=parts[0x0];}CWriteContactPreviewDataRequest['CompanyName']=sCompany;}}}if(!bConfirmed&&!ctrlContactPreview['CurrentContact']['ContactId']){var fnOnSave=function(lCompanyId,contact,lAddressId,bEditAfterSave){var options={'Callback':function(lContactId,contact){debugger;contact['ContactId']=lContactId,ctrlContactPreview['DisplayContactAfterCreation'](contact),bEditAfterSave&&ctrlContactPreview['OpenContactFormAndFocusOnTab'](lContactId,!![]);}};if(lCompanyId>0x0)TriSysApex['Pages']['CompanyForm']['SubmitNewCompanyContact'](lCompanyId,contact,lAddressId,bEditAfterSave,options);else{var sContactType=TriSysSDK['CShowForm']['GetTextFromCombo']('newCompanyContact-Type'),sCompanyName=$('#newCompanyContact-Company')['val']();if(!sCompanyName&&sContactType=='Client'){TriSysApex['UI']['ShowMessage']('Please\x20select\x20or\x20enter\x20a\x20company\x20name.');return;}var lstError=[];if(contact['Title']=='(None)')lstError['push']('Title');if(contact['Gender']=='Unknown')lstError['push']('Gender');if(!contact['JobTitle'])lstError['push']('Job\x20Title');if(!contact['Forenames'])lstError['push']('Forename(s)');if(!contact['Surname'])lstError['push']('Surname');if(lstError['length']>0x0){TriSysApex['UI']['ShowMessage']('Please\x20complete\x20the\x20following\x20mandatory\x20fields:<br><br>'+lstError['join']('<br>'));return;}if(sCompanyName){var parts=sCompanyName['split']('|');if(parts['length']>0x1)sCompanyName=parts[0x0];}contact['FullName']=contact['Forenames']+'\x20'+contact['Surname'],contact['URL']=ctrlContactPreview['Data']['URL'],contact['Company']=sCompanyName,contact['Photo']=contact['ContactPhotoURL'],ctrlContactPreview['SaveNewContact'](contact,bEditAfterSave,options['Callback']);}};TriSysApex['ModalDialogue']['NewCompanyContact']['Popup']({'CompanyId':0x0,'Company':'','BrowserExtension':TriSysApex['EntityPreview']['Contact']['Data']['BrowserExtension'],'Contact':CWriteContactPreviewDataRequest},fnOnSave);return;}var payloadObject={};payloadObject['URL']='Contact/WriteContactPreviewData',payloadObject['OutboundDataPacket']=CWriteContactPreviewDataRequest,payloadObject['InboundDataFunction']=function(CWriteUserContactProfileResponse){if(CWriteUserContactProfileResponse){if(CWriteUserContactProfileResponse['Success']){TriSysApex['Toasters']['Success']('Updated\x20'+ctrlContactPreview['CurrentContact']['FullName']);if(TriSysApex['EntityPreview']['Contact']['Data']['BrowserExtension']){ctrlContactPreview['CurrentContact']['ContactId']=CWriteUserContactProfileResponse['ContactId'];if(CWriteUserContactProfileResponse['ContactId']>0x0)ctrlContactPreview['DisplayContactSavedStatus'](CWriteUserContactProfileResponse['ContactId']);}}else TriSysApex['UI']['errorAlert'](CWriteUserContactProfileResponse['ErrorMessage'],TriSysWeb['Constants']['ApplicationName']);}return!![];},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['ErrorHandlerRedirector']('ctrlContactPreview.SaveContactDetails:\x20',request,status,error);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);TriSysApex['Pages']['ContactForm']['ContactId']==ctrlContactPreview['CurrentContact']['ContactId']&&($('#Contact_HomeAddressTelNo')['val'](sHomeTelNo),$('#ContactConfigFields_AlternativeEMailAddress1')['val'](sPersonalEMail),$('#Contact_MobileTelNo')['val'](sPersonalMobile),$('#Contact_WorkTelNo')['val'](sWorkTelNo),$('#ContactConfigFields_WorkMobile')['val'](sWorkMobile),$('#Contact_EMail')['val'](sWorkEMail),$('#Contact_Comments')['val'](sComments),TriSysSDK['CShowForm']['setDatePickerValue']('ContactConfigFields_AvailabilityDate',dtAvailabilityDate));ctrlContactPreview['RemoveFromCache'](ctrlContactPreview['CurrentContact']['ContactId']);var bOnlyOpenIfRemoteApp=!![];ctrlContactPreview['OpenEntityFormRecord']('Contact',ctrlContactPreview['CurrentContact']['ContactId'],bOnlyOpenIfRemoteApp);},'SaveNewContact':function(contactDetails,bEditAfterSave,fnCallback){debugger;var payloadObject={};payloadObject['URL']='SocialNetwork/CreateContact',payloadObject['OutboundDataPacket']=contactDetails,payloadObject['InboundDataFunction']=function(CSocialNetworkProfileCreateContactResponse){if(CSocialNetworkProfileCreateContactResponse){if(CSocialNetworkProfileCreateContactResponse['Success']){TriSysApex['UI']['CloseModalPopup'](),contactDetails['ContactId']=CSocialNetworkProfileCreateContactResponse['ContactId'],ctrlContactPreview['DisplayContactAfterCreation'](contactDetails);bEditAfterSave&&ctrlContactPreview['OpenContactFormAndFocusOnTab'](CSocialNetworkProfileCreateContactResponse['ContactId'],!![]);return;}else TriSysApex['UI']['ShowMessage'](CSocialNetworkProfileCreateContactResponse['ErrorMessage']);}else TriSysApex['UI']['ShowMessage']('Error');},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['ShowMessage']('TriSysExtension.AddNewContact:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'OpenContactFormAndFocusOnTab':function(lContactId){TriSysApex['InterprocessCommunication']['ClientOpenForm']('Contact',lContactId),ctrlContactPreview['FocusOnApexBrowserTab']();},'FocusOnApexBrowserTab':function(){var sDefaultURL='https://apex.trisys.co.uk/*',payloadObject={};payloadObject['URL']='OfficeAutomation/ActiveTabURL',payloadObject['InboundDataFunction']=function(CActiveTabURLResponse){if(CActiveTabURLResponse){if(CActiveTabURLResponse['Success'])sDefaultURL=CActiveTabURLResponse['URL'];}var extensionObject={'Type':TriSysApex['InterprocessCommunication']['MessageType_TriSysToBrowser'],'Instruction':TriSysApex['InterprocessCommunication']['ActivateApexTab'],'URL':sDefaultURL};parent['postMessage'](extensionObject,'*');},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DisplayContactAfterCreation':function(contact){ctrlContactPreview['CurrentContact']['ContactId']=contact['ContactId'],ctrlContactPreview['DisplayContactSavedStatus'](contact['ContactId']),TriSysSDK['ContactTypes']['SetClass']('ctrlContactPreview-type',contact['ContactType']);var sFullName=contact['Forenames']+'\x20'+contact['Surname'],sContactName=sFullName?sFullName:'';$('#'+ctrlContactPreview['ContactNameID'])['html'](sContactName);var sAtCompany='';if(contact['CompanyName']){var sCompanyHyperlink='<a\x20href=\x22\x22\x20onclick=\x22ctrlContactPreview.OpenEntityFormRecord(\x27Company\x27,\x20'+contact['CompanyId']+');\x20return\x20false;\x22>'+contact['CompanyName']+'</a>';sAtCompany='\x20at\x20<b><i>'+sCompanyHyperlink+'</i></b>';}$('#ctrlContactPreview-jobtitle')['html']((contact['JobTitle']?contact['JobTitle']:'')+sAtCompany);},'SendSocketIOMessageToBrowserExtension':function(){var extensionObject={'Type':TriSysApex['InterprocessCommunication']['ApexBrowserExtensionLoaded'],'Instruction':TriSysApex['InterprocessCommunication']['ApexBrowserExtensionLoaded']};TriSysApex['SignalR']['Communication']['Send'](TriSysApex['SignalR']['Communication']['FullLoggedInSenderAndRecipientAddress'](),JSON['stringify'](extensionObject));},'Data':{'URL':null}};$(document)['ready'](function(){ctrlContactPreview['Load']();});