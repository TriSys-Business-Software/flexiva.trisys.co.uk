var ctrlWidgetPicker={'_CallbackOnSelection':null,'Load':function(fnCallbackOnSelection){ctrlWidgetPicker['_CallbackOnSelection']=fnCallbackOnSelection,setTimeout(ctrlWidgetPicker['LoadWidgets'],0x5);},'WidgetCategories':[{'category':'blocks','caption':'Block','icon':'gi\x20gi-embed'},{'category':'clipboard','caption':'Clipboard','icon':'fa\x20fa-clipboard','clipboard':!![]},{'category':'fields','caption':'Field','icon':'fa\x20fa-database','grid':!![]},{'category':'images','caption':'Image','icon':'gi\x20gi-picture'},{'category':'icons','caption':'Icon','icon':'fa\x20fa-file-image-o'}],'LoadWidgets':function(){var iFudgeFactor=0x14a,lHeight=$(window)['height']()-iFudgeFactor,pickerList=$('#widget-picker-list');pickerList['height'](lHeight);var liPrefix='widget-picker-category-';for(var i=0x0;i<ctrlWidgetPicker['WidgetCategories']['length'];i++){var item=ctrlWidgetPicker['WidgetCategories'][i],sCategory=item['category'],liID=liPrefix+sCategory,li=$('#'+liID);li['find']('a')['each'](function(){$(this)['click'](function(e){e['preventDefault']();var li=$(this)['parent'](),liID=li['attr']('id'),parts=liID['split'](liPrefix),sSelectedCategory=parts[0x1],itemCategory=ctrlWidgetPicker['WidgetCategories']['filter'](function(item){return item['category']===sSelectedCategory;})['shift']();ctrlWidgetPicker['WidgetPickerCategorySelection'](itemCategory);});});}ctrlWidgetPicker['PopulateListOfWidgetsForCategory'](ctrlWidgetPicker['WidgetCategories'][0x0]);},'WidgetPickerCategorySelection':function(item){var sUL='widget-picker-categories-list';$('#'+sUL)['find']('li')['each'](function(){$(this)['removeClass']('active');});var liPrefix='widget-picker-category-',liID=liPrefix+item['category'];$('#'+liID)['addClass']('active'),$('#widget-picker-category')['html'](item['caption']),$('#widget-picker-category-icon')['removeClass']()['addClass'](item['icon']+'\x20pull-left\x20themed-color'),ctrlWidgetPicker['PopulateListOfWidgetsForCategory'](item);},'PopulateListOfWidgetsForCategory':function(categoryItem){var bFields=categoryItem['grid'],sGridID='widget-picker-grid';bFields?($('#'+sGridID)['show'](),$('#widget-picker-list')['hide']()):($('#'+sGridID)['hide'](),$('#widget-picker-list')['show']());if(bFields){TriSysSDK['Grid']['WaitSpinnerMode']({'Div':sGridID},!![]),setTimeout(function(){ctrlWidgetPicker['PopulateFieldGrid'](sGridID);},0x64);return;}ctrlWidgetPicker['PopulateListOfWidgets'](categoryItem);},'ReadWidgetsFromFile':function(){var widgets=TriSysApex['Forms']['Configuration']['JsonFileData']('widgets.json');if(widgets)return widgets['Widgets'];},'GetWidgetByNameFromClipboard':function(sName){var widget=null,lst=ctrlFormDesigner['Settings']['Clipboard']['_List'];return lst['forEach'](function(categoryItem){if(categoryItem['ID']==sName){widget={'Category':'clipboard','Name':categoryItem['ID'],'Caption':categoryItem['ID'],'Description':categoryItem['HTML'],'HTML':categoryItem['HTML']};if(categoryItem['Type'])widget['Caption']=categoryItem['Type'];}}),widget;},'ReadWidgetsFromClipboard':function(){var lst=ctrlFormDesigner['Settings']['Clipboard']['_List'],widgets=[];for(var i=lst['length']-0x1;i>=0x0;i--){var categoryItem=lst[i],widget=ctrlWidgetPicker['GetWidgetByNameFromClipboard'](categoryItem['ID']);widgets['push'](widget);}return widgets;},'PopulateListOfWidgets':function(itemCategory){ctrlWidgetPicker['RemoveAllWidgetsFromList']();var widgets=null;if(itemCategory['clipboard'])widgets=ctrlWidgetPicker['ReadWidgetsFromClipboard']();else widgets=ctrlWidgetPicker['ReadWidgetsFromFile']();if(!widgets)return null;var iAddedCounter=0x0;for(var i=0x0;i<widgets['length'];i++){var widget=widgets[i],bAddWidget=widget['Category']['toLowerCase']()==itemCategory['category']['toLowerCase']();if(widget['Hidden'])bAddWidget=![];bAddWidget&&(iAddedCounter+=0x1,ctrlWidgetPicker['AddWidgetToList'](widget,iAddedCounter));}},'GetWidgetByNameFromJSONFile':function(sName){var widgets=ctrlWidgetPicker['ReadWidgetsFromFile']();if(!widgets)return null;for(var i=0x0;i<widgets['length'];i++){var widget=widgets[i];if(widget['Name']==sName)return widget;}},'AddWidgetToList':function(widget,iRow){var sTableRowTemplateID='widget-picker-category-widget-table-row',sTableRowTemplateHTML=document['getElementById'](sTableRowTemplateID)['outerHTML'],sTableRowDividerTemplateID='widget-picker-category-widget-table-row-divider',sTableRowDividerTemplateHTML=document['getElementById'](sTableRowDividerTemplateID)['outerHTML'],sTableRowID=sTableRowTemplateID+'-'+iRow,sTableRow=sTableRowTemplateHTML;sTableRow=sTableRow['replace'](sTableRowTemplateID,sTableRowID),sTableRow=sTableRow['replace']('display:none;',''),sTableRow=sTableRow['replace']('display:\x20none;','');var sThumbnailDisplay='block',sThumbnailImage=widget['Thumbnail'],sImageFolder='https://apex.trisys.co.uk/images/trisys/widgets/';if(sThumbnailImage)sThumbnailImage=sImageFolder+sThumbnailImage;else sThumbnailDisplay='none';var sCaption=widget['Caption'],sImageViewer='';if(sThumbnailImage)sImageViewer='onclick=\x22TriSysSDK.Controls.FileManager.OpenDocumentViewer(\x27'+sCaption+'\x27,\x20\x27'+sThumbnailImage+'\x27);\x22';sTableRow=sTableRow['replace']('##image-viewer##',sImageViewer),sTableRow=sTableRow['replace']('##install-image-display##',sThumbnailDisplay),sTableRow=sTableRow['replace']('##ImagePath##',sThumbnailImage),sTableRow=sTableRow['replace']('##Caption##',sCaption),sTableRow=sTableRow['replace']('##Description##',widget['Description']);var bInstalledInView=![],sInstallHandler='onclick=\x22ctrlWidgetPicker.SelectButtonClicked(\x27'+widget['Name']+'\x27,\x20this);\x22',sEnabled=bInstalledInView?'disabled':'',sInstall=bInstalledInView?'':sInstallHandler;sTableRow=sTableRow['replace']('##install-enabled##',sEnabled),sTableRow=sTableRow['replace']('##install-click##',sInstall);var sTableID='widget-picker-category-widget-table';if(iRow>0x1){var sRowDivider=sTableRowDividerTemplateHTML;sRowDivider=TriSysSDK['DocumentObjectModel']['RemoveStyleDisplayNone'](sRowDivider),$('#'+sTableID)['append'](sRowDivider);}$('#'+sTableID)['append'](sTableRow);},'SelectButtonClicked':function(sWidgetName,btn){var widget=null;widget=ctrlWidgetPicker['GetWidgetByNameFromClipboard'](sWidgetName);if(!widget)widget=ctrlWidgetPicker['GetWidgetByNameFromJSONFile'](sWidgetName);if(widget)ctrlWidgetPicker['SelectedWidget'](null,widget);},'RemoveAllWidgetsFromList':function(){var sTableID='widget-picker-category-widget-table';$('#'+sTableID+'\x20tr')['each'](function(i,row){var sDisplay=$(row)['css']('display');if(sDisplay){if(sDisplay['indexOf']('none')<0x0)$(row)['remove']();}});},'PopulateFieldGrid':function(sGridID){var fieldDescriptions=TriSysApex['Cache']['FieldDescriptions']();fieldDescriptions['sort'](function(a,b){var x=a['TableName']['toLowerCase']()+'_'+a['TableFieldName']['toLowerCase'](),y=b['TableName']['toLowerCase']()+'_'+b['TableFieldName']['toLowerCase']();return x<y?-0x1:x>y?0x1:0x0;});var columns=[{'field':'FieldId','title':'FieldId','type':'number','width':0x46,'hidden':!![]},{'field':'TableName','title':'TableName','type':'string'},{'field':'TableFieldName','title':'TableFieldName','type':'string'},{'field':'FieldTypeName','title':'Field\x20Type','type':'string'},{'field':'Lookup','title':'Lookup','type':'string','template':'#\x20if(Lookup\x20==\x20\x22true\x22){#Yes#}else{#No#}\x20#'},{'field':'Description','title':'Description','type':'string'}],iModalRecordsPerPage=TriSysApex['UserOptions']['RecordsPerPage']()/0x2,sDivTag=sGridID,sGridName=sDivTag+'-GridInstance';TriSysSDK['Grid']['VirtualMode']({'Div':sDivTag,'ID':sGridName,'Title':'Field\x20Descriptions','RecordsPerPage':iModalRecordsPerPage,'PopulationByObject':fieldDescriptions,'Columns':columns,'KeyColumnName':'FieldId','DrillDownFunction':function(rowData){fieldDescriptions['forEach'](function(fieldDescription){if(fieldDescription['FieldId']==rowData['FieldId'])ctrlWidgetPicker['SelectedWidget'](fieldDescription);});},'MultiRowSelect':![],'Grouping':![],'OpenButtonCaption':'Select'});},'SelectedWidget':function(fieldDescription,widget){ctrlWidgetPicker['_CallbackOnSelection'](fieldDescription,widget),TriSysApex['UI']['CloseModalPopup']();}};