var CompanyPhone={'_CompanyId':0x0,'LoadCompany':function(lCompanyId){CompanyPhone['_CompanyId']=lCompanyId,CompanyPhone['HideFieldsBeforeDisplay']();if(lCompanyId<=0x0){var options={'IgnorePhoneGap':!![]};TriSysApex['FormsManager']['OpenForm']('Company',-0x1,![],options);return;}var spinnerWait={'Div':'company-phone-summary-top'};TriSysSDK['Grid']['WaitSpinnerMode'](spinnerWait,!![]);var fnCallbackSummary=function(CCompanyReadResponse,bSuccess){TriSysSDK['Grid']['WaitSpinnerMode'](spinnerWait,![]);if(bSuccess){if(CCompanyReadResponse['Success']){CompanyPhone['DisplayCompany'](CCompanyReadResponse['Company']);var spinnerWait2={'Div':'company-form-addresses-container'};TriSysSDK['Grid']['WaitSpinnerMode'](spinnerWait2,!![]);var fnAddressesAndContacts=function(CCompanyReadResponse,bSuccess){TriSysSDK['Grid']['WaitSpinnerMode'](spinnerWait2,![]);if(bSuccess)CompanyPhone['DisplayCompany'](CCompanyReadResponse['Company']);};CompanyPhone['ReadCompanyFromWebAPI'](lCompanyId,!![],fnAddressesAndContacts);}}};CompanyPhone['ReadCompanyFromWebAPI'](lCompanyId,![],fnCallbackSummary);},'ReadCompanyFromWebAPI':function(lCompanyId,bAddressesAndContacts,fnCallback){var CCompanyReadRequest={'CompanyId':lCompanyId,'AddressesAndContacts':bAddressesAndContacts},payloadObject={};payloadObject['URL']='Company/Read',payloadObject['OutboundDataPacket']=CCompanyReadRequest,payloadObject['InboundDataFunction']=function(CCompanyReadResponse){fnCallback(CCompanyReadResponse,!![]);},payloadObject['ErrorHandlerFunction']=function(request,status,error){fnCallback(null,![]),TriSysApex['UI']['errorAlert']('CompanyPhone.ReadCompanyFromWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'HideFieldsBeforeDisplay':function(){var sFieldPrefix='#company-phone-';$(sFieldPrefix+'companyname')['html'](''),$(sFieldPrefix+'industry')['html'](''),$(sFieldPrefix+'logourl')['unbind']('click'),$(sFieldPrefix+'employees')['hide'](),$(sFieldPrefix+'directors')['hide'](),$(sFieldPrefix+'turnover')['hide'](),$('[id^='+sFieldPrefix['replace']('#','')+']')['filter']('[id*=-tr]')['each'](function(){$(this)['hide']();}),$(sFieldPrefix+'comments-table')['hide'](),$(sFieldPrefix+'requirements-table')['hide'](),$(sFieldPrefix+'placements-table')['hide'](),$('#company-form-addresses-container')['empty']();},'DisplayCompany':function(CCompanySummary){CompanyPhone['ScrollToTop']();var sFieldPrefix='#company-phone-';$(sFieldPrefix+'companyname')['html'](CCompanySummary['CompanyName']),$(sFieldPrefix+'industry')['html'](CCompanySummary['Industry']);var bHyperlinkOpenLogo=!![],sCompanyLogoURL=CCompanySummary['CompanyLogoURL'];!sCompanyLogoURL&&(sCompanyLogoURL=TriSysApex['Constants']['DefaultCompanyImage'],bHyperlinkOpenLogo=![]);$(sFieldPrefix+'logourl')['attr']('src',sCompanyLogoURL),$(sFieldPrefix+'logourl')['unbind']('click');bHyperlinkOpenLogo&&$(sFieldPrefix+'logourl')['on']('click',function(){TriSysSDK['Controls']['FileManager']['OpenDocumentViewer'](CCompanySummary['CompanyName'],sCompanyLogoURL,CCompanySummary['CompanyName']);});CCompanySummary['Employees']&&CCompanySummary['Employees']>0x0&&($(sFieldPrefix+'employees')['show'](),$(sFieldPrefix+'employees')['html']('<br\x20/><i\x20class=\x22gi\x20gi-user\x22\x20style=\x22color:\x20cornflowerblue;\x22></i>\x20&nbsp;\x20'+CCompanySummary['Employees']+'\x20employee'+(CCompanySummary['Employees']==0x1?'':'s')));CCompanySummary['Directors']&&CCompanySummary['Directors']>0x0&&($(sFieldPrefix+'directors')['show'](),$(sFieldPrefix+'directors')['html']('<br\x20/><i\x20class=\x22gi\x20gi-tie\x22\x20style=\x22color:\x20plum;\x22></i>\x20&nbsp;\x20'+CCompanySummary['Directors']+'\x20director'+(CCompanySummary['Directors']==0x1?'':'s')));if(CCompanySummary['Turnover']&&CCompanySummary['Turnover']>0x0){var sTurnover=TriSysSDK['Numbers']['ThousandsSeparator'](CCompanySummary['Turnover']);$(sFieldPrefix+'turnover')['show'](),$(sFieldPrefix+'turnover')['html']('<br\x20/><i\x20class=\x22gi\x20gi-gbp\x22\x20style=\x22color:\x20green;\x22></i>\x20&nbsp;\x20'+sTurnover+'\x20annual\x20turnover');}CCompanySummary['Comments']&&($(sFieldPrefix+'comments-table')['show'](),$(sFieldPrefix+'comments')['html'](CCompanySummary['Comments']));if(CCompanySummary['MainTelNo'])TriSysPhoneGap['ShowAndActivateCall'](sFieldPrefix+'maintelno',CCompanySummary['MainTelNo']);if(CCompanySummary['EMail'])TriSysPhoneGap['ShowAndActivateEMail'](sFieldPrefix+'email',CCompanySummary['EMail']);if(CCompanySummary['WebPage'])TriSysPhoneGap['ShowAndActivateWebSite'](sFieldPrefix+'website',CCompanySummary['WebPage']);CCompanySummary['Addresses']&&CCompanySummary['Addresses']['forEach'](function(addressContacts){var sHTML=CompanyPhone['BuildAddressFromTemplates'](addressContacts);if(sHTML)$('#company-form-addresses-container')['append'](sHTML);});if(CCompanySummary['RequirementCount']>0x0){var sRequirements=CCompanySummary['RequirementCount']+'\x20Requirement'+(CCompanySummary['RequirementCount']==0x1?'':'s');$(sFieldPrefix+'requirements-table')['show'](),$(sFieldPrefix+'requirementcount')['html'](sRequirements);var sFunction='CompanyPhone.LoadRequirements('+CCompanySummary['CompanyId']+',\x20\x27'+CCompanySummary['CompanyName']+'\x27)';TriSysPhoneGap['ShowAndActivateFunction'](sFieldPrefix+'requirements',null,sFunction);}if(CCompanySummary['PlacementCount']>0x0){var sPlacements=CCompanySummary['PlacementCount']+'\x20Placement'+(CCompanySummary['PlacementCount']==0x1?'':'s');$(sFieldPrefix+'placements-table')['show'](),$(sFieldPrefix+'placementcount')['html'](sPlacements);var sFunction='CompanyPhone.LoadPlacements('+CCompanySummary['CompanyId']+',\x20\x27'+CCompanySummary['CompanyName']+'\x27)';TriSysPhoneGap['ShowAndActivateFunction'](sFieldPrefix+'placements',null,sFunction);}TriSysApex['BrowserHistory']['Menu']['Add']('Company',CCompanySummary['CompanyId'],CCompanySummary['CompanyName']);},'BuildAddressFromTemplates':function(CCompanySummaryAddressContacts){var sHTML=$('#company-form-address-template')['html']();sHTML=sHTML['replace']('{{contact-phone-address-type}}',CCompanySummaryAddressContacts['Address']['Type']);var address=CCompanySummaryAddressContacts['Address'],sAddress=CompanyPhone['DisplayAddress'](address['Street'],address['City'],address['County'],address['PostCode'],address['Country']);if(!sAddress)sAddress='Unknown';sHTML=sHTML['replace'](/{{contact-phone-address}}/g,sAddress);var sContactTemplateHTML=CompanyPhone['BuildContactFromTemplates'](CCompanySummaryAddressContacts['Contacts']);return sHTML=sHTML['replace']('{{company-form-address-contact-list}}',sContactTemplateHTML),sHTML;},'BuildContactFromTemplates':function(lstCContact){if(!lstCContact)return'';if(lstCContact['length']==0x0)return'';var sHTML='',sTemplateHTML=$('#company-form-address-contacts')['html']();return lstCContact['forEach'](function(CContact){var sContactHTML=sTemplateHTML;sContactHTML=sContactHTML['replace']('{{contact-phone-address-contactid}}',CContact['ContactId']),sContactHTML=sContactHTML['replace']('#:FullName#',CContact['FullName']),sContactHTML=sContactHTML['replace']('#:JobTitle#',CContact['JobTitle']?CContact['JobTitle']:'');if(!CContact['ContactPhotoURL'])CContact['ContactPhotoURL']=TriSysApex['Constants']['DefaultContactImage'];sContactHTML=sContactHTML['replace']('#:ContactPhotoURL#',CContact['ContactPhotoURL']),sHTML+=sContactHTML;}),sHTML;},'DisplayAddress':function(sStreet,sCity,sCounty,sPostCode,sCountry){var sAddress=sStreet!='?'?sStreet:'';sAddress&&sAddress!='?'&&(sAddress=sAddress['replace'](/\n/g,',\x20'),sAddress=sAddress['replace'](/\r/g,''));if(sAddress&&sCity&&sCity!='?')sAddress+=',\x20';if(sCity!='?')sAddress+=sCity;if(sAddress&&sCounty&&sCounty!='?')sAddress+=',\x20';if(sCounty!='?')sAddress+=sCounty;if(sAddress&&sPostCode&&sPostCode!='?')sAddress+=',\x20';if(sPostCode!='?')sAddress+=sPostCode;if(sAddress&&sCountry&&sCountry!='?')sAddress+=',\x20';if(sCountry!='?')sAddress+=sCountry;return sAddress;},'ScrollToTop':function(){$(document['body'])['scrollTop']($('#company-form-top')['offset']()['top']-0x78);},'EditCompany':function(){var options={'IgnorePhoneGap':!![]};TriSysApex['FormsManager']['OpenForm']('Company',CompanyPhone['_CompanyId'],!![],options);},'LoadRequirements':function(lCompanyId,sCompanyName){var sSearchText='{Company:'+lCompanyId+'}';TriSysApex['FormsManager']['OpenForm']('Requirements',sSearchText,!![]);},'LoadPlacements':function(lCompanyId,sCompanyName){var sSearchText='{Company:'+lCompanyId+'}';TriSysApex['FormsManager']['OpenForm']('Placements',sSearchText,!![]);}};