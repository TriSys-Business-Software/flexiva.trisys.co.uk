var ClientVacancy={'LoadFromURL':function(sParameters){TriSysWebJobs['Vacancies']['RequirementId']=TriSysApex['Pages']['Controller']['ParseLoadRecordURLParameter'](sParameters,0x0,!![]),ClientVacancy['Load'](TriSysWebJobs['Vacancies']['RequirementId']);},'Load':function(lRequirementId){$('#webjobs-customer-name')['html'](TriSysWebJobs['Agency']['CustomerName']),ClientVacancy['ShowVacancySummary'](lRequirementId);},'ShowVacancySummary':function(lRequirementId){$('#trisys-api-results')['html']('Authenticated.');var CVacancySummaryRequest={'RequirementId':lRequirementId},payloadObject={};payloadObject['URL']='Vacancy/Summary',payloadObject['OutboundDataPacket']=CVacancySummaryRequest,payloadObject['InboundDataFunction']=function(CVacancySummaryResponse){TriSysApex['UI']['HideWait']();if(CVacancySummaryResponse['Success']){var sDisplay=JSON['stringify'](CVacancySummaryResponse);$('#trisys-api-results')['html'](sDisplay),$('#trisys-vacancy-reference')['html'](CVacancySummaryResponse['Reference']),$('#trisys-vacancy-type')['html'](CVacancySummaryResponse['Type']),$('#trisys-vacancy-status')['html'](CVacancySummaryResponse['Status']),$('#trisys-vacancy-jobtitle')['html'](CVacancySummaryResponse['JobTitle']),$('#trisys-vacancy-location')['html'](CVacancySummaryResponse['Location']);TriSysWebJobs['Constants']['LoggedInAsClient']&&($('#trisys-vacancy-location-label')['html']('Site\x20Address'),$('#trisys-vacancy-status-group')['show']());var sSummary=CVacancySummaryResponse['Reference']+'\x20&bull;\x20'+CVacancySummaryResponse['JobTitle']+'\x20&bull;\x20'+CVacancySummaryResponse['Location'];$('#trisys-vacancy-summary')['html'](sSummary);var sDescription=CVacancySummaryResponse['JobDescription'];if(sDescription)sDescription=sDescription['split']('\x0a')['join']('<br\x20/>');var sPayType=(TriSysWebJobs['Constants']['LoggedInAsClient']?'Charge\x20':'')+'Rate',sRemuneration=CVacancySummaryResponse['ChargeRateSummary'];CVacancySummaryResponse['Type']=='Permanent'?(sPayType='Salary',sRemuneration=CVacancySummaryResponse['MaximumSalaryRate']):($('#trisys-vacancy-durationweeks-group')['show'](),$('#trisys-vacancy-durationweeks')['html'](CVacancySummaryResponse['DurationInWeeks']));if(sRemuneration)sRemuneration=sRemuneration['replace'](/\n/g,'<br\x20/>');$('#trisys-vacancy-remunerationtype')['html'](sPayType),$('#trisys-vacancy-remuneration')['html'](sRemuneration);if(CVacancySummaryResponse['StartDate']){var sStartDate=moment(CVacancySummaryResponse['StartDate'])['format']('dddd\x20DD\x20MMMM\x20YYYY');$('#trisys-vacancy-startdate')['html'](sStartDate);}$('#trisys-vacancy-jobdescription')['html'](sDescription);if(CVacancySummaryResponse['Custom']&&CVacancySummaryResponse['Custom']['HealthAndSafety']){var sHealthAndSafety=CVacancySummaryResponse['Custom']['HealthAndSafety'];if(sHealthAndSafety)sHealthAndSafety=sHealthAndSafety['split']('\x0a')['join']('<br\x20/>');$('#trisys-vacancy-health-and-safety')['html'](sHealthAndSafety);}$('#trisys-vacancy-username')['html'](CVacancySummaryResponse['UserName']),fnGetUser(CVacancySummaryResponse['UserId'],CVacancySummaryResponse['Reference'],CVacancySummaryResponse['JobTitle']);var clientContact=CVacancySummaryResponse['ClientContact'];$('#trisys-vacancy-client-name')['html'](clientContact['FullName']),$('#trisys-vacancy-client-company')['html'](clientContact['CompanyName']);var sAddress=clientContact['CompanyAddressStreet'];sAddress&&(sAddress=sAddress['replace'](/\r\n/g,'<br\x20/>'),sAddress=sAddress['replace'](/\n/g,'<br\x20/>'));sAddress+='<br\x20/>'+clientContact['CompanyAddressCity']+'<br\x20/>'+clientContact['CompanyAddressCounty']+'<br\x20/>'+clientContact['CompanyAddressPostCode'];if(clientContact['CompanyAddressCountry'])sAddress+='<br\x20/>'+clientContact['CompanyAddressCountry'];$('#trisys-vacancy-client-address')['html'](sAddress),$('#trisys-vacancy-client-jobtitle')['html'](clientContact['JobTitle']),$('#trisys-vacancy-client-worktelno')['html'](clientContact['WorkTelNo']),$('#trisys-vacancy-client-mobiletelno')['html'](clientContact['WorkMobileTelNo']);if(CVacancySummaryResponse['ClientCompanyLogoURL'])$('#trisys-vacancy-companylogo')['attr']('src',CVacancySummaryResponse['ClientCompanyLogoURL'])['show']();return $('#trisys-vacancy-client-email')['attr']('href','mailto:'+clientContact['WorkEMail']+'?subject='+CVacancySummaryResponse['Reference']+':\x20'+CVacancySummaryResponse['JobTitle']),$('#trisys-vacancy-client-email')['html'](clientContact['WorkEMail']),!![];}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),alert('ClientVacancy.ShowVacancySummary:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Vacancy...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);if(TriSysWebJobs['Constants']['LoggedInAsClient'])ClientVacancy['PopulateCandidateShortlistGrid'](lRequirementId);var fnGetUser=function(lUserId,sReference,sJobTitle){if(lUserId>0x0){var CReadUserAccountRequest={'UserId':lUserId},payloadObject={};payloadObject['URL']='Users/ReadUserAccount',payloadObject['OutboundDataPacket']=CReadUserAccountRequest,payloadObject['InboundDataFunction']=function(CReadUserAccountResponse){TriSysApex['UI']['HideWait']();var user=CReadUserAccountResponse['UserAccount'],contact=user['Contact'];$('#trisys-vacancy-user-name')['html'](contact['FullName']),$('#trisys-vacancy-user-company')['html'](contact['CompanyName']),$('#trisys-vacancy-user-jobtitle')['html'](contact['JobTitle']),$('#trisys-vacancy-user-worktelno')['html'](contact['WorkTelNo']),$('#trisys-vacancy-user-mobiletelno')['html'](contact['WorkMobileTelNo']);if(user['Photo'])$('#trisys-vacancy-userphoto')['attr']('src',user['Photo'])['show']();$('#trisys-vacancy-user-email')['attr']('href','mailto:'+contact['WorkEMail']+'?subject='+sReference+':\x20'+sJobTitle),$('#trisys-vacancy-user-email')['html'](contact['WorkEMail']);var elemLinkedIn=$('#trisys-vacancy-user-linkedin');if(elemLinkedIn&&contact['LinkedIn'])elemLinkedIn['attr']('href',contact['LinkedIn']);return!![];},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),alert('ClientVacancy.ShowVacancySummary.fnGetUser:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Contact\x20Details...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);};};},'PopulateCandidateShortlistGrid':function(lRequirementId){var sGridID='trisys-vacancy-ShortlistGrid',sGridName='ShortlistedCandidates',sTitle='Shortlisted\x20Candidates',fnPopulationByFunction={'API':'Contacts/List','Parameters':function(request){request['RequirementId']=lRequirementId,request['Shortlist']=!![];},'DataTableFunction':function(response){return response['List'];}},bHorizontalScrolling=![];TriSysSDK['Grid']['VirtualMode']({'Div':sGridID,'ID':sGridName,'Title':sTitle,'RecordsPerPage':TriSysApex['UserOptions']['RecordsPerPage'](),'PopulationByFunction':fnPopulationByFunction,'Columns':ClientVacancy['Columns'],'MobileVisibleColumns':ClientVacancy['MobileVisibleColumns'],'MobileRowTemplate':ClientVacancy['MobileRowTemplate'],'KeyColumnName':'ContactId','DrillDownFunction':null,'PreviewButtonFunction':function(rowData){var lContactId=rowData['ContactId'];ClientVacancy['OpenCandidateCV'](lContactId,lRequirementId);},'PreviewButtonTooltip':'Candidate\x20CV','MultiRowSelect':!![],'ColumnFilters':![],'Grouping':![],'HorizontalScrolling':bHorizontalScrolling});},'Columns':[{'field':'ContactId','title':'ID','type':'number','width':0x46,'hidden':!![]},{'field':'Contact_FullName','title':'Candidate\x20Name','type':'string','width':0xaa,'locked':![]},{'field':'DateShortlisted','title':'Shortlisted','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}','width':0x6e,'hidden':!![]},{'field':'Called','title':'Called','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}','width':0x64,'hidden':!![]},{'field':'Interested','title':'Interested','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}','width':0x64,'hidden':!![]},{'field':'CVSend','title':'CV\x20Send','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}','width':0x64},{'field':'TelephoneInterview','title':'Tel.\x20Interview','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}','width':0x78},{'field':'FirstInterview','title':'First\x20Interview','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}','width':0x78},{'field':'SecondInterview','title':'Second\x20Interview','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}','width':0x82},{'field':'ThirdInterview','title':'Third\x20Interview','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}','hidden':!![]},{'field':'FourthInterview','title':'Fourth\x20Interview','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}','hidden':!![]},{'field':'FifthInterview','title':'Fifth\x20Interview','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}','hidden':!![]},{'field':'ReferencesTaken','title':'References\x20Taken','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}','width':0x8c,'hidden':!![]},{'field':'OfferMade','title':'Offer\x20Made','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}','width':0x6e},{'field':'OfferAccepted','title':'Offer\x20Accepted','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}','width':0x82},{'field':'OfferRejected','title':'Offer\x20Rejected','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}','width':0x82},{'field':'Placed','title':'Placed','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}','width':0x64},{'field':'Withdrawn','title':'Withdrawn','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}','width':0x6e,'hidden':!![]},{'field':'Rejected','title':'Rejected','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}','width':0x64}],'MobileVisibleColumns':[{'field':'Contact_FullName'}],'MobileRowTemplate':'<td\x20colspan=\x221\x22><strong>#:\x20Contact_FullName\x20#\x20</strong><br\x20/>#:\x20ShortlistSourceName\x20#<br\x20/>'+'<i>Shortlisted:\x20#:\x20DateShortlisted\x20#</i><br\x20/>'+'Called:\x20#:\x20Called\x20#<br\x20/>'+'Interested:\x20#:\x20Interested\x20#<br\x20/>'+'CV\x20Send:\x20#:\x20CVSend\x20#<br\x20/>'+'Tel.\x20Interview:\x20#:\x20TelephoneInterview\x20#<br\x20/>'+'1st.\x20Interview:\x20#:\x20FirstInterview\x20#<br\x20/>'+'Offer:\x20#:\x20OfferMade\x20#<br\x20/>'+'Accepted:\x20#:\x20OfferAccepted\x20#<br\x20/>'+'Placed:\x20#:\x20Placed\x20#<br\x20/>'+'<hr></td>','OpenCandidateCV':function(lContactId,lRequirementId){var COpenCandidateFormattedCVRequest={'ContactId':lContactId,'RequirementId':lRequirementId},payloadObject={};payloadObject['URL']='Contact/OpenCandidateFormattedCV',payloadObject['OutboundDataPacket']=COpenCandidateFormattedCVRequest,payloadObject['InboundDataFunction']=function(COpenCandidateFormattedCVResponse){TriSysApex['UI']['HideWait']();if(COpenCandidateFormattedCVResponse&&COpenCandidateFormattedCVResponse['Success']){var sFilePath=COpenCandidateFormattedCVResponse['FilePath'],sCandidateName=COpenCandidateFormattedCVResponse['FullName'];sFilePath&&TriSysSDK['Controls']['FileManager']['GetOpenFileURLFromWebService']('TriSys\x20CV\x20Viewer',sFilePath,sCandidateName+'\x20CV');}return!![];},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),alert('ClientVacancy.OpenCandidateCV:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Candidate...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'GetSingleCandidate':function(){var sGrid='trisys-vacancy-ShortlistGrid',lContactId=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid'](sGrid,'ContactId','candidate',!![]);if(lContactId>0x0){var sCandidateName=TriSysSDK['Grid']['GetSelectedSingletonRowFieldValueFromGrid'](sGrid,'Contact_FullName'),candidate={'FullName':sCandidateName,'ContactId':lContactId};return candidate;}},'RequestInterview':function(){var candidate=ClientVacancy['GetSingleCandidate']();candidate&&(candidate['Operation']='Request\x20Interview',ClientVacancy['ShortlistedCandidateAction'](candidate,'Request\x20Interview\x20with\x20'+candidate['FullName'],'request\x20an\x20interview\x20with\x20'+candidate['FullName']));},'MakeOffer':function(){var candidate=ClientVacancy['GetSingleCandidate']();candidate&&(candidate['Operation']='Make\x20Offer',ClientVacancy['ShortlistedCandidateAction'](candidate,'Make\x20Offer\x20to\x20'+candidate['FullName'],'make\x20an\x20offer\x20to\x20'+candidate['FullName']));},'Reject':function(){var candidate=ClientVacancy['GetSingleCandidate']();candidate&&(candidate['Operation']='Reject\x20Candidate',ClientVacancy['ShortlistedCandidateAction'](candidate,'Reject\x20'+candidate['FullName'],'reject\x20'+candidate['FullName']));},'ShortlistedCandidateAction':function(candidate,sTitle,sDescription){var requirement={'RequirementId':TriSysWebJobs['Vacancies']['RequirementId'],'Reference':$('#trisys-vacancy-reference')['html'](),'JobTitle':$('#trisys-vacancy-jobtitle')['html']()};candidate['Description']=sDescription;var sButtonSendText='Send\x20Request',fnSendRequest=function(){ctrlClientShortlistAction['SendRequest'](candidate,requirement);},fnCancelSend=function(){return!![];},parametersObject=new TriSysApex['UI']['ShowMessageParameters']();parametersObject['Title']=sTitle,parametersObject['Height']=0xe1,parametersObject['Resizable']=![],parametersObject['Maximize']=![],parametersObject['Image']='fa-envelope-o',parametersObject['ContentURL']=TriSysApex['Constants']['UserControlFolder']+'ctrlClientShortlistAction.html',parametersObject['ButtonLeftText']=sButtonSendText,parametersObject['ButtonLeftFunction']=fnSendRequest,parametersObject['ButtonLeftVisible']=!![],parametersObject['ButtonLeftWidth']=0x64,parametersObject['ButtonRightWidth']=0x64,parametersObject['ButtonRightVisible']=!![],parametersObject['ButtonRightText']='Cancel',parametersObject['ButtonRightFunction']=fnCancelSend,parametersObject['OnLoadCallback']=function(){ctrlClientShortlistAction['Load'](candidate,requirement);},TriSysApex['UI']['PopupMessage'](parametersObject);}};$(document)['ready'](function(){});