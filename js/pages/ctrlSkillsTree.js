var ctrlSkillsTree={'PopulateSource':function(sEntityName,parentDiv){var categories=TriSysApex['Cache']['SkillCategories'](),skills=TriSysApex['Cache']['Skills'](),sIgnoreType=sEntityName=='Task'?sEntityName:'General',sSetting='Ignore\x20'+sIgnoreType+'\x20Skill\x20Categories',sSystemSetting=TriSysApex['Cache']['SystemSettingManager']['GetValue'](sSetting),trimmedIgnoreCategories=['Gender'];if(sSystemSetting){var sSplitChar=sEntityName=='Task'?';':',',arrayIgnoreCategories=sSystemSetting['split'](sSplitChar);$['each'](arrayIgnoreCategories,function(index,sIgnore){sIgnore=sIgnore['trim'](),trimmedIgnoreCategories['push'](sIgnore);});}var ds=[];for(var c=0x0;c<categories['length'];c++){var category=categories[c],bFound=$['inArray'](category['Category'],trimmedIgnoreCategories)>=0x0;if(category['FieldId']==0x0&&!bFound){var dsItems=[];for(var s=0x0;s<skills['length'];s++){var skill=skills[s];if(skill['SkillCategoryId']==category['SkillCategoryId']){var skillItem={'text':skill['Skill'],'id':category['Category']+'|'+skill['Skill']};dsItems['push'](skillItem);}}if(dsItems['length']>0x0){var dsItem={'text':category['Category'],'expanded':![],'items':dsItems};ds['push'](dsItem);}}}var sSuffix='-'+parentDiv,elemTree=$('#ctrlSkillsTree-Source'+sSuffix);elemTree['kendoTreeView']({'dragAndDrop':![],'dataSource':ds,'checkboxes':{'checkChildren':!![]}}),TriSysApex['ControlPopulationDirty']['SetPopulated'](parentDiv,!![]),TriSysApex['ControlPopulationDirty']['SetDirty'](parentDiv,![]),setTimeout(TriSysProUI['kendoUI_Overrides'],0x3e8),ctrlSkillsTree['LoadObjectFilter'](sSuffix);},'AddSelectedSkills':function(sIDSuffix){var treeview=$('#ctrlSkillsTree-Source'+sIDSuffix)['data']('kendoTreeView'),checkedNodes=[],bRemoveChecked=!![];ctrlSkillsTree['ReadCheckedItems'](treeview,treeview['dataSource']['view'](),checkedNodes,bRemoveChecked);var ds=ctrlSkillsTree['ConvertCheckedNodesToDataSet'](checkedNodes,!![]);ctrlSkillsTree['AddSkillsDataSetToDestination'](sIDSuffix,ds);},'AddSkillsDataSetToDestination':function(sIDSuffix,ds){var treeview=$('#ctrlSkillsTree-Destination'+sIDSuffix)['data']('kendoTreeView');!treeview?$('#ctrlSkillsTree-Destination'+sIDSuffix)['kendoTreeView']({'dragAndDrop':![],'dataSource':ds,'checkboxes':{'checkChildren':!![]}}):ctrlSkillsTree['AddDataSetToExistingTreeView'](treeview,ds);},'AddDataSetToExistingTreeView':function(treeview,ds){var updatedDataSource=[],existingDataSource=treeview['dataSource']['view']();if(existingDataSource){for(var i=0x0;i<existingDataSource['length'];i++){var existingCategoryItem=existingDataSource[i];for(var n=0x0;n<ds['length'];n++){var addCategoryItem=ds[n];if(existingCategoryItem['text']==addCategoryItem['text']){addCategoryItem['Added']=!![];for(var s=0x0;s<addCategoryItem['items']['length'];s++){var addSkill=addCategoryItem['items'][s],bFoundExistingSkill=![];for(var e=0x0;e<existingCategoryItem['items']['length'];e++){var existingSkill=existingCategoryItem['items'][e];if(addSkill['text']==existingSkill['text'])bFoundExistingSkill=!![];}if(!bFoundExistingSkill)existingCategoryItem['items']['push'](addSkill);}}}existingCategoryItem['items']['sort'](function(a,b){return a['text']>b['text'];}),updatedDataSource['push'](existingCategoryItem);}for(var i=0x0;i<ds['length'];i++){var newCategoryItem=ds[i];if(newCategoryItem['Added'])newCategoryItem['Added']=!![];else updatedDataSource['push'](newCategoryItem);}}updatedDataSource['sort'](function(a,b){return a['text']>b['text'];}),treeview['setDataSource'](updatedDataSource);},'RemoveSelectedSkills':function(sIDSuffix){var destinationTreeview=$('#ctrlSkillsTree-Destination'+sIDSuffix)['data']('kendoTreeView'),sourceTreeview=$('#ctrlSkillsTree-Source'+sIDSuffix)['data']('kendoTreeView');if(destinationTreeview){var checkedNodes=[],bRemoveChecked=![];ctrlSkillsTree['ReadCheckedItems'](destinationTreeview,destinationTreeview['dataSource']['view'](),checkedNodes,bRemoveChecked);if(checkedNodes){var ds=ctrlSkillsTree['ConvertCheckedNodesToDataSet'](checkedNodes,![]);ctrlSkillsTree['AddDataSetToExistingTreeView'](sourceTreeview,ds);}ctrlSkillsTree['RemoveCheckedItems'](destinationTreeview,destinationTreeview['dataSource']['view']());}},'ConvertCheckedNodesToDataSet':function(checkedNodes,bExpanded){var categories=[];for(var s=0x0;s<checkedNodes['length'];s++){var checkedNode=checkedNodes[s],sID=checkedNode['id'];if(sID){var sParts=sID['split']('|'),sCategory=sParts[0x0],sSkill=sParts[0x1],bFoundCategory=![];for(var c=0x0;c<categories['length'];c++){var category=categories[c];if(category['Category']==sCategory){bFoundCategory=!![];break;}}if(!bFoundCategory){var category={'Category':sCategory};categories['push'](category);}}}var ds=[];for(var c=0x0;c<categories['length'];c++){var category=categories[c],dsItems=[];for(var s=0x0;s<checkedNodes['length'];s++){var checkedNode=checkedNodes[s],sID=checkedNode['id'];if(sID){var sParts=sID['split']('|'),sCategory=sParts[0x0],sSkill=sParts[0x1];if(category['Category']==sCategory){var skillItem={'text':sSkill,'id':sCategory+'|'+sSkill};dsItems['push'](skillItem);}}}if(dsItems['length']>0x0){var dsItem={'text':category['Category'],'expanded':bExpanded,'items':dsItems};ds['push'](dsItem);}}return ds;},'ReadCheckedItems':function(treeview,nodes,checkedNodes,bRemoveChecked){for(var i=0x0;i<nodes['length'];i++){var node=nodes[i],bRemoveNode=![];if(node['checked']){checkedNodes['push'](node);if(bRemoveChecked)bRemoveNode=!![];}node['hasChildren']&&ctrlSkillsTree['ReadCheckedItems'](treeview,node['children']['view'](),checkedNodes,bRemoveChecked);if(bRemoveNode){var item=treeview['findByUid'](node['uid']);treeview['remove'](item);}}},'ReadDestinationItems':function(parentDiv){var sSuffix='-'+parentDiv,treeview=$('#ctrlSkillsTree-Destination'+sSuffix)['data']('kendoTreeView');if(treeview){var nodes=[];return ctrlSkillsTree['ReadSubNodes'](treeview['dataSource']['view'](),nodes),nodes;}},'ReadSubNodes':function(nodes,readNodes){for(var i=0x0;i<nodes['length'];i++){var node=nodes[i];readNodes['push'](node),node['hasChildren']&&ctrlSkillsTree['ReadSubNodes'](node['children']['view'](),readNodes);}},'RemoveCheckedItems':function(treeview,nodes){for(var i=0x0;i<nodes['length'];i++){var node=nodes[i];if(node['checked']){var item=treeview['findByUid'](node['uid']);treeview['remove'](item);}else node['hasChildren']&&ctrlSkillsTree['RemoveCheckedItems'](treeview,node['children']['view']());}},'AddAssignedSkills':function(parentDiv,listOfSkills){if(!listOfSkills)return;listOfSkills['sort'](function(a,b){return a['Category']>b['Category']&&a['Skill']>b['Skill'];});var checkedNodes=[];for(var i=0x0;i<listOfSkills['length'];i++){var skill=listOfSkills[i],checkedNode={'text':skill['Skill'],'id':skill['Category']+'|'+skill['Skill']};checkedNodes['push'](checkedNode);}var ds=ctrlSkillsTree['ConvertCheckedNodesToDataSet'](checkedNodes,!![]);ds['sort'](function(a,b){return a['text']>b['text'];});var sSuffix='-'+parentDiv;ctrlSkillsTree['AddSkillsDataSetToDestination'](sSuffix,ds);var sourceTreeview=$('#ctrlSkillsTree-Source'+sSuffix)['data']('kendoTreeView');ctrlSkillsTree['RemoveNodes'](sourceTreeview,sourceTreeview['dataSource']['view'](),checkedNodes);},'RemoveNodes':function(treeview,nodes,removeNodes){for(var i=0x0;i<nodes['length'];i++){var node=nodes[i],bRemoveNode=![];for(var r=0x0;r<removeNodes['length'];r++){var removeItem=removeNodes[r];if(node['id']==removeItem['id'])bRemoveNode=!![];}if(bRemoveNode){var item=treeview['findByUid'](node['uid']);treeview['remove'](item);}else node['hasChildren']&&ctrlSkillsTree['RemoveNodes'](treeview,node['children']['view'](),removeNodes);}},'PostLoad':function(parentDiv){var sIDSuffix='-'+parentDiv,controls=['ctrlSkillsTree-Source','ctrlSkillsTree-Destination','ctrlSkillsTree-AddSelectedSkills','ctrlSkillsTree-RemoveSelectedSkills'];for(var i in controls){$('#'+controls[i])['attr']('id',controls[i]+sIDSuffix);}$('#ctrlSkillsTree-AddSelectedSkills'+sIDSuffix)['on']('click',function(){TriSysApex['ControlPopulationDirty']['SetDirty'](parentDiv,!![]),ctrlSkillsTree['AddSelectedSkills'](sIDSuffix);}),$('#ctrlSkillsTree-RemoveSelectedSkills'+sIDSuffix)['on']('click',function(){TriSysApex['ControlPopulationDirty']['SetDirty'](parentDiv,!![]),ctrlSkillsTree['RemoveSelectedSkills'](sIDSuffix);});},'ReadSkills':function(sParentDiv){var skillList=null,nodes=ctrlSkillsTree['ReadDestinationItems'](sParentDiv);if(nodes){if(nodes['length']==0x0)return skillList=[],skillList;var skills=TriSysApex['Cache']['Skills']();for(var i=0x0;i<nodes['length'];i++){var node=nodes[i],sID=node['id'];if(sID){var sParts=sID['split']('|'),sCategory=sParts[0x0],sSkill=sParts[0x1];for(var s=0x0;s<skills['length'];s++){var skill=skills[s];if(skill['Category']['trim']()==sCategory['trim']()&&skill['Skill']==sSkill){if(!skillList)skillList=[];skillList['push'](skill);break;}}}}}return skillList;},'LoadObjectFilter':function(sSuffix){var sID='ctrlSkillsTree-object-search',sFilterID=sID+sSuffix;$('#'+sID)['attr']('id',sFilterID);var txtFilter=$('#'+sFilterID);txtFilter['off']()['keyup'](function(e){e['keyCode']!=0xd&&(sFilter=txtFilter['val'](),ctrlSkillsTree['FilterObjects'](sFilter,sSuffix));});},'FilterObjects':function(sFilter,sSuffix){if(sFilter)sFilter=sFilter['toLowerCase']();ctrlSkillsTree['FilterObjectsBeneathRoot']('ctrlSkillsTree-Source'+sSuffix,sFilter),ctrlSkillsTree['FilterObjectsBeneathRoot']('ctrlSkillsTree-Destination'+sSuffix,sFilter);},'FilterObjectsBeneathRoot':function(sDOMRootId,sFilter){$('#'+sDOMRootId+'\x20li.k-item')['each'](function(){var spanText=$(this)['find']('span.k-in')['text']();spanText&&(spanText=spanText['toLowerCase'](),spanText['indexOf'](sFilter)>=0x0?$(this)['show']():$(this)['hide']());});return;}};