var CandidateTimesheet={'PlacementId':0x0,'HoursPerWeek':37.5,'LoadFromURL':function(sParameters){var lTimesheetId=TriSysApex['Pages']['Controller']['ParseLoadRecordURLParameter'](sParameters,0x0,!![]);if($['isNumeric'](lTimesheetId))TriSysWebJobs['Timesheet']['TimesheetId']=lTimesheetId;CandidateTimesheet['Load'](TriSysWebJobs['Timesheet']['TimesheetId']);},'Load':function(lTimesheetId){CandidateTimesheet['ShowTimesheetSummary'](lTimesheetId);},'ShowTimesheetSummary':function(lTimesheetId){var CTimesheetRequest={'TimesheetId':lTimesheetId};CandidateTimesheet['PlacementId']=TriSysWebJobs['Placement']['PlacementId'];if(lTimesheetId==0x0)CTimesheetRequest['PlacementId']=TriSysWebJobs['Placement']['PlacementId'];var payloadObject={};payloadObject['URL']='Timesheet/Read',payloadObject['OutboundDataPacket']=CTimesheetRequest,payloadObject['InboundDataFunction']=function(CTimesheetResponse){TriSysApex['UI']['HideWait']();if(CTimesheetResponse&&CTimesheetResponse['Success']){var timesheet=CTimesheetResponse['Timesheet'];if(timesheet){var placement=CTimesheetResponse['Placement'],sHyperlink='<a\x20href=\x22javascript:void(0)\x22\x20onclick=\x22TriSysWebJobs.Placement.Open('+placement['PlacementId']+')\x22>'+placement['Reference']+'</a>';$('#trisys-timesheet-reference')['html'](sHyperlink),$('#trisys-timesheet-candidate')['html'](placement['CandidateName']),$('#trisys-timesheet-linemanager')['html'](placement['LineManagerName']),$('#trisys-timesheet-type')['html'](placement['Type']),$('#trisys-timesheet-jobtitle')['html'](placement['JobTitle']);var sLocation=placement['Location'];if(sLocation)sLocation=sLocation['replace'](/\n/g,'<br\x20/>');$('#trisys-timesheet-location')['html'](sLocation),$('#trisys-timesheet-company')['html'](placement['CompanyName']);var sStartDate=moment(placement['StartDate'])['format']('dddd\x20DD\x20MMMM\x20YYYY');$('#trisys-timesheet-startdate')['html'](sStartDate);if(placement['EndDate']){var sEndDate=moment(placement['EndDate'])['format']('dddd\x20DD\x20MMMM\x20YYYY');$('#trisys-timesheet-enddate')['html'](sEndDate);}CandidateTimesheet['HoursPerWeek']=placement['HoursPerWeek'];var periodList=null;if(lTimesheetId>0x0)periodList=placement['PeriodDescriptionsAll'];else periodList=placement['PeriodDescriptionsUnassignedToTimesheets'];if(!periodList){var fnGoToPlacement=function(){return TriSysApex['FormsManager']['OpenForm']('CandidatePlacement',placement['PlacementId']),!![];},sMessage='You\x20are\x20not\x20permitted\x20to\x20add\x20any\x20more\x20timesheets\x20for\x20this\x20placement.';TriSysApex['UI']['ShowMessage'](sMessage,null,fnGoToPlacement);return;}TriSysSDK['CShowForm']['populateComboFromListOfString']('trisys-timesheet-period',periodList),$('#trisys-timesheet-id')['html'](TriSysSDK['Numbers']['Pad'](CTimesheetResponse['TimesheetId'],0x6));if(CTimesheetResponse['TimesheetId']>0x0)TriSysSDK['CShowForm']['SetTextInCombo']('trisys-timesheet-period',timesheet['Period']),TriSysSDK['CShowForm']['ComboEnabled']('trisys-timesheet-period',![]);else{$('#trisys-timesheet-id')['html']('&lt;Allocated\x20when\x20Saved&gt;'),timesheet['InputDate']=new Date();if(periodList){TriSysSDK['CShowForm']['addCallbackOnComboSelect']('trisys-timesheet-period',CandidateTimesheet['PeriodSelectionEvent']);var sFirstPeriod=TriSysSDK['CShowForm']['GetTextFromCombo']('trisys-timesheet-period');CandidateTimesheet['PeriodSelectionEvent'](sFirstPeriod);}else return;}$('#trisys-timesheet-inputdate')['html'](moment(timesheet['InputDate'])['format']('dddd\x20DD\x20MMMM\x20YYYY'));var bAuthorised=timesheet['PaymentAuthorised'];$('#trisys-timesheet-status')['html']((bAuthorised?'':'Not\x20')+'Authorised');bAuthorised&&($('#trisys-timesheet-authorised')['html'](moment(timesheet['AuthorisedDate'])['format']('dddd\x20DD\x20MMMM\x20YYYY')),$('#trisys-timesheet-authorised-form-group')['show'](),$('#trisys-timesheet-authorisedby')['html'](timesheet['AuthorisedBy']),$('#trisys-timesheet-authorisedby-form-group')['show']());var bPaid=timesheet['Payrolled'];bPaid&&($('#trisys-timesheet-paid')['html'](bPaid?'Yes':'No'),$('#trisys-timesheet-paid-form-group')['show']());if(timesheet['AuthorisationRequested']&&moment(timesheet['AuthorisationRequested'])['year']()>=0x76c){var sAuthorisationRequested=moment(timesheet['AuthorisationRequested'])['format']('dddd\x20DD\x20MMMM\x20YYYY');$('#trisys-timesheet-authorisationrequested')['html'](sAuthorisationRequested);}var bClientContact=![];TriSysWebJobs['Timesheet']['PopulateAmountsTable'](CTimesheetResponse['Rates'],bClientContact),TriSysWebJobs['Timesheet']['PopulateSummaryTable'](CTimesheetResponse,bClientContact);var bCanEdit=CTimesheetResponse['CanEdit'];TriSysWebJobs['Timesheet']['PopulateGrid'](CTimesheetResponse,'trisys-timesheet-hours-grid',bCanEdit),TriSysWebJobs['Timesheet']['FormButtonVisibility'](CTimesheetResponse,'CandidateTimesheet-Menu-Save','CandidateTimesheet-Menu-RequestAuthorisation'),TriSysWebJobs['Agency']['CustomerIDMatch']('CoSector')&&($('#CandidateTimesheet-Menu-RequestAuthorisation-Text')['html']('Request\x20Approval'),$('#trisys-timesheet-miscellaneous-hours-reason')['val'](CTimesheetResponse['Custom']['MiscellaneousHoursReason']));}else{TriSysApex['UI']['ShowMessage']('Unable\x20to\x20find\x20timesheet');return;}return!![];}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),alert('CandidateTimesheet.ShowTimesheetSummary:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Timesheet...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'PeriodSelectionEvent':function(sPeriod){var lPlacementId=CandidateTimesheet['PlacementId'];TriSysApex['UI']['ShowWait'](null,sPeriod+'...');var CTimesheetRequest={'TimesheetId':0x0,'PlacementId':lPlacementId,'Period':sPeriod},payloadObject={};payloadObject['URL']='Timesheet/Read',payloadObject['OutboundDataPacket']=CTimesheetRequest,payloadObject['InboundDataFunction']=function(CTimesheetResponse){TriSysApex['UI']['HideWait']();if(CTimesheetResponse){if(CTimesheetResponse['Success'])TriSysWebJobs['Timesheet']['PopulateGrid'](CTimesheetResponse,'trisys-timesheet-hours-grid',!![]);else TriSysApex['UI']['errorAlert'](CTimesheetResponse['ErrorMessage'],TriSysWebJobs['Constants']['ApplicationName']);}return!![];},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['ErrorHandlerRedirector']('CandidateTimesheet.PeriodSelectionEvent:\x20',request,status,error);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'Save':function(){var lPlacementId=CandidateTimesheet['PlacementId'],lTimesheetId=parseInt($('#trisys-timesheet-id')['html']()),sPeriod=TriSysSDK['CShowForm']['GetTextFromCombo']('trisys-timesheet-period'),sGridID='trisys-timesheet-hours-grid',timesheetPeriodRatesHours=TriSysWebJobs['Timesheet']['ReadHoursGridData'](sGridID);if(!timesheetPeriodRatesHours)return;var fnCallback=function(lTimesheetId){$('#trisys-timesheet-id')['html'](TriSysSDK['Numbers']['Pad'](lTimesheetId,0x6)),TriSysSDK['CShowForm']['ComboEnabled']('trisys-timesheet-period',![]),$('#CandidateTimesheet-Menu-RequestAuthorisation')['show']();var sMessage=TriSysSDK['Resources']['Message']('TriSysWeb.Pages.Timesheet.SendHoursMatrixToServer.SavedTimesheetId')+TriSysSDK['Numbers']['Pad'](lTimesheetId,0x6)+TriSysSDK['Resources']['Message']('TriSysWeb.Pages.Timesheet.SendHoursMatrixToServer.AuthorisationReminder');TriSysApex['UI']['ShowMessage'](sMessage,TriSysWebJobs['Constants']['ApplicationName']);},customFields=null;if(TriSysWebJobs['Agency']['CustomerIDMatch']('CoSector')){var sMiscellaneousHoursReason=$('#trisys-timesheet-miscellaneous-hours-reason')['val']();customFields={'MiscellaneousHoursReason':sMiscellaneousHoursReason};var fExpectedHours=CandidateTimesheet['HoursPerWeek'],fStandardHours=TriSysSDK['Grid']['CalculateColumnTotal'](sGridID,'ID','Standard'),fHolidayHours=TriSysSDK['Grid']['CalculateColumnTotal'](sGridID,'ID','Holiday'),fSickHours=TriSysSDK['Grid']['CalculateColumnTotal'](sGridID,'ID','Sick'),fMiscellaneousHours=TriSysSDK['Grid']['CalculateColumnTotal'](sGridID,'ID','Miscellaneous'),fWeeklyHours=fStandardHours+fSickHours+fHolidayHours+fMiscellaneousHours,sMessage=null;fExpectedHours!=fWeeklyHours&&(sMessage='Your\x20standard\x20working\x20hours\x20does\x20not\x20match\x20your\x20agreed\x20contracted\x20hours\x20of\x20'+fExpectedHours+'\x20so\x20please\x20amend\x20and\x20re-submit.'+'<br/>'+'If\x20you\x20have\x20exceeded\x20your\x20agreed\x20contracted\x20hours,\x20please\x20contact\x20the\x20University\x20of\x20London\x20CoSector\x20recruitment\x20team\x20as\x20a\x20matter\x20of\x20urgency.');if(fMiscellaneousHours>0x0&&!sMiscellaneousHoursReason){sMessage='You\x20must\x20supply\x20a\x20reason\x20why\x20you\x20are\x20recording\x20Miscellaneous\x20hours.',TriSysApex['UI']['ShowMessage'](sMessage,TriSysWebJobs['Constants']['ApplicationName']);return;}}TriSysWebJobs['Timesheet']['SendHoursMatrixToServer'](lPlacementId,lTimesheetId,sPeriod,timesheetPeriodRatesHours,customFields,fnCallback);},'RequestAuthorisation':function(){var lTimesheetId=parseInt($('#trisys-timesheet-id')['html']());if(lTimesheetId<=0x0)return;var fnConfirmed=function(lTimesheetId){$('#CandidateTimesheet-Menu-Save')['attr']('disabled',!![]),$('#CandidateTimesheet-Menu-RequestAuthorisation')['attr']('disabled',!![]);var bAlreadyRequested=$('#trisys-timesheet-authorisationrequested')['html']();if(!bAlreadyRequested){var sAuthorisationRequested=moment(new Date())['format']('dddd\x20DD\x20MMMM\x20YYYY');$('#trisys-timesheet-authorisationrequested')['html'](sAuthorisationRequested);}setTimeout(function(){var sMessage=TriSysSDK['Resources']['Message']('TriSysWeb.Pages.Timesheet.ConfirmedAuthorisationRequest.Message');TriSysApex['UI']['ShowMessage'](sMessage,TriSysWebJobs['Constants']['ApplicationName']);},0x64);},fnConfirmAuthorisationRequest=function(){return TriSysWebJobs['Timesheet']['ConfirmedAuthorisationRequest'](lTimesheetId,fnConfirmed),!![];},sCaption=TriSysSDK['Resources']['Message']('TriSysWeb.Pages.Timesheet.RequestAuthorisation.PromptCaption'),sMessage=TriSysSDK['Resources']['Message']('TriSysWeb.Pages.Timesheet.RequestAuthorisation.PromptMessage');TriSysWebJobs['Agency']['CustomerIDMatch']('CoSector')&&(sCaption=sCaption['replace'](/Authorisation/g,'Approval'),sMessage=sMessage['replace'](/authorisation/g,'approval'),sMessage=sMessage['replace'](/authorised/g,'approved')),TriSysApex['UI']['questionYesNo'](sMessage,sCaption,'Yes',fnConfirmAuthorisationRequest,'No',null);}};$(document)['ready'](function(){});