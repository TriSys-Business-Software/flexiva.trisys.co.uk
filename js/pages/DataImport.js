var DataImport={'UploadFile':function(){TriSysSDK['Controls']['FileManager']['FindFileUpload']('Upload\x20Excel\x20Import\x20File',DataImport['UploadedFile']);},'UploadedFile':function(sFilePath,uploadFiles){var sFileType=TriSysApex['Pages']['FileManagerForm']['DetermineFileTypeForImageFromFilePath'](sFilePath);if(sFileType!='excel'){var fnWrongFileType=function(){TriSysApex['UI']['ShowMessage']('You\x20must\x20upload\x20only\x20Microsoft\x20Excel\x20(.xlsx,\x20.xls,\x20.csv)\x20files.');};setTimeout(fnWrongFileType,0x64);return;}$('#data-import-step-3-p1')['show']();var sName=TriSysSDK['Controls']['FileManager']['GetFileNameFromPath'](sFilePath);$('#data-import-step-3-filepath')['html'](sName),$('#data-import-step-3')['show'](),$('#data-import-step-3-p3')['hide'](),$('#data-import-step-3-p4')['hide'](),$('#data-import-step-3-progress-div')['hide'](),$('#data-import-step-3-cancel-button')['hide'](),$('#data-import-step-4')['hide'](),DataImport['ValidateUploadedFile'](sFilePath);},'ValidateUploadedFile':function(sFilePath){var fnValidated=function(lRecordCount,sEntityName){$('#data-import-step-3-p2')['hide'](),$('#data-import-step-3-p3')['show'](),$('#data-import-step-3-validated-record-count')['html'](TriSysSDK['Numbers']['ThousandsSeparator'](lRecordCount));var fnProceed=function(options){return $('#data-import-step-3-p4')['show'](),$('#data-import-step-3-progress-div')['show'](),$('#data-import-step-3-cancel-button')['show'](),TriSysSDK['Grid']['Clear']('data-import-record-grid'),DataImport['UploadData'](sFilePath,sEntityName,options),DataImport['_Cancelled']=![],DataImport['ProgressMonitoring'](sFilePath),!![];},fnPrompt=function(){DataImport['PromptPriorToImport'](fnProceed,lRecordCount,sEntityName);};TriSysApex['WhiteLabelling']['LoadJavascriptFile']('js/pages/ctrlDataImportPrompt.js',null,fnPrompt);};DataImport['ProcessFileViaWebAPI'](sFilePath,!![],fnValidated);},'PromptPriorToImport':function(fnCommence,lRecordCount,sEntityName){var parametersObject=new TriSysApex['UI']['ShowMessageParameters']();parametersObject['Title']='Import\x20'+TriSysSDK['Numbers']['ThousandsSeparator'](lRecordCount)+'\x20'+sEntityName+'\x20Record'+(lRecordCount>0x1?'s':''),parametersObject['Image']='gi-server',parametersObject['Maximize']=![],parametersObject['CloseTopRightButton']=!![],parametersObject['ContentURL']=TriSysApex['CustomFormsAndComponents']['UserControlPath']('ctrlDataImportPrompt.html'),parametersObject['Width']=0x258,parametersObject['OnLoadCallback']=function(){ctrlDataImportPrompt['Load'](lRecordCount,sEntityName);},parametersObject['ButtonLeftVisible']=!![],parametersObject['ButtonLeftText']='Cancel',parametersObject['ButtonLeftFunction']=function(){return!![];},parametersObject['ButtonCentreVisible']=!![],parametersObject['ButtonCentreText']='Yes,\x20Commence\x20Import',parametersObject['ButtonCentreFunction']=function(){var options=ctrlDataImportPrompt['ReadOptions']();return setTimeout(function(){fnCommence(options);},0xa),!![];},TriSysApex['UI']['PopupMessage'](parametersObject);},'UploadData':function(sFilePath,sEntityName,options){var fnCompleted=function(lRecordCount){$('#data-import-step-3-p4')['hide'](),$('#data-import-step-3-cancel-button')['hide'](),$('#data-import-step-4')['show'](),TriSysApex['LoginCredentials']['CacheStandingData'](null,function(){});var fnProceed=function(){return setTimeout(function(){DataImport['ShowGrid'](sFilePath,sEntityName);},0x64),!![];},sMessage='We\x20have\x20successfully\x20imported\x20'+TriSysSDK['Numbers']['ThousandsSeparator'](lRecordCount)+'\x20'+sEntityName+'\x20record'+(lRecordCount!=0x1?'s':'')+'\x20into\x20your\x20database.'+'<br/>'+'View\x20imported\x20records?';TriSysApex['UI']['questionYesNo'](sMessage,sEntityName+'\x20Import\x20Successful','Yes',fnProceed,'No');};DataImport['ProcessFileViaWebAPI'](sFilePath,![],fnCompleted,options);},'ProcessFileViaWebAPI':function(sFilePath,bVerifyOnly,fnCallback,options){var sProgressTitle=(bVerifyOnly?'Verifying':'Importing')+'\x20File',CImportFileRequest={'FilePath':sFilePath,'VerifyOnly':bVerifyOnly,'Options':options},payloadObject={};payloadObject['URL']='DataImport/ImportFile',payloadObject['OutboundDataPacket']=CImportFileRequest,payloadObject['TimeoutMilliseconds']=0x3c*0x3c*0x3e8,payloadObject['InboundDataFunction']=function(CImportDataFileResponse){if(bVerifyOnly)TriSysApex['UI']['HideWait']();if(CImportDataFileResponse){if(CImportDataFileResponse['Success'])fnCallback(CImportDataFileResponse['RecordCount'],CImportDataFileResponse['EntityName']);else TriSysApex['UI']['ShowMessage'](CImportDataFileResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){if(bVerifyOnly)TriSysApex['UI']['HideWait']();TriSysApex['UI']['errorAlert']('DataImport.ProcessFileViaWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);};if(bVerifyOnly)TriSysApex['UI']['ShowWait'](null,sProgressTitle);TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'ProgressMonitoring':function(sFilePath){var CImportFileMonitoringRequest={'FilePath':sFilePath};if(DataImport['_Cancelled'])CImportFileMonitoringRequest['Cancel']=!![];var payloadObject={};payloadObject['URL']='DataImport/ImportFileMonitoring',payloadObject['OutboundDataPacket']=CImportFileMonitoringRequest,payloadObject['InboundDataFunction']=function(CImportFileMonitoringResponse){CImportFileMonitoringResponse&&(CImportFileMonitoringResponse['Success']&&(DataImport['ProgressMonitoringDisplay'](CImportFileMonitoringResponse['PercentageComplete']),CImportFileMonitoringResponse['PercentageComplete']<0x64&&!CImportFileMonitoringResponse['Cancelled']&&setTimeout(function(){DataImport['ProgressMonitoring'](sFilePath);},0x3e8)));},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('DataImport.ProgressMonitoring:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'_Cancelled':![],'ProgressMonitoringDisplay':function(iPercentageComplete){var bar=$('#data-import-step-3-progress-bar'),sPercent=''+iPercentageComplete+'%';bar['html'](sPercent),bar['width'](sPercent),bar['attr']('aria-valuenow',iPercentageComplete);},'CancelImport':function(){DataImport['_Cancelled']=!![];},'ShowGrid':function(sFilePath,sEntityName){$('html,\x20body')['animate']({'scrollTop':$('#data-import-step-4')['offset']()['top']},0x0);var fnPopulationByFunction={'API':'DataImport/ImportedRecordList','Parameters':function(request){request['FilePath']=sFilePath,request['EntityName']=sEntityName;},'DataTableFunction':function(response){return response['List'];}},sGrid='data-import-record-grid';switch(sEntityName){case'Contact':TriSysWeb['Pages']['Contacts']['PopulateGrid'](sGrid,'grd'+sEntityName,sGrid+'s',fnPopulationByFunction);break;case'Company':TriSysWeb['Pages']['Companies']['PopulateGrid'](sGrid,'grd'+sEntityName,'Companies',fnPopulationByFunction);break;case'Requirement':TriSysWeb['Pages']['Requirements']['PopulateGrid'](sGrid,'grd'+sEntityName,sGrid+'s',fnPopulationByFunction);break;case'Placement':TriSysWeb['Pages']['Placements']['PopulateGrid'](sGrid,'grd'+sEntityName,sGrid+'s',fnPopulationByFunction);break;}}};