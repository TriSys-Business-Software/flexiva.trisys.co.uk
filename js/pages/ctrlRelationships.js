var ctrlRelationships={'Load':function(sParentID,sEntityName,fnCallback){var sGridId=ctrlRelationships['GridId'](sEntityName);$('#EntityNameForm-RelationshipsGrid')['attr']('id',sGridId);var sTitleId=sEntityName+'Form-RelationshipsTitle';$('#EntityNameForm-RelationshipsTitle')['attr']('id',sTitleId),$('#'+sTitleId)['html'](sEntityName+'\x20Relationships');var sAddButtonId=sEntityName+'Form-Relationships-add-button';$('#EntityNameForm-Relationships-add-button')['attr']('id',sAddButtonId);var sUpdateButtonId=sEntityName+'Form-Relationships-update-button';$('#EntityNameForm-Relationships-update-button')['attr']('id',sUpdateButtonId);var sDeleteButtonId=sEntityName+'Form-Relationships-delete-button';$('#EntityNameForm-Relationships-delete-button')['attr']('id',sDeleteButtonId);var sGridMenuId=sEntityName+'Form-RelationshipsGridMenu';$('#EntityNameForm-RelationshipsGridMenu')['attr']('id',sGridMenuId),TriSysSDK['FormMenus']['DrawGridMenu'](sGridMenuId,sGridId);if(fnCallback)fnCallback();},'LoadRelationships':function(sEntityName,lRecordId){var sAddButtonId=sEntityName+'Form-Relationships-add-button';$('#'+sAddButtonId)['off']()['on']('click',function(){ctrlRelationships['Add'](sEntityName,lRecordId);});var sUpdateButtonId=sEntityName+'Form-Relationships-update-button';$('#'+sUpdateButtonId)['off']()['on']('click',function(){ctrlRelationships['Update'](sEntityName,lRecordId);});var sDeleteButtonId=sEntityName+'Form-Relationships-delete-button';$('#'+sDeleteButtonId)['off']()['on']('click',function(){ctrlRelationships['Delete'](sEntityName,lRecordId);}),setTimeout(TriSysProUI['kendoUI_Overrides'],0xa),ctrlRelationships['ReadFromWebAPI'](sEntityName,lRecordId);},'ReadFromWebAPI':function(sEntityName,lRecordId){var fnPopulationByFunction={'API':'Relationships/List','Parameters':function(request){request['EntityName']=sEntityName,request['RecordId']=lRecordId;},'DataTableFunction':function(response){return response['List'];}},sGridId=ctrlRelationships['GridId'](sEntityName);ctrlRelationships['PopulateGrid'](sGridId,'grdRelationships',sEntityName,lRecordId,fnPopulationByFunction);},'PopulateGrid':function(sGridId,sGridName,sEntityName,lRecordId,fnPopulationByFunction){var bMultiRowSelect=!TriSysApex['Device']['isPhone'](),bColumnFilters=![];TriSysSDK['Grid']['VirtualMode']({'Div':sGridId,'ID':sGridName,'Title':sEntityName+'\x20Relationships','RecordsPerPage':TriSysApex['UserOptions']['RecordsPerPage'](),'PopulationByFunction':fnPopulationByFunction,'Columns':ctrlRelationships['GridColumns'](sEntityName),'KeyColumnName':'FromEntity','DrillDownFunction':function(rowData){ctrlRelationships['DrillDownFunction'](sEntityName,lRecordId,rowData);},'MultiRowSelect':bMultiRowSelect,'ColumnFilters':bColumnFilters,'Grouping':TriSysApex['UserOptions']['GridGrouping'](),'HyperlinkedEntities':{'EntityName':sEntityName,'Columns':[{'field':'FromEntity','linkType':'Function','fnCallback':function(row){ctrlRelationships['HyperlinkDrillDown'](row,'From',sGridId);},'keyColumnName':'From'+sEntityName+'Id'},{'field':'ToEntity','linkType':'Function','fnCallback':function(row){ctrlRelationships['HyperlinkDrillDown'](row,'To',sGridId);},'keyColumnName':'To'+sEntityName+'Id'}]}});},'GridColumns':function(sEntityName){var columns=[{'field':'FromEntity','title':'From','type':'string'},{'field':'RelationshipType','title':'Relationship\x20Type','type':'string','hidden':!![]},{'field':'ToEntity','title':'To','type':'string'}];switch(sEntityName){case'Contact':columns['splice'](0x1,0x0,{'field':'Relationship','title':'Relationship','type':'string'}),columns['push']({'field':'FromContactId','title':'FromContactId','type':'number','hidden':!![]}),columns['push']({'field':'ToContactId','title':'ToContactId','type':'number','hidden':!![]});break;case'Company':columns[0x1]['hidden']=![],columns['push']({'field':'FromCompanyId','title':'FromCompanyId','type':'number','hidden':!![]}),columns['push']({'field':'ToCompanyId','title':'ToCompanyId','type':'number','hidden':!![]});break;}return columns;},'DrillDownFunction':function(sEntityName,lRecordId,rowData){switch(sEntityName){case'Contact':var lContactId=rowData['FromContactId']==lRecordId?rowData['ToContactId']:rowData['FromContactId'];TriSysApex['FormsManager']['OpenForm'](sEntityName,lContactId);break;case'Company':var lCompanyId=rowData['FromCompanyId']==lRecordId?rowData['ToCompanyId']:rowData['FromCompanyId'];TriSysApex['FormsManager']['OpenForm'](sEntityName,lCompanyId);break;}},'HyperlinkDrillDown':function(rowData,sDirection,sGridDiv){var gridDrillDown=TriSysSDK['Grid']['HyperlinkedColumns']['ReadGridDrillDownCallbackFunctions'](sGridDiv);if(gridDrillDown){var sEntityName=gridDrillDown['gridLayout']['HyperlinkedEntities']['EntityName'],lEntityId=rowData[sDirection+sEntityName+'Id'];TriSysApex['FormsManager']['OpenForm'](sEntityName,lEntityId);}},'GridId':function(sEntityName){return sEntityName+'Form-RelationshipsGrid';},'Add':function(sEntityName,lRecordId){var relationship=new ctrlRelationships['CRelationship'](sEntityName,lRecordId);ctrlRelationships['EditRelationship'](relationship);},'Update':function(sEntityName,lRecordId){var relationship=ctrlRelationships['GetSelectedSingletonLinkedRecordFromGrid'](sEntityName);if(relationship['LinkedRecordId']<=0x0)return;var bReversed=lRecordId!=relationship['RecordId'];ctrlRelationships['EditRelationship'](relationship,bReversed);},'Delete':function(sEntityName,lRecordId){var relationship=ctrlRelationships['GetSelectedSingletonLinkedRecordFromGrid'](sEntityName);if(relationship['LinkedRecordId']<=0x0)return;ctrlRelationships['DeleteRelationship'](relationship,lRecordId);},'GetSelectedSingletonLinkedRecordFromGrid':function(sEntityName){var sGridId=ctrlRelationships['GridId'](sEntityName),sWhat=sEntityName=='Contact'?'contact':'company',sFieldFromId=sEntityName=='Contact'?'FromContactId':'FromCompanyId',sFieldToId=sEntityName=='Contact'?'ToContactId':'ToCompanyId',lFromId=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid'](sGridId,sFieldFromId,sWhat);if(!lFromId)return;var lToId=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid'](sGridId,sFieldToId,sWhat);if(!lToId)return;var sFieldRelationship=sEntityName=='Contact'?'Relationship':'RelationshipType',sRelationship=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid'](sGridId,sFieldRelationship,sWhat),sFromEntity=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid'](sGridId,'FromEntity',sWhat),sToEntity=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid'](sGridId,'ToEntity',sWhat),relationship=new ctrlRelationships['CRelationship'](sEntityName,lFromId,sFromEntity,sRelationship,lToId,sToEntity);return relationship;},'CRelationship':function(sEntityName,lRecordId,sRecordName,sRelationship,lLinkedRecordId,sLinkedRecordName){this['EntityName']=sEntityName,this['RecordId']=lRecordId;if(!sRecordName){if(sEntityName=='Contact')sRecordName=$('#Contact_Forenames')['val']()+'\x20'+$('#Contact_Surname')['val']();else sRecordName=$('#Company_Name')['val']();}this['RecordName']=sRecordName,this['Relationship']=sRelationship?sRelationship:'is\x20a\x20colleague\x20of',this['LinkedRecordId']=lLinkedRecordId,this['LinkedRecordName']=sLinkedRecordName;var lRefreshRecordIdOnUpdate=sEntityName=='Contact'?TriSysApex['Pages']['ContactForm']['ContactId']:TriSysApex['Pages']['CompanyForm']['CompanyId'];this['AfterUpdateCallback']=function(relationship){ctrlRelationships['LoadRelationships'](sEntityName,lRefreshRecordIdOnUpdate);};},'EditRelationship':function(relationship,bReversed){var parametersObject=new TriSysApex['UI']['ShowMessageParameters']();parametersObject['Title']=(relationship['LinkedRecordId']>0x0?'Edit':'New')+'\x20'+relationship['EntityName']+'\x20Relationship',parametersObject['Image']='gi-random',parametersObject['ContentURL']=TriSysApex['Constants']['UserControlFolder']+'ctrlEditRelationship.html',parametersObject['ButtonRightText']='Cancel',parametersObject['ButtonRightVisible']=!![],parametersObject['ButtonCentreText']='Reverse\x20Relationship',parametersObject['ButtonCentreVisible']=!![],parametersObject['ButtonCentreFunction']=function(){ctrlEditRelationship['ReverseRelationship']();},parametersObject['ButtonLeftText']='Save',parametersObject['ButtonLeftVisible']=!![],parametersObject['ButtonLeftFunction']=function(){ctrlEditRelationship['SaveButtonClick'](relationship);},parametersObject['OnLoadCallback']=function(){ctrlEditRelationship['Load'](relationship);},TriSysApex['UI']['PopupMessage'](parametersObject);},'DeleteRelationship':function(relationship,lRecordId){var sMessage='Do\x20you\x20wish\x20to\x20delete\x20the\x20relationship\x20between\x20'+relationship['RecordName']+'\x20and\x20'+relationship['LinkedRecordName']+'?',fnDelete=function(){return ctrlRelationships['DeleteViaWebAPI'](relationship,lRecordId),!![];};TriSysApex['UI']['questionYesNo'](sMessage,'Delete\x20'+relationship['EntityName']+'\x20Relationship','Yes',fnDelete,'No');},'DeleteViaWebAPI':function(relationship,lRecordId){var CRelationshipDeleteRequest={'EntityName':relationship['EntityName'],'FromRecordId':relationship['RecordId'],'ToRecordId':relationship['LinkedRecordId']},payloadObject={};payloadObject['OutboundDataPacket']=CRelationshipDeleteRequest,payloadObject['URL']='Relationships/Delete',payloadObject['InboundDataFunction']=function(CRelationshipDeleteResponse){TriSysApex['UI']['HideWait']();if(CRelationshipDeleteResponse){if(CRelationshipDeleteResponse['Success'])ctrlRelationships['LoadRelationships'](relationship['EntityName'],lRecordId);else TriSysApex['UI']['ShowMessage'](CRelationshipDeleteResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlRelationships.DeleteViaWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Deleting\x20Relationship...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);}};