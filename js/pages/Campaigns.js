var Campaigns={'Tabs':['campaigns','campaignrecord','search','recipients','sent','delivered','openread','clicks','undelivered'],'Load':function(){var fnChangeUsers=function(){Campaigns['LoadCampaigns']();},userCredentials=TriSysApex['LoginCredentials']['UserCredentials'](),sUserName=userCredentials['LoggedInUser']['ForenameAndSurname'],sUserComboId='campaigns-Users';TriSysSDK['CShowForm']['MultiUserCombo'](sUserComboId,fnChangeUsers),TriSysSDK['CShowForm']['SetSkillsInList'](sUserComboId,sUserName),TriSysSDK['EntityFormTabs']['AddClickEventHandlers']('campaigns-tab-nav-horizontal'),TriSysSDK['EntityFormTabs']['TabClickEvent']('campaigns-panel-','campaigns',null,Campaigns['TabClickEvent']),TriSysSDK['EntityFormTabs']['AddHorizontalScrollBar']('campaigns-tab-buttons'),Campaigns['Tabs']['forEach'](function(sTab){$('#campaigns-tab-'+sTab)['off']()['on']('click',function(){TriSysSDK['EntityFormTabs']['TabClickEvent']('campaigns-panel-',sTab,null,Campaigns['TabClickEvent']);});}),$('#campaigns-add-campaign-button')['off']()['on']('click',function(){Campaigns['Add']();}),$('#campaigns-clone-campaign-button')['off']()['on']('click',function(){Campaigns['Clone']();}),$('#campaigns-edit-campaign-button')['off']()['on']('click',function(){Campaigns['Edit']();}),$('#campaigns-delete-campaign-button')['off']()['on']('click',function(){Campaigns['Delete']();});var sGrid='campaigns-campaigns-grid';TriSysSDK['FormMenus']['DrawGridMenu']('campaigns-GridMenu',sGrid),$('#campaign-save-button')['off']()['on']('click',function(){Campaigns['Save']();}),Campaigns['PopulateSenderCombo'](),Campaigns['PopulateRecipientEMailFieldCombo']();var sCampaign='Campaign',sCampaigneFolder=sCampaign+'/';TriSysActions['MailMerge']['PopulateTemplates'](sCampaign,TriSysActions['MailMerge']['MasterTemplateFolder']+sCampaigneFolder,'campaign-Template',sCampaign,'campaign-EditTemplate'),TriSysActions['MailMerge']['PopulateAttachments']('campaign-Attachments','campaign-ManageAttachmentLibrary'),TriSysActions['Forms']['Attributes']['Load']('campaign-Attributes');var defaults={'TaskType':'E-Mail'};TriSysActions['NoteHistory']['Load']('campaign-NoteHistory',defaults);var dtFollowUp=TriSysActions['FollowUp']['FollowUpDateTomorrow']();defaults={'CreateFollowUp':!![],'StartDateTime':dtFollowUp},TriSysActions['FollowUp']['Load']('campaign-FollowUp',defaults),TriSysSDK['FormMenus']['DrawGridMenu']('campaigns-search-GridMenu','campaigns-search-grid'),TriSysActions['Menus']['Draw']('campaigns-search-ActionsMenu','Contact','Campaigns.ActionSearchInvocation'),$('#campaigns-open-search-result-button')['off']()['on']('click',function(){Campaigns['OpenSearchContact']();}),$('#campaigns-add-search-recipient-selected')['off']()['on']('click',function(){Campaigns['CopyFromSearchResultsToRecipients'](![]);}),$('#campaigns-add-search-recipient-all')['off']()['on']('click',function(){Campaigns['CopyFromSearchResultsToRecipients'](!![]);}),TriSysSDK['FormMenus']['DrawGridMenu']('campaigns-recipients-GridMenu','campaigns-recipients-grid'),TriSysActions['Menus']['Draw']('campaigns-recipients-ActionsMenu','Contact','Campaigns.ActionRecipientInvocation'),$('#campaigns-open-recipients-button')['off']()['on']('click',function(){Campaigns['OpenRecipient']();}),$('#campaigns-add-recipients-button')['off']()['on']('click',function(){Campaigns['AddRecipient']();}),$('#campaigns-remove-recipients-menu-selected')['off']()['on']('click',function(){Campaigns['RemoveRecipient'](![]);}),$('#campaigns-remove-recipients-menu-all')['off']()['on']('click',function(){Campaigns['RemoveRecipient'](!![]);}),$('#campaigns-sendto-recipients-menu-selected')['off']()['on']('click',function(){Campaigns['SendToRecipient'](![]);}),$('#campaigns-sendto-recipients-menu-all')['off']()['on']('click',function(){Campaigns['SendToRecipient'](!![]);}),TriSysSDK['FormMenus']['DrawGridMenu']('campaigns-sent-GridMenu','campaigns-sent-grid'),TriSysActions['Menus']['Draw']('campaigns-sent-ActionsMenu','Contact','Campaigns.ActionSentInvocation'),$('#campaigns-open-sent-button')['off']()['on']('click',function(){Campaigns['OpenSent']();}),TriSysSDK['FormMenus']['DrawGridMenu']('campaigns-delivered-GridMenu','campaigns-delivered-grid'),TriSysActions['Menus']['Draw']('campaigns-delivered-ActionsMenu','Contact','Campaigns.ActionDeliveredInvocation'),$('#campaigns-open-delivered-button')['off']()['on']('click',function(){Campaigns['OpenDelivered']();}),TriSysSDK['FormMenus']['DrawGridMenu']('campaigns-openread-GridMenu','campaigns-openread-grid'),TriSysActions['Menus']['Draw']('campaigns-openread-ActionsMenu','Contact','Campaigns.ActionOpenedInvocation'),$('#campaigns-open-openread-button')['off']()['on']('click',function(){Campaigns['OpenRead']();}),TriSysSDK['FormMenus']['DrawGridMenu']('campaigns-clicks-GridMenu','campaigns-clicks-grid'),TriSysActions['Menus']['Draw']('campaigns-clicks-ActionsMenu','Contact','Campaigns.ActionClickedInvocation'),$('#campaigns-open-clicks-button')['off']()['on']('click',function(){Campaigns['OpenClicked']();}),TriSysSDK['FormMenus']['DrawGridMenu']('campaigns-undelivered-GridMenu','campaigns-undelivered-grid'),TriSysActions['Menus']['Draw']('campaigns-undelivered-ActionsMenu','Contact','Campaigns.ActionUndeliveredInvocation'),$('#campaigns-open-undelivered-button')['off']()['on']('click',function(){Campaigns['OpenUndelivered']();});},'TabClickEvent':function(sTabID){var sTabPrefix='campaigns-panel-',sTab=sTabID['replace'](sTabPrefix,'');switch(sTab){case'campaigns':Campaigns['Tabs']['forEach'](function(sTab){if(sTab!='campaigns')Campaigns['ReadOnlyTabButton'](sTab,!![]);}),$('#campaigns-tab-campaignrecord-name')['html'](''),$('#campaigns-campaign-name')['html'](''),Campaigns['LoadCampaigns']();break;case'search':if(TriSysApex['Forms']['EntityForm']['isGridPopulated']('Campaigns',sTab))return;Campaigns['LoadContactSearch']();break;case'recipients':if(TriSysApex['Forms']['EntityForm']['isGridPopulated']('Campaigns',sTab))return;Campaigns['LoadRecipients']();break;case'sent':if(TriSysApex['Forms']['EntityForm']['isGridPopulated']('Campaigns',sTab))return;Campaigns['LoadSent']();break;case'delivered':if(TriSysApex['Forms']['EntityForm']['isGridPopulated']('Campaigns',sTab))return;Campaigns['LoadDelivered']();break;case'openread':if(TriSysApex['Forms']['EntityForm']['isGridPopulated']('Campaigns',sTab))return;Campaigns['LoadOpened']();break;case'clicks':if(TriSysApex['Forms']['EntityForm']['isGridPopulated']('Campaigns',sTab))return;Campaigns['LoadClicked']();break;case'undelivered':if(TriSysApex['Forms']['EntityForm']['isGridPopulated']('Campaigns',sTab))return;Campaigns['LoadUndelivered']();break;}},'ReadOnlyTabButton':function(sId,bReadOnly){var sTabPrefix='campaigns-form-tab-';TriSysSDK['Controls']['Button']['ReadOnly'](sTabPrefix+sId,bReadOnly),bReadOnly&&(Campaigns['SetTabStatCount'](sId,0x0,!![]),Campaigns['SetTabStatPercentage'](sId,0x0,!![]));},'SetTabStatCount':function(sId,fValue,bHideZero){var sValue=TriSysSDK['Numbers']['ThousandsSeparator'](fValue);if(bHideZero&&fValue==0x0)sValue='';$('#'+'campaigns-tab-'+sId+'-count')['html'](sValue);},'SetTabStatPercentage':function(sId,fValue,bHideZero){var sValue=TriSysSDK['Numbers']['Format'](fValue,0x2)+'%';if(bHideZero&&fValue==0x0)sValue='';$('#'+'campaigns-tab-'+sId+'-percentage')['html'](sValue);},'LoadCampaigns':function(){var sGrid='campaigns-campaigns-grid',userList=TriSysSDK['CShowForm']['GetSelectedSkillsFromList']('campaigns-Users','\x27');if(!userList){TriSysSDK['Grid']['Clear'](sGrid),TriSysApex['UI']['ShowMessage']('Please\x20choose\x20one\x20or\x20more\x20users.');return;}var sUsers=userList,fnPopulationByFunction={'API':'Marketing/ListCampaigns','Parameters':function(request){request['UserNames']=sUsers;},'DataTableFunction':function(response){return Campaigns['SetTabStatCount']('campaigns',response['TotalRecordCount']),response['List'];}};Campaigns['LoadCampaignGrid'](sGrid,fnPopulationByFunction);},'LoadCampaignGrid':function(sGrid,fnPopulationByFunction){TriSysSDK['Grid']['VirtualMode']({'Div':sGrid,'ID':sGrid,'Title':'Campaigns','RecordsPerPage':TriSysApex['UserOptions']['RecordsPerPage'](),'PopulationByFunction':fnPopulationByFunction,'Columns':[{'field':'MarketingCampaignId','title':'Id','type':'number','width':0x46,'hidden':!![]},{'field':'Name','title':'Campaign\x20Name','type':'string'},{'field':'Description','title':'Description','type':'string'},{'field':'Created','title':'Created','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}'},{'field':'Updated','title':'Last\x20Updated','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}'},{'field':'UserName','title':'User','type':'string'}],'KeyColumnName':'MarketingCampaignId','DrillDownFunction':function(rowData){var lMarketingCampaignId=rowData['MarketingCampaignId'],sName=rowData['Name'];Campaigns['LoadCampaignRecord'](lMarketingCampaignId,sName);},'MultiRowSelect':!![],'Grouping':![],'ColumnFilters':!![],'OpenButtonCaption':'Open','HyperlinkedColumns':['Name']});},'Add':function(){Campaigns['LoadCampaignRecord'](0x0,null);},'Clone':function(){var lMarketingCampaignId=Campaigns['GetSelectedSingletonMarketingCampaignIdFromGrid']();if(lMarketingCampaignId<=0x0)return;var fnClonedCampaign=function(sNewName){return Campaigns['CloneMarketingCampaign'](lMarketingCampaignId,sNewName),!![];},sMessage='Cloned\x20Marketing\x20Campaign',options={'Label':'Name'};TriSysApex['ModalDialogue']['New']['Popup'](sMessage,'fa-envelope-o',fnClonedCampaign,options);},'Edit':function(){var lMarketingCampaignId=Campaigns['GetSelectedSingletonMarketingCampaignIdFromGrid']();if(lMarketingCampaignId<=0x0)return;Campaigns['LoadCampaignRecord'](lMarketingCampaignId,Campaigns['GetSelectedNameFromGrid']());},'Delete':function(){var lMarketingCampaignId=Campaigns['GetSelectedSingletonMarketingCampaignIdFromGrid']();if(lMarketingCampaignId<=0x0)return;var sName=Campaigns['GetSelectedNameFromGrid'](),sMessage='Are\x20you\x20sure\x20that\x20you\x20wish\x20to\x20delete\x20the\x20marketing\x20campaign:\x20'+sName+'?';TriSysApex['UI']['questionYesNo'](sMessage,'Delete\x20Marketing\x20Campaign','Yes',function(){return Campaigns['DeleteMarketingCampaign'](lMarketingCampaignId),!![];},'No');},'GetSelectedSingletonMarketingCampaignIdFromGrid':function(){var sGrid='campaigns-campaigns-grid',lMarketingCampaignId=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid'](sGrid,'MarketingCampaignId','marketing\x20campaign');return lMarketingCampaignId;},'GetSelectedNameFromGrid':function(){var sGrid='campaigns-campaigns-grid',sName=TriSysSDK['Grid']['GetSelectedSingletonRowFieldValueFromGrid'](sGrid,'Name');return sName;},'LoadCampaignRecord':function(lMarketingCampaignId,sName){if(lMarketingCampaignId>0x0)Campaigns['Tabs']['forEach'](function(sTab){Campaigns['ReadOnlyTabButton'](sTab,![]);});else Campaigns['ReadOnlyTabButton']('campaignrecord',![]);TriSysSDK['Controls']['Button']['Click']('campaigns-form-tab-campaignrecord'),Campaigns['Data']['MarketingCampaignId']=lMarketingCampaignId;if(lMarketingCampaignId<=0x0){var campaignDetails={'Name':null,'Description':null,'UserName':TriSysApex['LoginCredentials']['UserCredentials']()['LoggedInUser']['ForenameAndSurname'],'Created':new Date(),'Updated':null,'Settings':{'Template':null,'Attachments':null,'Subject':null,'NoteHistory':{'CreateNoteHistory':![]},'FollowUp':{'CreateFollowUp':![]}}};Campaigns['DisplayMarketingCampaign'](campaignDetails);}else Campaigns['DisplayMarketingCampaign']({'Name':sName}),Campaigns['ReadCampaignFromWebAPI'](lMarketingCampaignId);Campaigns['Tabs']['forEach'](function(sTab){if(sTab!='campaigns'&&sTab!='campaignrecord')TriSysApex['Forms']['EntityForm']['unPopulateFormGrids']('Campaigns',sTab);});},'ReadCampaignFromWebAPI':function(lMarketingCampaignId){var payloadObject={};payloadObject['URL']='Marketing/ReadCampaign',payloadObject['OutboundDataPacket']={'MarketingCampaignId':lMarketingCampaignId},payloadObject['InboundDataFunction']=function(CReadCampaignResponse){if(CReadCampaignResponse){if(CReadCampaignResponse['Success']){var campaignDetails=CReadCampaignResponse;try{campaignDetails['Settings']=JSON['parse'](CReadCampaignResponse['Settings']);}catch(ex){}Campaigns['DisplayMarketingCampaign'](campaignDetails);}else TriSysApex['UI']['ShowMessage'](CReadCampaignResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['ErrorHandlerRedirector']('Campaigns.ReadCampaignFromWebAPI:\x20',request,status,error);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DisplayMarketingCampaign':function(campaignDetails){$('#campaign-name-block-title')['html'](campaignDetails['Name']?campaignDetails['Name']:'New\x20Campaign'),$('#campaign-name')['val'](campaignDetails['Name']),$('#campaigns-tab-campaignrecord-name')['html'](TriSysSDK['Miscellaneous']['EllipsisText'](campaignDetails['Name'],0x14)),$('#campaigns-campaign-name')['html'](':\x20'+campaignDetails['Name']),$('#campaign-description')['val'](campaignDetails['Description']),$('#campaign-user')['html'](campaignDetails['UserName']),TriSysSDK['CShowForm']['SetTextInCombo']('campaign-sender',campaignDetails['Sender']),$('#campaign-datecreated')['html'](moment(campaignDetails['Created'])['format']('dddd\x20DD\x20MMMM\x20YYYY'));var sUpdated='';if(campaignDetails['Updated']){var dt=new Date(campaignDetails['Updated']);sUpdated=dt['getFullYear']()<=0x1?'':moment(campaignDetails['Updated'])['format']('dddd\x20DD\x20MMMM\x20YYYY');}$('#campaign-dateupdated')['html'](sUpdated);if(campaignDetails['Settings']){var mySettings=campaignDetails['Settings'];mySettings&&(TriSysSDK['CShowForm']['SetTextInCombo']('campaign-recipient-email-field',mySettings['RecipientEMailField']),TriSysSDK['CShowForm']['SetTextInCombo']('campaign-Template',mySettings['Template']),TriSysSDK['CShowForm']['SetSkillsInList']('campaign-Attachments',mySettings['Attachments']),$('#campaign-Subject')['val'](mySettings['Subject']),TriSysSDK['CShowForm']['SetSkillsInList']('campaign-Attributes',mySettings['Attributes']),TriSysActions['PersistedSettingsSafeguard']['WaitUntilTaskControlsAreLoaded'](!![],!![],function(){ctrlNoteHistory['Reload'](mySettings['NoteHistory']),ctrlFollowUp['Reload'](mySettings['FollowUp']);}));}if(campaignDetails['MarketingCampaignId']>0x0){Campaigns['SetTabStatCount']('search',campaignDetails['LastSearchCount']),Campaigns['SetTabStatCount']('recipients',campaignDetails['Recipients']),Campaigns['SetTabStatCount']('sent',campaignDetails['SentCount']);if(campaignDetails['Recipients']>0x0)Campaigns['SetTabStatPercentage']('sent',campaignDetails['SentCount']/campaignDetails['Recipients']*0x64);Campaigns['SetTabStatCount']('delivered',campaignDetails['Delivered']);if(campaignDetails['SentCount']>0x0)Campaigns['SetTabStatPercentage']('delivered',campaignDetails['Delivered']/campaignDetails['SentCount']*0x64);Campaigns['SetTabStatCount']('openread',campaignDetails['Opened']);if(campaignDetails['SentCount']>0x0)Campaigns['SetTabStatPercentage']('openread',campaignDetails['Opened']/campaignDetails['SentCount']*0x64);Campaigns['SetTabStatCount']('clicks',campaignDetails['Clicked']);if(campaignDetails['Opened']>0x0)Campaigns['SetTabStatPercentage']('clicks',campaignDetails['Clicked']/campaignDetails['Opened']*0x64);Campaigns['SetTabStatCount']('undelivered',campaignDetails['Undelivered']);if(campaignDetails['SentCount']>0x0)Campaigns['SetTabStatPercentage']('undelivered',campaignDetails['Undelivered']/campaignDetails['SentCount']*0x64);}},'LoadContactSearch':function(){var sSearchTree='campaigns-lookup-criteria',sGrid='campaigns-search-grid',oldTreeElement=$('[id*=\x22'+sSearchTree+'\x22]');oldTreeElement['empty']();var sOldID=oldTreeElement['attr']('id'),sSearchDivForRecord=sSearchTree+'-id-'+Campaigns['Data']['MarketingCampaignId'];$('#'+sOldID)['attr']('id',sSearchDivForRecord),Campaigns['ShowGridLoadingWhilstSearchCriteriaTreeIsPopulated'](!![]);var lRecordId=0x0;TriSysSDK['SearchCriteria']['Load']('Contact',lRecordId,sSearchDivForRecord,Campaigns['InvokeLookupFromCriteria']);},'ShowGridLoadingWhilstSearchCriteriaTreeIsPopulated':function(bSpin){var spinnerWait={'Div':'campaigns-search-grid-container'};TriSysSDK['Grid']['WaitSpinnerMode'](spinnerWait,bSpin);},'InvokeLookupFromCriteria':function(sEntityName,lRecordId,sPopulationJson,dynamicColumns){var sGrid='campaigns-search-grid';Campaigns['ShowGridLoadingWhilstSearchCriteriaTreeIsPopulated'](![]);if(!sPopulationJson){TriSysSDK['Grid']['Empty'](sGrid),TriSysApex['Toasters']['Warning']('Please\x20enter\x20'+sEntityName+'\x20search\x20criteria.');return;}Campaigns['PopulateContactGrid'](sGrid,sPopulationJson,dynamicColumns);},'PopulateContactGrid':function(sGrid,sPopulationJson,dynamicColumns){var sController='Contacts',fnPopulationByFunction={'API':sController+'/List','Parameters':function(request){request['SearchTreeEnabled']=!![],request['SearchTreeJson']=sPopulationJson;},'DataTableFunction':function(response){return Campaigns['Data']['UpdateStat']('search',response['TotalRecordCount']),response['List'];}};TriSysWeb['Pages']['Contacts']['PopulateGrid'](sGrid,'grdContacts','Contacts',fnPopulationByFunction,null,{'DynamicColumns':dynamicColumns});},'Save':function(){var bUpdate=Campaigns['Data']['MarketingCampaignId']>0x0,CWriteCampaignRequest={'MarketingCampaignId':Campaigns['Data']['MarketingCampaignId'],'Name':$('#campaign-name')['val'](),'Description':$('#campaign-description')['val'](),'Sender':TriSysSDK['CShowForm']['GetTextFromCombo']('campaign-sender'),'Settings':Campaigns['GetSettings']()},sValidationError=null;if(!CWriteCampaignRequest['Name'])sValidationError='Name';if(!CWriteCampaignRequest['Description']&&!sValidationError)sValidationError='Description';if(sValidationError){TriSysApex['UI']['ShowMessage']('Please\x20complete\x20the\x20['+sValidationError+']\x20field.');return;}if(!CWriteCampaignRequest['Settings'])return;else CWriteCampaignRequest['Settings']=JSON['stringify'](CWriteCampaignRequest['Settings']);var payloadObject={};payloadObject['URL']='Marketing/WriteCampaign',payloadObject['OutboundDataPacket']=CWriteCampaignRequest,payloadObject['InboundDataFunction']=function(CWriteCampaignResponse){if(CWriteCampaignResponse){if(CWriteCampaignResponse['Success']){Campaigns['Data']['MarketingCampaignId']=CWriteCampaignResponse['MarketingCampaignId'];var sName=$('#campaign-name')['val']();$('#campaign-name-block-title')['html'](sName),$('#campaigns-tab-campaignrecord-name')['html'](TriSysSDK['Miscellaneous']['EllipsisText'](sName,0x14)),$('#campaigns-campaign-name')['html'](':\x20'+sName);if(bUpdate)$('#campaign-dateupdated')['html'](moment()['format']('dddd\x20DD\x20MMMM\x20YYYY'));else Campaigns['Tabs']['forEach'](function(sTab){Campaigns['ReadOnlyTabButton'](sTab,![]);});TriSysApex['Toasters']['Information']('Saved\x20Campaign:\x20'+sName);}else TriSysApex['UI']['ShowMessage'](CWriteCampaignResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['ErrorHandlerRedirector']('Campaigns.Save:\x20',request,status,error);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'GetSettings':function(){var sError=null,sRecipientEMailField=TriSysSDK['CShowForm']['GetTextFromCombo']('campaign-recipient-email-field'),sTemplate=TriSysActions['MailMerge']['GetTemplateFromCombo']('campaign-Template'),sAttachments=TriSysSDK['CShowForm']['GetSelectedSkillsFromList']('campaign-Attachments'),sSubject=$('#campaign-Subject')['val'](),sAttributes=TriSysSDK['CShowForm']['GetSelectedSkillsFromList']('campaign-Attributes');if(!sTemplate)sError='You\x20must\x20choose\x20an\x20e-mail\x20template.';else{if(!sSubject)sError='You\x20must\x20specify\x20an\x20e-mail\x20subject\x20heading.';}if(sError)return TriSysApex['UI']['ShowMessage'](sError),null;var mySettings={'RecipientEMailField':sRecipientEMailField,'Template':sTemplate,'Attachments':sAttachments,'Subject':sSubject,'Attributes':sAttributes,'NoteHistory':ctrlNoteHistory['Validation'](),'FollowUp':ctrlFollowUp['Validation']()};return mySettings;},'DeleteMarketingCampaign':function(lMarketingCampaignId){var CDeleteCampaignRequest={'MarketingCampaignId':lMarketingCampaignId},payloadObject={};payloadObject['URL']='Marketing/DeleteCampaign',payloadObject['OutboundDataPacket']=CDeleteCampaignRequest,payloadObject['InboundDataFunction']=function(CDeleteCampaignResponse){if(CDeleteCampaignResponse){if(CDeleteCampaignResponse['Success'])Campaigns['LoadCampaigns']();else TriSysApex['UI']['ShowMessage'](CDeleteCampaignResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['ErrorHandlerRedirector']('Campaigns.DeleteMarketingCampaign:\x20',request,status,error);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'CloneMarketingCampaign':function(lMarketingCampaignId,sNewName){var CCloneCampaignRequest={'MarketingCampaignId':lMarketingCampaignId,'Name':sNewName},payloadObject={};payloadObject['URL']='Marketing/CloneCampaign',payloadObject['OutboundDataPacket']=CCloneCampaignRequest,payloadObject['InboundDataFunction']=function(CCloneCampaignResponse){if(CCloneCampaignResponse){if(CCloneCampaignResponse['Success'])Campaigns['LoadCampaigns']();else TriSysApex['UI']['ShowMessage'](CCloneCampaignResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['ErrorHandlerRedirector']('Campaigns.CloneMarketingCampaign:\x20',request,status,error);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'ActionSearchInvocation':function(){var sGrid='campaigns-search-grid';return Campaigns['ActionInvocation'](sGrid);},'ActionRecipientInvocation':function(){var sGrid='campaigns-recipients-grid';return Campaigns['ActionInvocation'](sGrid);},'ActionInvocation':function(sGrid){var sIDField='Contact_ContactId',recordIds=TriSysSDK['Grid']['GetSelectedMultipleRowsFromGrid'](sGrid,sIDField);return recordIds;},'OpenSearchContact':function(){var lContactId=Campaigns['GetSelectedSingletonContactIdFromGrid']('campaigns-search-grid');if(lContactId>0x0)TriSysApex['FormsManager']['OpenForm']('Contact',lContactId);},'CopyFromSearchResultsToRecipients':function(bAll){if(bAll){var sSearchCriteriaInstance='search-criteria-tree-campaigns-lookup-criteria-id-'+Campaigns['Data']['MarketingCampaignId'],sJSON=ctrlSearchCriteria['GetJSONSearchRules']('Contact',sSearchCriteriaInstance,Campaigns['Data']['MarketingCampaignId']);Campaigns['AddContactsToRecipients'](null,sJSON);}else{var sGrid='campaigns-search-grid',lstContactId=Campaigns['ActionInvocation'](sGrid);if(!lstContactId||lstContactId['length']==0x0)TriSysApex['UI']['ShowMessage']('Please\x20select\x20one\x20or\x20more\x20records.');else Campaigns['AddContactsToRecipients'](lstContactId);}},'AddContactsToRecipients':function(lstContactId,sSearchTreeJson){var CAddContactsToCampaignRecipientsRequest={'MarketingCampaignId':Campaigns['Data']['MarketingCampaignId'],'Contacts':lstContactId,'SearchTreeEnabled':!lstContactId,'SearchTreeJson':sSearchTreeJson},payloadObject={};payloadObject['URL']='Marketing/AddContactsToCampaignRecipients',payloadObject['OutboundDataPacket']=CAddContactsToCampaignRecipientsRequest,payloadObject['InboundDataFunction']=function(CAddContactsToCampaignRecipientsResponse){TriSysApex['UI']['HideWait']();if(CAddContactsToCampaignRecipientsResponse){if(CAddContactsToCampaignRecipientsResponse['Success']){var sCounter=TriSysSDK['Numbers']['ThousandsSeparator'](CAddContactsToCampaignRecipientsResponse['AddedCount']);TriSysApex['Toasters']['Information'](sCounter+'\x20recipient(s)\x20added.'),Campaigns['Data']['UpdateStat']('recipients',CAddContactsToCampaignRecipientsResponse['RecipientCount']),Campaigns['LoadRecipients']();}else TriSysApex['UI']['ShowMessage'](CAddContactsToCampaignRecipientsResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['ErrorHandlerRedirector']('Campaigns.AddContactsToRecipients:\x20',request,status,error);},TriSysApex['UI']['ShowWait'](null,'Adding\x20Recipients...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'LoadRecipients':function(){var fnPopulationByFunction={'API':'Marketing/CampaignRecipientList','Parameters':function(request){request['MarketingCampaignId']=Campaigns['Data']['MarketingCampaignId'],request['Added']=!![],request['Scheduled']=!![];},'DataTableFunction':function(response){return Campaigns['Data']['UpdateStat']('recipients',response['TotalRecordCount']),response['List'];}},columns=JSON['parse'](JSON['stringify'](TriSysWeb['Pages']['Contacts']['Columns']));columns['splice'](0x3,0x0,{'field':'Added','title':'Added','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20HH:mm}'}),columns['splice'](0x4,0x0,{'field':'Scheduled','title':'Scheduled','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20HH:mm}'});var options={'DrillDownFunction':Campaigns['OpenContact']};TriSysWeb['Pages']['Contacts']['PopulateGrid']('campaigns-recipients-grid','grdContacts','Contacts',fnPopulationByFunction,columns,options);},'OpenRecipient':function(){var lContactId=Campaigns['GetSelectedSingletonContactIdFromGrid']('campaigns-recipients-grid');if(lContactId>0x0)Campaigns['OpenContact'](lContactId);},'AddRecipient':function(){var fnSelected=function(sEntityName,lRecordId,sName){Campaigns['AddContactsToRecipients']([lRecordId]);};TriSysApex['ModalDialogue']['EntityRecord']['Select']('Contact',fnSelected);},'RemoveRecipient':function(bAll){var lstContactId=null;if(!bAll){var sGrid='campaigns-recipients-grid',sIDField='Contact_ContactId';lstContactId=TriSysSDK['Grid']['GetSelectedMultipleRowsFromGrid'](sGrid,sIDField);if(!lstContactId||lstContactId['length']==0x0){TriSysApex['UI']['ShowMessage']('Please\x20select\x20one\x20or\x20more\x20recipients.');return;}}var CRemoveCampaignRecipientsRequest={'MarketingCampaignId':Campaigns['Data']['MarketingCampaignId'],'Contacts':lstContactId,'AllRecipients':bAll},payloadObject={};payloadObject['URL']='Marketing/RemoveCampaignRecipients',payloadObject['OutboundDataPacket']=CRemoveCampaignRecipientsRequest,payloadObject['InboundDataFunction']=function(CRemoveCampaignRecipientsResponse){TriSysApex['UI']['HideWait']();if(CRemoveCampaignRecipientsResponse){if(CRemoveCampaignRecipientsResponse['Success']){var sCounter=TriSysSDK['Numbers']['ThousandsSeparator'](CRemoveCampaignRecipientsResponse['RemovedCount']);TriSysApex['Toasters']['Information'](sCounter+'\x20recipient(s)\x20removed.'),Campaigns['LoadRecipients']();}else TriSysApex['UI']['ShowMessage'](CRemoveCampaignRecipientsResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['ErrorHandlerRedirector']('Campaigns.RemoveRecipient:\x20',request,status,error);},TriSysApex['UI']['ShowWait'](null,'Removing\x20Recipients...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'SendToRecipient':function(bAll){var lstContactId=null,lNumberOfRecipients=0x0;if(bAll){var sNumberOfRecipients=$('#campaigns-tab-recipients-count')['html']();if(sNumberOfRecipients)lNumberOfRecipients=parseInt(sNumberOfRecipients['replace'](/,/g,''));}else{var sGrid='campaigns-recipients-grid',sIDField='Contact_ContactId';lstContactId=TriSysSDK['Grid']['GetSelectedMultipleRowsFromGrid'](sGrid,sIDField);if(!lstContactId||lstContactId['length']==0x0){TriSysApex['UI']['ShowMessage']('Please\x20select\x20one\x20or\x20more\x20recipients.');return;}else lNumberOfRecipients=lstContactId['length'];}if(lNumberOfRecipients==0x0){TriSysApex['UI']['ShowMessage']('There\x20are\x20no\x20recipients.');return;}var CSendToCampaignRecipientsRequest={'MarketingCampaignId':Campaigns['Data']['MarketingCampaignId'],'Name':$('#campaign-name')['val'](),'Contacts':lstContactId,'AllRecipients':bAll,'NumberOfRecipients':lNumberOfRecipients};TriSysApex['WhiteLabelling']['LoadJavascriptFile']('js/pages/ctrlCampaignSendSchedule.js',null,function(){Campaigns['PopupCampaignSendSchedule'](CSendToCampaignRecipientsRequest);});},'PopupCampaignSendSchedule':function(sName,lNumberOfRecipients){var parametersObject=new TriSysApex['UI']['ShowMessageParameters']();parametersObject['Title']='Schedule\x20Send',parametersObject['Image']='fa-send-o',parametersObject['Maximize']=![],parametersObject['CloseTopRightButton']=!![],parametersObject['ContentURL']=TriSysApex['Constants']['UserControlFolder']+'ctrlCampaignSendSchedule.html',parametersObject['Width']=0x258,parametersObject['OnLoadCallback']=function(){ctrlCampaignSendSchedule['Load'](sName,lNumberOfRecipients);},parametersObject['ButtonLeftVisible']=!![],parametersObject['ButtonLeftText']='Cancel',parametersObject['ButtonLeftFunction']=function(){return!![];},parametersObject['ButtonCentreVisible']=!![],parametersObject['ButtonCentreText']='Send',parametersObject['ButtonCentreFunction']=ctrlCampaignSendSchedule['Send'],TriSysApex['UI']['PopupMessage'](parametersObject);},'ScheduleSendViaWebAPI':function(CSendToCampaignRecipientsRequest){var payloadObject={};payloadObject['URL']='Marketing/SendToCampaignRecipients',payloadObject['OutboundDataPacket']=CSendToCampaignRecipientsRequest,payloadObject['InboundDataFunction']=function(CSendToCampaignRecipientsResponse){TriSysApex['UI']['HideWait']();if(CSendToCampaignRecipientsResponse){if(CSendToCampaignRecipientsResponse['Success']){var sCounter=TriSysSDK['Numbers']['ThousandsSeparator'](CSendToCampaignRecipientsResponse['ScheduledCount']);TriSysApex['Toasters']['Information'](sCounter+'\x20recipient\x20e-mail(s)\x20scheduled.'),Campaigns['LoadRecipients']();}else TriSysApex['UI']['ShowMessage'](CSendToCampaignRecipientsResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['ErrorHandlerRedirector']('Campaigns.ScheduleSendViaWebAPI:\x20',request,status,error);},TriSysApex['UI']['ShowWait'](null,'Sending\x20to\x20Recipients...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'GetSelectedSingletonContactIdFromGrid':function(sGrid){var sIDField='Contact_ContactId',lContactId=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid'](sGrid,sIDField,'contact');return lContactId;},'LoadSent':function(){var fnPopulationByFunction={'API':'Marketing/CampaignRecipientList','Parameters':function(request){request['MarketingCampaignId']=Campaigns['Data']['MarketingCampaignId'],request['Sent']=!![];},'DataTableFunction':function(response){return Campaigns['Data']['UpdateStat']('sent',response['TotalRecordCount']),response['List'];}},columns=JSON['parse'](JSON['stringify'](TriSysWeb['Pages']['Contacts']['Columns']));columns['splice'](0x3,0x0,{'field':'Sent','title':'Sent','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20HH:mm}'});var options={'DrillDownFunction':Campaigns['OpenContact']};TriSysWeb['Pages']['Contacts']['PopulateGrid']('campaigns-sent-grid','grdContacts','Contacts',fnPopulationByFunction,columns,options);},'OpenSent':function(){var lContactId=Campaigns['GetSelectedSingletonContactIdFromGrid']('campaigns-sent-grid');if(lContactId>0x0)Campaigns['OpenContact'](lContactId);},'ActionSentInvocation':function(){var sGrid='campaigns-sent-grid';return Campaigns['ActionInvocation'](sGrid);},'LoadDelivered':function(){var fnPopulationByFunction={'API':'Marketing/CampaignRecipientList','Parameters':function(request){request['MarketingCampaignId']=Campaigns['Data']['MarketingCampaignId'],request['Delivered']=!![];},'DataTableFunction':function(response){return Campaigns['Data']['UpdateStat']('delivered',response['TotalRecordCount']),response['List'];}},columns=JSON['parse'](JSON['stringify'](TriSysWeb['Pages']['Contacts']['Columns']));columns['splice'](0x3,0x0,{'field':'Delivered','title':'Delivered','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20HH:mm}'});var options={'DrillDownFunction':Campaigns['OpenContact']};TriSysWeb['Pages']['Contacts']['PopulateGrid']('campaigns-delivered-grid','grdContacts','Contacts',fnPopulationByFunction,columns,options);},'OpenDelivered':function(){var lContactId=Campaigns['GetSelectedSingletonContactIdFromGrid']('campaigns-delivered-grid');if(lContactId>0x0)Campaigns['OpenContact'](lContactId);},'ActionDeliveredInvocation':function(){var sGrid='campaigns-delivered-grid';return Campaigns['ActionInvocation'](sGrid);},'LoadOpened':function(){var fnPopulationByFunction={'API':'Marketing/CampaignRecipientList','Parameters':function(request){request['MarketingCampaignId']=Campaigns['Data']['MarketingCampaignId'],request['Opened']=!![];},'DataTableFunction':function(response){return Campaigns['Data']['UpdateStat']('openread',response['TotalRecordCount']),response['List'];}},columns=JSON['parse'](JSON['stringify'](TriSysWeb['Pages']['Contacts']['Columns']));columns['splice'](0x3,0x0,{'field':'Opened','title':'Opened/Read','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20HH:mm}'});var options={'DrillDownFunction':Campaigns['OpenContact']};TriSysWeb['Pages']['Contacts']['PopulateGrid']('campaigns-openread-grid','grdContacts','Contacts',fnPopulationByFunction,columns,options);},'OpenRead':function(){var lContactId=Campaigns['GetSelectedSingletonContactIdFromGrid']('campaigns-openread-grid');if(lContactId>0x0)Campaigns['OpenContact'](lContactId);},'ActionOpenedInvocation':function(){var sGrid='campaigns-openread-grid';return Campaigns['ActionInvocation'](sGrid);},'LoadClicked':function(){var fnPopulationByFunction={'API':'Marketing/CampaignRecipientList','Parameters':function(request){request['MarketingCampaignId']=Campaigns['Data']['MarketingCampaignId'],request['Clicked']=!![];},'DataTableFunction':function(response){return Campaigns['Data']['UpdateStat']('clicks',response['TotalRecordCount']),response['List'];}},columns=JSON['parse'](JSON['stringify'](TriSysWeb['Pages']['Contacts']['Columns']));columns['splice'](0x3,0x0,{'field':'Clicked','title':'Clicked','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20HH:mm}'});var options={'DrillDownFunction':Campaigns['OpenContact']};TriSysWeb['Pages']['Contacts']['PopulateGrid']('campaigns-clicks-grid','grdContacts','Contacts',fnPopulationByFunction,columns,options);},'OpenClicked':function(){var lContactId=Campaigns['GetSelectedSingletonContactIdFromGrid']('campaigns-clicks-grid');if(lContactId>0x0)Campaigns['OpenContact'](lContactId);},'ActionClickedInvocation':function(){var sGrid='campaigns-clicks-grid';return Campaigns['ActionInvocation'](sGrid);},'LoadUndelivered':function(){var fnPopulationByFunction={'API':'Marketing/CampaignRecipientList','Parameters':function(request){request['MarketingCampaignId']=Campaigns['Data']['MarketingCampaignId'],request['Undelivered']=!![];},'DataTableFunction':function(response){return Campaigns['Data']['UpdateStat']('undelivered',response['TotalRecordCount']),response['List'];}},columns=JSON['parse'](JSON['stringify'](TriSysWeb['Pages']['Contacts']['Columns']));columns['splice'](0x3,0x0,{'field':'Undelivered','title':'Undelivered','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20HH:mm}'});var options={'DrillDownFunction':Campaigns['OpenContact']};TriSysWeb['Pages']['Contacts']['PopulateGrid']('campaigns-undelivered-grid','grdContacts','Contacts',fnPopulationByFunction,columns,options);},'OpenUndelivered':function(){var lContactId=Campaigns['GetSelectedSingletonContactIdFromGrid']('campaigns-undelivered-grid');if(lContactId>0x0)Campaigns['OpenContact'](lContactId);},'ActionUndeliveredInvocation':function(){var sGrid='campaigns-undelivered-grid';return Campaigns['ActionInvocation'](sGrid);},'OpenContact':function(lContactId){TriSysApex['WhiteLabelling']['LoadJavascriptFile']('js/pages/ctrlCampaignRecipient.js',null,function(){Campaigns['PopupCampaignRecipient'](lContactId);});},'PopupCampaignRecipient':function(lContactId){var parametersObject=new TriSysApex['UI']['ShowMessageParameters']();parametersObject['Title']='Campaign\x20Recipient',parametersObject['Image']='fa-send-o',parametersObject['Maximize']=![],parametersObject['CloseTopRightButton']=!![],parametersObject['ContentURL']=TriSysApex['Constants']['UserControlFolder']+'ctrlCampaignRecipient.html',parametersObject['Width']=0x258,parametersObject['OnLoadCallback']=function(){ctrlCampaignRecipient['Load'](lContactId,Campaigns['Data']['MarketingCampaignId']);},parametersObject['ButtonLeftVisible']=!![],parametersObject['ButtonLeftText']='Close',parametersObject['ButtonLeftFunction']=function(){return!![];},parametersObject['ButtonCentreVisible']=!![],parametersObject['ButtonCentreText']='Open\x20Contact',parametersObject['ButtonCentreFunction']=function(){return TriSysApex['FormsManager']['OpenForm']('Contact',lContactId),!![];},parametersObject['ButtonRightVisible']=!![],parametersObject['ButtonRightText']='Open\x20E-Mail',parametersObject['ButtonRightFunction']=function(){ctrlCampaignRecipient['OpenEMail'](lContactId,Campaigns['Data']['MarketingCampaignId']);},TriSysApex['UI']['PopupMessage'](parametersObject);},'PopulateSenderCombo':function(){var payloadObject={};payloadObject['URL']='Marketing/AvailableSenders',payloadObject['InboundDataFunction']=function(CAvailableSendersResponse){if(CAvailableSendersResponse){if(CAvailableSendersResponse['Success']){var lstSenders=[];CAvailableSendersResponse['Senders']['forEach'](function(sSenderAddress){lstSenders['push']({'value':sSenderAddress,'text':sSenderAddress});}),TriSysSDK['CShowForm']['populateComboFromDataSource']('campaign-sender',lstSenders);}else TriSysApex['UI']['ShowMessage'](CAvailableSendersResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['ErrorHandlerRedirector']('Campaigns.PopulateSenderCombo:\x20',request,status,error);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'PopulateRecipientEMailFieldCombo':function(){var sWork='Work\x20E-Mail',sPersonal='Personal\x20E-Mail',lstFields=[{'value':sWork,'text':sWork},{'value':sPersonal,'text':sPersonal}];TriSysSDK['CShowForm']['populateComboFromDataSource']('campaign-recipient-email-field',lstFields);},'Data':{'MarketingCampaignId':0x0,'UpdateStat':function(sTab,lCount){Campaigns['SetTabStatCount'](sTab,lCount);var sField=null;switch(sTab){case'search':sField='LastSearchCount';break;case'recipients':sField='Recipients';break;}var CUpdateCampaignStatisticRequest={'MarketingCampaignId':Campaigns['Data']['MarketingCampaignId'],'Field':sField,'Value':lCount},payloadObject={};payloadObject['URL']='Marketing/UpdateCampaignStatistic',payloadObject['OutboundDataPacket']=CUpdateCampaignStatisticRequest,payloadObject['InboundDataFunction']=function(CUpdateCampaignStatisticResponse){if(CUpdateCampaignStatisticResponse){if(CUpdateCampaignStatisticResponse['Success']){}else TriSysApex['UI']['ShowMessage'](CUpdateCampaignStatisticResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['ErrorHandlerRedirector']('Campaigns.Data.UpdateStat:\x20',request,status,error);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);}}};$(document)['ready'](function(){Campaigns['Load']();});