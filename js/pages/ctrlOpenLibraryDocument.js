var ctrlOpenLibraryDocument={'Load':function(){var context=TriSysApex['ModalDialogue']['DocumentLibrary']['Context'],bFileList=!TriSysAPI['Operators']['isEmpty'](context['Files']);if(bFileList)$('#openLibraryDocument-File-Reference-tr')['hide'](),$('#openLibraryDocument-Expiry-tr')['hide']();else ctrlOpenLibraryDocument['LoadDocumentWidget']();TriSysActions['Forms']['TaskType']['Load']('openLibraryDocument-TaskType','openLibraryDocument-selected-TaskType-Image','Letter'),TriSysSDK['CShowForm']['dateTimePicker']('openLibraryDocument-DateAdded'),TriSysSDK['CShowForm']['dateTimePicker']('openLibraryDocument-Expiry');var dtNow=new Date();TriSysSDK['CShowForm']['setDateTimePickerValue']('openLibraryDocument-DateAdded',dtNow);var userCredentials=TriSysApex['LoginCredentials']['UserCredentials'](),sOwner=userCredentials['LoggedInUser']['ForenameAndSurname'];$('#openLibraryDocument-Owner')['val'](sOwner),!bFileList&&ctrlOpenLibraryDocument['ReadFromWebAPI']();},'LoadDocumentWidget':function(){var sDocumentFileRef='openLibraryDocument-File-Reference',fnFileCallback=function(sOperation,divTag,sFilePath){switch(sOperation){case'find':break;case'delete':break;}},fieldDescription={'TableFieldName':'Library\x20Document','TableName':'File'};TriSysSDK['Controls']['FileReference']['Load'](sDocumentFileRef,fieldDescription,fnFileCallback);},'ReadFromWebAPI':function(){var context=TriSysApex['ModalDialogue']['DocumentLibrary']['Context'],CReadDocumentRequest={'DocumentId':context['DocumentId']},payloadObject={};payloadObject['URL']='DocumentLibrary/ReadDocument',payloadObject['OutboundDataPacket']=CReadDocumentRequest,payloadObject['InboundDataFunction']=function(data){TriSysApex['UI']['HideWait']();var CReadDocumentResponse=data;if(CReadDocumentResponse){if(CReadDocumentResponse['Success']){var file=CReadDocumentResponse['File'];TriSysSDK['Controls']['FileReference']['SetFile']('openLibraryDocument-File-Reference',file['FilePath']),TriSysSDK['CShowForm']['SetTaskTypeComboValue']('openLibraryDocument-TaskType',file['TypeName']),$('#openLibraryDocument-Description')['val'](file['Description']),TriSysSDK['CShowForm']['setDateTimePickerValue']('openLibraryDocument-DateAdded',file['DateAdded']),$('#openLibraryDocument-Owner')['val'](file['OwnerName']),TriSysSDK['CShowForm']['setDateTimePickerValue']('openLibraryDocument-Expiry',file['Expiry']),TriSysSDK['Controls']['FileReference']['OpenFileButtonClick']('openLibraryDocument-File-Reference');return;}else TriSysApex['UI']['ShowMessage'](CReadDocumentResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlOpenLibraryDocument.ReadFromWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Document...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'SaveButtonClick':function(){var file={};file['FilePath']=TriSysSDK['Controls']['FileReference']['GetFile']('openLibraryDocument-File-Reference'),file['TypeName']=TriSysSDK['CShowForm']['GetTaskTypeFromCombo']('openLibraryDocument-TaskType'),file['Description']=$('#openLibraryDocument-Description')['val'](),file['DateAdded']=TriSysSDK['CShowForm']['getDateTimePickerValue']('openLibraryDocument-DateAdded'),file['Expiry']=TriSysSDK['CShowForm']['getDateTimePickerValue']('openLibraryDocument-Expiry'),file['OwnerName']=$('#openLibraryDocument-Owner')['val']();if(!file['FilePath']){TriSysApex['UI']['ShowMessage']('Please\x20pick\x20a\x20document.');return;}var context=TriSysApex['ModalDialogue']['DocumentLibrary']['Context'];file['EntityName']=context['EntityName'],file['EntityId']=context['RecordId'],file['DocumentId']=context['DocumentId'];var CWriteDocumentRequest={'File':file},payloadObject={};payloadObject['URL']='DocumentLibrary/WriteDocument',payloadObject['OutboundDataPacket']=CWriteDocumentRequest,payloadObject['InboundDataFunction']=function(data){TriSysApex['UI']['HideWait']();var CWriteDocumentResponse=data;if(CWriteDocumentResponse){if(CWriteDocumentResponse['Success']){TriSysSDK['Grid']['ClearCheckedRows'](context['Grid']),TriSysSDK['Grid']['RefreshData'](context['Grid']),TriSysApex['UI']['CloseModalPopup']();return;}else TriSysApex['UI']['ShowMessage'](CWriteDocumentResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlOpenLibraryDocument.SaveButtonClick:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Saving\x20Document...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);}};$(document)['ready'](function(){ctrlOpenLibraryDocument['Load']();});