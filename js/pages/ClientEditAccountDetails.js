var ClientEditAccountDetails={'Load':function(){TriSysWebJobs['CandidateRegistration']['LoadContactTitleLookup']('txtEditClientTitle'),TriSysWebJobs['CandidateRegistration']['LoadCountryLookup']('txtEditClientCountry'),TriSysWebJobs['CandidateRegistration']['LoadContactPhotoWidgets']('EditClientContactPhoto','imgEditClientEditor');var fnPopulate=function(client){TriSysSDK['CShowForm']['SetTextInCombo']('txtEditClientTitle',client['Title']),$('#txtEditClientForenames')['val'](client['Forenames']),$('#txtEditClientSurname')['val'](client['Surname']),$('#txtEditClientJobTitle')['val'](client['JobTitle']),$('#txtEditClientMobileTelNo')['val'](client['WorkMobileTelNo']),$('#txtEditClientWorkTelNo')['val'](client['WorkTelNo']),$('#txtEditClientEMail')['val'](client['WorkEMail']),$('#txtEditClientCompanyName')['val'](client['CompanyName']);var companyAddresses=[],addresses=client['CompanyAddresses'],iSelectedIndex=0x0;if(addresses)for(var i=0x0;i<addresses['length'];i++){var address=addresses[i],sAddressDisplay=TriSysSDK['Miscellaneous']['EllipsisText'](address['Display'],0x64);companyAddresses['push']({'value':address['AddressId'],'text':sAddressDisplay});if(address['AddressId']==client['CompanyAddressId'])iSelectedIndex=i;}TriSysSDK['CShowForm']['populateComboFromDataSource']('cmbEditClientAddress',companyAddresses,iSelectedIndex),$('#EditClientNewCompanyAddress')['on']('click',function(){ClientEditAccountDetails['SpecifyNewCompanyAddress'](client['CompanyId'],client['CompanyName'],'cmbEditClientAddress');});if(client['CompanyAddressStreet']){var sStreet=client['CompanyAddressStreet']['replace'](/, /g,'\x0a');$('#txtEditClientStreet')['val'](sStreet);}$('#txtEditClientCity')['val'](client['CompanyAddressCity']),$('#txtEditClientCounty')['val'](client['CompanyAddressCounty']),$('#txtEditClientPostCode')['val'](client['CompanyAddressPostCode']);if(client['CompanyAddressCountry'])TriSysSDK['CShowForm']['SetTextInCombo']('txtEditClientCountry',client['CompanyAddressCountry']);$('#txtEditClientAddressPhone')['val'](client['CompanyAddressTelNo']);if(client['ContactPhoto']){var photoWidget=$('#imgEditClientEditor');photoWidget['attr']('src',client['ContactPhoto']),photoWidget['show']();}client['GDPRSettings']&&(TriSysSDK['CShowForm']['SetCheckBoxValue']('ClientEditAccountDetails-AgreeToReceiveMarketingCommunications',client['GDPRSettings']['AgreeToMarketingCommunications']),TriSysSDK['CShowForm']['SetCheckBoxValue']('ClientEditAccountDetails-AgreeToPrivacyPolicy',client['GDPRSettings']['AgreeToPrivacyPolicy']),TriSysSDK['CShowForm']['SetCheckBoxValue']('ClientEditAccountDetails-RestrictProcessing',client['GDPRSettings']['GDPRRestrictDataProcessing']),client['GDPRSettings']['GDPRDeletionRequestReceived']&&ClientEditAccountDetails['RemovalRequested'](client['GDPRSettings']['DateGDPRDeletionRequestReceived']),client['GDPRSettings']['GDPRDataPortabilityRequestReceived']&&ClientEditAccountDetails['PortabilityRequestReceived'](client['GDPRSettings']['DateGDPRDataPortabilityRequestReceived']));};TriSysWebJobs['ContactUs']['LoadLoggedInUserDetails'](fnPopulate,![]),ClientEditAccountDetails['ReadSocialProfile'](),ClientEditAccountDetails['JobTitleSelectionMode']();},'SpecifyNewCompanyAddress':function(lCompanyId,sCompanyName,sComboID){var fnNewAddress=function(lCompanyId,lContactId,address){var sStreet=address['Street']['replace'](/\r\n/g,',\x20')['replace'](/\n/g,',\x20'),sAddress=sStreet+(address['City']?',\x20'+address['City']:'')+(address['County']?',\x20'+address['County']:'')+(address['PostCode']?',\x20'+address['PostCode']:''),sAddressObject=JSON['stringify'](address);TriSysSDK['CShowForm']['addItemToCombo'](sComboID,sAddress,!![],sAddressObject),TriSysApex['UI']['CloseModalPopup']();},options={'Title':'New\x20'+sCompanyName+'\x20Address','HideCompanyBlock':!![]};TriSysApex['ModalDialogue']['NewCompanyAddress']['Popup'](lCompanyId,sCompanyName,0x0,0x0,fnNewAddress,![],options);},'ReadSocialProfile':function(){var payloadObject={};payloadObject['URL']='Contact/ReadLoggedInClientSocialProfile',payloadObject['OutboundDataPacket']=null,payloadObject['InboundDataFunction']=function(CLoggedInClientSocialProfileResponse){CLoggedInClientSocialProfileResponse&&(CLoggedInClientSocialProfileResponse['Success']&&ClientEditAccountDetails['DisplaySocialProfile'](CLoggedInClientSocialProfileResponse));},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DisplaySocialProfile':function(profile){$('#txtEditClientTwitter')['val'](profile['Twitter']),$('#txtEditClientLinkedIn')['val'](profile['LinkedIn']),$('#txtEditClientFacebook')['val'](profile['Facebook']),$('#txtEditClientYouTube')['val'](profile['YouTube']),$('#txtEditClientSkype')['val'](profile['Skype']);},'PostCodelookup':function(){var sPrefix='txtEditClient';TriSysSDK['PostCode']['Lookup'](sPrefix+'PostCode',sPrefix+'Street',sPrefix+'City',sPrefix+'County',sPrefix+'Country');},'SubmitButtonClick':function(){var client={};client['Title']=TriSysSDK['CShowForm']['GetTextFromCombo']('txtEditClientTitle'),client['Forenames']=$('#txtEditClientForenames')['val'](),client['Surname']=$('#txtEditClientSurname')['val'](),client['Password']=$('#txtEditClientPassword')['val'](),client['VerifyPassword']=$('#txtEditClientPasswordConfirmation')['val'](),client['JobTitle']=$('#txtEditClientJobTitle')['val'](),client['CompanyName']=$('#txtEditClientCompanyName')['val']();var lAddressId=TriSysSDK['CShowForm']['GetValueFromCombo']('cmbEditClientAddress');if(!$['isNumeric'](lAddressId))client['NewCompanyAddress']=JSON['parse'](lAddressId);else client['CompanyAddressId']=lAddressId;client['CompanyAddressStreet']=$('#txtEditClientStreet')['val'](),client['CompanyAddressCity']=$('#txtEditClientCity')['val'](),client['CompanyAddressCounty']=$('#txtEditClientCounty')['val'](),client['CompanyAddressPostCode']=$('#txtEditClientPostCode')['val'](),client['CompanyAddressCountry']=$('#txtEditClientCountry')['val'](),client['CompanyAddressTelNo']=$('#txtEditClientAddressPhone')['val'](),client['WorkMobileTelNo']=$('#txtEditClientMobileTelNo')['val'](),client['WorkTelNo']=$('#txtEditClientWorkTelNo')['val'](),client['WorkEMail']=$('#txtEditClientEMail')['val'](),client['ContactPhoto']=TriSysSDK['Controls']['FileReference']['GetFile']('EditClientContactPhoto'),client['Twitter']=$('#txtEditClientTwitter')['val'](),client['LinkedIn']=$('#txtEditClientLinkedIn')['val'](),client['Facebook']=$('#txtEditClientFacebook')['val'](),client['YouTube']=$('#txtEditClientYouTube')['val'](),client['Skype']=$('#txtEditClientSkype')['val'](),client['AgreeToMarketingCommunications']=TriSysSDK['CShowForm']['GetCheckBoxValue']('ClientEditAccountDetails-AgreeToReceiveMarketingCommunications'),client['AgreeToPrivacyPolicy']=TriSysSDK['CShowForm']['GetCheckBoxValue']('ClientEditAccountDetails-AgreeToPrivacyPolicy'),client['GDPRRestrictDataProcessing']=TriSysSDK['CShowForm']['GetCheckBoxValue']('ClientEditAccountDetails-RestrictProcessing');var sRuleFailure='';if(!client['Forenames'])sRuleFailure+='Please\x20enter\x20your\x20forename(s)'+'<br\x20/>';if(!client['Surname'])sRuleFailure+='Please\x20enter\x20your\x20surname'+'<br\x20/>';if(!TriSysApex['LoginCredentials']['validateEmail'](client['WorkEMail']))sRuleFailure+='Please\x20enter\x20a\x20valid\x20e-mail\x20address.'+'<br\x20/>';if(client['Password']||client['VerifyPassword']){var iMinLength=TriSysApex['Constants']['iMinimumPasswordLength'];if(client['Password']['length']<iMinLength)sRuleFailure+='Please\x20enter\x20a\x20password\x20with\x20a\x20mininum\x20length\x20of\x20'+iMinLength+'\x20characters'+'<br\x20/>';if(client['Password']!=client['VerifyPassword'])sRuleFailure+='Please\x20confirm\x20your\x20password'+'<br\x20/>';}if(sRuleFailure['length']>0x0){TriSysApex['UI']['ShowMessage'](sRuleFailure,TriSysWebJobs['Constants']['ApplicationName']);return;}ClientEditAccountDetails['WriteProfileAndSocialMedia'](client);},'WriteProfileAndSocialMedia':function(client){var payloadObject={},WriteLoggedInClientProfileRequest={'Client':client};payloadObject['OutboundDataPacket']=WriteLoggedInClientProfileRequest,payloadObject['URL']='Contact/WriteLoggedInClientProfile',payloadObject['InboundDataFunction']=function(WriteLoggedInClientProfileResponse){TriSysApex['UI']['HideWait']();if(WriteLoggedInClientProfileResponse){if(WriteLoggedInClientProfileResponse['Success'])TriSysApex['UI']['ShowMessage']('Profile\x20Successfuly\x20Updated',TriSysWebJobs['Constants']['ApplicationName']);else TriSysApex['UI']['ShowMessage'](WriteLoggedInClientProfileResponse['ErrorMessage'],TriSysWebJobs['Constants']['ApplicationName']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ClientEditAccountDetails.WriteProfileAndSocialMedia:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Saving\x20Profile...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'JobTitleSelectionMode':function(){var bJobTitleSelectionMode=![],bManeGroup=TriSysWebJobs['Agency']['CustomerID']['toLowerCase']()=='Mane-Group'['toLowerCase']();if(bManeGroup)bJobTitleSelectionMode=!![];bJobTitleSelectionMode&&($('#txtEditClientJobTitle')['attr']('readonly','readonly'),$('#tr-EditClientJobTitle')['show']());},'JobTitleLookup':function(){var sJobTitleField='txtEditClientJobTitle',sJobTitle=null;TriSysSDK['JobTitle']['Lookup'](sJobTitle,sJobTitleField);},'TweakLittleQuestionMarks':function(){$('i[id^=ClientEditAccountDetails-QuestionMark]')['filter'](function(){var sID=this['id'],elem=$('#'+sID);elem['css']('color',TriSysProUI['BackColour']());var sTitle=this['title'],sCaption=elem['data']('caption');elem['off']()['on']('click',function(){TriSysApex['UI']['ShowMessage'](sTitle,sCaption);});});},'PrivacyPolicy':function(){var parametersObject=new TriSysApex['UI']['ShowMessageParameters']();parametersObject['Title']=TriSysApex['Copyright']['ShortProductName']+'\x20Privacy\x20Policy',parametersObject['Image']='gi-lock',parametersObject['Maximize']=!![];var sCustomerID=TriSysWebJobs['Agency']['CustomerID'];parametersObject['ContentURL']='https://api.trisys.co.uk/apex/custom/'+sCustomerID+'/ctrlPrivacyPolicy.html',parametersObject['ButtonRightText']='OK',parametersObject['ButtonRightVisible']=!![],parametersObject['ButtonLeftText']='Agree\x20to\x20Privacy\x20Policy',parametersObject['ButtonLeftVisible']=!![],parametersObject['ButtonLeftFunction']=function(){return TriSysSDK['CShowForm']['SetCheckBoxValue']('ClientEditAccountDetails-AgreeToPrivacyPolicy',!![]),!![];},TriSysApex['UI']['PopupMessage'](parametersObject);},'RequestRemoval':function(){TriSysApex['WhiteLabelling']['LoadJavascriptFile']('js/pages/ctrlRequestRemoval.js',null,ClientEditAccountDetails['PopupRequestRemoval']);},'PopupRequestRemoval':function(){var parametersObject=new TriSysApex['UI']['ShowMessageParameters']();parametersObject['Title']='Request\x20Removal',parametersObject['Image']='gi-remove_2',parametersObject['Maximize']=![],parametersObject['CloseTopRightButton']=!![],parametersObject['ContentURL']=TriSysApex['CustomFormsAndComponents']['UserControlPath']('ctrlRequestRemoval.html'),parametersObject['Width']=0x258,parametersObject['OnLoadCallback']=function(){var sFullName=$('#txtEditClientForenames')['val']()+'\x20'+$('#txtEditClientSurname')['val']();ctrlRequestRemoval['Load'](sFullName);},parametersObject['ButtonLeftVisible']=!![],parametersObject['ButtonLeftText']='Cancel',parametersObject['ButtonLeftFunction']=function(){return!![];},parametersObject['ButtonCentreVisible']=!![],parametersObject['ButtonCentreText']='Confirm\x20Removal\x20Request',parametersObject['ButtonCentreFunction']=ctrlRequestRemoval['Confirm'],TriSysApex['UI']['PopupMessage'](parametersObject);},'PortabilityRequest':function(){TriSysApex['WhiteLabelling']['LoadJavascriptFile']('js/pages/ctrlPortabilityRequest.js',null,ClientEditAccountDetails['PopupPortabilityRequest']);},'PopupPortabilityRequest':function(){var parametersObject=new TriSysApex['UI']['ShowMessageParameters']();parametersObject['Title']='Portability\x20Request',parametersObject['Image']='gi-global',parametersObject['Maximize']=![],parametersObject['CloseTopRightButton']=!![],parametersObject['ContentURL']=TriSysApex['CustomFormsAndComponents']['UserControlPath']('ctrlPortabilityRequest.html'),parametersObject['Width']=0x258,parametersObject['OnLoadCallback']=function(){var sFullName=$('#txtEditClientForenames')['val']()+'\x20'+$('#txtEditClientSurname')['val']();ctrlPortabilityRequest['Load'](sFullName);},parametersObject['ButtonLeftVisible']=!![],parametersObject['ButtonLeftText']='Cancel',parametersObject['ButtonLeftFunction']=function(){return!![];},parametersObject['ButtonCentreVisible']=!![],parametersObject['ButtonCentreText']='Confirm\x20Portability\x20Request',parametersObject['ButtonCentreFunction']=ctrlPortabilityRequest['Confirm'],TriSysApex['UI']['PopupMessage'](parametersObject);},'RemovalRequested':function(dtDateGDPRDeletionRequestReceived){var sDateGDPRDeletionRequestReceived=moment(dtDateGDPRDeletionRequestReceived)['format']('dddd\x20DD\x20MMMM\x20YYYY');$('#ClientEditAccountDetails-RequestRemovalButton')['hide']();var sIcon='<i\x20class=\x22gi\x20gi-remove_2\x22></i>\x20&nbsp;\x20';$('#ClientEditAccountDetails-RequestRemovalMessage')['show']()['html'](sIcon+'Requested\x20removal\x20on\x20'+sDateGDPRDeletionRequestReceived);},'PortabilityRequestReceived':function(dtDateGDPRDataPortabilityRequestReceived){var sDateGDPRDataPortabilityRequestReceived=moment(dtDateGDPRDataPortabilityRequestReceived)['format']('dddd\x20DD\x20MMMM\x20YYYY');$('#ClientEditAccountDetails-PortabilityRequestButton')['hide']();var sIcon='<i\x20class=\x22gi\x20gi-global\x22></i>\x20&nbsp;\x20';$('#ClientEditAccountDetails-PortabilityRequestMessage')['show']()['html'](sIcon+'Portability\x20request\x20received\x20on\x20'+sDateGDPRDataPortabilityRequestReceived);}};$(document)['ready'](function(){ClientEditAccountDetails['Load']();});