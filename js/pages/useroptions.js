var ctrlUserOptions={'Load':function(){if(!ctrlUserOptions['isApexUserOptionsForm']())return;TriSysSDK['CShowForm']['HTMLFieldsCodeInjection'](),TriSysSDK['EntityFormTabs']['AddClickEventHandlers']('user-options-tab-nav-horizontal',!![]),setTimeout(function(){TriSysSDK['Controls']['Button']['Click']('useroptions-form-tab-forms-behaviour');},ctrlUserOptions['Constants']['DelayClickingTabsToPreventScrolling']),ctrlUserOptions['GatherAsynchronousAppSettingsForDisplay'](),TriSysProUI['InitialiseThemesForUserEvents'](),$('.select-select2')['select2'](),ctrlUserOptions['InitialiseWidgets'](),ctrlUserOptions['PopulateGridPagerPosition'](),TriSysApex['UserOptions']['Load'](),ctrlUserOptions['UpdateEvents'](),ctrlUserOptions['DisplayThemeColours'](),ctrlUserOptions['DisplayLoginEMail'](),ctrlUserOptions['SMTPButtons'](),ctrlUserOptions['GridManagementResetButtonSetup'](),ctrlUserOptions['Social']['DisplayStatus'](),ctrlUserOptions['Social']['AddEventHandlers'](),ctrlUserOptions['Language']['Load'](),ctrlUserOptions['DesignerThemes']['Load'](),ctrlUserOptions['LoadFonts'](),ctrlUserOptions['LoadFontWeights'](),ctrlUserOptions['CloudSync']['Load'](),ctrlUserOptions['TaskSettings']['Load']();},'GatherAsynchronousAppSettingsForDisplay':function(){var elemAppSettings=$('#divAppSettings');TriSysApex['UserOptions']['SystemSettings'](function(sHTML){elemAppSettings['html'](sHTML+'<br\x20/>'),ctrlUserOptions['ReadLicenseInformation'](function(license){ctrlUserOptions['AppendLicenseInformation'](elemAppSettings,license);});});},'DisplayThemeColours':function(){$('#user-options-themed-border')['css']('color',TriSysProUI['ThemedBorder']()),$('#user-options-themed-background')['css']('color',TriSysProUI['ThemedBackground']()),$('#user-options-themed-background')['css']('background-color',TriSysProUI['ThemedAlternativeBackColor']()),$('#user-options-themed-navbar')['css']('background-color',TriSysProUI['NavBarInverseColour']()),$('#user-options-themed-navbar-light')['css']('background-color',TriSysProUI['ThemedSidebarBackgroundLight'](0.25)),TriSysApex['Constants']['WhiteLabelPreventThemeChange']&&($('#user-options-themes-block')['hide'](),$('#user-options-pagestyle-block')['hide']());},'DisplayLoginEMail':function(){var userCredentials=TriSysApex['LoginCredentials']['UserCredentials']();if(userCredentials&&userCredentials['LoggedInUser']){var sEMail=userCredentials['LoggedInUser']['FullName'];$('#login-email')['html'](sEMail);var btn=$('#change-login-credentials');btn['show'](),btn['on']('click',ctrlUserOptions['ChangeLoginCredentials']);}},'ChangeLoginCredentials':function(){var parametersObject=new TriSysApex['UI']['ShowMessageParameters']();parametersObject['Title']='Change\x20Login\x20Credentials',parametersObject['Image']='gi-lock',parametersObject['ContentURL']=TriSysApex['Constants']['UserControlFolder']+'ctrlChangeLoginCredentials.html',parametersObject['ButtonRightText']='Cancel',parametersObject['ButtonRightVisible']=!![],parametersObject['ButtonLeftText']='Save',parametersObject['ButtonLeftVisible']=!![],parametersObject['ButtonLeftFunction']=ctrlUserOptions['OnSaveButtonClick'],TriSysApex['UI']['PopupMessage'](parametersObject);},'OnSaveButtonClick':function(){var fnCallback=function(sNewEMail){$('#login-email')['html'](sNewEMail);};return ctrlChangeLoginCredentials['SaveLoginCredentialsButtonClick'](fnCallback),![];},'GridManagementResetButtonSetup':function(){var btn=$('#reset-grid-layouts');btn['on']('click',ctrlUserOptions['GridManagementReset']);},'GridManagementReset':function(){TriSysSDK['Grid']['Persistence']['DeleteAll']();},'SMTPButtons':function(){var btn=$('#test-send-smtp-email');btn['on']('click',ctrlUserOptions['TestSMTPSend']);var btnSetPassword=$('#smtp-server-password-button');btnSetPassword['on']('click',ctrlUserOptions['ChangeSMTPPassword']);},'ChangeSMTPPassword':function(){var sSMTPServerAddress=$('#smtp-server-address')['val'](),sSMTPServerLogin=$('#smtp-server-login')['val']();if(!sSMTPServerAddress||!sSMTPServerLogin){var sMessage='You\x20have\x20not\x20specified\x20your\x20own\x20personal\x20SMTP\x20server\x20and\x20login.\x20Please\x20set\x20these\x20before\x20setting\x20your\x20password.';TriSysApex['UI']['ShowMessage'](sMessage);return;}var parametersObject=new TriSysApex['UI']['ShowMessageParameters']();parametersObject['Title']='Change\x20SMTP\x20Password',parametersObject['Image']='fa-lock',parametersObject['ContentURL']=TriSysApex['Constants']['UserControlFolder']+'ctrlChangeSMTPPassword.html',parametersObject['ButtonRightText']='Cancel',parametersObject['ButtonRightVisible']=!![],parametersObject['ButtonRightFunction']=ctrlUserOptions['RollbackSMTPPasswordChange'],parametersObject['ButtonLeftText']='Save',parametersObject['ButtonLeftVisible']=!![],parametersObject['ButtonLeftFunction']=ctrlUserOptions['VerifySMTPPasswordChange'],TriSysApex['UI']['PopupMessage'](parametersObject);},'RollbackSMTPPasswordChange':function(){var sExistingSMTPPassword=$('#smtp-server-password')['val']();return TriSysApex['Cache']['UserSettingManager']['SetValue']('SMTPServerPassword',sExistingSMTPPassword),!![];},'VerifySMTPPasswordChange':function(){var sExistingSMTPPassword=$('#smtp-server-password')['val'](),sPassword=$('#change-smtp-password-password')['val'](),sPasswordConfirmation=$('#change-smtp-password-password-confirmation')['val'](),sError=null,iMinLength=0x6;if(!sPassword)sError='Please\x20enter\x20a\x20password.';else{if(sPassword['length']<iMinLength)sError='Passwords\x20must\x20be\x20at\x20least\x20'+iMinLength+'\x20characters\x20in\x20length';else{if(sPassword!=sPasswordConfirmation)sError='Passwords\x20do\x20not\x20match';else{if(sPassword==sExistingSMTPPassword)sError='New\x20password\x20is\x20the\x20same\x20as\x20your\x20existing\x20one';}}}if(sError)return TriSysApex['UI']['ShowMessage'](sError),![];TriSysApex['Cache']['UserSettingManager']['SetValue']('SMTPServerPassword',sPassword);var options={'SendPasswordChangeConfirmCode':!![],'Callback':function(){ctrlUserOptions['ConfirmSMTPCodePrompt'](sPassword);},'WaitingMessage':'Sending\x20E-Mail'};ctrlUserOptions['TestSMTPSend'](options);},'ConfirmSMTPCodePrompt':function(sNewPassword){var sMessage='Your\x20SMTP\x20password\x20has\x20been\x20temporarily\x20changed\x20in\x20order\x20to\x20verify\x20that\x20you\x20can\x20receive\x20an\x20e-mail'+'\x20containing\x20your\x20confirmation\x20code.'+'<br/>'+'This\x20e-mail\x20has\x20now\x20been\x20sent\x20to\x20you.'+'<br/>'+'When\x20you\x20receive\x20this,\x20enter\x20the\x20code\x20below:',fnConfirmCode=function(sCode){var payloadObject={};payloadObject['URL']='Customer/ConfirmSMTPPasswordChangeCode',payloadObject['OutboundDataPacket']={'Code':sCode},payloadObject['InboundDataFunction']=function(CConfirmSMTPPasswordChangeCodeResponse){TriSysApex['UI']['HideWait']();if(CConfirmSMTPPasswordChangeCodeResponse){if(CConfirmSMTPPasswordChangeCodeResponse['Success']){$('#smtp-server-password')['val'](sNewPassword),setTimeout(TriSysApex['UI']['CloseModalPopup'],0xa),setTimeout(TriSysApex['UI']['CloseModalPopup'],0x64);var fnGlory=function(){TriSysApex['UI']['ShowMessage']('Your\x20SMTP\x20password\x20has\x20been\x20changed.');};setTimeout(fnGlory,0xc8);}else TriSysApex['UI']['ShowMessage'](CConfirmSMTPPasswordChangeCodeResponse['ErrorMessage']);return;}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlUserOptions.ConfirmSMTPCodePrompt:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);};var sSending='Verifying\x20Code';TriSysApex['UI']['ShowWait'](null,sSending+'...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},options={'Label':'Code','SaveButtonText':'Confirm','Instructions':sMessage};TriSysApex['ModalDialogue']['New']['Popup']('Confirm\x20SMTP\x20Password\x20Change\x20Code','fa-lock',fnConfirmCode,options);},'TestSMTPSend':function(sendOptions){var fnSend=function(){var payloadObject={};payloadObject['URL']='EMail/SendTestSMTPToLoggedInUser';if(sendOptions&&sendOptions['SendPasswordChangeConfirmCode'])payloadObject['OutboundDataPacket']={'SendPasswordChangeConfirmCode':!![]};payloadObject['InboundDataFunction']=function(CSendTestSMTPToLoggedInUserResponse){TriSysApex['UI']['HideWait']();if(CSendTestSMTPToLoggedInUserResponse){if(sendOptions&&sendOptions['Callback'])sendOptions['Callback']();else{if(CSendTestSMTPToLoggedInUserResponse['Success'])TriSysApex['UI']['ShowMessage']('A\x20test\x20e-mail\x20has\x20been\x20sent\x20to\x20you.\x20Please\x20check\x20both\x20your\x20e-mail\x20inbox\x20and\x20spam\x20folders.');else TriSysApex['UI']['ShowMessage'](CSendTestSMTPToLoggedInUserResponse['ErrorMessage']);}return;}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlUserOptions.TestSMTPSend:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);};var sSending='Testing\x20E-Mail';if(sendOptions&&sendOptions['WaitingMessage'])sSending=sendOptions['WaitingMessage'];return TriSysApex['UI']['ShowWait'](null,sSending+'...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject),!![];};if(sendOptions)fnSend();else{var sSMTPServerAddress=$('#smtp-server-address')['val'](),sSMTPServerLogin=$('#smtp-server-login')['val'](),sSMTPServerPassword=$('#smtp-server-password')['val']();if(!sSMTPServerAddress||!sSMTPServerLogin||!sSMTPServerPassword){var sMessage='You\x20have\x20not\x20specified\x20your\x20own\x20personal\x20SMTP\x20settings.\x20Would\x20you\x20still\x20like\x20to\x20test\x20sending\x20an\x20automated\x20e-mail\x20to\x20yourself?';TriSysApex['UI']['questionYesNo'](sMessage,'Incomplete\x20Personal\x20SMTP\x20Settings','Yes',fnSend,'No');return;}fnSend();}},'Social':{'DisplayStatus':function(){var payloadObject={};payloadObject['URL']='SocialNetwork/AssociatedSocialNetworks',payloadObject['OutboundDataPacket']=null,payloadObject['InboundDataFunction']=function(CAssociatedSocialNetworksResponse){CAssociatedSocialNetworksResponse&&(CAssociatedSocialNetworksResponse['Success']&&ctrlUserOptions['Social']['DisplaySocialNetworkStatus'](CAssociatedSocialNetworksResponse['Networks']));},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DisplaySocialNetworkStatus':function(networks){var sPrefix='useroptions-socialnetwork-list-';$('[id^='+sPrefix+']')['each'](function(){$(this)['hide']();});if(networks)for(var i=0x0;i<networks['length'];i++){var network=networks[i],sID=sPrefix+network['toLowerCase']()['replace'](/ /g,'-');$('#'+sID)['show']();}},'AddEventHandlers':function(){if(TriSysPhoneGap['Enabled']()){$('#useroptions-socialnetworks-1')['hide'](),$('#useroptions-socialnetworks-2')['hide']();return;}TriSysWebJobs['SocialNetwork']['CurrentNetworks']=TriSysWebJobs['SocialNetwork']['AllNetworks'];var fnLoadControlHTML=function(){TriSysApex['FormsManager']['loadControlIntoDiv']('useroptions-SocialNetworkButtons','ctrlSocialNetworkLoginButtons.html',function(response,status,xhr){ctrlSocialNetworkLoginButtons['OnSuccessfulLoginFunction']=ctrlUserOptions['Social']['SendToWebAPI'],ctrlSocialNetworkLoginButtons['HelpLabel']('');});};TriSysApex['WhiteLabelling']['LoadJavascriptFile']('js/pages/ctrlSocialNetworkLoginButtons.js',null,fnLoadControlHTML);},'_SocialNetworkButtonsLoadedTests':0x0,'SendToWebAPI':function(provider_name,connection_token,user_token){TriSysApex['UI']['ShowWait'](null,'Associating\x20'+provider_name+'...');var CAssociateSocialNetworkWithLoggedInProfileRequest={'ProviderName':provider_name,'ConnectionToken':connection_token,'UserToken':user_token},payloadObject={};payloadObject['URL']='SocialNetwork/AssociateSocialNetworkWithLoggedInProfile',payloadObject['OutboundDataPacket']=CAssociateSocialNetworkWithLoggedInProfileRequest,payloadObject['InboundDataFunction']=function(CAssociateSocialNetworkWithLoggedInProfileResponse){TriSysApex['UI']['HideWait']();if(CAssociateSocialNetworkWithLoggedInProfileResponse){if(CAssociateSocialNetworkWithLoggedInProfileResponse['Success']){ctrlUserOptions['Social']['DisplayStatus']();return;}else TriSysApex['UI']['ShowMessage'](CAssociateSocialNetworkWithLoggedInProfileResponse['ErrorMessage'],TriSysWebJobs['Constants']['ApplicationName']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlUserOptions.Social.SendToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'RemoveLinkedIn':function(){ctrlUserOptions['Social']['Remove']('LinkedIn');},'RemoveApple':function(){ctrlUserOptions['Social']['Remove']('Apple');},'RemoveTwitter':function(){ctrlUserOptions['Social']['Remove']('Twitter');},'RemoveFacebook':function(){ctrlUserOptions['Social']['Remove']('Facebook');},'RemoveGoogle':function(){ctrlUserOptions['Social']['Remove']('Google');},'RemoveMicrosoft':function(){ctrlUserOptions['Social']['Remove']('Windows\x20Live');},'Remove':function(sSocialNetworkProvider){TriSysApex['UI']['ShowWait'](null,'Removing\x20Association\x20'+sSocialNetworkProvider+'...');var CRemoveAssociationRequest={'ProviderName':sSocialNetworkProvider},payloadObject={};payloadObject['URL']='SocialNetwork/RemoveAssociation',payloadObject['OutboundDataPacket']=CRemoveAssociationRequest,payloadObject['InboundDataFunction']=function(CRemoveAssociationResponse){TriSysApex['UI']['HideWait']();if(CRemoveAssociationResponse){if(CRemoveAssociationResponse['Success']){ctrlUserOptions['Social']['DisplayStatus']();return;}else TriSysApex['UI']['ShowMessage'](CRemoveAssociationResponse['ErrorMessage'],TriSysWebJobs['Constants']['ApplicationName']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlUserOptions.Social.Remove:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);}},'Language':{'Load':function(){TriSysWebJobs['CandidateRegistration']['LoadCountryLookup']('userOptions-Country'),$('#userOptions-Country')['change'](function(e){var sCountry=this['value'];TriSysSDK['Countries']['ChangeCountryAndLanguage'](sCountry);});}},'DesignerThemes':{'Load':function(){var bVisible=TriSysApex['Pages']['Controller']['isDesigner']();!bVisible&&$('li[id^=\x22user-options-designer-only-theme-\x22]')['filter'](function(){$(this)['hide']();});}},'InitialiseWidgets':function(){ctrlUserOptions['EnableSyncCheckBoxClick'](null,'enabled-sync-services');var sFieldStartDateTime='sync-services-StartDateTime';TriSysSDK['CShowForm']['dateTimePicker'](sFieldStartDateTime),TriSysSDK['CShowForm']['setDateTimePickerValue'](sFieldStartDateTime,new Date());var lstProviders=[{'text':'Exchange/Office\x20365','value':0x1},{'text':'Google','value':0x2}];TriSysSDK['CShowForm']['populateComboFromDataSource']('email-service-provider',lstProviders);var fieldDescription={'MinValue':0x1,'MaxValue':0xc,'SpinIncrement':0x1,'DefaultValue':0x2,'Format':'#0'};TriSysSDK['Controls']['NumericSpinner']['Initialise']('sync-services-diary-weeks',fieldDescription);var timezones=TriSysApex['Cache']['InternationalTimeZones']();if(timezones){var sLondon=null;timezones['forEach'](function(sTimezone){if(sTimezone['indexOf']('London')>0x0)sLondon=sTimezone;}),TriSysSDK['CShowForm']['populateComboFromListOfString']('sync-services-timezone',timezones,sLondon);}},'EnableSyncCheckBoxClick':function(e,sID){var bEnabled=TriSysSDK['CShowForm']['CheckBoxValue'](sID,![]);for(var i=0x1;i<=0xa;i++){var elem=$('#synch-services-row'+i);bEnabled?elem['show']():elem['hide']();}e&&ctrlUserOptions['UpdateMailSyncEvent']('Enabled',bEnabled);},'UpdateEvents':function(){$('#email-service-provider')['change'](function(e){var iSyncType=parseInt(this['value']);ctrlUserOptions['UpdateMailSyncEvent']('SyncType',iSyncType);var bExchange=iSyncType==0x1,bGmail=iSyncType==0x2,elemMailServer=$('#sync-services-email-server'),sExchangeURL='https://outlook.office365.com',sGMailURL='https://smtp.gmail.com';if(bExchange)elemMailServer['val'](sExchangeURL);else{if(bGmail)elemMailServer['val'](sGMailURL);}elemMailServer['trigger']('change');}),$('#sync-services-email-server')['change'](function(e){var sMailServer=$(this)['val']();ctrlUserOptions['UpdateMailSyncEvent']('MailServer',sMailServer);}),$('#sync-services-email-login')['change'](function(e){var sMailUsername=$(this)['val']();ctrlUserOptions['UpdateMailSyncEvent']('Username',sMailUsername);}),$('#sync-services-email-password')['change'](function(e){var sMailPassword=$(this)['val']();ctrlUserOptions['UpdateMailSyncEvent']('Password',sMailPassword);});var datePicker=$('#sync-services-StartDateTime')['data']('kendoDateTimePicker');datePicker['bind']('change',function(){var dt=this['value'](),apiFriendlyDate=moment(dt)['format']('YYYY-MM-DDTHH:mm:ss');ctrlUserOptions['UpdateMailSyncEvent']('ExportChangesAfter',apiFriendlyDate);});var numerictextbox=$('#sync-services-diary-weeks')['data']('kendoNumericTextBox');numerictextbox['bind']('change',function(){var iWeeks=this['value']();ctrlUserOptions['UpdateMailSyncEvent']('AppointmentSyncWindow',iWeeks);}),$('#sync-services-timezone')['change'](function(e){var sTimeZoneDisplayName=this['value'];ctrlUserOptions['UpdateMailSyncEvent']('TimeZoneDisplayName',sTimeZoneDisplayName);}),$('#enabled-sync-email')['click'](function(){var bEMail=$(this)['is'](':checked');ctrlUserOptions['UpdateMailSyncEvent']('SyncEMail',bEMail);}),$('#enabled-sync-diary')['click'](function(){var bDiary=$(this)['is'](':checked');ctrlUserOptions['UpdateMailSyncEvent']('SyncAppointment',bDiary);});},'UpdateMailSyncEvent':function(sFieldUpdated,mailSyncObject){var mailSync=TriSysApex['Cache']['UserSettingManager']['GetValue']('MailSync',null);if(!mailSync)mailSync={};else mailSync=JSON['parse'](mailSync);mailSync[sFieldUpdated]=mailSyncObject;var sJSON=JSON['stringify'](mailSync);TriSysApex['Cache']['UserSettingManager']['SetValue']('MailSync',sJSON);},'_LoadedFonts':![],'LoadFonts':function(){var sId='#user-options-font-combo',sFontFamily=$('body')['css']('font-family'),parts=sFontFamily['split'](','),sCurrentFont=parts[0x0]['trim']();sCurrentFont=sCurrentFont['replace'](/\"/g,''),$('#user-options-current-font-name')['text'](sCurrentFont);var iSelectedIndex=0x0,lst=[];TriSysSDK['Fonts']['List']['forEach'](function(fontInformation){lst['push']({'name':fontInformation['name']});if(fontInformation['name']==sCurrentFont)iSelectedIndex=lst['length']-0x1;if(!ctrlUserOptions['_LoadedFonts'])TriSysSDK['Fonts']['Install'](fontInformation['name']);}),ctrlUserOptions['_LoadedFonts']=!![],$(sId)['kendoComboBox']({'dataTextField':'name','dataValueField':'name','dataSource':lst,'index':iSelectedIndex,'clearButton':![],'template':'<span\x20style=\x22font-family:\x20#:\x20data.name\x20#;\x22>#:\x20data.name\x20#</span>','select':ctrlUserOptions['FontSelected']});var fontSelector=$(sId)['data']('kendoComboBox'),input=fontSelector['input'];input['attr']('readonly','readonly');},'FontSelected':function(e){if(e['dataItem']){var dataItem=e['dataItem'],sName=dataItem['name'];$('#user-options-current-font-name')['text'](sName),TriSysSDK['Fonts']['ApplyFontChange'](sName,![]),TriSysApex['Cache']['UserSettingManager']['SetValue'](TriSysSDK['Fonts']['UserSettingName'],sName);}},'LoadFontWeights':function(){var sId='#user-options-fontweight-combo',sFontWeight=$('body')['css']('font-weight');$('#user-options-current-font-weight')['text'](sFontWeight);var iSelectedIndex=0x0,lst=[];TriSysSDK['Fonts']['WeightList']['forEach'](function(fontInformation){lst['push']({'weight':fontInformation['weight']});if(fontInformation['weight']==sFontWeight)iSelectedIndex=lst['length']-0x1;}),$(sId)['kendoComboBox']({'dataTextField':'weight','dataValueField':'weight','dataSource':lst,'index':iSelectedIndex,'clearButton':![],'template':'<span\x20style=\x22font-weight:\x20#:\x20data.weight\x20#;\x22>#:\x20data.weight\x20#</span>','select':ctrlUserOptions['FontWeightSelected']});var fontWeightSelector=$(sId)['data']('kendoComboBox'),input=fontWeightSelector['input'];input['attr']('readonly','readonly');},'FontWeightSelected':function(e){if(e['dataItem']){var dataItem=e['dataItem'],sWeight=dataItem['weight'];$('#user-options-current-font-weight')['text'](sWeight),TriSysSDK['Fonts']['ApplyFontWeightChange'](sWeight),TriSysApex['Cache']['UserSettingManager']['SetValue'](TriSysSDK['Fonts']['UserSettingWeight'],sWeight);}},'CloudSync':{'Load':function(){var sCloudSyncEnabledElement='enabled-cloud-sync',CloudSyncEnabledUserSetting='CloudSyncEnabled',bCloudSyncEnabled=TriSysApex['Cache']['UserSettingManager']['GetValue'](CloudSyncEnabledUserSetting,![]);$('#'+sCloudSyncEnabledElement)['click'](function(){bCloudSyncEnabled=$(this)['is'](':checked'),TriSysApex['Cache']['UserSettingManager']['SetValue'](CloudSyncEnabledUserSetting,bCloudSyncEnabled),ctrlUserOptions['CloudSync']['EnableCloudSyncCheckBoxClick'](bCloudSyncEnabled),ctrlUserOptions['CloudSync']['SendToWebAPICloudSyncSubsystem']({'SettingName':'Enabled','SettingValue':bCloudSyncEnabled});}),TriSysSDK['CShowForm']['SetCheckBoxValue'](sCloudSyncEnabledElement,bCloudSyncEnabled),ctrlUserOptions['CloudSync']['EnableCloudSyncCheckBoxClick'](bCloudSyncEnabled);var sCloudSyncEMailElement='enabled-cloud-sync-email',CloudSyncEMailUserSetting='CloudSyncEMailEnabled';$('#'+sCloudSyncEMailElement)['click'](function(){var bCloudSyncEMailEnabled=$(this)['is'](':checked');TriSysApex['Cache']['UserSettingManager']['SetValue'](CloudSyncEMailUserSetting,bCloudSyncEMailEnabled),ctrlUserOptions['CloudSync']['SendToWebAPICloudSyncSubsystem']({'SettingName':'EMailEnabled','SettingValue':bCloudSyncEMailEnabled});}),TriSysSDK['CShowForm']['SetCheckBoxValue'](sCloudSyncEMailElement,TriSysApex['Cache']['UserSettingManager']['GetValue'](CloudSyncEMailUserSetting,![]));var sCloudSyncCalendarElement='enabled-cloud-sync-calendar',CloudSyncCalendarUserSetting='CloudSyncCalendarEnabled';$('#'+sCloudSyncCalendarElement)['click'](function(){var bCloudSyncCalendarEnabled=$(this)['is'](':checked');TriSysApex['Cache']['UserSettingManager']['SetValue'](CloudSyncCalendarUserSetting,bCloudSyncCalendarEnabled),ctrlUserOptions['CloudSync']['SendToWebAPICloudSyncSubsystem']({'SettingName':'CalendarEnabled','SettingValue':bCloudSyncCalendarEnabled});}),TriSysSDK['CShowForm']['SetCheckBoxValue'](sCloudSyncCalendarElement,TriSysApex['Cache']['UserSettingManager']['GetValue'](CloudSyncCalendarUserSetting,![]));var sCloudSyncContactsElement='enabled-cloud-sync-contacts',CloudSyncContactsUserSetting='CloudSyncContactsEnabled';$('#'+sCloudSyncContactsElement)['click'](function(){var bCloudSyncContactsEnabled=$(this)['is'](':checked');TriSysApex['Cache']['UserSettingManager']['SetValue'](CloudSyncContactsUserSetting,bCloudSyncContactsEnabled),ctrlUserOptions['CloudSync']['SendToWebAPICloudSyncSubsystem']({'SettingName':'ContactsEnabled','SettingValue':bCloudSyncContactsEnabled});}),TriSysSDK['CShowForm']['SetCheckBoxValue'](sCloudSyncContactsElement,TriSysApex['Cache']['UserSettingManager']['GetValue'](CloudSyncContactsUserSetting,![]));var sAuthoriseButtonID='authorise-cloud-sync-account';$('#'+sAuthoriseButtonID)['click'](function(){ctrlUserOptions['CloudSync']['Authorise']();});var bAuthorised=TriSysApex['Cache']['UserSettingManager']['GetValue']('CloudSyncAuthorised',![]);TriSysSDK['CShowForm']['SetCheckBoxValue']('cloud-sync-authorised',bAuthorised);var sAuthorisedDate=TriSysApex['Cache']['UserSettingManager']['GetValue']('CloudSyncAuthorisedDate','');$('#cloud-sync-date-authorised')['text'](sAuthorisedDate);if(bCloudSyncEnabled)ctrlUserOptions['CloudSync']['CheckStatus']();},'EnableCloudSyncCheckBoxClick':function(bEnabled){var iMax=0x6;for(var i=0x1;i<=iMax;i++){var elem=$('#cloud-sync-row'+i);bEnabled?elem['show']():elem['hide']();}},'Authorise':function(){var payloadObject={};payloadObject['URL']='CloudSync/UserAuthenticationURL';const iVersion=0x7e9,iPort=location['port']?parseInt(location['port']):0x0,sApexURL=location['protocol']+'//'+location['hostname']+(iPort!=0x1bb?':'+iPort:'');payloadObject['OutboundDataPacket']={'ApexURL':sApexURL,'Version':iVersion},payloadObject['InboundDataFunction']=function(CUserAuthenticationURLResponse){TriSysApex['UI']['HideWait']();if(CUserAuthenticationURLResponse){if(CUserAuthenticationURLResponse['Success']){var sURL=CUserAuthenticationURLResponse['URL']+TriSysApex['FormsManager']['pageURLTimestampArgumentsToForceNoCache'](CUserAuthenticationURLResponse['URL']);ctrlUserOptions['CloudSync']['OpenOAuth'](sURL);}else TriSysApex['UI']['ShowMessage'](CUserAuthenticationURLResponse['ErrorMessage']);return;}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlUserOptions.CloudSync.Authorise:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);};var sSending='Reading\x20Authorisation\x20Service';TriSysApex['UI']['ShowWait'](null,sSending+'...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'_PopupBrowserWindowName':'TriSysCloudSyncPopupBrowserWindow','_PopupBrowserWindowInstance':null,'OpenOAuth':function(sSecureURL){ctrlUserOptions['CloudSync']['ClosePopupBrowserWindow']();var sTitle='Authorise\x20Access\x20to\x20E-Mail\x20&amp;\x20Calendar',iHeightFactor=0.75,iWidth=0x2bc,iHeight=$(window)['height']()*iHeightFactor,iTop=0x32,iLeft=$(window)['width']()-iWidth,iDefaultHeight=0x2b2;if($(window)['height']()>iTop+iDefaultHeight)iHeight=iDefaultHeight;var dualScreenLeft=window['screenLeft']!=undefined?window['screenLeft']:screen['left'],dualScreenTop=window['screenTop']!=undefined?window['screenTop']:screen['top'],iWidthOfScreen=window['innerWidth']?window['innerWidth']:document['documentElement']['clientWidth']?document['documentElement']['clientWidth']:screen['width'],iHeightOfScreen=window['innerHeight']?window['innerHeight']:document['documentElement']['clientHeight']?document['documentElement']['clientHeight']:screen['height'];iLeft=iWidthOfScreen/0x2-iWidth/0x2+dualScreenLeft,iTop=iHeightOfScreen/0x2-iHeight/0x2+dualScreenTop;var sStatusOptions=',\x20menubar=no,\x20resizable=yes,\x20scrollbars=no,\x20status=no,\x20location=no';ctrlUserOptions['CloudSync']['_PopupBrowserWindowInstance']=window['open'](sSecureURL,ctrlUserOptions['CloudSync']['_PopupBrowserWindowName'],'width='+iWidth+',\x20height='+iHeight+',\x20left='+iLeft+',\x20top='+iTop+sStatusOptions);return;},'ClosePopupBrowserWindow':function(){if(ctrlUserOptions['CloudSync']['_PopupBrowserWindowInstance']){try{ctrlUserOptions['CloudSync']['_PopupBrowserWindowInstance']['close']();}catch(e){}ctrlUserOptions['CloudSync']['_PopupBrowserWindowInstance']=null;}},'ReceivedOAuthWorkflowCompletedMessageFromBrowserPopupWindow':function(sToken){ctrlUserOptions['CloudSync']['ClosePopupBrowserWindow']();var sApp='User\x20Options',sProcess='SignalR',fnCreateMessage=function(sIPAddress,sVersion,sEMail){var sMessage='User:\x20'+sEMail+'\x20ReceivedOAuthWorkflowCompletedMessageFromBrowserPopupWindow:\x20'+'Received\x20Token:\x20'+sToken+'\x20and\x20closed\x20browser\x20popup\x20window?';return sMessage;};TriSysApex['DebugLogging']['LoggedInUserMessage'](sApp,sProcess,fnCreateMessage);if(!sToken){ctrlUserOptions['CloudSync']['RecordSuccessfulAuthorisationStatus'](),ctrlUserOptions['CloudSync']['SupportPortalCompletion']();return;}var payloadObject={};payloadObject['URL']='CloudSync/ExchangeOAuthToken',payloadObject['OutboundDataPacket']={'Token':sToken},payloadObject['InboundDataFunction']=function(CExchangeOAuthTokenResponse){TriSysApex['UI']['HideWait']();if(CExchangeOAuthTokenResponse){var sCommentary='.\x20Web\x20API\x20returned\x20';CExchangeOAuthTokenResponse['Success']?(ctrlUserOptions['CloudSync']['RecordSuccessfulAuthorisationStatus'](),ctrlUserOptions['CloudSync']['SupportPortalCompletion'](),sCommentary+='Success'):(TriSysApex['UI']['ShowMessage'](CExchangeOAuthTokenResponse['ErrorMessage']),sCommentary+='Error:\x20'+CExchangeOAuthTokenResponse['ErrorMessage']);var fnCreateMessage=function(sIPAddress,sVersion,sEMail){var sMessage='User:\x20'+sEMail+'\x20called\x20Web\x20API:\x20'+payloadObject['URL']+sCommentary;return sMessage;};TriSysApex['DebugLogging']['LoggedInUserMessage'](sApp,sProcess,fnCreateMessage);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlUserOptions.CloudSync.ReceivedOAuthWorkflowCompletedMessageFromBrowserPopupWindow:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);};var sSending='Exchanging\x20Secret\x20Tokens';TriSysApex['UI']['ShowWait'](null,sSending+'...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'RecordSuccessfulAuthorisationStatus':function(){var sExtraDetails='';if(ctrlUserOptions['isApexUserOptionsForm']()){var sToday=moment()['format']('dddd\x20DD\x20MMMM\x20YYYY')+'\x20@\x20'+moment()['format']('HH:mm');$('#cloud-sync-date-authorised')['text'](sToday),TriSysSDK['CShowForm']['SetCheckBoxValue']('cloud-sync-authorised',!![]),TriSysApex['Cache']['UserSettingManager']['SetValue']('CloudSyncAuthorised',!![]),TriSysApex['Cache']['UserSettingManager']['SetValue']('CloudSyncAuthorisedDate',sToday),sExtraDetails='<br>'+'Please\x20choose\x20which\x20items\x20you\x20would\x20like\x20to\x20be\x20synchronised.';}TriSysApex['UI']['ShowMessage']('You\x20have\x20successfully\x20authenticated\x20your\x20cloud\x20e-mail\x20supplier\x20to\x20synchronise\x20data\x20with\x20TriSys.'+sExtraDetails);},'SendToWebAPICloudSyncSubsystem':function(CSetEnabledFlagRequest){var payloadObject={};payloadObject['URL']='CloudSync/SetEnabledFlag',payloadObject['OutboundDataPacket']=CSetEnabledFlagRequest,payloadObject['InboundDataFunction']=function(CSetEnabledFlagResponse){if(CSetEnabledFlagResponse){if(CSetEnabledFlagResponse['Success']){}else TriSysApex['UI']['ShowMessage'](CSetEnabledFlagResponse['ErrorMessage']);return;}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('ctrlUserOptions.CloudSync.SendToWebAPICloudSyncSubsystem:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'CheckStatus':function(fnCallback){var payloadObject={};payloadObject['URL']='CloudSync/CheckUserStatus',payloadObject['InboundDataFunction']=function(CCheckUserStatusResponse){if(CCheckUserStatusResponse){if(fnCallback)fnCallback(CCheckUserStatusResponse);else{if(CCheckUserStatusResponse['Success'])ctrlUserOptions['CloudSync']['ReportCheckedStatus'](CCheckUserStatusResponse);else TriSysApex['UI']['ShowMessage'](CCheckUserStatusResponse['ErrorMessage']);}return;}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('ctrlUserOptions.CloudSync.CheckStatus:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'ReportCheckedStatus':function(CCheckUserStatusResponse){if(!CCheckUserStatusResponse['HasAccount']||!CCheckUserStatusResponse['Valid']){$('#cloud-sync-date-authorised')['text'](''),TriSysSDK['CShowForm']['SetCheckBoxValue']('cloud-sync-authorised',![]),TriSysApex['Cache']['UserSettingManager']['SetValue']('CloudSyncAuthorised',![]);var sRe=CCheckUserStatusResponse['HasAccount']?'re-':'';TriSysApex['UI']['ShowMessage']('Please\x20'+sRe+'authorise\x20your\x20cloud\x20e-mail\x20supplier\x20to\x20synchronise\x20data\x20with\x20TriSys.'),$('#user-options-cloud-sync-block')['show'](),setTimeout(function(){TriSysSDK['Controls']['Button']['Click']('useroptions-form-tab-login-credentials');},ctrlUserOptions['Constants']['DelayClickingTabsToPreventScrolling']);}},'SupportPortalCompletion':function(){var formInstance=TriSysApex['FormsManager']['FormInstances']['GetForm']('CloudSync');formInstance&&CloudSync['PostAuthentication']();}},'ReadLicenseInformation':function(fnCallback){var payloadObject={};payloadObject['URL']='Customer/ReadLicense',payloadObject['InboundDataFunction']=function(CReadLicenseResponse){if(CReadLicenseResponse){if(CReadLicenseResponse['Success'])fnCallback(CReadLicenseResponse['License']);else TriSysApex['UI']['ShowMessage'](CReadLicenseResponse['ErrorMessage']);return;}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('ctrlUserOptions.ReadLicenseInformation:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'AppendLicenseInformation':function(elemAppSettings,license){if(!elemAppSettings||!license)return;var sExpiry=moment(license['ExpiryDate'])['format']('dddd\x20DD\x20MMMM\x20YYYY'),fnPart=TriSysApex['UserOptions']['SystemSettingTablePart'],sHTML='<table\x20style=\x22width:100%;\x20line-height:\x2020px;\x20margin-bottom:\x2020px;\x22\x20border=\x220\x22>'+fnPart(!![],'<hr\x20/>')+fnPart(![],'<hr\x20/>')+fnPart(!![],'Licensee')+fnPart(![],license['Licensee'])+fnPart(!![],'Expiry\x20Date')+fnPart(![],sExpiry)+fnPart(!![],'Number\x20of\x20Licenses')+fnPart(![],license['NumberOfLicenses'])+fnPart(!![],'Verified')+fnPart(![],license['Verified']);sHTML+='</table>',elemAppSettings['append'](sHTML);var sCRMCompanyName=$('#crm-company-name')['text']();sCRMCompanyName['toLowerCase']()!==license['Licensee']['toLowerCase']()&&TriSysApex['Toasters']['Error']('DANGER:\x20Licensee\x20does\x20not\x20match\x20CRM\x20company\x20name');},'isApexUserOptionsForm':function(){var formInstance=TriSysApex['FormsManager']['FormInstances']['GetForm']('UserOptions');return formInstance?!![]:![];},'PopulateGridPagerPosition':function(){var sourceKeys=[{'value':'top','text':'Top'},{'value':'bottom','text':'Bottom'},{'value':'both','text':'Both\x20Top\x20and\x20Bottom'}];TriSysSDK['CShowForm']['populateComboFromDataSource']('grid-pager-position',sourceKeys,0x1);},'TaskSettings':{'Load':function(){var sAlarmLeadTimeSetting='Task.AlarmLeadTime',durationOptions={'DefaultPeriod':'minutes','DefaultDurationValue':0xf,'OnChangeEventHandler':function(sFieldID,sLeadTime){TriSysApex['Cache']['UserSettingManager']['SetValue'](sAlarmLeadTimeSetting,sLeadTime);}},sLeadTime=TriSysApex['Cache']['UserSettingManager']['GetValue'](sAlarmLeadTimeSetting);if(sLeadTime){var parts=sLeadTime['split']('\x20'),iAmount=parseInt(parts[0x0]);if(iAmount>0x0&&parts['length']==0x2){var sPeriod=parts[0x1];durationOptions['DefaultPeriod']=sPeriod,durationOptions['DefaultDurationValue']=iAmount;}}TriSysSDK['Controls']['Duration']['Initialise']('userOptions-taskForm-Duration',durationOptions);var sAlarmedSetting='Task.Alarmed',bAlarmed=TriSysApex['Cache']['UserSettingManager']['GetValueBoolean'](sAlarmedSetting,!![]),sCheckBoxID='userOptions-taskForm-set-alarm';TriSysSDK['CShowForm']['SetCheckBoxValue'](sCheckBoxID,bAlarmed),$('#'+sCheckBoxID)['click'](function(){var bAlarmed=$(this)['is'](':checked');TriSysApex['Cache']['UserSettingManager']['SetValue'](sAlarmedSetting,bAlarmed);});var sAlarmSoundSetting='Task.AlarmSound',sSound=TriSysApex['Cache']['UserSettingManager']['GetValue'](sAlarmSoundSetting),sSoundFieldID='userOptions-taskAlarm-Sound',lstAudio=TriSysSDK['Audio']['AudioAssetList'](null,sSound),fnChangeSound=function(value,sText,sFieldID){TriSysApex['Cache']['UserSettingManager']['SetValue'](sAlarmSoundSetting,sText);};TriSysSDK['CShowForm']['populateComboFromDataSource'](sSoundFieldID,lstAudio,0x0,fnChangeSound);if(sSound)TriSysSDK['CShowForm']['SetTextInCombo'](sSoundFieldID,sSound);var btnPlay=$('#userOptions-taskAlarm-Play'),btnStop=$('#userOptions-taskAlarm-Stop');btnPlay['on']('click',function(){var sSoundSelected=TriSysSDK['CShowForm']['GetTextFromCombo'](sSoundFieldID);TriSysSDK['Audio']['PlayTaskAlarmSound'](sSoundSelected,0x1,function(){btnStop['hide'](),btnPlay['show']();}),btnStop['show'](),btnPlay['hide']();}),btnStop['on']('click',function(){TriSysSDK['Audio']['StopPlayingTaskAlarmSound'](),btnStop['hide'](),btnPlay['show']();});var btnCustom=$('#userOptions-taskAlarm-Custom');btnCustom['on']('click',function(){var fnCustomURL=function(sURL){if(sURL){var bValidURL=sURL['indexOf']('https')==0x0&&(sURL['indexOf']('.mp3')>0x0||sURL['indexOf']('.wav')>0x0);if(!bValidURL)TriSysApex['UI']['ShowMessage']('Please\x20enter\x20a\x20valid\x20URL\x20of\x20an\x20mp3\x20or\x20wav\x20file\x20e.g.\x20https://domain/server/file.mp3');else return TriSysApex['Cache']['UserSettingManager']['SetValue'](sAlarmSoundSetting,sURL),lstAudio=TriSysSDK['Audio']['AudioAssetList'](null,sURL),TriSysSDK['CShowForm']['populateComboFromDataSource'](sSoundFieldID,lstAudio,0x0,fnChangeSound),TriSysSDK['CShowForm']['SetTextInCombo'](sSoundFieldID,sURL),!![];}},sMessage='Custom\x20Sound\x20URL',sValue=sSound&&sSound['indexOf']('http')==0x0?sSound:'',options={'Label':'URL','Value':sValue,'Instructions':'Please\x20paste\x20an\x20https://\x20URL\x20pointing\x20to\x20an\x20mp3\x20or\x20wav\x20file\x20which\x20you\x20have\x20tested\x20in\x20your\x20browser.'};TriSysApex['ModalDialogue']['New']['Popup'](sMessage,'gi-globe_af',fnCustomURL,options);});}},'Constants':{'DelayClickingTabsToPreventScrolling':0x1f4}};$(document)['ready'](function(){ctrlUserOptions['Load']();});