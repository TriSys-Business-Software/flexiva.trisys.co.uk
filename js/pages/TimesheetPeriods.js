var TimesheetPeriods={'FrequenciesComboId':'timesheetPeriods-Frequencies','PeriodGridID':'timesheetPeriods-PeriodGrid','IntervalGridID':'timesheetPeriods-IntervalGrid','StartDateID':'timesheetPeriods-StartDate','EndDateID':'timesheetPeriods-EndDate','DaysPerPeriodID':'timesheetPeriods-DaysPerPeriod','NumberOfPeriodsID':'timesheetPeriods-NumberOfPeriods','FrequenciesBlockID':'timesheetPeriods-FrequenciesBlock','AddPeriodBlockID':'timesheetPeriods-AddPeriodBlock','SelectedPeriodID':'timesheetPeriods-SelectedPeriod','PeriodSelectedCounterID':'timesheetPeriods-period-grid-selected-counter','Load':function(){var iFudgeFactor=0x16d,lHeight=$(window)['height']()-iFudgeFactor;$('#timesheetPeriods-Splitter-vertical')['height'](lHeight),$('#timesheetPeriods-Splitter-vertical')['kendoSplitter']({'orientation':'vertical','panes':[{'collapsible':![]}]});var iWidth=$('#timesheetPeriods-Splitter')['width'](),sHalfWidth=iWidth/0x2+'px';$('#timesheetPeriods-Splitter-horizontal')['kendoSplitter']({'panes':[{'collapsible':![],'size':sHalfWidth},{'collapsible':![]}]}),TimesheetPeriods['LoadFrequencies'](),TimesheetPeriods['LoadWidgets']();},'LoadWidgets':function(){TriSysSDK['CShowForm']['datePicker'](TimesheetPeriods['StartDateID']),TriSysSDK['CShowForm']['datePicker'](TimesheetPeriods['EndDateID']);var fieldDescription={'MinValue':0x1,'MaxValue':0x34,'SpinIncrement':0x1,'DefaultValue':0x1,'Format':'0'};TriSysSDK['Controls']['NumericSpinner']['Initialise'](TimesheetPeriods['NumberOfPeriodsID'],fieldDescription),fieldDescription['MaxValue']=0x1f,TriSysSDK['Controls']['NumericSpinner']['Initialise'](TimesheetPeriods['DaysPerPeriodID'],fieldDescription);var lHeight=$('#'+TimesheetPeriods['AddPeriodBlockID'])['height']();$('#'+TimesheetPeriods['FrequenciesBlockID'])['height'](lHeight);},'LoadFrequencies':function(){var payloadObject={};payloadObject['URL']='TimesheetPeriod/Frequencies',payloadObject['OutboundDataPacket']=null,payloadObject['InboundDataFunction']=function(CFrequenciesResponse){TriSysApex['UI']['HideWait']();if(CFrequenciesResponse['Success'])TimesheetPeriods['PopulateFrequenciesCombo'](CFrequenciesResponse['Frequencies']);},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['ShowError']('TimesheetPeriods.LoadFrequencies:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Frequencies...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'PopulateFrequenciesCombo':function(frequencies){var iIndex=0x0,lstFrequencies=TriSysSDK['CShowForm']['generateDataSourceFromListOfString'](frequencies);TriSysSDK['CShowForm']['populateComboFromDataSource'](TimesheetPeriods['FrequenciesComboId'],lstFrequencies,iIndex,TimesheetPeriods['LoadPeriodsAfterFrequencySelection']),TimesheetPeriods['LoadPeriodsAfterFrequencySelection'](frequencies[iIndex]);},'LoadPeriodsAfterFrequencySelection':function(sFrequency){TimesheetPeriods['ClearIntervalGrid'](),TimesheetPeriods['PopulatePeriodGrid'](sFrequency);},'PopulatePeriodGrid':function(sFrequency){var fnRowClickHandler=function(e,gridObject,gridLayout){var lstTimesheetPeriodID=TimesheetPeriods['GetSelectedTimesheetPeriods']();if(lstTimesheetPeriodID['length']>0x0){var sDisplay=lstTimesheetPeriodID['length']+'\x20Period'+(lstTimesheetPeriodID['length']==0x1?'':'s');TimesheetPeriods['DisplaySelectedPeriodAboveIntervalGrid'](sDisplay),TimesheetPeriods['PopulateIntervalGrid'](lstTimesheetPeriodID);}else TimesheetPeriods['ClearIntervalGrid']();},bPopulated=![],fnPostPopulationCallback=function(lRecordCount){!bPopulated&&TriSysSDK['Grid']['SelectFirstRow'](TimesheetPeriods['PeriodGridID']),bPopulated=!![];};TriSysSDK['Grid']['VirtualMode']({'Div':TimesheetPeriods['PeriodGridID'],'ID':TimesheetPeriods['PeriodGridID']-'-GridInstance','Title':'Periods','RecordsPerPage':TriSysApex['UserOptions']['RecordsPerPage'](),'PopulationByFunction':{'API':'TimesheetPeriod/List','Parameters':function(request){request['Frequency']=sFrequency;},'DataTableFunction':function(response){return response['Periods'];}},'Columns':[{'field':'TimesheetPeriodID','title':'TimesheetPeriodID','type':'number','width':0x46,'hidden':!![]},{'field':'StartDate','title':'Start\x20Date','type':'date','format':'{0:ddd\x20dd\x20MMM\x20yyyy\x20}','width':0xc8},{'field':'EndDate','title':'End\x20Date','type':'date','format':'{0:ddd\x20dd\x20MMM\x20yyyy\x20}','width':0xc8},{'field':'Description','title':'Description','type':'string'}],'KeyColumnName':'TimesheetPeriodID','DrillDownFunction':null,'MultiRowSelect':!![],'SingleRowSelect':![],'RowClickHandler':fnRowClickHandler,'PostPopulationCallback':fnPostPopulationCallback,'Grouping':![],'SelectedRowsCounterId':TimesheetPeriods['PeriodSelectedCounterID']});},'PopulateIntervalGrid':function(lstTimesheetPeriodID){TriSysSDK['Grid']['VirtualMode']({'Div':TimesheetPeriods['IntervalGridID'],'ID':TimesheetPeriods['IntervalGridID']-'-GridInstance','Title':'Intervals','RecordsPerPage':TriSysApex['UserOptions']['RecordsPerPage'](),'PopulationByFunction':{'API':'TimesheetPeriod/IntervalList','Parameters':function(request){request['TimesheetPeriodIDList']=lstTimesheetPeriodID;},'DataTableFunction':function(response){return response['Intervals'];}},'Columns':[{'field':'TimesheetPeriodID','title':'TimesheetPeriodID','type':'number','width':0x46,'hidden':!![]},{'field':'TimesheetPeriodIntervalID','title':'TimesheetPeriodIntervalID','type':'number','width':0x46,'hidden':!![]},{'field':'StartDate','title':'Start\x20Date','type':'date','format':'{0:ddd\x20dd\x20MMM\x20yyyy\x20}','width':0xc8},{'field':'EndDate','title':'End\x20Date','type':'date','format':'{0:ddd\x20dd\x20MMM\x20yyyy\x20}','width':0xc8},{'field':'Description','title':'Description','type':'string'}],'KeyColumnName':'TimesheetPeriodIntervalID','DrillDownFunction':null,'MultiRowSelect':![],'SingleRowSelect':!![],'Grouping':![]});},'DisplaySelectedPeriodAboveIntervalGrid':function(sPeriod){$('#'+TimesheetPeriods['SelectedPeriodID'])['text'](sPeriod?':\x20'+sPeriod:'');},'ClearIntervalGrid':function(){TimesheetPeriods['DisplaySelectedPeriodAboveIntervalGrid'](null),TriSysSDK['Grid']['Clear'](TimesheetPeriods['IntervalGridID']);},'DeleteFrequency':function(){TriSysApex['UI']['ShowMessage']('You\x20must\x20be\x20a\x20system\x20administrator\x20to\x20delete\x20frequencies\x20from\x20the\x20admin\x20console.');},'AddPeriod':function(){var sFrequency=TriSysSDK['CShowForm']['GetTextFromCombo'](TimesheetPeriods['FrequenciesComboId']),dtStart=TriSysSDK['CShowForm']['getDatePickerValue'](TimesheetPeriods['StartDateID']),dtEnd=TriSysSDK['CShowForm']['getDatePickerValue'](TimesheetPeriods['EndDateID']),iNumberOfPeriods=parseInt(TriSysSDK['Controls']['NumericSpinner']['GetValue'](TimesheetPeriods['NumberOfPeriodsID'],0x0)),iDaysPerPeriod=parseInt(TriSysSDK['Controls']['NumericSpinner']['GetValue'](TimesheetPeriods['DaysPerPeriodID'],0x0)),sError=null;if(!sFrequency)sError='Frequency';if(!dtStart)sError='Start\x20Date';if(iDaysPerPeriod<=0x0)sError='Days\x20per\x20Period';if(sError){TriSysApex['UI']['ShowMessage'](sError+'\x20must\x20be\x20set.');return;}TimesheetPeriods['GenerateTimesheetPeriods']({'Frequency':sFrequency,'StartDate':dtStart,'EndDate':dtEnd,'NumberOfPeriods':iNumberOfPeriods,'DaysPerPeriod':iDaysPerPeriod});},'GetSelectedTimesheetPeriods':function(){var lst=[],selectedRows=TriSysSDK['Grid']['GetCheckedRows'](TimesheetPeriods['PeriodGridID']);return selectedRows&&selectedRows['length']>0x0&&selectedRows['forEach'](function(row){var lTimesheetPeriodID=row['TimesheetPeriodID'];lst['push'](lTimesheetPeriodID);}),lst;},'DeletePeriod':function(){var lstTimesheetPeriodID=TimesheetPeriods['GetSelectedTimesheetPeriods']();if(lstTimesheetPeriodID['length']==0x0)return;var sMessage='Are\x20you\x20sure\x20that\x20you\x20wish\x20to\x20delete\x20'+lstTimesheetPeriodID['length']+'\x20timesheet\x20period'+(lstTimesheetPeriodID['length']==0x1?'':'s')+'\x20and\x20all\x20intervals?';TriSysApex['UI']['questionYesNo'](sMessage,'Delete\x20Timesheet\x20Periods','Yes',function(){return setTimeout(function(){TimesheetPeriods['DeletePeriodViaWebAPI'](lstTimesheetPeriodID);},0xa),!![];},'No');},'DeletePeriodViaWebAPI':function(lstTimesheetPeriodID){var payloadObject={};payloadObject['URL']='TimesheetPeriod/DeletePeriod',payloadObject['OutboundDataPacket']={'TimesheetPeriodIDList':lstTimesheetPeriodID},payloadObject['InboundDataFunction']=function(CDeletePeriodResponse){TriSysApex['UI']['HideWait']();if(CDeletePeriodResponse['Success'])TimesheetPeriods['RefreshPeriodGrid']();else TriSysApex['UI']['ShowError'](CDeletePeriodResponse['ErrorMessage']);},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['ShowError']('TimesheetPeriods.DeletePeriodViaWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Deleting\x20Timesheet\x20Period...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'RefreshPeriodGrid':function(){var sFrequency=TriSysSDK['CShowForm']['GetTextFromCombo'](TimesheetPeriods['FrequenciesComboId']);TimesheetPeriods['LoadPeriodsAfterFrequencySelection'](sFrequency),$('#'+TimesheetPeriods['PeriodSelectedCounterID'])['text']('');},'GenerateTimesheetPeriods':function(CAddRequest){var payloadObject={};payloadObject['URL']='TimesheetPeriod/Add',payloadObject['OutboundDataPacket']=CAddRequest,payloadObject['InboundDataFunction']=function(CAddResponse){TriSysApex['UI']['HideWait']();if(CAddResponse['Success'])TimesheetPeriods['RefreshPeriodGrid']();else TriSysApex['UI']['ShowError'](CAddResponse['ErrorMessage']);},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['ShowError']('TimesheetPeriods.GenerateTimesheetPeriods:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Generating\x20Timesheet\x20Periods...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);}};$(document)['ready'](function(){TimesheetPeriods['Load']();});