var TriSysActions={'Copyright':{'AllRightsReserved':'TriSys\x20Business\x20Software'},'Menus':{'Draw':function(sDiv,sEntityName,sGetRecordIdsFunction,sGetMasterEntityFunction){var actions=TriSysActions['Data']['Actions'](sEntityName);if(!actions)return;if(actions['length']==0x0)return;var fnReadUserSettingThenAddMenuItems=function(setting){var lstHiddenActions=[];if(setting){if(setting['Value'])lstHiddenActions=setting['Value']['split'](',\x20');}var fnLoadControlHTML=function(){TriSysApex['FormsManager']['loadControlReplacingDiv'](sDiv,'actions/ctrlActionsMenu.html',function(){ctrlActionsMenu['AddMenuItems'](actions,sEntityName,sDiv,sGetRecordIdsFunction,sGetMasterEntityFunction,TriSysActions['Invocation']['Invoke'],sDiv,lstHiddenActions);});};TriSysApex['WhiteLabelling']['LoadJavascriptFile']('usercontrols/actions/ctrlActionsMenu.js',null,fnLoadControlHTML);};TriSysApex['UserOptions']['ReadLoggedInUserSetting']('Hidden\x20Actions',fnReadUserSettingThenAddMenuItems);},'_MenuLoadedTests':0x0,'Popup':function(sEntityName,fnCallback,ignoreActions){var actions=TriSysActions['Data']['Actions'](sEntityName);if(!actions)return;if(actions['length']==0x0)return;var gridActions=[];for(var i=0x0;i<actions['length'];i++){var action=actions[i],bAdd=!![];if(ignoreActions)for(var ig=0x0;ig<ignoreActions['length'];ig++){var ignoreAction=ignoreActions[ig];if(ignoreAction==action['ID'])bAdd=![];}if(bAdd){var actionRow={'ID':action['ID'],'Caption':action['Caption']};gridActions['push'](actionRow);}}var columns=[{'field':'ID','title':'ID','type':'string','hidden':!![]},{'field':'Caption','title':'Action','type':'string'}],sGridID='grdPreviewActions',fnPopulateButtons=function(parametersObject,sGridDivID){parametersObject['ButtonLeftVisible']=![],parametersObject['ButtonRightText']='Close',parametersObject['ButtonRightVisible']=!![];},fnPopulateGrid=function(sGridID){TriSysSDK['Grid']['VirtualMode']({'Div':sGridID,'ID':'grdContactActions','RecordsPerPage':0xa,'PopulationByObject':gridActions,'Columns':columns,'KeyColumnName':'Caption','DrillDownFunction':function(rowData){TriSysApex['UI']['CloseModalPopup'](),fnCallback(rowData['ID']);},'MultiRowSelect':![],'Grouping':TriSysApex['UserOptions']['GridGrouping'](),'ColumnFilters':![],'OpenButtonCaption':'Run'});};TriSysApex['ModalDialogue']['Grid']['Show']('Actions',null,fnPopulateButtons,fnPopulateGrid,{'CloseTopRightButton':!![]});}},'Invocation':{'InvokedActionID':null,'Invoke':function(sActionID,sEntityName,sGetRecordIdsFunction,sGetMasterEntityFunction){TriSysActions['Invocation']['InvokedActionID']=sActionID;var action=TriSysActions['Data']['Action'](sActionID);if(!action)return;var bInsufficientData=![],recordIds=TriSysActions['Invocation']['CallDynamicFunction'](sGetRecordIdsFunction,!![],sEntityName);if(!recordIds)bInsufficientData=!![];else{if(recordIds['length']==0x0)bInsufficientData=!![];else{var objEntityId=recordIds[0x0];if(!objEntityId||parseInt(objEntityId)<=0x0)bInsufficientData=!![];}}if(bInsufficientData){if(!action['AllowInvocationWithNoRecords']){var sMessage='Before\x20running\x20the\x20\x27'+action['Caption']+'\x27\x20action,\x20you\x20must\x20select\x20at\x20least\x20one\x20record.';TriSysApex['UI']['ShowMessage'](sMessage);return;}}TriSysActions['Data']['RecordIdentifierList']=recordIds,TriSysActions['Data']['EntityName']=sEntityName,TriSysActions['Data']['MasterEntityName']=null,TriSysActions['Data']['MasterEntityId']=0x0;if(sGetMasterEntityFunction){var masterEntity=TriSysActions['Invocation']['CallDynamicFunction'](sGetMasterEntityFunction,!![],null);masterEntity&&(TriSysActions['Data']['MasterEntityName']=masterEntity['EntityName'],TriSysActions['Data']['MasterEntityId']=masterEntity['EntityId']);}if(!TriSysActions['Invocation']['PreInvocation'](action))return;TriSysActions['Invocation']['OpenActionForm'](action);},'ActionData':function(){var actionSpecificData=null,sEntityName=null,recordIdentifierList=null,action=TriSysActions['Data']['Action'](TriSysActions['Invocation']['InvokedActionID']);if(action){var sFunction=action['MailMergeDataFunction'];if(sFunction)actionSpecificData=TriSysActions['Invocation']['CallDynamicFunction'](sFunction,!![],null);sEntityName=TriSysActions['Data']['EntityName'],recordIdentifierList=TriSysActions['Data']['RecordIdentifierList'];}else{var userCredentials=TriSysApex['LoginCredentials']['UserCredentials']();if(userCredentials&&userCredentials['LoggedInUser']){var contact=userCredentials['LoggedInUser']['Contact'];contact&&(sEntityName='Contact',recordIdentifierList=[contact['ContactId']]);}}var actionDataObject={'EntityName':sEntityName,'RecordIdentifierList':recordIdentifierList,'MasterEntityName':TriSysActions['Data']['MasterEntityName'],'MasterEntityId':TriSysActions['Data']['MasterEntityId'],'ActionSpecific':actionSpecificData};return actionDataObject;},'OpenActionForm':function(action){var parametersObject=new TriSysApex['UI']['ShowMessageParameters']();parametersObject['Title']='Action:\x20'+action['Caption'],parametersObject['Image']=action['ImagePath'],parametersObject['CloseTopRightButton']=!![];var bAction=!![];parametersObject['ContentURL']=TriSysApex['CustomFormsAndComponents']['UserControlPath'](action['Control'],bAction),parametersObject['ButtonRightText']='Cancel',parametersObject['ButtonRightVisible']=!![];var bAllowedSaveSettings=TriSysApex['Cache']['ApplicationSettingsManager']['Security']['Actions']['SaveSettingsButton']();if(bAllowedSaveSettings){}action['ConfigureFunction']&&bAllowedSaveSettings&&(parametersObject['ButtonCentreText']='Save\x20Settings',parametersObject['ButtonCentreVisible']=!![],parametersObject['ButtonCentreFunction']=function(){TriSysActions['Invocation']['CallDynamicFunction'](action['ConfigureFunction']);});var sFinishCaption=action['FinishCaption']?action['FinishCaption']:'Run';parametersObject['ButtonLeftText']=sFinishCaption,parametersObject['ButtonLeftVisible']=!![],parametersObject['ButtonLeftFunction']=function(){TriSysActions['Invocation']['CallDynamicFunction'](action['FinishFunction']);},parametersObject['VerticalScrollbar']=!![];if(action['MaximumHeight'])parametersObject['MaximumHeight']=action['MaximumHeight'];if(action['FullScreen'])parametersObject['FullScreen']=!![];else parametersObject['Width']=action['MaximumWidth']?action['MaximumWidth']:0x2ee;if(action['Draggable'])parametersObject['Draggable']=!![];parametersObject['OnLoadCallback']=function(){TriSysApex['FormsManager']['EntityUpdateController']['AsynchronousActionFormLoaded'](action);},TriSysApex['UI']['PopupMessage'](parametersObject);},'CallDynamicFunction':function(sDynamicFunction,bParameters,parameters){if(!sDynamicFunction)return;var fn=TriSysApex['DynamicClasses']['GetObject'](sDynamicFunction);if(fn){if(typeof fn==='function')try{if(bParameters)return fn(parameters);else fn();}catch(e){TriSysApex['Logging']['LogMessage'](TriSysApex['Logging']['CatchVariableToText'](e));}}},'PreInvocation':function(action){var sFormName=TriSysApex['FormsManager']['SelectedFormName'];if(sFormName=='Requirement'){if(action['ID']=='AddContactToShortlist'){var lstContactID=TriSysActions['Data']['RecordIdentifierList'];if(lstContactID&&lstContactID['length']>0x0)return ctrlRequirementForm['PreInvocationShortlistAction'](lstContactID),![];}else{if(action['ID']=='AddContactToLonglist'){var lstContactID=TriSysActions['Data']['RecordIdentifierList'];if(lstContactID&&lstContactID['length']>0x0)return ctrlRequirementForm['PreInvocationLonglistAction'](lstContactID),![];}}}return TriSysActions['Invocation']['CustomPreInvocation'](action);},'CustomPreInvocation':function(action){return!![];},'PostInvocationCompletion':function(){TriSysApex['ModalDialogue']['Task']['PostTaskUpdate'](null,!![]);var sFormName=TriSysApex['FormsManager']['SelectedFormName'];switch(sFormName){case'Requirement':if(TriSysActions['Invocation']['InvokedActionID']!='AddContactToShortlist')setTimeout(ctrlRequirementForm['ReloadCandidateGrids'],0xa);break;case'Company':TriSysActions['Invocation']['InvokedActionID']=='CreditCheckRequest'&&TriSysSDK['CShowForm']['SetTextInCombo']('CompanyConfigFields_CreditCheckStatus','Check\x20Requested');break;}},'RunEntityAction':function(sEntityName,lRecordId,sActionID){lRecordId>0x0&&sActionID&&(TriSysApex['FormsManager']['OpenForm'](sEntityName,lRecordId),setTimeout(function(){var action=TriSysActions['Data']['Action'](sActionID);action&&(TriSysActions['Invocation']['InvokedActionID']=action['ID'],TriSysActions['Data']['RecordIdentifierList']=[lRecordId],TriSysActions['Data']['EntityName']=sEntityName,TriSysActions['Data']['MasterEntityName']=null,TriSysActions['Data']['MasterEntityId']=0x0,TriSysActions['Invocation']['OpenActionForm'](action));},TriSysApex['Constants']['LoadEntityDelay']));},'SingletonContactListCheck':function(sAction,sContactType){var actionData=new TriSysActions['Invocation']['ActionData']();if(actionData['EntityName']=='Contact'){if(actionData['RecordIdentifierList']){if(actionData['RecordIdentifierList']['length']>0x1){var sTitle=sAction,sMessage='This\x20action\x20can\x20only\x20process\x20one\x20'+sContactType+'\x20at\x20a\x20time.'+'<br\x20/>'+'Please\x20select\x20only\x20one\x20'+sContactType+'\x20before\x20running\x20this\x20action\x20again.';return setTimeout(function(){TriSysApex['UI']['ShowMessage'](sMessage,sTitle);},0x32),TriSysApex['UI']['CloseModalPopup'](),!![];}}}return![];}},'Data':{'Read':function(){var actions=TriSysApex['Forms']['Configuration']['JsonFileData']('actions.json');return actions;},'Actions':function(sEntityName){var actions=TriSysActions['Data']['Read']();if(!actions)return null;var actionsForThisEntity=[];for(var i=0x0;i<actions['length'];i++){var action=actions[i],entityNames=action['Entities'];if(entityNames['indexOf'](sEntityName)>=0x0)actionsForThisEntity['push'](action);}return actionsForThisEntity;},'Action':function(sID){var actions=TriSysActions['Data']['Read']();if(!actions)return null;for(var i=0x0;i<actions['length'];i++){var action=actions[i];if(action['ID']==sID)return action;}},'RecordIdentifierList':null,'EntityName':null,'MasterEntityName':null,'MasterEntityId':0x0},'Forms':{'Attributes':{'Load':function(sFieldID,sSkillCategory,lstIncludeSkillCategories){var categories=TriSysApex['Cache']['SystemSettingManager']['GeneralSkillCategories']();if(sSkillCategory)categories=[{'Category':sSkillCategory}];else{if(lstIncludeSkillCategories){if(!categories)categories=[];for(var i=0x0;i<lstIncludeSkillCategories['length'];i++){var sSkillCategory=lstIncludeSkillCategories[i],allCategories=TriSysApex['Cache']['SkillCategories']();for(var j=0x0;j<allCategories['length'];j++){var category=allCategories[j];if(category['Category']==sSkillCategory){categories['push'](category);break;}}}}if(!categories)return;}categories['sort'](function(a,b){var s1=a['Category']+'_'+a['Skill'],s2=b['Category']+'_'+b['Skill'];return s1['localeCompare'](s2);});var sourceAttributes=[];for(var i=0x0;i<categories['length'];i++){var category=categories[i],attributes=TriSysApex['Cache']['SkillManager']['SkillsInCategory'](category['Category']);if(attributes)for(var a=0x0;a<attributes['length'];a++){var attribute=attributes[a],sourceStruct={'value':attribute['Skill'],'text':category['Category']+':\x20'+attribute['Skill']};sourceAttributes['push'](sourceStruct);}}TriSysSDK['CShowForm']['populateMultiSelectComboFromDataSource'](sFieldID,sourceAttributes);}},'TaskType':{'Load':function(sFieldID,sImageFieldID,sDefault){TriSysSDK['CShowForm']['TaskTypeCombo'](sFieldID,sImageFieldID,TriSysActions['Forms']['TaskType']['Icon']),sDefault&&(TriSysSDK['CShowForm']['SetTaskTypeComboValue'](sFieldID,sDefault),TriSysActions['Forms']['TaskType']['Icon'](sFieldID,sImageFieldID));},'Icon':function(sFieldId,sImageFieldID){var sTaskType=TriSysSDK['CShowForm']['GetTaskTypeFromCombo'](sFieldId),sImage=TriSysSDK['CShowForm']['TaskTypeImageFile'](sTaskType);sImage+=TriSysApex['FormsManager']['pageURLTimestampArgumentsToForceNoCache'](),$('#'+sImageFieldID)['attr']('src',sImage);}}},'NoteHistory':{'_Loaded':![],'Load':function(sFieldDivTag,defaults){TriSysActions['NoteHistory']['_Loaded']=![];var fnLoadControlHTML=function(){var sPath=TriSysApex['Constants']['UserControlFolder']+'actions/ctrlNoteHistory.html';TriSysApex['FormsManager']['loadPageIntoDiv'](sFieldDivTag,sPath,function(response,status,xhr){ctrlNoteHistory['Load'](),TriSysActions['NoteHistory']['AfterLoadEvent'](sFieldDivTag,defaults),TriSysActions['NoteHistory']['_Loaded']=!![];});};TriSysApex['WhiteLabelling']['LoadJavascriptFile'](TriSysApex['Constants']['UserControlFolder']+'actions/ctrlNoteHistory.js',null,fnLoadControlHTML);},'AfterLoadEvent':function(divTag,defaults){if(defaults){if(defaults['TaskType'])ctrlNoteHistory['SetTaskType'](defaults['TaskType']);if(defaults['Attributes'])ctrlNoteHistory['DisplayAttributes'](defaults['Category']);}}},'FollowUp':{'_Loaded':![],'Load':function(sFieldDivTag,defaults){TriSysActions['FollowUp']['_Loaded']=![];var fnLoadControlHTML=function(){var sPath=TriSysApex['Constants']['UserControlFolder']+'actions/ctrlFollowUp.html';TriSysApex['FormsManager']['loadPageIntoDiv'](sFieldDivTag,sPath,function(response,status,xhr){ctrlFollowUp['Load'](),TriSysActions['FollowUp']['AfterLoadEvent'](sFieldDivTag,defaults),TriSysActions['FollowUp']['_Loaded']=!![];});};TriSysApex['WhiteLabelling']['LoadJavascriptFile'](TriSysApex['Constants']['UserControlFolder']+'actions/ctrlFollowUp.js',null,fnLoadControlHTML);},'AfterLoadEvent':function(divTag,defaults){if(defaults){if(defaults['CreateFollowUp'])ctrlFollowUp['SetCreateFollowUp'](!![]);if(defaults['StartDateTime'])ctrlFollowUp['SetStartDateTime'](defaults['StartDateTime']);if(defaults['AlarmLeadTime'])ctrlFollowUp['SetAlarmLeadTime'](defaults['AlarmLeadTime']);if(defaults['Attributes'])ctrlFollowUp['DisplayAttributes'](defaults['Category']);}},'FollowUpDateTomorrow':function(){var dtNow=new Date(),dtFollowUp=new Date(moment(dtNow)['add'](0x1,'days')),iHour=moment(dtFollowUp)['hour'](),iYear=moment(dtFollowUp)['year'](),iMonth=moment(dtFollowUp)['month'](),iDay=moment(dtFollowUp)['date']();return dtFollowUp=new Date(iYear,iMonth,iDay,iHour,0x0,0x0,0x0),dtFollowUp;}},'MailMerge':{'MasterTemplateFolder':'Master\x20Templates/','ClientTemplatesFolder':'Client/','CandidateTemplatesFolder':'Candidate/','None':'no\x20template\x20-\x20do\x20not\x20merge','LastPopulationCriteria':null,'PopulateTemplates':function(sTitle,sFolder,sComboID,sDefaultTemplate,sButtonTemplateEditor,fnSelectTemplateCallback){TriSysActions['MailMerge']['LastPopulationCriteria']={'Title':sTitle,'Folder':sFolder,'ComboID':sComboID};var fnCallback=function(lstTemplates){TriSysActions['MailMerge']['DisplayTemplatesInCombo'](lstTemplates,sTitle,sFolder,sComboID,sDefaultTemplate,sButtonTemplateEditor,fnSelectTemplateCallback);};TriSysActions['MailMerge']['ReadTemplatesFromWebAPI'](sFolder,fnCallback);},'GetTemplateFromCombo':function(sComboID){var sTemplate=TriSysSDK['CShowForm']['GetTextFromCombo'](sComboID);if(sTemplate&&sTemplate!=TriSysActions['MailMerge']['None'])return sTemplate;return null;},'ReadTemplatesFromWebAPI':function(sFolder,fnCallback){var CListMailMergeTemplatesRequest={'Folder':sFolder},payloadObject={};payloadObject['URL']='Files/ListMailMergeTemplates',payloadObject['OutboundDataPacket']=CListMailMergeTemplatesRequest,payloadObject['InboundDataFunction']=function(CListMailMergeTemplatesResponse){TriSysApex['UI']['HideWait']();if(CListMailMergeTemplatesResponse){if(CListMailMergeTemplatesResponse['Success']){fnCallback(CListMailMergeTemplatesResponse['Templates']);return;}else TriSysApex['UI']['ShowMessage'](CListMailMergeTemplatesResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('TriSysActions.MailMerge.ReadTemplatesFromWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Templates...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DisplayTemplatesInCombo':function(lstTemplates,sTitle,sFolder,sComboID,sDefaultTemplate,sButtonTemplateEditor,fnSelectTemplateCallback){sButtonTemplateEditor&&$('#'+sButtonTemplateEditor)['on']('click',function(){TriSysActions['MailMerge']['EditTemplate'](sTitle,sFolder,sComboID);});var dsTemplates=[{'value':0x0,'text':TriSysActions['MailMerge']['None']}],iIndex=0x0;if(lstTemplates)for(var i=0x0;i<lstTemplates['length'];i++){var sTemplate=lstTemplates[i],sourceStruct={'value':sTemplate,'text':sTemplate};dsTemplates['push'](sourceStruct);if(sTemplate['toLowerCase']()==sDefaultTemplate['toLowerCase']())iIndex=i+0x1;}TriSysSDK['CShowForm']['populateComboFromDataSource'](sComboID,dsTemplates,iIndex,fnSelectTemplateCallback);},'EditTemplate':function(sTitle,sFolder,sComboID){TriSysActions['MailMerge']['Folder']=sFolder,TriSysActions['MailMerge']['Template']=null;var sTemplate=TriSysSDK['CShowForm']['GetTextFromCombo'](sComboID);if(sTemplate!=TriSysActions['MailMerge']['None'])TriSysActions['MailMerge']['Template']=sTemplate;var parametersObject=new TriSysApex['UI']['ShowMessageParameters']();parametersObject['Title']=sTitle+'\x20Action\x20Templates',parametersObject['Image']='gi-edit',parametersObject['CloseTopRightButton']=!![],parametersObject['ContentURL']=TriSysApex['Constants']['UserControlFolder']+'actions/ctrlTemplateEditor.html',parametersObject['ButtonRightText']='Cancel',parametersObject['ButtonRightVisible']=!![],parametersObject['ButtonLeftText']='Select',parametersObject['ButtonLeftVisible']=!![],parametersObject['ButtonLeftFunction']=function(){var sTemplate=ctrlTemplateEditor['SelectButtonClick']();if(sTemplate){var lastCriteria=TriSysActions['MailMerge']['LastPopulationCriteria'];return TriSysActions['MailMerge']['PopulateTemplates'](lastCriteria['Title'],lastCriteria['Folder'],lastCriteria['ComboID'],sTemplate),!![];}},parametersObject['FullScreen']=!![],parametersObject['Draggable']=![],TriSysApex['UI']['PopupMessage'](parametersObject);},'Folder':null,'Template':null,'PopulateAttachments':function(sMultiSelectComboID,sButtonAttachmentManager){var fnCallback=function(lstAttachments){TriSysActions['MailMerge']['DisplayAttachmentsInMultiSelectCombo'](lstAttachments,sMultiSelectComboID,sButtonAttachmentManager);};TriSysActions['MailMerge']['ReadAttachmentsFromWebAPI'](fnCallback);},'DisplayAttachmentsInMultiSelectCombo':function(lstAttachments,sComboID,sButtonAttachmentManager){sButtonAttachmentManager&&$('#'+sButtonAttachmentManager)['on']('click',function(){TriSysApex['UI']['ShowMessage']('Attachments\x20can\x20be\x20added\x20or\x20removed\x20from\x20the\x20document\x20manager\x20in\x20the\x20administrator\x20console.');});var sourceAttachments=[];if(lstAttachments)for(var i=0x0;i<lstAttachments['length'];i++){var attachment=lstAttachments[i],sourceStruct={'value':attachment,'text':attachment};sourceAttachments['push'](sourceStruct);}TriSysSDK['CShowForm']['populateMultiSelectComboFromDataSource'](sComboID,sourceAttachments);},'ReadAttachmentsFromWebAPI':function(fnCallback){var payloadObject={};payloadObject['URL']='Files/ListMailMergeAttachments',payloadObject['OutboundDataPacket']=null,payloadObject['InboundDataFunction']=function(CListMailMergeAttachmentsResponse){TriSysApex['UI']['HideWait']();if(CListMailMergeAttachmentsResponse){if(CListMailMergeAttachmentsResponse['Success']){fnCallback(CListMailMergeAttachmentsResponse['Attachments']);return;}else TriSysApex['UI']['ShowMessage'](CListMailMergeAttachmentsResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('TriSysActions.MailMerge.ReadAttachmentsFromWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Attachments...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DisplayContactDetails':function(contactList,sContactID){var sContact='';if(contactList&&contactList['length']==0x1){var contact=contactList[0x0];sContact=contact['FullName'];if(contact['ContactType']=='Client'){if(contact['CompanyName'])sContact+=',\x20'+contact['CompanyName'];}else{if(contact['HomeAddressStreet'])sContact+=',\x20'+contact['HomeAddressStreet']['replace'](/\r\n/g,',\x20');if(contact['HomeAddressCity'])sContact+=',\x20'+contact['HomeAddressCity'];}}else{if(contactList){sContact=contactList['length']+'\x20contacts\x20including\x20';var iMaxContactsToDisplay=0x4;for(var i=0x0;i<contactList['length'];i++){var contact=contactList[i];if(sContact['length']>0x0)sContact+=',\x20';sContact+=contact['FullName'];if(contact['ContactType']=='Client'){if(contact['CompanyName'])sContact+='\x20['+contact['CompanyName']+']';}else{var sAddress='';if(contact['HomeAddressStreet'])sAddress='\x20['+contact['HomeAddressStreet']['replace'](/\r\n/g,',\x20');if(contact['HomeAddressCity'])sAddress+=',\x20'+contact['HomeAddressCity'];if(sAddress)sAddress+=']';sContact+=sAddress;}if(i==iMaxContactsToDisplay){if(contactList['length']>i+0x1)sContact+='...';break;}}}}$('#'+sContactID)['html'](sContact);}},'PlacementTimesheetMerge':{'DisplayPlacementDetails':function(placements,sID){var sPlacements=placements['length']+'\x20Placement'+(placements['length']==0x1?'':'s');$('#'+sID)['html'](sPlacements);}},'EMail':{'EMailClientSideMessages':[],'EMailClientSideOptions':null,'SendDialogue':function(messageList,options){TriSysApex['UI']['CloseModalPopup']();var bOutlook=![];if(bOutlook){var sName='Outlook',sDocumentPath='https://api.trisys.co.uk/file\x20viewer/test.eml';TriSysApex['ModalDialogue']['DocumentViewer']['DownloadAndOpen'](sName,sDocumentPath);}else TriSysActions['EMail']['EMailClientSideMessages']=messageList,TriSysActions['EMail']['EMailClientSideOptions']=options,setTimeout(TriSysActions['EMail']['Popup'],0x32);},'Popup':function(){var parametersObject=new TriSysApex['UI']['ShowMessageParameters']();parametersObject['Title']='Send\x20E-Mail',parametersObject['Image']='fa-envelope-o',parametersObject['CloseTopRightButton']=!![],parametersObject['ContentURL']=TriSysApex['Constants']['UserControlFolder']+'actions/ctrlSendEMail.html',parametersObject['ButtonLeftText']='Send',parametersObject['ButtonLeftVisible']=!![],parametersObject['ButtonLeftFunction']=function(){var bSent=ctrlSendEMail['Send']();return bSent;},parametersObject['ButtonCentreText']='Send\x20All',parametersObject['ButtonCentreVisible']=!![],parametersObject['ButtonCentreFunction']=function(){var bSent=ctrlSendEMail['SendAllRemaining']();return bSent;},parametersObject['ButtonRightText']='Cancel',parametersObject['ButtonRightVisible']=!![],parametersObject['FullScreen']=!![],parametersObject['Draggable']=![],TriSysApex['UI']['PopupMessage'](parametersObject);}},'Persistence':{'Write':function(settings){var sMessage,fnWritePersistedConfiguration=function(settings,bDefault,bTemplateOnly){var CPersistedActionWriteConfigurationRequest={'ActionName':TriSysActions['Invocation']['InvokedActionID'],'Settings':JSON['stringify'](settings),'Default':bDefault,'TemplateOnly':bTemplateOnly},payloadObject={};payloadObject['URL']='Action/WritePersistedConfiguration',payloadObject['OutboundDataPacket']=CPersistedActionWriteConfigurationRequest,payloadObject['InboundDataFunction']=function(CPersistedActionWriteConfigurationResponse){if(CPersistedActionWriteConfigurationResponse){if(CPersistedActionWriteConfigurationResponse['Success']){sMessage='Your\x20action\x20settings\x20have\x20been\x20saved'+(bDefault?'\x20for\x20all\x20users':'\x20for\x20only\x20you')+'.',TriSysApex['Toasters']['Success'](sMessage);return;}else TriSysApex['UI']['ShowMessage'](CPersistedActionWriteConfigurationResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('TriSysActions.Persistence.Write:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);};if(TriSysApex['Cache']['UserGroupManager']['SystemAdministrator']()){var sSaveSelected='Save\x20selected\x20template\x20settings\x20for\x20',Option_1=sSaveSelected+'all\x20users',Option_2=sSaveSelected+'me\x20only',fnSave=function(sOption){switch(sOption){case Option_1:fnWritePersistedConfiguration(settings,!![],!![]);break;case Option_2:fnWritePersistedConfiguration(settings,![],!![]);break;default:setTimeout(function(){TriSysApex['UI']['ShowMessage']('ToDo');},0x64);}return!![];},sMessage='Save\x20Action\x20Settings',options={'Instructions':'Please\x20choose\x20from\x20one\x20of\x20the\x20following\x20options:<br><br>','ComboLabel':'Save\x20Option','ComboList':[Option_1,Option_2],'ComboSelectedItem':Option_1};TriSysApex['ModalDialogue']['Combo']['Popup'](sMessage,'gi-floppy_save',fnSave,options);}else fnWritePersistedConfiguration(settings,![]);},'Read':function(fnCallback,options){var CPersistedActionReadConfigurationRequest={'ActionName':TriSysActions['Invocation']['InvokedActionID']},payloadObject={};payloadObject['URL']='Action/ReadPersistedConfiguration',payloadObject['OutboundDataPacket']=CPersistedActionReadConfigurationRequest,payloadObject['InboundDataFunction']=function(CPersistedActionReadConfigurationResponse){if(CPersistedActionReadConfigurationResponse){if(CPersistedActionReadConfigurationResponse['Success']){var sSettings=CPersistedActionReadConfigurationResponse['Settings'];if(sSettings&&fnCallback){var json=JSON['parse'](sSettings);options&&(json['Default']=options['Template']),fnCallback(json);}return;}else TriSysApex['UI']['ShowMessage'](CPersistedActionReadConfigurationResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['Logging']['LogMessage']('TriSysActions.Persistence.Read:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);}},'EntityListManagement':{'AddRecordIdToEntityList':function(lRecordId,entityList){if(entityList['indexOf'](lRecordId)<0x0)entityList['push'](lRecordId);},'RemoveRecordIdsFromEntityList':function(recordIds,entityList){if(!recordIds)return;for(var i=0x0;i<recordIds['length'];i++){var lRecordId=recordIds[i],iIndex=entityList['indexOf'](lRecordId);if(iIndex>=0x0)entityList['splice'](iIndex,0x1);}}},'SMTPChecking':{'PreventContinueWithoutSMTPCredentials':function(sActionName,options){var iFieldCount=0x0,iFieldsSet=0x0,fnUserSettingCheck=function(setting){iFieldCount+=0x1;if(setting){if(setting['Value'])iFieldsSet+=0x1;}if(iFieldCount==0x3){if(iFieldsSet<iFieldCount){var fnCloseActionForm=function(){return setTimeout(TriSysApex['UI']['CloseModalPopup'],0x64),!![];},sMessage='You\x20have\x20not\x20configured\x20your\x20SMTP\x20e-mail\x20settings.\x20Please\x20do\x20this\x20in\x20Administration/User\x20Options\x20and\x20retry.';TriSysApex['UI']['ShowMessage'](sMessage,sActionName,fnCloseActionForm);}else{if(options){if(options['callbackIfOKToProceed'])options['callbackIfOKToProceed']();}}}};TriSysApex['UserOptions']['ReadLoggedInUserSetting']('SMTPServerAddress',fnUserSettingCheck),TriSysApex['UserOptions']['ReadLoggedInUserSetting']('SMTPServerLogin',fnUserSettingCheck),TriSysApex['UserOptions']['ReadLoggedInUserSetting']('SMTPServerPassword',fnUserSettingCheck);}},'PersistedSettingsSafeguard':{'WaitUntilTaskControlsAreLoaded':function(bCheckNoteHistory,bCheckFollowUp,fnCallback){var fnReloadTasks=function(){var bNoteHistoryLoaded=!![],bFollowUpLoaded=!![];if(bCheckNoteHistory)bNoteHistoryLoaded=!(typeof ctrlNoteHistory==TriSysApex['Constants']['Undefined']);if(bCheckFollowUp)bFollowUpLoaded=!(typeof ctrlFollowUp==TriSysApex['Constants']['Undefined']);var bBothLoaded=bNoteHistoryLoaded&&TriSysActions['NoteHistory']['_Loaded']&&bFollowUpLoaded&&TriSysActions['FollowUp']['_Loaded'];if(!bBothLoaded)setTimeout(fnReloadTasks,0xfa);else setTimeout(fnCallback,0x32);};setTimeout(fnReloadTasks,0x64);}}};