var ctrlColdCall={'Load':function(){ctrlColdCall['SetHeightOfScript'](),ctrlColdCall['LoadScripts'](),ctrlColdCall['PopulateActionData'](),$('#ctrlColdCall-previous-contact')['on']('click',ctrlColdCall['PreviousContact']),$('#ctrlColdCall-next-contact')['on']('click',ctrlColdCall['NextContact']),$('#ctrlColdCall-Contact-Button-Lead')['on']('click',ctrlColdCall['Lead']),$('#ctrlColdCall-Contact-Button-Reject')['on']('click',ctrlColdCall['Reject']),$('#ctrlColdCall-Contact-Button-Dead')['on']('click',ctrlColdCall['Dead']),$('#ctrlColdCall-Contact-Button-Callback')['on']('click',ctrlColdCall['Callback']),ctrlColdCall['LoadDefaults']();},'LoadDefaults':function(){TriSysSDK['Titles']['LoadCombo']('ctrlColdCall-Contact-Title'),TriSysActions['Forms']['Attributes']['Load']('ctrlColdCall-Lead-Attributes'),TriSysActions['Forms']['Attributes']['Load']('ctrlColdCall-Reject-Attributes'),TriSysActions['Forms']['Attributes']['Load']('ctrlColdCall-Dead-Attributes'),TriSysActions['Forms']['Attributes']['Load']('ctrlColdCall-Callback-Attributes'),ctrlColdCall['SetupFieldsForAutoUpdate']();},'PopulateActionData':function(){var actionDataObject=new TriSysActions['Invocation']['ActionData'](),lstContactId=actionDataObject['RecordIdentifierList'];ctrlColdCall['_Numbers']['Total']=lstContactId['length'],ctrlColdCall['_Numbers']['CurrentIndex']=0x1,ctrlColdCall['_Numbers']['List']=lstContactId,ctrlColdCall['LoadContactUsingNumbers']();},'_Numbers':{'Total':0x0,'CurrentIndex':0x0,'List':null},'LoadContactUsingNumbers':function(){var sNumbers='#'+ctrlColdCall['_Numbers']['CurrentIndex']+'\x20of\x20'+ctrlColdCall['_Numbers']['Total'];$('#ctrlColdCall-Numbers')['html'](sNumbers),ctrlColdCall['LoadCurrentContact']();},'PreviousContact':function(){ctrlColdCall['ForceTabToNextField']();if(ctrlColdCall['_Numbers']['CurrentIndex']==0x1)return;ctrlColdCall['_Numbers']['CurrentIndex']--,ctrlColdCall['LoadContactUsingNumbers']();},'NextContact':function(){ctrlColdCall['ForceTabToNextField']();if(ctrlColdCall['_Numbers']['CurrentIndex']==ctrlColdCall['_Numbers']['Total'])return;ctrlColdCall['_Numbers']['CurrentIndex']++,ctrlColdCall['LoadContactUsingNumbers']();},'Lead':function(){ctrlColdCall['ForceTabToNextField'](),ctrlColdCall['SubmitActionButtonClick']('Lead');},'Reject':function(){ctrlColdCall['ForceTabToNextField'](),ctrlColdCall['SubmitActionButtonClick']('Reject');},'Dead':function(){ctrlColdCall['ForceTabToNextField'](),ctrlColdCall['SubmitActionButtonClick']('Dead');},'Callback':function(){ctrlColdCall['ForceTabToNextField'](),ctrlColdCall['SubmitActionButtonClick']('Callback');},'SetHeightOfScript':function(){var iFrameID='ctrlColdCall-Script-Frame',frame_element=document['getElementById'](iFrameID);frame_element['style']['height']='1px';var iKludgeFactor=0x17c,iFrameHeight=$(window)['height']()-iKludgeFactor;frame_element['style']['height']=iFrameHeight+'px';},'ShowSelectedScript':function(sScriptName){var sURL=null;ctrlColdCall['_CallScripts']&&$['each'](ctrlColdCall['_CallScripts'],function(index,script){if(script['Name']==sScriptName)sURL=script['URL'];});var sFrameID='ctrlColdCall-Script-Frame',frame_element=document['getElementById'](sFrameID);if(!frame_element)return;if(sURL)frame_element['src']=sURL;else{var sHTML='Unable\x20to\x20view\x20'+sScriptName,iframeElementContainer=frame_element['contentDocument'];iframeElementContainer['open'](),iframeElementContainer['writeln'](sHTML),iframeElementContainer['close']();}},'_CallScripts':null,'_CannedCommentPrefix':'','LoadScripts':function(){var payloadObject={};payloadObject['URL']='Action/ColdCall',payloadObject['InboundDataFunction']=function(CColdCallActionResponse){TriSysApex['UI']['HideWait']();if(CColdCallActionResponse){if(CColdCallActionResponse['Success']){ctrlColdCall['_CallScripts']=CColdCallActionResponse['Scripts'];if(ctrlColdCall['_CallScripts']){var scripts=[];$['each'](ctrlColdCall['_CallScripts'],function(index,script){scripts['push'](script['Name']);}),ctrlColdCall['LoadScriptsIntoCombo'](scripts);}ctrlColdCall['PopulateCannedComments'](CColdCallActionResponse['CannedComments'],'ctrlColdCall-CannedComments');if(CColdCallActionResponse['CannedCommentPrefix'])ctrlColdCall['_CannedCommentPrefix']=CColdCallActionResponse['CannedCommentPrefix'];CColdCallActionResponse['ProcessAttributes']&&$['each'](CColdCallActionResponse['ProcessAttributes'],function(index,attributes){TriSysSDK['CShowForm']['SetSkillsInList']('ctrlColdCall-'+attributes['Process']+'-Attributes',attributes['Skills']);});}else TriSysApex['UI']['ShowMessage'](CColdCallActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlColdCall.LoadScripts:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Loading\x20Call\x20Scripts...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'LoadScriptsIntoCombo':function(scripts){var fnChange=function(sScriptName){var sHTML='<h1>Loading\x20'+sScriptName+'...</h1>';ctrlColdCall['ShowSelectedScript'](sScriptName);};TriSysSDK['CShowForm']['populateComboFromListOfString']('ctrlColdCall-ScriptTemplate',scripts,scripts[0x0],fnChange),fnChange(scripts[0x0]);},'PopulateCannedComments':function(cannedComments,sComboId){if(!cannedComments)return;$('#'+sComboId)['show']();var fnSelectCan=function(sCan){if(!sCan||sCan=='')return;var elemComments=$('#ctrlColdCall-Contact-Comments'),sText=elemComments['val']()+'\x0a'+ctrlColdCall['_CannedCommentPrefix']+sCan;elemComments['val'](sText);var CDataWhat={'Field':'Comments','Value':sText};ctrlColdCall['UpdateSpecificField'](CDataWhat);},sDefaultCan='';cannedComments['unshift'](sDefaultCan),TriSysSDK['CShowForm']['populateComboFromListOfString'](sComboId,cannedComments,sDefaultCan,fnSelectCan);},'Completed':function(){TriSysActions['Invocation']['PostInvocationCompletion']();},'LoadCurrentContact':function(){var lContactId=ctrlColdCall['_Numbers']['List'][ctrlColdCall['_Numbers']['CurrentIndex']-0x1],CReadColdCallClientRequest={'ContactId':lContactId},payloadObject={};payloadObject['URL']='Contact/ReadColdCallClient',payloadObject['OutboundDataPacket']=CReadColdCallClientRequest,payloadObject['InboundDataFunction']=function(CReadColdCallClientResponse){TriSysApex['UI']['HideWait']();if(CReadColdCallClientResponse){if(CReadColdCallClientResponse['Success']){var contact=CReadColdCallClientResponse['Client'];ctrlColdCall['DisplayContactDetails'](contact);}else TriSysApex['UI']['ShowMessage'](CReadColdCallClientResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlColdCall.LoadCurrentContact:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DisplayContactDetails':function(contact){TriSysSDK['CShowForm']['SetTextInCombo']('ctrlColdCall-Contact-Title',contact['Title']),$('#ctrlColdCall-Contact-Forenames')['val'](contact['Forenames']),$('#ctrlColdCall-Contact-Surname')['val'](contact['Surname']),$('#ctrlColdCall-Contact-Company')['val'](contact['CompanyName']),$('#ctrlColdCall-Contact-JobTitle')['val'](contact['JobTitle']),$('#ctrlColdCall-Contact-WorkTelNo')['val'](contact['WorkTelNo']),$('#ctrlColdCall-Contact-MobileTelNo')['val'](contact['WorkMobileTelNo']),$('#ctrlColdCall-Contact-WorkEMail')['val'](contact['WorkEMail']);var dtLastUpdated=contact['LastUpdated'];$('#ctrlColdCall-Contact-LastUpdated')['html'](moment(dtLastUpdated)['format']('dddd\x20DD\x20MMMM\x20YYYY')),$('#ctrlColdCall-Contact-Comments')['val'](contact['Comments']),$('#ctrlColdCall-Contact-CompanySwitchboard')['val'](contact['CompanySwitchboard']);try{TriSysSDK['CShowForm']['SetValueInCombo']('ctrlColdCall-CannedComments','');}catch(e){}},'SubmitActionButtonClick':function(sButtonName){var lContactId=ctrlColdCall['_Numbers']['List'][ctrlColdCall['_Numbers']['CurrentIndex']-0x1],sField='ctrlColdCall-'+sButtonName+'-Attributes',sAttributes=TriSysSDK['CShowForm']['GetSelectedSkillsFromList'](sField),CSubmitColdCallResultRequest={'ContactId':lContactId,'Process':sButtonName,'Attributes':sAttributes},payloadObject={};payloadObject['URL']='Action/SubmitColdCallResult',payloadObject['OutboundDataPacket']=CSubmitColdCallResultRequest,payloadObject['InboundDataFunction']=function(CSubmitColdCallResultResponse){if(CSubmitColdCallResultResponse){if(CSubmitColdCallResultResponse['Success']){var dtLastUpdated=new Date();$('#ctrlColdCall-Contact-LastUpdated')['html'](moment(dtLastUpdated)['format']('dddd\x20DD\x20MMMM\x20YYYY')),ctrlColdCall['NextContact']();}else TriSysApex['UI']['ShowMessage'](CSubmitColdCallResultResponse['ErrorMessage']);}else TriSysApex['UI']['ShowMessage']('No\x20response\x20from\x20'+payloadObject['URL']);},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlColdCall.SubmitActionButtonClick:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'SetupFieldsForAutoUpdate':function(){$('#ctrlColdCall-Contact-Title')['change'](function(e){var CDataWhat={'Field':'Title','Value':$(this)['val']()};ctrlColdCall['UpdateSpecificField'](CDataWhat);}),$('#ctrlColdCall-Contact-Forenames')['change'](function(e){var CDataWhat={'Field':'Forenames','Value':$(this)['val']()};ctrlColdCall['UpdateSpecificField'](CDataWhat);}),$('#ctrlColdCall-Contact-Surname')['change'](function(e){var CDataWhat={'Field':'Surname','Value':$(this)['val']()};ctrlColdCall['UpdateSpecificField'](CDataWhat);}),$('#ctrlColdCall-Contact-Company')['change'](function(e){var CDataWhat={'Field':'Company','Value':$(this)['val']()};ctrlColdCall['UpdateSpecificField'](CDataWhat);}),$('#ctrlColdCall-Contact-JobTitle')['change'](function(e){var CDataWhat={'Field':'JobTitle','Value':$(this)['val']()};ctrlColdCall['UpdateSpecificField'](CDataWhat);}),$('#ctrlColdCall-Contact-WorkTelNo')['change'](function(e){var CDataWhat={'Field':'WorkTelNo','Value':$(this)['val']()};ctrlColdCall['UpdateSpecificField'](CDataWhat);}),$('#ctrlColdCall-Contact-WorkEMail')['change'](function(e){var CDataWhat={'Field':'WorkEMail','Value':$(this)['val']()};ctrlColdCall['UpdateSpecificField'](CDataWhat);}),$('#ctrlColdCall-Contact-MobileTelNo')['change'](function(e){var CDataWhat={'Field':'MobileTelNo','Value':$(this)['val']()};ctrlColdCall['UpdateSpecificField'](CDataWhat);}),$('#ctrlColdCall-Contact-CompanySwitchboard')['change'](function(e){var CDataWhat={'Field':'CompanySwitchboard','Value':$(this)['val']()};ctrlColdCall['UpdateSpecificField'](CDataWhat);}),$('#ctrlColdCall-Contact-Comments')['change'](function(e){var CDataWhat={'Field':'Comments','Value':$(this)['val']()};ctrlColdCall['UpdateSpecificField'](CDataWhat);});},'UpdateSpecificField':function(CUpdateColdCallClientFieldRequest){CUpdateColdCallClientFieldRequest['ContactId']=ctrlColdCall['_Numbers']['List'][ctrlColdCall['_Numbers']['CurrentIndex']-0x1];var payloadObject={};payloadObject['URL']='Contact/UpdateColdCallClientField',payloadObject['OutboundDataPacket']=CUpdateColdCallClientFieldRequest,payloadObject['InboundDataFunction']=function(CUpdateColdCallClientFieldResponse){if(CUpdateColdCallClientFieldResponse){if(CUpdateColdCallClientFieldResponse['Success']){var dtLastUpdated=new Date();$('#ctrlColdCall-Contact-LastUpdated')['html'](moment(dtLastUpdated)['format']('dddd\x20DD\x20MMMM\x20YYYY'));}else TriSysApex['UI']['ShowMessage'](CUpdateColdCallClientFieldResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlColdCall.UpdateSpecificField:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'ForceTabToNextField':function(){$('#ctrlColdCall-Contact-Comments')['focus'](),$('#ctrlColdCall-Contact-Forenames')['focus']();}};$(document)['ready'](function(){ctrlColdCall['Load']();});