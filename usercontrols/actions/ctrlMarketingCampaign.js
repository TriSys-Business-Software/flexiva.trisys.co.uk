var ctrlMarketingCampaign={'ContactID':'ctrlMarketingCampaign-Contact','CampaignGrid':'ctrlMarketingCampaign-campaigns-grid','Load':function(){ctrlMarketingCampaign['DisplayContacts'](),ctrlMarketingCampaign['LoadCampaigns']();},'DisplayContacts':function(){var actionData=new TriSysActions['Invocation']['ActionData']();actionData['EntityName']=='Contact'&&(actionData['RecordIdentifierList']&&$('#'+ctrlMarketingCampaign['ContactID'])['text'](actionData['RecordIdentifierList']['length']));},'LoadCampaigns':function(){$('#ctrlMarketingCampaign-add-campaign-button')['off']()['on']('click',function(){ctrlMarketingCampaign['AddCampaign']();}),$('#ctrlMarketingCampaign-clone-campaign-button')['off']()['on']('click',function(){ctrlMarketingCampaign['CloneCampaign']();});var userCredentials=TriSysApex['LoginCredentials']['UserCredentials'](),sUserName=userCredentials['LoggedInUser']['ForenameAndSurname'],fnPopulationByFunction={'API':'Marketing/ListCampaigns','Parameters':function(request){request['UserNames']='\x27'+sUserName+'\x27';},'DataTableFunction':function(response){return response['List'];}};ctrlMarketingCampaign['LoadCampaignGrid'](ctrlMarketingCampaign['CampaignGrid'],fnPopulationByFunction);},'LoadCampaignGrid':function(sGrid,fnPopulationByFunction){TriSysSDK['Grid']['VirtualMode']({'Div':sGrid,'ID':sGrid,'Title':'Campaigns','RecordsPerPage':TriSysApex['UserOptions']['RecordsPerPage'](),'PopulationByFunction':fnPopulationByFunction,'Columns':[{'field':'MarketingCampaignId','title':'Id','type':'number','width':0x46,'hidden':!![]},{'field':'Name','title':'Campaign\x20Name','type':'string'},{'field':'Description','title':'Description','type':'string'},{'field':'Created','title':'Created','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}'},{'field':'Updated','title':'Last\x20Updated','type':'date','format':'{0:dd\x20MMM\x20yyyy\x20}'},{'field':'UserName','title':'User','type':'string'}],'KeyColumnName':'MarketingCampaignId','MultiRowSelect':!![],'Grouping':![],'ColumnFilters':!![]});},'GetSelectedSingletonMarketingCampaignIdFromGrid':function(){var lMarketingCampaignId=TriSysSDK['Grid']['GetSelectedSingletonRowRecordIdFromGrid'](ctrlMarketingCampaign['CampaignGrid'],'MarketingCampaignId','marketing\x20campaign');return lMarketingCampaignId;},'GetSelectedNameFromGrid':function(){var sName=TriSysSDK['Grid']['GetSelectedSingletonRowFieldValueFromGrid'](ctrlMarketingCampaign['CampaignGrid'],'Name');return sName;},'AddCampaign':function(){var fnNewCampaign=function(){var fnOpenCampaign=function(){TriSysApex['FormsManager']['OpenForm']('Campaigns',0x0,!![]);var fnOpenSpecificCampaign=function(){Campaigns['LoadCampaignRecord'](0x0,'New');};setTimeout(fnOpenSpecificCampaign,0x7d0);};return setTimeout(fnOpenCampaign,0x32),setTimeout(TriSysApex['UI']['CloseModalPopup'],0xa),!![];},sMessage='Create\x20a\x20new\x20marketing\x20campaign?';TriSysApex['UI']['questionYesNo'](sMessage,'Marketing\x20Campaign\x20Action','Yes',fnNewCampaign,'No');},'CloneCampaign':function(){var lMarketingCampaignId=ctrlMarketingCampaign['GetSelectedSingletonMarketingCampaignIdFromGrid']();if(lMarketingCampaignId<=0x0)return;var fnClonedCampaign=function(sNewName){return ctrlMarketingCampaign['CloneMarketingCampaign'](lMarketingCampaignId,sNewName),!![];},sMessage='Cloned\x20Marketing\x20Campaign',options={'Label':'Name'};TriSysApex['ModalDialogue']['New']['Popup'](sMessage,'fa-envelope-o',fnClonedCampaign,options);},'CloneMarketingCampaign':function(lMarketingCampaignId,sNewName){var CCloneCampaignRequest={'MarketingCampaignId':lMarketingCampaignId,'Name':sNewName},payloadObject={};payloadObject['URL']='Marketing/CloneCampaign',payloadObject['OutboundDataPacket']=CCloneCampaignRequest,payloadObject['InboundDataFunction']=function(CCloneCampaignResponse){if(CCloneCampaignResponse){if(CCloneCampaignResponse['Success'])ctrlMarketingCampaign['LoadCampaigns']();else TriSysApex['UI']['ShowMessage'](CCloneCampaignResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['ErrorHandlerRedirector']('ctrlMarketingCampaign.CloneMarketingCampaign:\x20',request,status,error);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'Finish':function(){var lMarketingCampaignId=ctrlMarketingCampaign['GetSelectedSingletonMarketingCampaignIdFromGrid']();if(lMarketingCampaignId<=0x0)return;ctrlMarketingCampaign['SendActionDataToWebAPI'](lMarketingCampaignId);},'SendActionDataToWebAPI':function(lMarketingCampaignId){var actionData=new TriSysActions['Invocation']['ActionData'](),CAddContactsToCampaignRecipientsRequest={'Contacts':actionData['RecordIdentifierList'],'MarketingCampaignId':lMarketingCampaignId},sCampaignName=ctrlMarketingCampaign['GetSelectedNameFromGrid'](),payloadObject={};payloadObject['URL']='Marketing/AddContactsToCampaignRecipients',payloadObject['OutboundDataPacket']=CAddContactsToCampaignRecipientsRequest,payloadObject['InboundDataFunction']=function(CAddContactsToCampaignRecipientsResponse){TriSysApex['UI']['HideWait']();if(CAddContactsToCampaignRecipientsResponse){if(CAddContactsToCampaignRecipientsResponse['Success']){TriSysActions['Invocation']['PostInvocationCompletion']();var fnViewCampaign=function(){var fnOpenCampaign=function(){TriSysApex['FormsManager']['OpenForm']('Campaigns',lMarketingCampaignId,!![]);var fnOpenSpecificCampaign=function(){Campaigns['LoadCampaignRecord'](lMarketingCampaignId,sCampaignName);};setTimeout(fnOpenSpecificCampaign,0x7d0);};return setTimeout(fnOpenCampaign,0xa),!![];},sMessage=CAddContactsToCampaignRecipientsResponse['AddedCount']+'\x20contacts/recipients\x20added\x20to\x20marketing\x20campaign:\x20'+sCampaignName+'<br/>'+'View\x20campaign?';TriSysApex['UI']['questionYesNo'](sMessage,'Marketing\x20Campaign\x20Action','Yes',fnViewCampaign,'No');return;}else TriSysApex['UI']['ShowMessage'](CAddContactsToCampaignRecipientsResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlMarketingCampaign.SendActionDataToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Assigning\x20Contacts...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);}};$(document)['ready'](function(){ctrlMarketingCampaign['Load']();});