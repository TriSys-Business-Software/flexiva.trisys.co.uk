var ctrlPlacement={'ClientID':'ctrlPlacement-Client','RequirementID':'ctrlPlacement-Requirement','CandidateID':'ctrlPlacement-Candidate','StartDateID':'ctrlPlacement-StartDate','EndDateID':'ctrlPlacement-EndDate','SalaryID':'ctrlPlacement-Salary','NoteHistoryID':'ctrlPlacement-NoteHistory','FollowUpID':'ctrlPlacement-FollowUp','CandidateList':null,'Load':function(){var defaults={'TaskType':'Placement','Attributes':!![],'Category':'Placement'};TriSysActions['NoteHistory']['Load'](ctrlPlacement['NoteHistoryID'],defaults),TriSysSDK['CShowForm']['datePicker'](ctrlPlacement['StartDateID'],function(dt){ctrlPlacement['CalculateDurationWeeks']();}),TriSysSDK['CShowForm']['datePicker'](ctrlPlacement['EndDateID'],function(dt){ctrlPlacement['CalculateDurationWeeks']();});var fSpinIncrement=0x1f4,sPeriod='Annum';TriSysSDK['Controls']['CurrencyAmountPeriod']['PopulateCurrencyAmountPeriodWidget'](ctrlPlacement['SalaryID'],fSpinIncrement,sPeriod);var dtFollowUp=TriSysActions['FollowUp']['FollowUpDateTomorrow']();defaults={'CreateFollowUp':!![],'StartDateTime':dtFollowUp,'Attributes':!![],'Category':'Placement'},TriSysActions['FollowUp']['Load'](ctrlPlacement['FollowUpID'],defaults),ctrlPlacement['PopulateActionData']();},'PopulateActionData':function(){if(TriSysActions['Invocation']['SingletonContactListCheck']('Placement','candidate'))return;var CReadCVSendDetailsActionRequest=new TriSysActions['Invocation']['ActionData'](),payloadObject={};payloadObject['URL']='Action/ReadCVSendDetails',payloadObject['OutboundDataPacket']=CReadCVSendDetailsActionRequest,payloadObject['InboundDataFunction']=function(CReadCVSendDetailsActionResponse){TriSysApex['UI']['HideWait']();if(CReadCVSendDetailsActionResponse){if(CReadCVSendDetailsActionResponse['Success']){ctrlPlacement['DisplayClientContactDetails'](CReadCVSendDetailsActionResponse['ClientContact']),ctrlPlacement['DisplayCandidateDetails'](CReadCVSendDetailsActionResponse['CandidateContacts']),ctrlPlacement['DisplayRequirementDetails'](CReadCVSendDetailsActionResponse['Requirement']);if(!CReadCVSendDetailsActionResponse['CandidateContacts']||CReadCVSendDetailsActionResponse['CandidateContacts']['length']>0x1){var sMessage='Only\x20one\x20candidate\x20can\x20be\x20placed\x20using\x20this\x20action.',fnOK=function(){return TriSysActions['Invocation']['PostInvocationCompletion'](),!![];};TriSysApex['UI']['ShowMessage'](sMessage,'Multiple\x20Candidates',fnOK);return;}if(CReadCVSendDetailsActionResponse['Requirement']){TriSysSDK['CShowForm']['setDatePickerValue'](ctrlPlacement['StartDateID'],CReadCVSendDetailsActionResponse['Requirement']['EarliestStartDate']);var sType=CReadCVSendDetailsActionResponse['Requirement']['Type'],sAttribute='Placement:\x20'+sType;ctrlNoteHistory['SetAttributes'](sAttribute);}ctrlFollowUp['SetAttributes']('Placement:\x20Check\x20in'),TriSysActions['Persistence']['Read'](ctrlPlacement['ReadPersistedSettingsCallback']);return;}else TriSysApex['UI']['ShowMessage'](CReadCVSendDetailsActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlPlacement.PopulateActionData:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Contacts...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DisplayClientContactDetails':function(contact){var sContact=contact['FullName'];if(contact['CompanyName'])sContact+=',\x20'+contact['CompanyName'];$('#'+ctrlPlacement['ClientID'])['html'](sContact);},'DisplayCandidateDetails':function(contactList){ctrlPlacement['CandidateList']=contactList;var sContact='';if(contactList&&contactList['length']==0x1){var contact=contactList[0x0];sContact=contact['FullName'];if(contact['HomeAddressStreet'])sContact+=',\x20'+contact['HomeAddressStreet']['replace'](/\r\n/g,',\x20');if(contact['HomeAddressCity'])sContact+=',\x20'+contact['HomeAddressCity'];}else{if(contactList)for(var i=0x0;i<contactList['length'];i++){var contact=contactList[i];if(sContact['length']>0x0)sContact+=',\x20';sContact+=contact['FullName'];}}$('#'+ctrlPlacement['CandidateID'])['html'](sContact);},'DisplayRequirementDetails':function(requirement){if(requirement){$('#'+ctrlPlacement['RequirementID'])['html'](requirement['Reference']+':\x20'+requirement['JobTitle']);if(requirement['Type']=='Permanent')TriSysSDK['Controls']['CurrencyAmountPeriod']['SetCurrencyAmountPeriod'](ctrlPlacement['SalaryID'],requirement['Salary']),$('#ctrlPlacement-EndDate-tr')['hide'](),$('#ctrlPlacement-DurationWeeks-tr')['hide']();else $('#ctrlPlacement-Salary-tr')['hide']();}else $('#ctrlPlacement-Requirement-tr')['hide']();},'Configure':function(){var mySettings=ctrlPlacement['GetSettings']();if(!mySettings)return;TriSysActions['Persistence']['Write'](mySettings);},'GetSettings':function(){var mySettings={'NoteHistory':ctrlNoteHistory['Validation'](),'FollowUp':ctrlFollowUp['Validation']()};return mySettings;},'ReadPersistedSettingsCallback':function(mySettings){TriSysActions['PersistedSettingsSafeguard']['WaitUntilTaskControlsAreLoaded'](!![],!![],function(){ctrlNoteHistory['Reload'](mySettings['NoteHistory']),ctrlFollowUp['Reload'](mySettings['FollowUp']);});},'Finish':function(){var mySettings=ctrlPlacement['GetSettings']();if(!mySettings)return;var NoteHistoryData=ctrlNoteHistory['Validation']();if(!NoteHistoryData)return;var FollowUpData=ctrlFollowUp['Validation']();if(!FollowUpData)return;var sError=null,dtStart=TriSysSDK['CShowForm']['getDatePickerValue'](ctrlPlacement['StartDateID']),dtEnd=TriSysSDK['CShowForm']['getDatePickerValue'](ctrlPlacement['EndDateID']),iDurationWeeks=$('#ctrlPlacement-DurationWeeks')['val'](),bOpenPlacement=TriSysSDK['CShowForm']['CheckBoxValue']('ctrlPlacement-OpenPlacement'),sSalary=TriSysSDK['Controls']['CurrencyAmountPeriod']['GetCurrencyAmountPeriod'](ctrlPlacement['SalaryID']);if(!dtStart)sError='Please\x20specify\x20a\x20start\x20date.';else{var bVisible=$('#'+ctrlPlacement['EndDateID'])['is'](':visible');if(bVisible){if(!dtEnd){var bIgnoreMandatoryField=TriSysApex['LoginCredentials']['isLoggedInToSpecificCompanyAsRecruiter']('TQS\x20Blu\x20Limited');if(!bIgnoreMandatoryField)sError='Please\x20specify\x20an\x20end\x20date.';}}}if(sError)return TriSysApex['UI']['ShowMessage'](sError),null;mySettings['StartDate']=dtStart,mySettings['EndDate']=dtEnd,mySettings['DurationWeeks']=iDurationWeeks,mySettings['Salary']=sSalary,mySettings['OpenPlacement']=bOpenPlacement,ctrlPlacement['SendActionDataToWebAPI'](mySettings,NoteHistoryData,FollowUpData);},'SendActionDataToWebAPI':function(mySettings,NoteHistoryData,FollowUpData){var CPlacementActionRequest={'StartDate':mySettings['StartDate'],'EndDate':mySettings['EndDate'],'DurationWeeks':mySettings['DurationWeeks'],'Salary':mySettings['Salary'],'ActionData':new TriSysActions['Invocation']['ActionData'](),'NoteHistory':NoteHistoryData,'FollowUp':FollowUpData},payloadObject={};payloadObject['URL']='Action/Placement',payloadObject['OutboundDataPacket']=CPlacementActionRequest,payloadObject['InboundDataFunction']=function(CPlacementActionResponse){TriSysApex['UI']['HideWait']();if(CPlacementActionResponse){if(CPlacementActionResponse['Success']){TriSysActions['Invocation']['PostInvocationCompletion']();mySettings['OpenPlacement']&&CPlacementActionResponse['PlacementId']>0x0&&TriSysApex['FormsManager']['OpenForm']('Placement',CPlacementActionResponse['PlacementId']);return;}else TriSysApex['UI']['ShowMessage'](CPlacementActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlPlacement.SendActionDataToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Generating\x20Placement...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'CalculateDurationWeeks':function(){var sDurationWeeks='',dtStart=new moment(TriSysSDK['CShowForm']['getDatePickerValue'](ctrlPlacement['StartDateID'])),dtEnd=new moment(TriSysSDK['CShowForm']['getDatePickerValue'](ctrlPlacement['EndDateID'])),iWeeks=dtEnd['diff'](dtStart,'weeks');if(iWeeks>=0x0)sDurationWeeks=iWeeks;$('#ctrlPlacement-DurationWeeks')['val'](sDurationWeeks);}};$(document)['ready'](function(){ctrlPlacement['Load']();});