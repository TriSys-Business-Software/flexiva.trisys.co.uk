var ctrlTemplateEditor={'Load':function(){var sFolder=TriSysActions['MailMerge']['Folder'];TriSysActions['MailMerge']['ReadTemplatesFromWebAPI'](sFolder,ctrlTemplateEditor['DisplayAvailableTemplates']),ctrlTemplateEditor['InitialiseDocumentEditor'](!![]),ctrlTemplateEditor['InitialiseImageLibrary'](),ctrlTemplateEditor['InitialiseMergeFields'](),ctrlTemplateEditor['InitialiseZoomSlider'](),$('#template-editor-new')['on']('click',function(){ctrlTemplateEditor['NewTemplate']();}),$('#template-editor-copy')['on']('click',function(){ctrlTemplateEditor['CopyTemplate']();}),$('#template-editor-delete')['on']('click',function(){ctrlTemplateEditor['DeleteTemplate']();}),$('#template-editor-image-add')['on']('click',function(){ctrlTemplateEditor['AddImage']();}),$('#template-editor-image-delete')['on']('click',function(){ctrlTemplateEditor['DeleteImage']();}),$('#template-editor-save')['on']('click',function(){ctrlTemplateEditor['SaveTemplate']();}),$('#template-editor-preview-checkbox')['on']('click',function(){var bShowPreview=$(this)['is'](':checked');$('#template-editor-container')['toggle'](),$('#template-editor-save')['toggle'](),$('#template-editor-merged-document')['toggle'](),$('#template-editor-merged-document-zoom')['toggle'](),ctrlTemplateEditor['ShowPreviewIfEnabled']();var sEditorCaption=bShowPreview?'Preview':'Editor';$('#template-editor-document-edit-caption')['html'](sEditorCaption),TriSysApex['Cache']['ApplicationSettingsManager']['Security']['Apply']['PostLogin'](null);}),ctrlTemplateEditor['SizeAlgorithm'](),TriSysApex['Cache']['ApplicationSettingsManager']['Security']['Apply']['PostLogin'](null),setTimeout(function(){kendo['ui']['icon']($('.trisys-field-link'),{'icon':'link'});},0x3e8);},'isPreviewEnabled':function(){var bShowPreview=TriSysSDK['CShowForm']['GetCheckBoxValue']('template-editor-preview-checkbox',![]);return bShowPreview;},'ShowPreviewIfEnabled':function(){if(ctrlTemplateEditor['isPreviewEnabled']())ctrlTemplateEditor['MergePreview']();},'InitialiseDocumentEditor':function(bFullPage){TriSysSDK['Froala']['InitialiseEditor']({'ID':'template-editor','FullPage':bFullPage,'DropEnabled':!![],'HTML':''});},'DragDropEvents':{'onDragStart':function(e){var body=$(document['body']),editorWrapper=$('#template-editor-container');if(!e['sender']['dataItem'](e['sourceNode'])['value'])e['preventDefault']();else try{kendo['ui']['progress'](editorWrapper,!![]);}catch(e){}},'onDrag':function(e){var body=$(document['body']),editorWrapper=$('#template-editor-container');$(e['dropTarget'])['closest'](editorWrapper)[0x0]?e['setStatusClass']('k-icon\x20k-i-unlink-horizontal'):e['setStatusClass']('k-denied');},'onDropField':function(e){var editorWrapper=$('#template-editor-container');if($(e['dropTarget'])['closest'](editorWrapper)[0x0]){e['preventDefault']();var sField='{{'+e['sender']['dataItem'](e['sourceNode'])['value']+'}}';$('#template-editor')['froalaEditor']('html.insert',sField,!![]);}try{kendo['ui']['progress'](editorWrapper,![]);}catch(e){}},'onDropImage':function(e){var body=$(document['body']),editorWrapper=$('#template-editor-container');if($(e['dropTarget'])['closest'](editorWrapper)[0x0]){e['preventDefault']();var img='<img\x20src=\x22'+e['sender']['dataItem'](e['sourceNode'])['imageUrl']+'\x22\x20alt=\x22image\x22\x20/>';$('#template-editor')['froalaEditor']('html.insert',img,!![]);}kendo['ui']['progress'](editorWrapper,![]);}},'InitialiseImageLibrary':function(){var CListMailMergeImagesRequest={'Folder':''},payloadObject={};payloadObject['URL']='Files/ListMailMergeImages',payloadObject['OutboundDataPacket']=CListMailMergeImagesRequest,payloadObject['InboundDataFunction']=function(CListMailMergeImagesResponse){if(CListMailMergeImagesResponse){if(CListMailMergeImagesResponse['Success']){ctrlTemplateEditor['LoadImageLibraryData'](CListMailMergeImagesResponse['Images']);return;}else TriSysApex['UI']['ShowMessage'](CListMailMergeImagesResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('ctrlTemplateEditor.InitialiseImageLibrary:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'LoadImageLibraryData':function(lstImages){if(!lstImages||lstImages['length']==0x0)return;var imageData=[];for(var i=0x0;i<lstImages['length'];i++){var sImage=lstImages[i],parts=sImage['split']('/'),sName='\x20\x20\x20\x20'+parts[parts['length']-0x1],item={'text':sName,'value':sName,'imageUrl':sImage};imageData['push'](item);}var treeID='#template-editor-tree-images',treeview=$(treeID)['data']('kendoTreeView');if(!treeview)$(treeID)['kendoTreeView']({'dataSource':imageData,'dataTextField':'text','dataValueField':'value','dragAndDrop':!![],'dragstart':ctrlTemplateEditor['DragDropEvents']['onDragStart'],'drag':ctrlTemplateEditor['DragDropEvents']['onDrag'],'drop':ctrlTemplateEditor['DragDropEvents']['onDropImage']});else treeview['dataSource']['data'](imageData);},'InitialiseMergeFields':function(){var sFolder=TriSysActions['MailMerge']['Folder'],actionData=new TriSysActions['Invocation']['ActionData'](),actionSpecificData=null;if(actionData)actionSpecificData=actionData['ActionSpecific'];var CMailMergeFieldsRequest={'Folder':sFolder,'ActionSpecific':actionSpecificData},payloadObject={};payloadObject['URL']='Action/MailMergeFields',payloadObject['OutboundDataPacket']=CMailMergeFieldsRequest,payloadObject['InboundDataFunction']=function(CMailMergeFieldsResponse){if(CMailMergeFieldsResponse){if(CMailMergeFieldsResponse['Success']){ctrlTemplateEditor['DisplayMergeFields'](CMailMergeFieldsResponse['FieldCategories']);return;}else TriSysApex['UI']['ShowMessage'](CMailMergeFieldsResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('ctrlTemplateEditor.InitialiseMergeFields:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DisplayMergeFields':function(lstFieldCategories){if(!lstFieldCategories||lstFieldCategories['length']==0x0)return;var sSprite='k-i-link-horizontal',fieldData=[];for(var i=0x0;i<lstFieldCategories['length'];i++){var category=lstFieldCategories[i],fields=category['Fields'],fieldItems=[];if(fields)for(var f=0x0;f<fields['length'];f++){var field=fields[f],fieldItem={'text':field['Name'],'value':field['Value'],'isField':!![]};fieldItems['push'](fieldItem);}var categoryItem={'text':category['Name'],'value':null,'expanded':category['Expanded'],'items':fieldItems};fieldData['push'](categoryItem);}var treeID='#template-editor-tree-fields',treeview=$(treeID)['data']('kendoTreeView');if(!treeview)$(treeID)['kendoTreeView']({'dataSource':fieldData,'dataTextField':'text','dataValueField':'value','template':kendo['template']($('#template-editor-fields-template')['html']()),'dragAndDrop':!![],'dragstart':ctrlTemplateEditor['DragDropEvents']['onDragStart'],'drag':ctrlTemplateEditor['DragDropEvents']['onDrag'],'drop':ctrlTemplateEditor['DragDropEvents']['onDropField']}),treeview=$(treeID)['data']('kendoTreeView'),treeview['templates']['dragClue']=kendo['template']('<div\x20class=\x27k-header\x20k-drag-clue\x27><span\x20class=\x27k-icon\x20k-drag-status\x27/>#:\x20data.item.text\x20#</div>');else treeview['dataSource']['data'](fieldData);},'InitialiseZoomSlider':function(){var slider=$('#template-editor-form-slider')['kendoSlider']({'increaseButtonTitle':'Right','decreaseButtonTitle':'Left','min':0x19,'max':0x190,'smallStep':0x19,'largeStep':0x32,'change':ctrlTemplateEditor['ZoomDocumentPreviewEventHandler']})['data']('kendoSlider');},'ZoomDocumentPreviewEventHandler':function(e){var fZoom=e['value']/0x64,lFixedHeight=0x258,viewerDOMObject=$('#template-editor-merged-document');if(viewerDOMObject['css']('display')!='none'){var lHeight=viewerDOMObject['height'](),iTime=0x190;$('#template-editor-merged-document')['contents']()['children']()['animate']({'zoom':fZoom,'height':lFixedHeight/fZoom},0x190);}},'DisplayAvailableTemplates':function(lstTemplates){var sItemPrefix='template-editor-list-item-',sItemTemplate=sItemPrefix+'template',sRowTemplateHTML=document['getElementById'](sItemTemplate)['outerHTML'],sUL='template-editor-list';$('#'+sUL)['find']('li')['each'](function(){var sID=this['id'];if(sID!=sItemTemplate)$(this)['remove']();});if(!lstTemplates)return;for(var i=0x0;i<lstTemplates['length'];i++){var sTemplate=lstTemplates[i],sRowItemHTML=sRowTemplateHTML,sStripped=TriSysSDK['Controls']['FileManager']['StripInconvenientFileNameCharacters'](sTemplate);sStripped=sStripped['replace'](/\./g,'-');var sItemID=sItemPrefix+sStripped;sRowItemHTML=sRowItemHTML['replace'](sItemTemplate,sItemID),sRowItemHTML=TriSysSDK['DocumentObjectModel']['RemoveStyleDisplayNone'](sRowItemHTML);var sEscapedTemplateFile=sTemplate['replace'](/'/g,'\x5c\x27'),sOnClick='ctrlTemplateEditor.SelectTemplate(\x27'+sEscapedTemplateFile+'\x27)';sRowItemHTML=sRowItemHTML['replace']('##template-click-event##',sOnClick),sRowItemHTML=sRowItemHTML['replace']('##template-caption##',sTemplate),$('#'+sUL)['append'](sRowItemHTML);if(!TriSysActions['MailMerge']['Template']){if(i==0x0)TriSysActions['MailMerge']['Template']=sTemplate;}if(TriSysActions['MailMerge']['Template']==sTemplate)ctrlTemplateEditor['SelectTemplate'](sTemplate);}},'SelectTemplate':function(sTemplate){var sUL='template-editor-list';$('#'+sUL)['find']('li')['each'](function(){$(this)['removeClass']('active');});var sItemPrefix='template-editor-list-item-',sStripped=TriSysSDK['Controls']['FileManager']['StripInconvenientFileNameCharacters'](sTemplate);sStripped=sStripped['replace'](/\./g,'-');var sItemID=sItemPrefix+sStripped;$('#'+sItemID)['addClass']('active'),ctrlTemplateEditor['ReadTemplateFromWebAPI'](sTemplate);},'SelectedTemplate':function(){var sUL='template-editor-list',sTemplate=null;return $('#'+sUL)['find']('li')['each'](function(){$(this)['hasClass']('active')&&$(this)['find']('a')['each'](function(){sTemplate=$(this)['html']()['trim'](),sTemplate=sTemplate['replace']('<strong>',''),sTemplate=sTemplate['replace']('</strong>','');});}),sTemplate;},'ReadTemplateFromWebAPI':function(sTemplate){var sFolder=TriSysActions['MailMerge']['Folder'],sFilePath='Actions.Net/'+sFolder+'/'+sTemplate+'.html',CFileStreamRequest={'FilePath':sFilePath,'OriginalFileOnly':!![]},payloadObject={};payloadObject['URL']='Action/GetMailMergeTemplateHTML',payloadObject['OutboundDataPacket']=CFileStreamRequest,payloadObject['InboundDataFunction']=function(CFileContents){TriSysApex['UI']['HideWait']();if(CFileContents){if(CFileContents['Success']){var sBase64Text=CFileContents['Base64Text'];ctrlTemplateEditor['DisplayBase64HTMLInEditorAndPreview'](sBase64Text);return;}else TriSysApex['UI']['ShowMessage'](CFileContents['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlTemplateEditor.ReadTemplateFromWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Template...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DisplayBase64HTMLInEditorAndPreview':function(sBase64Text){if(!sBase64Text)return;try{var sHTML=$['base64']['decode'](sBase64Text),bFullPageEditing=!![];if(sHTML['indexOf']('{{Apex_MasterTemplate')>=0x0)bFullPageEditing=![];ctrlTemplateEditor['InitialiseDocumentEditor'](bFullPageEditing),$('#template-editor')['froalaEditor']('html.set',sHTML),ctrlTemplateEditor['ShowPreviewIfEnabled']();}catch(e){TriSysApex['UI']['ShowError'](e,'Template\x20Editor\x20HTML\x20Render\x20Engine');}},'WriteHTMLtoIFrame':function(sHTML){var sFrameID='template-editor-merged-document',frame_element=document['getElementById'](sFrameID);if(!frame_element)return;var iframeElementContainer=frame_element['contentDocument'];iframeElementContainer['open'](),iframeElementContainer['writeln'](sHTML),iframeElementContainer['close']();var frame_window=frames[sFrameID];frame_element['style']['height']='1px',frame_element['style']['height']=frame_window['document']['documentElement']['scrollHeight']+'px';},'MergePreview':function(){var sHTML=ctrlTemplateEditor['GetEditedHTML']();ctrlTemplateEditor['MergeDataViaWebAPI'](sHTML),ctrlTemplateEditor['WriteHTMLtoIFrame']('<h5>Merging\x20data...</h5>');},'MergeDataViaWebAPI':function(sHTML){var sFolder=TriSysActions['MailMerge']['Folder'],actionData=new TriSysActions['Invocation']['ActionData'](),bForceMergeMaster=ctrlTemplateEditor['isPreviewEnabled'](),CMailMergeToHTMLRequest={'Folder':sFolder,'HTML':sHTML,'ActionData':actionData,'ForceMergeMaster':bForceMergeMaster},payloadObject={};payloadObject['URL']='Action/MailMergeToHTML',payloadObject['OutboundDataPacket']=CMailMergeToHTMLRequest,payloadObject['InboundDataFunction']=function(CMailMergeToHTMLResponse){TriSysApex['UI']['HideWait']();if(CMailMergeToHTMLResponse){if(CMailMergeToHTMLResponse['Success']){ctrlTemplateEditor['WriteHTMLtoIFrame'](CMailMergeToHTMLResponse['HTML']);return;}else TriSysApex['UI']['ShowMessage'](CMailMergeToHTMLResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlTemplateEditor.MergeDataViaWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Merging\x20Data...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'GetEditedHTML':function(){var sJQueryDiv='#template-editor',sHTML=$(sJQueryDiv)['froalaEditor']('html.get');return sHTML;},'NewTemplate':function(){TriSysApex['ModalDialogue']['New']['Popup']('New\x20Template','gi-edit',ctrlTemplateEditor['SubmitNewTemplateToWebAPI']);},'SubmitNewTemplateToWebAPI':function(sName){var sFolder=TriSysActions['MailMerge']['Folder'],CAddMailMergeTemplateRequest={'Folder':sFolder,'Name':sName},payloadObject={};payloadObject['URL']='Files/AddMailMergeTemplate',payloadObject['OutboundDataPacket']=CAddMailMergeTemplateRequest,payloadObject['InboundDataFunction']=function(CAddMailMergeTemplateResponse){TriSysApex['UI']['HideWait']();if(CAddMailMergeTemplateResponse){if(CAddMailMergeTemplateResponse['Success']){TriSysApex['UI']['CloseModalPopup'](),TriSysActions['MailMerge']['Template']=CAddMailMergeTemplateResponse['Name'],ctrlTemplateEditor['DisplayAvailableTemplates'](CAddMailMergeTemplateResponse['Templates']);return;}else TriSysApex['UI']['ShowMessage'](CAddMailMergeTemplateResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlTemplateEditor.SubmitNewTemplateToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Creating\x20Template...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'CopyTemplate':function(){var sTemplate=ctrlTemplateEditor['SelectedTemplate']();if(sTemplate){var fnCallback=function(sCopyToName){ctrlTemplateEditor['SubmitCopyTemplateToWebAPI'](sTemplate,sCopyToName);};TriSysApex['ModalDialogue']['New']['Popup']('Copy\x20Template:\x20'+sTemplate,'gi-more_items',fnCallback);}},'SubmitCopyTemplateToWebAPI':function(sFromTemplate,sCopyToName){var sFolder=TriSysActions['MailMerge']['Folder'],CCopyMailMergeTemplateRequest={'Folder':sFolder,'FromName':sFromTemplate,'ToName':sCopyToName},payloadObject={};payloadObject['URL']='Files/CopyMailMergeTemplate',payloadObject['OutboundDataPacket']=CCopyMailMergeTemplateRequest,payloadObject['InboundDataFunction']=function(CCopyMailMergeTemplateResponse){TriSysApex['UI']['HideWait']();if(CCopyMailMergeTemplateResponse){if(CCopyMailMergeTemplateResponse['Success']){TriSysApex['UI']['CloseModalPopup'](),TriSysActions['MailMerge']['Template']=CCopyMailMergeTemplateResponse['ToName'],ctrlTemplateEditor['DisplayAvailableTemplates'](CCopyMailMergeTemplateResponse['Templates']);return;}else TriSysApex['UI']['ShowMessage'](CCopyMailMergeTemplateResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlTemplateEditor.SubmitCopyTemplateToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Copying\x20Template...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DeleteTemplate':function(){var sTemplate=ctrlTemplateEditor['SelectedTemplate']();if(sTemplate){var fnCallback=function(){return ctrlTemplateEditor['SubmitDeleteTemplateToWebAPI'](sTemplate),!![];},sMessage='Are\x20you\x20sure\x20that\x20you\x20wish\x20to\x20delete\x20the\x20template:\x20'+sTemplate+'?';TriSysApex['UI']['questionYesNo'](sMessage,'Delete\x20Template','Yes',fnCallback,'No');}},'SubmitDeleteTemplateToWebAPI':function(sTemplate){var sFolder=TriSysActions['MailMerge']['Folder'],CDeleteMailMergeTemplateRequest={'Folder':sFolder,'Name':sTemplate},payloadObject={};payloadObject['URL']='Files/DeleteMailMergeTemplate',payloadObject['OutboundDataPacket']=CDeleteMailMergeTemplateRequest,payloadObject['InboundDataFunction']=function(CDeleteMailMergeTemplateResponse){TriSysApex['UI']['HideWait']();if(CDeleteMailMergeTemplateResponse){if(CDeleteMailMergeTemplateResponse['Success']){TriSysActions['MailMerge']['Template']=null,ctrlTemplateEditor['DisplayAvailableTemplates'](CDeleteMailMergeTemplateResponse['Templates']);try{TriSysSDK['CShowForm']['RemoveItemFromCombo'](ctrlMailMerge['TemplatesID'],sTemplate),TriSysSDK['CShowForm']['SetIndexInCombo'](ctrlMailMerge['TemplatesID'],0x0);}catch(e){}return;}else TriSysApex['UI']['ShowMessage'](CDeleteMailMergeTemplateResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlTemplateEditor.SubmitDeleteTemplateToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Deleting\x20Template...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'AddImage':function(){TriSysSDK['Controls']['FileManager']['FindFileUpload']('Upload\x20Image',ctrlTemplateEditor['UploadImage']);},'UploadImage':function(sFilePath){var payloadObject={};payloadObject['URL']='Files/MoveUploadedActionImage';var CMoveUploadedActionImageRequest={'UploadedFilePath':sFilePath};payloadObject['OutboundDataPacket']=CMoveUploadedActionImageRequest,payloadObject['InboundDataFunction']=function(data){TriSysApex['UI']['HideWait']();var JSONdataset=data;if(JSONdataset){if(JSONdataset['Success']){var sFilePath=JSONdataset['PublicFilePath'];ctrlTemplateEditor['InitialiseImageLibrary']();}else TriSysApex['UI']['errorAlert'](JSONdataset['ErrorMessage']);}else{}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['ErrorHandlerRedirector']('ctrlTemplateEditor.UploadImage:\x20',request,status,error);},TriSysApex['UI']['ShowWait'](null,'Uploading\x20Image...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DeleteImage':function(){var treeID='#template-editor-tree-images',treeview=$(treeID)['data']('kendoTreeView');if(treeview){var item=treeview['select']();if(item){var sImageUrl=item[0x0]['innerText']['trim'](),fnCallback=function(){return ctrlTemplateEditor['SubmitDeleteImageToWebAPI'](sImageUrl),!![];},sMessage='Are\x20you\x20sure\x20that\x20you\x20wish\x20to\x20delete\x20the\x20image:\x20'+sImageUrl+'?';TriSysApex['UI']['questionYesNo'](sMessage,'Delete\x20Image','Yes',fnCallback,'No');}}},'SubmitDeleteImageToWebAPI':function(sImageUrl){var CDeleteMailMergeImageRequest={'Name':sImageUrl},payloadObject={};payloadObject['URL']='Files/DeleteMailMergeImage',payloadObject['OutboundDataPacket']=CDeleteMailMergeImageRequest,payloadObject['InboundDataFunction']=function(CDeleteMailMergeImageResponse){TriSysApex['UI']['HideWait']();if(CDeleteMailMergeImageResponse){if(CDeleteMailMergeImageResponse['Success']){ctrlTemplateEditor['InitialiseImageLibrary']();return;}else TriSysApex['UI']['ShowMessage'](CDeleteMailMergeImageResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlTemplateEditor.SubmitDeleteImageToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Deleting\x20Image...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'SaveTemplate':function(){var sTemplate=ctrlTemplateEditor['SelectedTemplate']();if(!sTemplate){TriSysApex['UI']['ShowMessage']('Please\x20create\x20a\x20new\x20template\x20before\x20saving.');return;}var sHTML=ctrlTemplateEditor['GetEditedHTML']();if(!sHTML){TriSysApex['UI']['ShowMessage']('Please\x20enter\x20some\x20text\x20in\x20the\x20editor.');return;}var sFolder=TriSysActions['MailMerge']['Folder'],CSaveMailMergeTemplateRequest={'Folder':sFolder,'Name':sTemplate,'HTML':sHTML},payloadObject={};payloadObject['URL']='Files/SaveMailMergeTemplate',payloadObject['OutboundDataPacket']=CSaveMailMergeTemplateRequest,payloadObject['InboundDataFunction']=function(CSaveMailMergeTemplateResponse){TriSysApex['UI']['HideWait']();if(CSaveMailMergeTemplateResponse){if(CSaveMailMergeTemplateResponse['Success'])return;else TriSysApex['UI']['ShowMessage'](CSaveMailMergeTemplateResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlTemplateEditor.SaveTemplate:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Saving\x20Template...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'SelectButtonClick':function(){var sTemplate=ctrlTemplateEditor['SelectedTemplate']();if(!sTemplate)TriSysApex['UI']['ShowMessage']('Please\x20create\x20a\x20new\x20template\x20before\x20selecting.');return sTemplate;},'SizeAlgorithm':function(){var iWidth=$(window)['width']();if(iWidth<0x708){var buttonsToHideText=['template-editor-button-new-template','template-editor-button-copy-template','template-editor-button-delete-template','template-editor-button-add-image','template-editor-button-delete-image'];for(var i=0x0;i<buttonsToHideText['length'];i++){var buttonSpanToHide=$('#'+buttonsToHideText[i]);buttonSpanToHide['hide']();}}var fnScrollbars=function(){var sModalBodyDiv=TriSysApex['UI']['GetLastOpenStackedModalDiv']('trisys-modal-dynamic-content'),lHeight=$('#'+sModalBodyDiv)['height']()-0x28,lHeightOfTemplatesAndImageLibrary=lHeight/0x2-0x1e;$('#template-editor-list')['height'](lHeightOfTemplatesAndImageLibrary),$('#template-editor-tree-images')['height'](lHeightOfTemplatesAndImageLibrary),$('#template-editor-tree-fields')['height'](lHeight),lHeight=$('#template-editor-merge-fields-block')['height'](),$('#template-editor-block')['height'](lHeight-0x14),$('#'+sModalBodyDiv)['css']('overflow-y','');};setTimeout(fnScrollbars,0x64);}};$(document)['ready'](function(){ctrlTemplateEditor['Load']();});