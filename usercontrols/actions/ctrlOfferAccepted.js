var ctrlOfferAccepted={'ClientID':'ctrlOfferAccepted-Client','RequirementID':'ctrlOfferAccepted-Requirement','CandidateID':'ctrlOfferAccepted-Candidate','ClientTemplatesID':'ctrlOfferAccepted-ClientTemplate','CandidateTemplatesID':'ctrlOfferAccepted-CandidateTemplate','EditClientTemplateButtonID':'ctrlOfferAccepted-EditClientTemplate','EditCandidateTemplateButtonID':'ctrlOfferAccepted-EditCandidateTemplate','ClientSubjectID':'ctrlOfferAccepted-ClientSubject','CandidateSubjectID':'ctrlOfferAccepted-CandidateSubject','StartDateID':'ctrlOfferAccepted-StartDate','EndDateID':'ctrlOfferAccepted-EndDate','SalaryID':'ctrlOfferAccepted-Salary','NoteHistoryID':'ctrlOfferAccepted-NoteHistory','FollowUpID':'ctrlOfferAccepted-FollowUp','CandidateList':null,'Load':function(){var sOfferAccepted='OfferAccepted',sOfferAcceptedFolder=sOfferAccepted+'/';TriSysActions['MailMerge']['PopulateTemplates'](sOfferAccepted+':\x20Client',TriSysActions['MailMerge']['MasterTemplateFolder']+sOfferAcceptedFolder+TriSysActions['MailMerge']['ClientTemplatesFolder'],ctrlOfferAccepted['ClientTemplatesID'],'Client\x20Offer\x20Accepted',ctrlOfferAccepted['EditClientTemplateButtonID']),TriSysActions['MailMerge']['PopulateTemplates'](sOfferAccepted+':\x20Candidate',TriSysActions['MailMerge']['MasterTemplateFolder']+sOfferAcceptedFolder+TriSysActions['MailMerge']['CandidateTemplatesFolder'],ctrlOfferAccepted['CandidateTemplatesID'],'Candidate\x20Offer\x20Accepted',ctrlOfferAccepted['EditCandidateTemplateButtonID']);var defaults={'TaskType':'Letter'};TriSysActions['NoteHistory']['Load'](ctrlOfferAccepted['NoteHistoryID'],defaults),TriSysSDK['CShowForm']['datePicker'](ctrlOfferAccepted['StartDateID']),TriSysSDK['CShowForm']['datePicker'](ctrlOfferAccepted['EndDateID']);var fSpinIncrement=0x1f4,sPeriod='Annum';TriSysSDK['Controls']['CurrencyAmountPeriod']['PopulateCurrencyAmountPeriodWidget'](ctrlOfferAccepted['SalaryID'],fSpinIncrement,sPeriod);var dtFollowUp=TriSysActions['FollowUp']['FollowUpDateTomorrow']();defaults={'CreateFollowUp':!![],'StartDateTime':dtFollowUp},TriSysActions['FollowUp']['Load'](ctrlOfferAccepted['FollowUpID'],defaults),ctrlOfferAccepted['PopulateActionData']();},'PopulateActionData':function(){if(TriSysActions['Invocation']['SingletonContactListCheck']('Offer\x20Accepted','candidate'))return;var CReadCVSendDetailsActionRequest=new TriSysActions['Invocation']['ActionData'](),payloadObject={};payloadObject['URL']='Action/ReadCVSendDetails',payloadObject['OutboundDataPacket']=CReadCVSendDetailsActionRequest,payloadObject['InboundDataFunction']=function(CReadCVSendDetailsActionResponse){TriSysApex['UI']['HideWait']();if(CReadCVSendDetailsActionResponse){if(CReadCVSendDetailsActionResponse['Success']){ctrlOfferAccepted['DisplayClientContactDetails'](CReadCVSendDetailsActionResponse['ClientContact']),ctrlOfferAccepted['DisplayCandidateDetails'](CReadCVSendDetailsActionResponse['CandidateContacts']),ctrlOfferAccepted['DisplayRequirementDetails'](CReadCVSendDetailsActionResponse['Requirement']);if(CReadCVSendDetailsActionResponse['Requirement'])TriSysSDK['CShowForm']['setDatePickerValue'](ctrlOfferAccepted['StartDateID'],CReadCVSendDetailsActionResponse['Requirement']['EarliestStartDate']);TriSysActions['Persistence']['Read'](ctrlOfferAccepted['ReadPersistedSettingsCallback']);return;}else TriSysApex['UI']['ShowMessage'](CReadCVSendDetailsActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlOfferAccepted.PopulateActionData:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Contacts...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DisplayClientContactDetails':function(contact){var sContact=contact['FullName'];if(contact['CompanyName'])sContact+=',\x20'+contact['CompanyName'];$('#'+ctrlOfferAccepted['ClientID'])['html'](sContact);},'DisplayCandidateDetails':function(contactList){ctrlOfferAccepted['CandidateList']=contactList;var sContact='';if(contactList&&contactList['length']==0x1){var contact=contactList[0x0];sContact=contact['FullName'];if(contact['HomeAddressStreet'])sContact+=',\x20'+contact['HomeAddressStreet']['replace'](/\r\n/g,',\x20');if(contact['HomeAddressCity'])sContact+=',\x20'+contact['HomeAddressCity'];}else{if(contactList)for(var i=0x0;i<contactList['length'];i++){var contact=contactList[i];if(sContact['length']>0x0)sContact+=',\x20';sContact+=contact['FullName'];}}$('#'+ctrlOfferAccepted['CandidateID'])['html'](sContact);},'DisplayRequirementDetails':function(requirement){if(requirement){$('#'+ctrlOfferAccepted['RequirementID'])['html'](requirement['Reference']+':\x20'+requirement['JobTitle']);if(requirement['Type']=='Permanent')TriSysSDK['Controls']['CurrencyAmountPeriod']['SetCurrencyAmountPeriod'](ctrlOfferAccepted['SalaryID'],requirement['Salary']),$('#ctrlOfferAccepted-EndDate-tr')['hide']();else $('#ctrlOfferAccepted-Salary-tr')['hide']();}else $('#ctrlOfferAccepted-Requirement-tr')['hide']();},'Configure':function(){var mySettings=ctrlOfferAccepted['GetSettings']();if(!mySettings)return;TriSysActions['Persistence']['Write'](mySettings);},'GetSettings':function(){var sError=null,sClientTemplate=TriSysActions['MailMerge']['GetTemplateFromCombo'](ctrlOfferAccepted['ClientTemplatesID']),sCandidateTemplate=TriSysActions['MailMerge']['GetTemplateFromCombo'](ctrlOfferAccepted['CandidateTemplatesID']),sClientSubject=$('#'+ctrlOfferAccepted['ClientSubjectID'])['val'](),sCandidateSubject=$('#'+ctrlOfferAccepted['CandidateSubjectID'])['val']();if(sError)return TriSysApex['UI']['ShowMessage'](sError),null;var mySettings={'ClientTemplate':sClientTemplate,'CandidateTemplate':sCandidateTemplate,'ClientSubject':sClientSubject,'CandidateSubject':sCandidateSubject,'NoteHistory':ctrlNoteHistory['Validation'](),'FollowUp':ctrlFollowUp['Validation']()};return mySettings;},'ReadPersistedSettingsCallback':function(mySettings){TriSysSDK['CShowForm']['SetTextInCombo'](ctrlOfferAccepted['ClientTemplatesID'],mySettings['ClientTemplate']),TriSysSDK['CShowForm']['SetTextInCombo'](ctrlOfferAccepted['CandidateTemplatesID'],mySettings['CandidateTemplate']),$('#'+ctrlOfferAccepted['ClientSubjectID'])['val'](mySettings['ClientSubject']),$('#'+ctrlOfferAccepted['CandidateSubjectID'])['val'](mySettings['CandidateSubject']),TriSysActions['PersistedSettingsSafeguard']['WaitUntilTaskControlsAreLoaded'](!![],!![],function(){ctrlNoteHistory['Reload'](mySettings['NoteHistory']),ctrlFollowUp['Reload'](mySettings['FollowUp']);});},'MailMergeData':function(){if(!ctrlOfferAccepted['CandidateList'])return;var dtStart=TriSysSDK['CShowForm']['getDatePickerValue'](ctrlOfferAccepted['StartDateID']),sFormatedStartDate=dtStart?moment(dtStart)['format']('dddd\x20DD\x20MMMM\x20YYYY'):null,dtEnd=TriSysSDK['CShowForm']['getDatePickerValue'](ctrlOfferAccepted['EndDateID']),sFormatedEndDate=dtEnd?moment(dtEnd)['format']('dddd\x20DD\x20MMMM\x20YYYY'):null,sSalary=TriSysSDK['Controls']['CurrencyAmountPeriod']['GetCurrencyAmountPeriod'](ctrlOfferAccepted['SalaryID'],!![]),actionSpecificData={'ActionName':'OfferAccepted','ActionDisplayName':'Offer\x20Accepted','Values':[{'FieldName':'StartDate','FieldDisplayName':'Start\x20Date','Value':sFormatedStartDate},{'FieldName':'EndDate','FieldDisplayName':'End\x20Date','Value':sFormatedEndDate},{'FieldName':'Salary','FieldDisplayName':'Salary','Value':sSalary}]};return actionSpecificData;},'Finish':function(){var mySettings=ctrlOfferAccepted['GetSettings']();if(!mySettings)return;var NoteHistoryData=ctrlNoteHistory['Validation']();if(!NoteHistoryData)return;var FollowUpData=ctrlFollowUp['Validation']();if(!FollowUpData)return;var sError=null,dtStart=TriSysSDK['CShowForm']['getDatePickerValue'](ctrlOfferAccepted['StartDateID']),dtEnd=TriSysSDK['CShowForm']['getDatePickerValue'](ctrlOfferAccepted['EndDateID']);if(!dtStart)sError='Please\x20specify\x20a\x20start\x20date.';else{var bVisible=$('#'+ctrlOfferAccepted['EndDateID'])['is'](':visible');if(bVisible){if(!dtEnd)sError='Please\x20specify\x20an\x20end\x20date.';}}if(sError)return TriSysApex['UI']['ShowMessage'](sError),null;ctrlOfferAccepted['SendActionDataToWebAPI'](mySettings,NoteHistoryData,FollowUpData);},'SendActionDataToWebAPI':function(mySettings,NoteHistoryData,FollowUpData){var COfferAcceptedActionRequest={'ClientTemplate':mySettings['ClientTemplate'],'CandidateTemplate':mySettings['CandidateTemplate'],'ClientSubject':mySettings['ClientSubject'],'CandidateSubject':mySettings['CandidateSubject'],'ActionData':new TriSysActions['Invocation']['ActionData'](),'NoteHistory':NoteHistoryData,'FollowUp':FollowUpData},payloadObject={};payloadObject['URL']='Action/OfferAccepted',payloadObject['OutboundDataPacket']=COfferAcceptedActionRequest,payloadObject['InboundDataFunction']=function(COfferAcceptedActionResponse){TriSysApex['UI']['HideWait']();if(COfferAcceptedActionResponse){if(COfferAcceptedActionResponse['Success']){TriSysActions['Invocation']['PostInvocationCompletion']();if(COfferAcceptedActionResponse['URL'])for(var i=0x0;i<COfferAcceptedActionResponse['URL']['length'];i++){var sURL=COfferAcceptedActionResponse['URL'][i];TriSysApex['ModalDialogue']['DocumentViewer']['DownloadAndOpen']('e-mail',sURL);}return;}else TriSysApex['UI']['ShowMessage'](COfferAcceptedActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlOfferAccepted.SendActionDataToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Generating\x20E-Mail...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);}};$(document)['ready'](function(){ctrlOfferAccepted['Load']();});