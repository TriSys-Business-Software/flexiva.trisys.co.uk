var ctrlPlacementTimesheetMerge={'PlacementID':'ctrlPlacementTimesheetMerge-Placement','TemplatesID':'ctrlPlacementTimesheetMerge-Template','EditTemplateButtonID':'ctrlPlacementTimesheetMerge-EditTemplate','DeliveryID':'ctrlPlacementTimesheetMerge-Delivery','SubjectID':'ctrlPlacementTimesheetMerge-Subject','NoteHistoryID':'ctrlPlacementTimesheetMerge-NoteHistory','FollowUpID':'ctrlPlacementTimesheetMerge-FollowUp','Delivery_Outlook':'Outlook\x20E-Mail','Delivery_SMTP':'SMTP\x20E-Mail','Delivery_SMSText':'SMS\x20Text','ContactList':null,'KeyFieldId':null,'Data':{},'Load':function(){var sMailMerge='Placement\x20Timesheet\x20Merge',sMailMergeFolder=sMailMerge+'/';TriSysActions['MailMerge']['PopulateTemplates'](sMailMerge,TriSysActions['MailMerge']['MasterTemplateFolder']+sMailMergeFolder,ctrlPlacementTimesheetMerge['TemplatesID'],sMailMerge,ctrlPlacementTimesheetMerge['EditTemplateButtonID']),ctrlPlacementTimesheetMerge['PopulateDeliveryCombo']();var defaults={'TaskType':'E-Mail'};TriSysActions['NoteHistory']['Load'](ctrlPlacementTimesheetMerge['NoteHistoryID'],defaults);var dtFollowUp=TriSysActions['FollowUp']['FollowUpDateTomorrow']();defaults={'CreateFollowUp':!![],'StartDateTime':dtFollowUp},TriSysActions['FollowUp']['Load'](ctrlPlacementTimesheetMerge['FollowUpID'],defaults),ctrlPlacementTimesheetMerge['PopulateActionData']();},'PersistedSettings':null,'ReadPersistedSettingsCallback':function(mySettings){ctrlPlacementTimesheetMerge['PersistedSettings']=mySettings;if(mySettings){var sDefaultTemplate=mySettings['Default'];if(sDefaultTemplate)ctrlPlacementTimesheetMerge['ApplyPersistedSetting'](sDefaultTemplate);}},'GetSettingsIndexForTemplate':function(sTemplate){if(ctrlPlacementTimesheetMerge['PersistedSettings'])for(var i=0x0;i<ctrlPlacementTimesheetMerge['PersistedSettings']['Templates']['length'];i++){var settings=ctrlPlacementTimesheetMerge['PersistedSettings']['Templates'][i];if(settings['Template']==sTemplate)return i;}return-0x1;},'GetSettingsForTemplate':function(sTemplate){var iIndex=ctrlPlacementTimesheetMerge['GetSettingsIndexForTemplate'](sTemplate);if(iIndex>=0x0)return ctrlPlacementTimesheetMerge['PersistedSettings']['Templates'][iIndex];},'ApplyPersistedSetting':function(sTemplate){var mySettings=ctrlPlacementTimesheetMerge['GetSettingsForTemplate'](sTemplate);mySettings&&(TriSysSDK['CShowForm']['SetTextInCombo'](ctrlPlacementTimesheetMerge['TemplatesID'],mySettings['Template']),TriSysSDK['CShowForm']['SetTextInCombo'](ctrlPlacementTimesheetMerge['DeliveryID'],mySettings['Delivery']),ctrlPlacementTimesheetMerge['DeliveryComboClick'](mySettings['Delivery']),$('#'+ctrlPlacementTimesheetMerge['SubjectID'])['val'](mySettings['Subject']),TriSysActions['PersistedSettingsSafeguard']['WaitUntilTaskControlsAreLoaded'](!![],!![],function(){ctrlNoteHistory['Reload'](mySettings['NoteHistory']),ctrlFollowUp['Reload'](mySettings['FollowUp']);}));},'PopulateDeliveryCombo':function(){var delivery=[{'value':0x0,'text':ctrlPlacementTimesheetMerge['Delivery_Outlook']},{'value':0x1,'text':ctrlPlacementTimesheetMerge['Delivery_SMTP']}];TriSysSDK['CShowForm']['populateComboFromDataSource'](ctrlPlacementTimesheetMerge['DeliveryID'],delivery,0x1);},'DeliveryComboClick':function(sDelivery){switch(sDelivery){case ctrlPlacementTimesheetMerge['Delivery_Outlook']:case ctrlPlacementTimesheetMerge['Delivery_SMTP']:$('#'+ctrlPlacementTimesheetMerge['SubjectID']+'-tr')['show']();break;}},'PopulateActionData':function(){var CReadPlacementTimesheetMergeDetailsActionRequest=new TriSysActions['Invocation']['ActionData'](),payloadObject={};payloadObject['URL']='Action/ReadPlacementTimesheetMergeDetails',payloadObject['OutboundDataPacket']=CReadPlacementTimesheetMergeDetailsActionRequest,payloadObject['InboundDataFunction']=function(CReadPlacementTimesheetMergeDetailsActionResponse){TriSysApex['UI']['HideWait']();if(CReadPlacementTimesheetMergeDetailsActionResponse){if(CReadPlacementTimesheetMergeDetailsActionResponse['Success']){TriSysActions['PlacementTimesheetMerge']['DisplayPlacementDetails'](CReadPlacementTimesheetMergeDetailsActionResponse['Placements'],ctrlPlacementTimesheetMerge['PlacementID']),TriSysActions['Persistence']['Read'](ctrlPlacementTimesheetMerge['ReadPersistedSettingsCallback']);return;}else TriSysApex['UI']['ShowMessage'](CReadPlacementTimesheetMergeDetailsActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlPlacementTimesheetMerge.PopulateActionData:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Placements...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'MailMergeData':function(){var lstPlacementRecords=reportsForm['ActionInvocationSelectedGridRowValues']();if(lstPlacementRecords){var placementRecordObject={'List':lstPlacementRecords},sPlacementRecords=JSON['stringify'](placementRecordObject),actionSpecificData={'ActionName':'PlacementTimesheetMerge','ActionDisplayName':'Placement\x20Timesheet\x20Merge','Values':[{'FieldName':'PlacementGridList','FieldDisplayName':'Placement\x20Grid\x20List','Value':sPlacementRecords,'ListOfFields':!![]}]};return actionSpecificData;}},'Finish':function(){var mySettings=ctrlPlacementTimesheetMerge['GetSettingsForSelectedTemplate']();if(!mySettings)return;var NoteHistoryData=ctrlNoteHistory['Validation']();if(!NoteHistoryData)return;var FollowUpData=ctrlFollowUp['Validation']();if(!FollowUpData)return;ctrlPlacementTimesheetMerge['SendActionDataToWebAPI'](mySettings,NoteHistoryData,FollowUpData);},'GetSettingsForSelectedTemplate':function(){var sError=null,sTemplate=TriSysActions['MailMerge']['GetTemplateFromCombo'](ctrlPlacementTimesheetMerge['TemplatesID']),sDelivery=TriSysSDK['CShowForm']['GetTextFromCombo'](ctrlPlacementTimesheetMerge['DeliveryID']),sSubject=$('#'+ctrlPlacementTimesheetMerge['SubjectID'])['val']();if(!sTemplate)sError='You\x20must\x20choose\x20an\x20e-mail\x20template.';else{if(!sSubject)sError='You\x20must\x20specify\x20an\x20e-mail\x20subject\x20heading.';}if(sError)return TriSysApex['UI']['ShowMessage'](sError),null;var mySettings={'Template':sTemplate,'Delivery':sDelivery,'Subject':sSubject,'NoteHistory':ctrlNoteHistory['Validation'](),'FollowUp':ctrlFollowUp['Validation']()};return mySettings;},'GetSettings':function(){var mySettings=ctrlPlacementTimesheetMerge['GetSettingsForSelectedTemplate']();if(!mySettings)return;if(!ctrlPlacementTimesheetMerge['PersistedSettings'])ctrlPlacementTimesheetMerge['PersistedSettings']={'Default':mySettings['Template'],'Templates':[]};var iIndex=ctrlPlacementTimesheetMerge['GetSettingsIndexForTemplate'](mySettings['Template']);if(iIndex>=0x0)ctrlPlacementTimesheetMerge['PersistedSettings']['Templates']['splice'](iIndex,0x1);return ctrlPlacementTimesheetMerge['PersistedSettings']['Templates']['push'](mySettings),ctrlPlacementTimesheetMerge['PersistedSettings']['Default']=mySettings['Template'],ctrlPlacementTimesheetMerge['PersistedSettings'];},'Configure':function(){var mySettings=ctrlPlacementTimesheetMerge['GetSettings']();if(!mySettings)return;TriSysActions['Persistence']['Write'](mySettings);},'SendActionDataToWebAPI':function(mySettings,NoteHistoryData,FollowUpData){var CPlacementTimesheetMergeActionRequest={'Settings':mySettings,'ActionData':new TriSysActions['Invocation']['ActionData'](),'NoteHistory':NoteHistoryData,'FollowUp':FollowUpData},payloadObject={};payloadObject['URL']='Action/PlacementTimesheetMerge',payloadObject['OutboundDataPacket']=CPlacementTimesheetMergeActionRequest,payloadObject['TimeoutMilliseconds']=0x3c*0x3c*0x3e8,payloadObject['InboundDataFunction']=function(CPlacementTimesheetMergeActionResponse){TriSysApex['UI']['HideWait']();if(CPlacementTimesheetMergeActionResponse){if(CPlacementTimesheetMergeActionResponse['Success']){TriSysActions['Invocation']['PostInvocationCompletion']();if(CPlacementTimesheetMergeActionResponse['URL'])for(var i=0x0;i<CPlacementTimesheetMergeActionResponse['URL']['length'];i++){var sURL=CPlacementTimesheetMergeActionResponse['URL'][i];TriSysApex['ModalDialogue']['DocumentViewer']['DownloadAndOpen']('e-mail',sURL);}else{if(CPlacementTimesheetMergeActionResponse['MailMessages']){if(CPlacementTimesheetMergeActionResponse['MailMessages']['length']>0x0){var options={'SuppressNoteHistory':!![]};TriSysActions['EMail']['SendDialogue'](CPlacementTimesheetMergeActionResponse['MailMessages'],options);}}}return;}else TriSysApex['UI']['ShowMessage'](CPlacementTimesheetMergeActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlPlacementTimesheetMerge.SendActionDataToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Timesheet\x20Merging...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);}};$(document)['ready'](function(){ctrlPlacementTimesheetMerge['Load']();});