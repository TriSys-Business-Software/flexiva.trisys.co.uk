var ctrlMailMerge={'ContactID':'ctrlMailMerge-Contact','TemplatesID':'ctrlMailMerge-Template','EditTemplateButtonID':'ctrlMailMerge-EditTemplate','AttachmentsID':'ctrlMailMerge-Attachments','ManageAttachmentsButtonID':'ctrlMailMerge-ManageAttachmentLibrary','DeliveryID':'ctrlMailMerge-Delivery','SubjectID':'ctrlMailMerge-Subject','NoteHistoryID':'ctrlMailMerge-NoteHistory','FollowUpID':'ctrlMailMerge-FollowUp','EntityID':'ctrlMailMerge-Entity','GridMenuID':'ctrlMailMerge-GridMenu','GridID':'ctrlMailMerge-DataGrid','BlindCopyID':'ctrlMailMerge-BlindCopy','EntityGridBlock':'ctrlMailMerge-entity-grid-block','Delivery_Outlook':'Outlook\x20E-Mail','Delivery_SMTP':'SMTP\x20E-Mail','Delivery_SMSText':'SMS\x20Text','Delivery_Twitter':'Twitter','Delivery_WordDocument':'Word\x20Document','Entity_ClientContacts':'Client\x20Contacts','Entity_CandidateContacts':'Candidate\x20Contacts','Entity_Companies':'Companies','Entity_Requirements':'Requirements','Entity_Placements':'Placements','Entity_Users':'Users','Entity_Interviews':'Interviews','Entity_Events':'Events','Entity_News':'News','ContactList':null,'KeyFieldId':null,'Data':{'ListOf_Entity_ClientContacts':[],'ListOf_Entity_CandidateContacts':[],'ListOf_Entity_Companies':[],'ListOf_Entity_Requirements':[],'ListOf_Entity_Placements':[],'ListOf_Entity_Users':[]},'Load':function(){var sMailMerge='Mail\x20Merge',sMailMergeFolder=sMailMerge+'/';TriSysActions['MailMerge']['PopulateTemplates'](sMailMerge,TriSysActions['MailMerge']['MasterTemplateFolder']+sMailMergeFolder,ctrlMailMerge['TemplatesID'],sMailMerge,ctrlMailMerge['EditTemplateButtonID'],ctrlMailMerge['SelectedTemplateEvent']),TriSysActions['MailMerge']['PopulateAttachments'](ctrlMailMerge['AttachmentsID'],ctrlMailMerge['ManageAttachmentsButtonID']),ctrlMailMerge['PopulateDeliveryCombo'](),ctrlMailMerge['PopulateEntityCombo'](),TriSysSDK['FormMenus']['DrawGridMenu'](ctrlMailMerge['GridMenuID'],ctrlMailMerge['GridID']);var defaults={'TaskType':'E-Mail'};TriSysActions['NoteHistory']['Load'](ctrlMailMerge['NoteHistoryID'],defaults);var dtFollowUp=TriSysActions['FollowUp']['FollowUpDateTomorrow']();defaults={'CreateFollowUp':!![],'StartDateTime':dtFollowUp},TriSysActions['FollowUp']['Load'](ctrlMailMerge['FollowUpID'],defaults),ctrlMailMerge['PopulateActionData'](),TriSysActions['Persistence']['Read'](ctrlMailMerge['ReadPersistedSettingsCallback']);},'PersistedSettings':null,'ReadPersistedSettingsCallback':function(mySettings){ctrlMailMerge['PersistedSettings']=mySettings;if(mySettings){var sDefaultTemplate=mySettings['Default'];if(sDefaultTemplate)ctrlMailMerge['ApplyPersistedSetting'](sDefaultTemplate);}},'GetSettingsIndexForTemplate':function(sTemplate){if(ctrlMailMerge['PersistedSettings'])for(var i=0x0;i<ctrlMailMerge['PersistedSettings']['Templates']['length'];i++){var settings=ctrlMailMerge['PersistedSettings']['Templates'][i];if(settings['Template']==sTemplate)return i;}return-0x1;},'GetSettingsForTemplate':function(sTemplate){var iIndex=ctrlMailMerge['GetSettingsIndexForTemplate'](sTemplate);if(iIndex>=0x0)return ctrlMailMerge['PersistedSettings']['Templates'][iIndex];},'ApplyPersistedSetting':function(sTemplate){var mySettings=ctrlMailMerge['GetSettingsForTemplate'](sTemplate);if(mySettings){TriSysSDK['CShowForm']['SetTextInCombo'](ctrlMailMerge['TemplatesID'],mySettings['Template']),TriSysSDK['CShowForm']['SetSkillsInList'](ctrlMailMerge['AttachmentsID'],mySettings['Attachments']),TriSysSDK['CShowForm']['SetTextInCombo'](ctrlMailMerge['DeliveryID'],mySettings['Delivery']),ctrlMailMerge['DeliveryComboClick'](mySettings['Delivery']),$('#'+ctrlMailMerge['SubjectID'])['val'](mySettings['Subject']),TriSysSDK['CShowForm']['SetCheckBoxValue'](ctrlMailMerge['BlindCopyID'],mySettings['BlindCopy']),TriSysActions['PersistedSettingsSafeguard']['WaitUntilTaskControlsAreLoaded'](!![],!![],function(){ctrlNoteHistory['Reload'](mySettings['NoteHistory']),ctrlFollowUp['Reload'](mySettings['FollowUp']);});var lists=mySettings['Lists'];lists&&(ctrlMailMerge['Data']['ListOf_Entity_ClientContacts']=JSON['parse'](JSON['stringify'](lists['ClientContacts'])),ctrlMailMerge['Data']['ListOf_Entity_CandidateContacts']=JSON['parse'](JSON['stringify'](lists['CandidateContacts'])),ctrlMailMerge['Data']['ListOf_Entity_Companies']=JSON['parse'](JSON['stringify'](lists['Companies'])),ctrlMailMerge['Data']['ListOf_Entity_Requirements']=JSON['parse'](JSON['stringify'](lists['Requirements'])),ctrlMailMerge['Data']['ListOf_Entity_Placements']=JSON['parse'](JSON['stringify'](lists['Placements'])),ctrlMailMerge['Data']['ListOf_Entity_Users']=JSON['parse'](JSON['stringify'](lists['Users']))),mySettings['Entity']&&(TriSysSDK['CShowForm']['SetTextInCombo'](ctrlMailMerge['EntityID'],mySettings['Entity']),ctrlMailMerge['EntityComboClick'](mySettings['Entity']));}},'PopulateDeliveryCombo':function(){var delivery=[{'value':0x0,'text':ctrlMailMerge['Delivery_Outlook']},{'value':0x1,'text':ctrlMailMerge['Delivery_SMTP']},{'value':0x3,'text':ctrlMailMerge['Delivery_Twitter']},{'value':0x4,'text':ctrlMailMerge['Delivery_WordDocument']}],fnDeliveryChange=function(value,sText,sFieldID){ctrlMailMerge['DeliveryComboClick'](sText),sText==ctrlMailMerge['Delivery_SMTP']&&TriSysActions['SMTPChecking']['PreventContinueWithoutSMTPCredentials']('Mail\x20Merge\x20Action');};TriSysSDK['CShowForm']['populateComboFromDataSource'](ctrlMailMerge['DeliveryID'],delivery,0x0,fnDeliveryChange);},'DeliveryComboClick':function(sDelivery){var bHideStuff=!![];switch(sDelivery){case ctrlMailMerge['Delivery_Outlook']:case ctrlMailMerge['Delivery_SMTP']:$('#'+ctrlMailMerge['SubjectID']+'-tr')['show'](),$('#'+ctrlMailMerge['BlindCopyID']+'-tr')['show'](),$('#'+ctrlMailMerge['AttachmentsID']+'-tr')['show'](),bHideStuff=![];break;}bHideStuff&&($('#'+ctrlMailMerge['AttachmentsID']+'-tr')['hide'](),$('#'+ctrlMailMerge['SubjectID']+'-tr')['hide'](),$('#'+ctrlMailMerge['BlindCopyID']+'-tr')['hide']()),sDelivery==ctrlMailMerge['Delivery_SMTP']&&TriSysActions['SMTPChecking']['PreventContinueWithoutSMTPCredentials']('Mail\x20Merge\x20Action');},'PopulateEntityCombo':function(){var entities=[{'value':0x0,'text':ctrlMailMerge['Entity_ClientContacts']},{'value':0x1,'text':ctrlMailMerge['Entity_CandidateContacts']},{'value':0x2,'text':ctrlMailMerge['Entity_Companies']},{'value':0x3,'text':ctrlMailMerge['Entity_Requirements']},{'value':0x4,'text':ctrlMailMerge['Entity_Placements']},{'value':0x5,'text':ctrlMailMerge['Entity_Users']}];TriSysSDK['CShowForm']['populateComboFromDataSource'](ctrlMailMerge['EntityID'],entities,0x3),ctrlMailMerge['EntityComboClick'](ctrlMailMerge['GetSelectedEntity']());},'GetSelectedEntity':function(){return TriSysSDK['CShowForm']['GetTextFromCombo'](ctrlMailMerge['EntityID']);},'EntityComboClick':function(sEntity){switch(sEntity){case ctrlMailMerge['Entity_ClientContacts']:ctrlMailMerge['LoadContactGrid'](ctrlMailMerge['Data']['ListOf_Entity_ClientContacts']);break;case ctrlMailMerge['Entity_CandidateContacts']:ctrlMailMerge['LoadContactGrid'](ctrlMailMerge['Data']['ListOf_Entity_CandidateContacts']);break;case ctrlMailMerge['Entity_Companies']:ctrlMailMerge['LoadCompanyGrid']();break;case ctrlMailMerge['Entity_Requirements']:ctrlMailMerge['LoadRequirementGrid']();break;case ctrlMailMerge['Entity_Placements']:ctrlMailMerge['LoadPlacementGrid']();break;case ctrlMailMerge['Entity_Users']:ctrlMailMerge['LoadUserGrid']();break;case ctrlMailMerge['Entity_Interviews']:ctrlMailMerge['LoadInterviewGrid']();break;case ctrlMailMerge['Entity_Events']:ctrlMailMerge['LoadEventGrid']();break;case ctrlMailMerge['Entity_News']:ctrlMailMerge['LoadNewsGrid']();break;}},'LoadContactGrid':function(lst){var sEntityName='Contact',criteria={'EntityName':sEntityName,'RecordList':lst},sJson=JSON['stringify'](criteria),columns=JSON['parse'](JSON['stringify'](TriSysWeb['Pages']['Contacts']['Columns']));columns=TriSysSDK['Grid']['HideColumns'](columns,['Contact_EMail','Contact_HomeEMail','Contact_WorkTelNo','Contact_MobileTelNo','Contact_WorkMobile','Contact_HomeAddressTelNo']),columns=TriSysSDK['Grid']['ShowColumns'](columns,['Contact_HomeAddressCity','Contact_JobTitle'],!![]);var fnPopulationByFunction={'API':'Contacts/List','Parameters':function(request){request['SearchTreeEnabled']=!![],request['SearchTreeJson']=sJson;},'DataTableFunction':function(response){return response['List'];}};ctrlMailMerge['LoadEntityGrid'](sEntityName,fnPopulationByFunction,columns);},'LoadCompanyGrid':function(){var sEntityName='Company',sEntityName='Contact',criteria={'EntityName':sEntityName,'RecordList':ctrlMailMerge['Data']['ListOf_Entity_Companies']},sJson=JSON['stringify'](criteria),columns=TriSysWeb['Pages']['Companies']['Columns'];columns=TriSysSDK['Grid']['HideColumns'](columns,['Company_MainTelNo']);var fnPopulationByFunction={'API':'Companies/List','Parameters':function(request){request['SearchTreeEnabled']=!![],request['SearchTreeJson']=sJson;},'DataTableFunction':function(response){return response['List'];}};ctrlMailMerge['LoadEntityGrid'](sEntityName,fnPopulationByFunction,columns);},'LoadRequirementGrid':function(){var sEntityName='Requirement',criteria={'EntityName':sEntityName,'RecordList':ctrlMailMerge['Data']['ListOf_Entity_Requirements']},sJson=JSON['stringify'](criteria),columns=TriSysWeb['Pages']['Requirements']['Columns'];columns=TriSysSDK['Grid']['HideColumns'](columns,['Requirement_RequirementEntityType','RequirementContact_FullName','Location','Salary','Requirement_RequirementStatus','Requirement_UserName']);var sOrderBy=TriSysWeb['Pages']['Requirements']['OrderBy'],fnPopulationByFunction={'API':'Requirements/List','Parameters':function(request){request['SearchTreeEnabled']=!![],request['SearchTreeJson']=sJson;},'DataTableFunction':function(response){return response['List'];}};ctrlMailMerge['LoadEntityGrid'](sEntityName,fnPopulationByFunction,columns);},'LoadPlacementGrid':function(){var sEntityName='Placement',criteria={'EntityName':sEntityName,'RecordList':ctrlMailMerge['Data']['ListOf_Entity_Placements']},sJson=JSON['stringify'](criteria),columns=TriSysWeb['Pages']['Placements']['Columns'];columns=TriSysSDK['Grid']['HideColumns'](columns,['Placement_PlacementEntityType','Placement_EndDate','PlacementContact_FullName','Location','City','Salary','Placement_PlacementStatus','Placement_UserName']);var fnPopulationByFunction={'API':'Placements/List','Parameters':function(request){request['SearchTreeEnabled']=!![],request['SearchTreeJson']=sJson;},'DataTableFunction':function(response){return response['List'];}};ctrlMailMerge['LoadEntityGrid'](sEntityName,fnPopulationByFunction,columns);},'LoadUserGrid':function(){var sEntityName='User',criteria={'EntityName':sEntityName,'RecordList':ctrlMailMerge['Data']['ListOf_Entity_Users']},sJson=JSON['stringify'](criteria),columns=JSON['parse'](JSON['stringify'](TriSysApex['ModalDialogue']['Users']['Columns']));columns[0x1]['field']='Name';var fnPopulationByFunction={'API':'Users/List','Parameters':function(request){request['SearchTreeEnabled']=!![],request['SearchTreeJson']=sJson;},'DataTableFunction':function(response){return response['List'];}};ctrlMailMerge['LoadEntityGrid'](sEntityName,fnPopulationByFunction,columns);},'LoadInterviewGrid':function(){},'LoadEventGrid':function(){},'LoadNewsGrid':function(){},'LoadEntityGrid':function(sEntityName,fnPopulationByFunction,columns){var sGrid=ctrlMailMerge['GridID'],sGridId=sGrid;TriSysSDK['Grid']['RemoveCheckBoxRowSelectorAndCommandDrillDownColumns'](columns);switch(sEntityName){case'Contact':TriSysWeb['Pages']['Contacts']['PopulateGrid'](sGrid,sGridId,'Contacts',fnPopulationByFunction,columns);break;case'Company':TriSysWeb['Pages']['Companies']['PopulateGrid'](sGrid,sGridId,'Companies',fnPopulationByFunction,columns);break;case'Requirement':TriSysWeb['Pages']['Requirements']['PopulateGrid'](sGrid,sGridId,'Requirements',fnPopulationByFunction,columns);break;case'Placement':TriSysWeb['Pages']['Placements']['PopulateGrid'](sGrid,sGridId,'Placements',fnPopulationByFunction,columns);break;case'Timesheet':TriSysWeb['Pages']['Timesheets']['PopulateGrid'](sGrid,sGridId,'Timesheets',fnPopulationByFunction,columns);break;case'User':TriSysSDK['Grid']['VirtualMode']({'Div':sGrid,'ID':sGridId,'RecordsPerPage':0xa,'PopulationByFunction':fnPopulationByFunction,'Columns':columns,'MultiRowSelect':![],'Grouping':![],'ColumnFilters':!![]});break;}},'AddGridRecord':function(){var sEntity=ctrlMailMerge['GetSelectedEntity']();switch(sEntity){case ctrlMailMerge['Entity_ClientContacts']:TriSysApex['Pages']['ContactForm']['OpenFindDialogue'](function(lRecordId){TriSysActions['EntityListManagement']['AddRecordIdToEntityList'](lRecordId,ctrlMailMerge['Data']['ListOf_Entity_ClientContacts']),ctrlMailMerge['LoadContactGrid'](ctrlMailMerge['Data']['ListOf_Entity_ClientContacts']);});break;case ctrlMailMerge['Entity_CandidateContacts']:TriSysApex['Pages']['ContactForm']['OpenFindDialogue'](function(lRecordId){TriSysActions['EntityListManagement']['AddRecordIdToEntityList'](lRecordId,ctrlMailMerge['Data']['ListOf_Entity_CandidateContacts']),ctrlMailMerge['LoadContactGrid'](ctrlMailMerge['Data']['ListOf_Entity_CandidateContacts']);});break;case ctrlMailMerge['Entity_Companies']:TriSysApex['Pages']['CompanyForm']['OpenFindDialogue'](function(lRecordId){TriSysActions['EntityListManagement']['AddRecordIdToEntityList'](lRecordId,ctrlMailMerge['Data']['ListOf_Entity_Companies']),ctrlMailMerge['LoadCompanyGrid']();});break;case ctrlMailMerge['Entity_Requirements']:TriSysApex['Pages']['RequirementForm']['OpenFindDialogue'](function(lRecordId){TriSysActions['EntityListManagement']['AddRecordIdToEntityList'](lRecordId,ctrlMailMerge['Data']['ListOf_Entity_Requirements']),ctrlMailMerge['LoadRequirementGrid']();});break;case ctrlMailMerge['Entity_Placements']:TriSysApex['Pages']['PlacementForm']['OpenFindDialogue'](function(lRecordId){TriSysActions['EntityListManagement']['AddRecordIdToEntityList'](lRecordId,ctrlMailMerge['Data']['ListOf_Entity_Placements']),ctrlMailMerge['LoadPlacementGrid']();});break;case ctrlMailMerge['Entity_Users']:var fnSelectUser=function(selectedRow){if(!selectedRow)return;var lUserId=selectedRow['UserId'];return TriSysActions['EntityListManagement']['AddRecordIdToEntityList'](lUserId,ctrlMailMerge['Data']['ListOf_Entity_Users']),ctrlMailMerge['LoadUserGrid'](),!![];};TriSysApex['ModalDialogue']['Users']['Select'](fnSelectUser,{'NotLocked':!![]});break;}},'DeleteGridRecord':function(){var recordIds=TriSysSDK['Grid']['GetSelectedMultipleRowsFromGrid'](ctrlMailMerge['GridID'],ctrlMailMerge['KeyFieldId']);if(recordIds){var sEntity=ctrlMailMerge['GetSelectedEntity']();switch(sEntity){case ctrlMailMerge['Entity_ClientContacts']:TriSysActions['EntityListManagement']['RemoveRecordIdsFromEntityList'](recordIds,ctrlMailMerge['Data']['ListOf_Entity_ClientContacts']),ctrlMailMerge['LoadContactGrid'](ctrlMailMerge['Data']['ListOf_Entity_ClientContacts']);break;case ctrlMailMerge['Entity_CandidateContacts']:TriSysActions['EntityListManagement']['RemoveRecordIdsFromEntityList'](recordIds,ctrlMailMerge['Data']['ListOf_Entity_CandidateContacts']),ctrlMailMerge['LoadContactGrid'](ctrlMailMerge['Data']['ListOf_Entity_CandidateContacts']);break;case ctrlMailMerge['Entity_Companies']:TriSysActions['EntityListManagement']['RemoveRecordIdsFromEntityList'](recordIds,ctrlMailMerge['Data']['ListOf_Entity_Companies']),ctrlMailMerge['LoadCompanyGrid']();break;case ctrlMailMerge['Entity_Requirements']:TriSysActions['EntityListManagement']['RemoveRecordIdsFromEntityList'](recordIds,ctrlMailMerge['Data']['ListOf_Entity_Requirements']),ctrlMailMerge['LoadRequirementGrid']();break;case ctrlMailMerge['Entity_Placements']:TriSysActions['EntityListManagement']['RemoveRecordIdsFromEntityList'](recordIds,ctrlMailMerge['Data']['ListOf_Entity_Placements']),ctrlMailMerge['LoadPlacementGrid']();break;case ctrlMailMerge['Entity_Users']:TriSysActions['EntityListManagement']['RemoveRecordIdsFromEntityList'](recordIds,ctrlMailMerge['Data']['ListOf_Entity_Users']),ctrlMailMerge['LoadUserGrid']();break;}}},'PopulateActionData':function(){var CReadMailMergeDetailsActionRequest=new TriSysActions['Invocation']['ActionData'](),payloadObject={};payloadObject['URL']='Action/ReadMailMergeDetails',payloadObject['OutboundDataPacket']=CReadMailMergeDetailsActionRequest,payloadObject['InboundDataFunction']=function(CReadMailMergeDetailsActionResponse){TriSysApex['UI']['HideWait']();if(CReadMailMergeDetailsActionResponse){if(CReadMailMergeDetailsActionResponse['Success']){TriSysActions['MailMerge']['DisplayContactDetails'](CReadMailMergeDetailsActionResponse['Contacts'],ctrlMailMerge['ContactID']);return;}else TriSysApex['UI']['ShowMessage'](CReadMailMergeDetailsActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlMailMerge.PopulateActionData:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Contacts...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'MailMergeData':function(){var sClientContactCount=ctrlMailMerge['Data']['ListOf_Entity_ClientContacts']['length'],sCandidateContactCount=ctrlMailMerge['Data']['ListOf_Entity_CandidateContacts']['length'],sCompanyCount=ctrlMailMerge['Data']['ListOf_Entity_Companies']['length'],sRequirementCount=ctrlMailMerge['Data']['ListOf_Entity_Requirements']['length'],sPlacementCount=ctrlMailMerge['Data']['ListOf_Entity_Placements']['length'],sUserCount=ctrlMailMerge['Data']['ListOf_Entity_Users']['length'],ClientContactIds=TriSysSDK['Miscellaneous']['ArrayToCommaSeparatedIdList'](ctrlMailMerge['Data']['ListOf_Entity_ClientContacts'],![]),CandidateContactIds=TriSysSDK['Miscellaneous']['ArrayToCommaSeparatedIdList'](ctrlMailMerge['Data']['ListOf_Entity_CandidateContacts'],![]),CompanyIds=TriSysSDK['Miscellaneous']['ArrayToCommaSeparatedIdList'](ctrlMailMerge['Data']['ListOf_Entity_Companies'],![]),RequirementIds=TriSysSDK['Miscellaneous']['ArrayToCommaSeparatedIdList'](ctrlMailMerge['Data']['ListOf_Entity_Requirements'],![]),PlacementIds=TriSysSDK['Miscellaneous']['ArrayToCommaSeparatedIdList'](ctrlMailMerge['Data']['ListOf_Entity_Placements'],![]),UserIds=TriSysSDK['Miscellaneous']['ArrayToCommaSeparatedIdList'](ctrlMailMerge['Data']['ListOf_Entity_Users'],![]),actionSpecificData={'ActionName':'MailMerge','ActionDisplayName':'Mail\x20Merge','Values':[{'FieldName':'ClientContactCount','FieldDisplayName':'ClientContact\x20Count','Value':sClientContactCount},{'FieldName':'CandidateContactCount','FieldDisplayName':'CandidateContact\x20Count','Value':sCandidateContactCount},{'FieldName':'CompanyCount','FieldDisplayName':'Company\x20Count','Value':sCompanyCount},{'FieldName':'RequirementCount','FieldDisplayName':'Requirement\x20Count','Value':sRequirementCount},{'FieldName':'PlacementCount','FieldDisplayName':'Placement\x20Count','Value':sPlacementCount},{'FieldName':'UserCount','FieldDisplayName':'User\x20Count','Value':sUserCount},{'FieldName':'ClientContactIdList','FieldDisplayName':'Client\x20Contact\x20Id\x20List','Value':ClientContactIds,'Hidden':!![]},{'FieldName':'CandidateContactIdList','FieldDisplayName':'Candidate\x20Contact\x20Id\x20List','Value':CandidateContactIds,'Hidden':!![]},{'FieldName':'CompanyIdList','FieldDisplayName':'Company\x20Id\x20List','Value':CompanyIds,'Hidden':!![]},{'FieldName':'RequirementIdList','FieldDisplayName':'Requirement\x20Id\x20List','Value':RequirementIds,'Hidden':!![]},{'FieldName':'PlacementIdList','FieldDisplayName':'Placement\x20Id\x20List','Value':PlacementIds,'Hidden':!![]},{'FieldName':'UserIdList','FieldDisplayName':'User\x20Id\x20List','Value':UserIds,'Hidden':!![]}]};return actionSpecificData;},'Finish':function(){var mySettings=ctrlMailMerge['GetSettingsForSelectedTemplate']();if(!mySettings)return;var NoteHistoryData=ctrlNoteHistory['Validation']();if(!NoteHistoryData)return;var FollowUpData=ctrlFollowUp['Validation']();if(!FollowUpData)return;var fnCallbackIfInvalidSMTPCredentialsWillNotCauseFailure=function(){var bAsynchronousMailMerge=![];if(ctrlMailMerge['isSMTPDelivery']())bAsynchronousMailMerge=![];ctrlMailMerge['SendActionDataToWebAPI'](mySettings,NoteHistoryData,FollowUpData,bAsynchronousMailMerge);},sDeliveryMethod=TriSysSDK['CShowForm']['GetTextFromCombo'](ctrlMailMerge['DeliveryID']);if(sDeliveryMethod==ctrlMailMerge['Delivery_SMTP']){var options={'callbackIfOKToProceed':fnCallbackIfInvalidSMTPCredentialsWillNotCauseFailure};TriSysActions['SMTPChecking']['PreventContinueWithoutSMTPCredentials']('Mail-Merge\x20Action',options);}else fnCallbackIfInvalidSMTPCredentialsWillNotCauseFailure();},'isSMTPDelivery':function(){var sDeliveryMethod=TriSysSDK['CShowForm']['GetTextFromCombo'](ctrlMailMerge['DeliveryID']);return sDeliveryMethod==ctrlMailMerge['Delivery_SMTP'];},'GetSettingsForSelectedTemplate':function(){var sError=null,sTemplate=TriSysActions['MailMerge']['GetTemplateFromCombo'](ctrlMailMerge['TemplatesID']),sAttachments=TriSysSDK['CShowForm']['GetSelectedSkillsFromList'](ctrlMailMerge['AttachmentsID']),sDelivery=TriSysSDK['CShowForm']['GetTextFromCombo'](ctrlMailMerge['DeliveryID']),sSubject=$('#'+ctrlMailMerge['SubjectID'])['val'](),bBCC=TriSysSDK['CShowForm']['GetCheckBoxValue'](ctrlMailMerge['BlindCopyID'],![]);if(!sTemplate)sError='You\x20must\x20choose\x20an\x20e-mail\x20template.';else{if(!sSubject&&sDelivery!=ctrlMailMerge['Delivery_Twitter'])sError='You\x20must\x20specify\x20an\x20e-mail\x20subject\x20heading.';}if(sError)return TriSysApex['UI']['ShowMessage'](sError),null;var mySettings={'Template':sTemplate,'Attachments':sAttachments,'Delivery':sDelivery,'Subject':sSubject,'BlindCopy':bBCC,'NoteHistory':ctrlNoteHistory['Validation'](),'FollowUp':ctrlFollowUp['Validation'](),'Entity':ctrlMailMerge['GetSelectedEntity'](),'Lists':{'ClientContacts':ctrlMailMerge['Data']['ListOf_Entity_ClientContacts'],'CandidateContacts':ctrlMailMerge['Data']['ListOf_Entity_CandidateContacts'],'Companies':ctrlMailMerge['Data']['ListOf_Entity_Companies'],'Requirements':ctrlMailMerge['Data']['ListOf_Entity_Requirements'],'Placements':ctrlMailMerge['Data']['ListOf_Entity_Placements'],'Users':ctrlMailMerge['Data']['ListOf_Entity_Users']}};return mySettings;},'GetSettings':function(){var mySettings=ctrlMailMerge['GetSettingsForSelectedTemplate']();if(!mySettings)return;if(!ctrlMailMerge['PersistedSettings'])ctrlMailMerge['PersistedSettings']={'Default':mySettings['Template'],'Templates':[]};var iIndex=ctrlMailMerge['GetSettingsIndexForTemplate'](mySettings['Template']);if(iIndex>=0x0)ctrlMailMerge['PersistedSettings']['Templates']['splice'](iIndex,0x1);return ctrlMailMerge['PersistedSettings']['Templates']['push'](mySettings),ctrlMailMerge['PersistedSettings']['Default']=mySettings['Template'],ctrlMailMerge['PersistedSettings'];},'Configure':function(){var mySettings=ctrlMailMerge['GetSettings']();if(!mySettings)return;TriSysActions['Persistence']['Write'](mySettings);},'SendActionDataToWebAPI':function(mySettings,NoteHistoryData,FollowUpData,bAsynchronousMailMerge){var CMailMergeActionRequest={'Settings':mySettings,'ActionData':new TriSysActions['Invocation']['ActionData'](),'NoteHistory':NoteHistoryData,'FollowUp':FollowUpData},payloadObject={};payloadObject['URL']='Action/MailMerge',payloadObject['OutboundDataPacket']=CMailMergeActionRequest,payloadObject['InboundDataFunction']=function(CMailMergeActionResponse){if(!bAsynchronousMailMerge)TriSysApex['UI']['HideWait']();if(CMailMergeActionResponse){if(CMailMergeActionResponse['Success']){TriSysActions['Invocation']['PostInvocationCompletion']();if(CMailMergeActionResponse['URL'])for(var i=0x0;i<CMailMergeActionResponse['URL']['length'];i++){var sURL=CMailMergeActionResponse['URL'][i];TriSysApex['ModalDialogue']['DocumentViewer']['DownloadAndOpen']('e-mail',sURL);}else{if(CMailMergeActionResponse['MailMessages']){if(CMailMergeActionResponse['MailMessages']['length']>0x0)TriSysActions['EMail']['SendDialogue'](CMailMergeActionResponse['MailMessages']);}}return;}else TriSysApex['UI']['ShowMessage'](CMailMergeActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){if(!bAsynchronousMailMerge)TriSysApex['UI']['HideWait']();TriSysApex['UI']['errorAlert']('ctrlMailMerge.SendActionDataToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);};if(bAsynchronousMailMerge){var fnCloseAction=function(){return setTimeout(TriSysApex['UI']['CloseModalPopup'],0x64),!![];};TriSysApex['UI']['ShowMessage']('Mail\x20Merge\x20has\x20been\x20scheduled.','Mail-Merge\x20Action',fnCloseAction);}else TriSysApex['UI']['ShowWait'](null,'Mail\x20Merging...');TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'SelectedTemplateEvent':function(sTemplateName,sText,sFieldID){var options={'Template':sTemplateName};TriSysActions['Persistence']['Read'](ctrlMailMerge['ReadPersistedSettingsCallback'],options);}};$(document)['ready'](function(){ctrlMailMerge['Load']();});