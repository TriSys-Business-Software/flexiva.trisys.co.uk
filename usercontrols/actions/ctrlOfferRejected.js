var ctrlOfferRejected={'ClientID':'ctrlOfferRejected-Client','RequirementID':'ctrlOfferRejected-Requirement','CandidateID':'ctrlOfferRejected-Candidate','ClientTemplatesID':'ctrlOfferRejected-ClientTemplate','CandidateTemplatesID':'ctrlOfferRejected-CandidateTemplate','EditClientTemplateButtonID':'ctrlOfferRejected-EditClientTemplate','EditCandidateTemplateButtonID':'ctrlOfferRejected-EditCandidateTemplate','ClientSubjectID':'ctrlOfferRejected-ClientSubject','CandidateSubjectID':'ctrlOfferRejected-CandidateSubject','StartDateID':'ctrlOfferRejected-StartDate','EndDateID':'ctrlOfferRejected-EndDate','SalaryID':'ctrlOfferRejected-Salary','NoteHistoryID':'ctrlOfferRejected-NoteHistory','FollowUpID':'ctrlOfferRejected-FollowUp','CandidateList':null,'Load':function(){var sOfferRejected='OfferRejected',sOfferRejectedFolder=sOfferRejected+'/';TriSysActions['MailMerge']['PopulateTemplates'](sOfferRejected+':\x20Client',TriSysActions['MailMerge']['MasterTemplateFolder']+sOfferRejectedFolder+TriSysActions['MailMerge']['ClientTemplatesFolder'],ctrlOfferRejected['ClientTemplatesID'],'Client\x20Offer\x20Rejected',ctrlOfferRejected['EditClientTemplateButtonID']),TriSysActions['MailMerge']['PopulateTemplates'](sOfferRejected+':\x20Candidate',TriSysActions['MailMerge']['MasterTemplateFolder']+sOfferRejectedFolder+TriSysActions['MailMerge']['CandidateTemplatesFolder'],ctrlOfferRejected['CandidateTemplatesID'],'Candidate\x20Offer\x20Rejected',ctrlOfferRejected['EditCandidateTemplateButtonID']);var defaults={'TaskType':'Letter'};TriSysActions['NoteHistory']['Load'](ctrlOfferRejected['NoteHistoryID'],defaults),TriSysSDK['CShowForm']['datePicker'](ctrlOfferRejected['StartDateID']),TriSysSDK['CShowForm']['datePicker'](ctrlOfferRejected['EndDateID']);var fSpinIncrement=0x1f4,sPeriod='Annum';TriSysSDK['Controls']['CurrencyAmountPeriod']['PopulateCurrencyAmountPeriodWidget'](ctrlOfferRejected['SalaryID'],fSpinIncrement,sPeriod);var dtFollowUp=TriSysActions['FollowUp']['FollowUpDateTomorrow']();defaults={'CreateFollowUp':!![],'StartDateTime':dtFollowUp},TriSysActions['FollowUp']['Load'](ctrlOfferRejected['FollowUpID'],defaults),ctrlOfferRejected['PopulateActionData']();},'PopulateActionData':function(){if(TriSysActions['Invocation']['SingletonContactListCheck']('Offer\x20Rejected','candidate'))return;var CReadCVSendDetailsActionRequest=new TriSysActions['Invocation']['ActionData'](),payloadObject={};payloadObject['URL']='Action/ReadCVSendDetails',payloadObject['OutboundDataPacket']=CReadCVSendDetailsActionRequest,payloadObject['InboundDataFunction']=function(CReadCVSendDetailsActionResponse){TriSysApex['UI']['HideWait']();if(CReadCVSendDetailsActionResponse){if(CReadCVSendDetailsActionResponse['Success']){ctrlOfferRejected['DisplayClientContactDetails'](CReadCVSendDetailsActionResponse['ClientContact']),ctrlOfferRejected['DisplayCandidateDetails'](CReadCVSendDetailsActionResponse['CandidateContacts']),ctrlOfferRejected['DisplayRequirementDetails'](CReadCVSendDetailsActionResponse['Requirement']);if(CReadCVSendDetailsActionResponse['Requirement'])TriSysSDK['CShowForm']['setDatePickerValue'](ctrlOfferRejected['StartDateID'],CReadCVSendDetailsActionResponse['Requirement']['EarliestStartDate']);TriSysActions['Persistence']['Read'](ctrlOfferRejected['ReadPersistedSettingsCallback']);return;}else TriSysApex['UI']['ShowMessage'](CReadCVSendDetailsActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlOfferRejected.PopulateActionData:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Contacts...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DisplayClientContactDetails':function(contact){var sContact=contact['FullName'];if(contact['CompanyName'])sContact+=',\x20'+contact['CompanyName'];$('#'+ctrlOfferRejected['ClientID'])['html'](sContact);},'DisplayCandidateDetails':function(contactList){ctrlOfferRejected['CandidateList']=contactList;var sContact='';if(contactList&&contactList['length']==0x1){var contact=contactList[0x0];sContact=contact['FullName'];if(contact['HomeAddressStreet'])sContact+=',\x20'+contact['HomeAddressStreet']['replace'](/\r\n/g,',\x20');if(contact['HomeAddressCity'])sContact+=',\x20'+contact['HomeAddressCity'];}else{if(contactList)for(var i=0x0;i<contactList['length'];i++){var contact=contactList[i];if(sContact['length']>0x0)sContact+=',\x20';sContact+=contact['FullName'];}}$('#'+ctrlOfferRejected['CandidateID'])['html'](sContact);},'DisplayRequirementDetails':function(requirement){if(requirement){$('#'+ctrlOfferRejected['RequirementID'])['html'](requirement['Reference']+':\x20'+requirement['JobTitle']);if(requirement['Type']=='Permanent')TriSysSDK['Controls']['CurrencyAmountPeriod']['SetCurrencyAmountPeriod'](ctrlOfferRejected['SalaryID'],requirement['Salary']),$('#ctrlOfferRejected-EndDate-tr')['hide']();else $('#ctrlOfferRejected-Salary-tr')['hide']();}else $('#ctrlOfferRejected-Requirement-tr')['hide']();},'Configure':function(){var mySettings=ctrlOfferRejected['GetSettings']();if(!mySettings)return;TriSysActions['Persistence']['Write'](mySettings);},'GetSettings':function(){var sError=null,sClientTemplate=TriSysActions['MailMerge']['GetTemplateFromCombo'](ctrlOfferRejected['ClientTemplatesID']),sCandidateTemplate=TriSysActions['MailMerge']['GetTemplateFromCombo'](ctrlOfferRejected['CandidateTemplatesID']),sClientSubject=$('#'+ctrlOfferRejected['ClientSubjectID'])['val'](),sCandidateSubject=$('#'+ctrlOfferRejected['CandidateSubjectID'])['val']();if(sError)return TriSysApex['UI']['ShowMessage'](sError),null;var mySettings={'ClientTemplate':sClientTemplate,'CandidateTemplate':sCandidateTemplate,'ClientSubject':sClientSubject,'CandidateSubject':sCandidateSubject,'NoteHistory':ctrlNoteHistory['Validation'](),'FollowUp':ctrlFollowUp['Validation']()};return mySettings;},'ReadPersistedSettingsCallback':function(mySettings){TriSysSDK['CShowForm']['SetTextInCombo'](ctrlOfferRejected['ClientTemplatesID'],mySettings['ClientTemplate']),TriSysSDK['CShowForm']['SetTextInCombo'](ctrlOfferRejected['CandidateTemplatesID'],mySettings['CandidateTemplate']),$('#'+ctrlOfferRejected['ClientSubjectID'])['val'](mySettings['ClientSubject']),$('#'+ctrlOfferRejected['CandidateSubjectID'])['val'](mySettings['CandidateSubject']),TriSysActions['PersistedSettingsSafeguard']['WaitUntilTaskControlsAreLoaded'](!![],!![],function(){ctrlNoteHistory['Reload'](mySettings['NoteHistory']),ctrlFollowUp['Reload'](mySettings['FollowUp']);});},'MailMergeData':function(){if(!ctrlOfferRejected['CandidateList'])return;var dtStart=TriSysSDK['CShowForm']['getDatePickerValue'](ctrlOfferRejected['StartDateID']),sFormatedStartDate=dtStart?moment(dtStart)['format']('dddd\x20DD\x20MMMM\x20YYYY'):null,dtEnd=TriSysSDK['CShowForm']['getDatePickerValue'](ctrlOfferRejected['EndDateID']),sFormatedEndDate=dtEnd?moment(dtEnd)['format']('dddd\x20DD\x20MMMM\x20YYYY'):null,sSalary=TriSysSDK['Controls']['CurrencyAmountPeriod']['GetCurrencyAmountPeriod'](ctrlOfferRejected['SalaryID'],!![]),actionSpecificData={'ActionName':'OfferRejected','ActionDisplayName':'Offer\x20Rejected','Values':[{'FieldName':'StartDate','FieldDisplayName':'Start\x20Date','Value':sFormatedStartDate},{'FieldName':'EndDate','FieldDisplayName':'End\x20Date','Value':sFormatedEndDate},{'FieldName':'Salary','FieldDisplayName':'Salary','Value':sSalary}]};return actionSpecificData;},'Finish':function(){var mySettings=ctrlOfferRejected['GetSettings']();if(!mySettings)return;var NoteHistoryData=ctrlNoteHistory['Validation']();if(!NoteHistoryData)return;var FollowUpData=ctrlFollowUp['Validation']();if(!FollowUpData)return;var sError=null,dtStart=TriSysSDK['CShowForm']['getDatePickerValue'](ctrlOfferRejected['StartDateID']),dtEnd=TriSysSDK['CShowForm']['getDatePickerValue'](ctrlOfferRejected['EndDateID']);if(!dtStart)sError='Please\x20specify\x20a\x20start\x20date.';else{var bVisible=$('#'+ctrlOfferRejected['EndDateID'])['is'](':visible');if(bVisible){if(!dtEnd)sError='Please\x20specify\x20an\x20end\x20date.';}}if(sError)return TriSysApex['UI']['ShowMessage'](sError),null;ctrlOfferRejected['SendActionDataToWebAPI'](mySettings,NoteHistoryData,FollowUpData);},'SendActionDataToWebAPI':function(mySettings,NoteHistoryData,FollowUpData){var COfferRejectedActionRequest={'ClientTemplate':mySettings['ClientTemplate'],'CandidateTemplate':mySettings['CandidateTemplate'],'ClientSubject':mySettings['ClientSubject'],'CandidateSubject':mySettings['CandidateSubject'],'ActionData':new TriSysActions['Invocation']['ActionData'](),'NoteHistory':NoteHistoryData,'FollowUp':FollowUpData},payloadObject={};payloadObject['URL']='Action/OfferRejected',payloadObject['OutboundDataPacket']=COfferRejectedActionRequest,payloadObject['InboundDataFunction']=function(COfferRejectedActionResponse){TriSysApex['UI']['HideWait']();if(COfferRejectedActionResponse){if(COfferRejectedActionResponse['Success']){TriSysActions['Invocation']['PostInvocationCompletion']();if(COfferRejectedActionResponse['URL'])for(var i=0x0;i<COfferRejectedActionResponse['URL']['length'];i++){var sURL=COfferRejectedActionResponse['URL'][i];TriSysApex['ModalDialogue']['DocumentViewer']['DownloadAndOpen']('e-mail',sURL);}return;}else TriSysApex['UI']['ShowMessage'](COfferRejectedActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlOfferRejected.SendActionDataToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Generating\x20E-Mail...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);}};$(document)['ready'](function(){ctrlOfferRejected['Load']();});