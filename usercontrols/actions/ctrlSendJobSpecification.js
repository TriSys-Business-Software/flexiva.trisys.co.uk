var ctrlSendJobSpecification={'ClientID':'ctrlSendJobSpecification-Client','RequirementID':'ctrlSendJobSpecification-Requirement','CandidateID':'ctrlSendJobSpecification-Candidate','CandidateTemplatesID':'ctrlSendJobSpecification-CandidateTemplate','EditCandidateTemplateButtonID':'ctrlSendJobSpecification-EditCandidateTemplate','CandidateSubjectID':'ctrlSendJobSpecification-CandidateSubject','JobDescriptionID':'ctrlSendJobSpecification-JobDescription','NoteHistoryID':'ctrlSendJobSpecification-NoteHistory','FollowUpID':'ctrlSendJobSpecification-FollowUp','AttachmentsID':'ctrlSendJobSpecification-Attachments','ManageAttachmentsButtonID':'ctrlSendJobSpecification-ManageAttachmentLibrary','DeliveryID':'ctrlSendJobSpecification-Delivery','Delivery_Outlook':'Outlook\x20E-Mail','Delivery_SMTP':'SMTP\x20E-Mail','CandidateList':null,'Load':function(){var sSendJobSpecifications='Send\x20Job\x20Specifications',sSendJobSpecificationsFolder=sSendJobSpecifications+'/';TriSysActions['MailMerge']['PopulateTemplates'](sSendJobSpecifications,TriSysActions['MailMerge']['MasterTemplateFolder']+sSendJobSpecificationsFolder,ctrlSendJobSpecification['CandidateTemplatesID'],'Job\x20Specification',ctrlSendJobSpecification['EditCandidateTemplateButtonID']),TriSysActions['MailMerge']['PopulateAttachments'](ctrlSendJobSpecification['AttachmentsID'],ctrlSendJobSpecification['ManageAttachmentsButtonID']),ctrlSendJobSpecification['PopulateDeliveryCombo']();var defaults={'TaskType':'Letter'};TriSysActions['NoteHistory']['Load'](ctrlSendJobSpecification['NoteHistoryID'],defaults),defaults={'HideFindButton':!![],'HideDeleteButton':!![]},TriSysSDK['Controls']['FileReference']['Load'](ctrlSendJobSpecification['JobDescriptionID'],null,null,defaults);var dtFollowUp=TriSysActions['FollowUp']['FollowUpDateTomorrow']();defaults={'CreateFollowUp':!![],'StartDateTime':dtFollowUp},TriSysActions['FollowUp']['Load'](ctrlSendJobSpecification['FollowUpID'],defaults),ctrlSendJobSpecification['PopulateActionData']();},'PopulateActionData':function(){var CReadCVSendDetailsActionRequest=new TriSysActions['Invocation']['ActionData'](),payloadObject={};payloadObject['URL']='Action/ReadCVSendDetails',payloadObject['OutboundDataPacket']=CReadCVSendDetailsActionRequest,payloadObject['InboundDataFunction']=function(CReadCVSendDetailsActionResponse){TriSysApex['UI']['HideWait']();if(CReadCVSendDetailsActionResponse){if(CReadCVSendDetailsActionResponse['Success']){ctrlSendJobSpecification['DisplayClientContactDetails'](CReadCVSendDetailsActionResponse['ClientContact']),ctrlSendJobSpecification['DisplayCandidateDetails'](CReadCVSendDetailsActionResponse['CandidateContacts']),ctrlSendJobSpecification['DisplayRequirementDetails'](CReadCVSendDetailsActionResponse['Requirement']);if(CReadCVSendDetailsActionResponse['Requirement']['JobDescription'])TriSysSDK['Controls']['FileReference']['SetFile'](ctrlSendJobSpecification['JobDescriptionID'],CReadCVSendDetailsActionResponse['Requirement']['JobDescription']);TriSysActions['Persistence']['Read'](ctrlSendJobSpecification['ReadPersistedSettingsCallback']);return;}else TriSysApex['UI']['ShowMessage'](CReadCVSendDetailsActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlSendJobSpecification.PopulateActionData:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Contacts...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DisplayClientContactDetails':function(contact){var sContact=contact['FullName'];if(contact['CompanyName'])sContact+=',\x20'+contact['CompanyName'];$('#'+ctrlSendJobSpecification['ClientID'])['html'](sContact);},'DisplayCandidateDetails':function(contactList){ctrlSendJobSpecification['CandidateList']=contactList;var sContact='';if(contactList&&contactList['length']==0x1){var contact=contactList[0x0];sContact=contact['FullName'];if(contact['HomeAddressStreet'])sContact+=',\x20'+contact['HomeAddressStreet']['replace'](/\r\n/g,',\x20');if(contact['HomeAddressCity'])sContact+=',\x20'+contact['HomeAddressCity'];}else{if(contactList)for(var i=0x0;i<contactList['length'];i++){var contact=contactList[i];if(sContact['length']>0x0)sContact+=',\x20';sContact+=contact['FullName'];}}$('#'+ctrlSendJobSpecification['CandidateID'])['html'](sContact);},'DisplayRequirementDetails':function(requirement){requirement?$('#'+ctrlSendJobSpecification['RequirementID'])['html'](requirement['Reference']+':\x20'+requirement['JobTitle']):$('#ctrlSendJobSpecification-Requirement-tr')['hide']();},'Configure':function(){var mySettings=ctrlSendJobSpecification['GetSettings']();if(!mySettings)return;TriSysActions['Persistence']['Write'](mySettings);},'GetSettings':function(){var sError=null,sCandidateTemplate=TriSysActions['MailMerge']['GetTemplateFromCombo'](ctrlSendJobSpecification['CandidateTemplatesID']),sCandidateSubject=$('#'+ctrlSendJobSpecification['CandidateSubjectID'])['val'](),sAttachments=TriSysSDK['CShowForm']['GetSelectedSkillsFromList'](ctrlSendJobSpecification['AttachmentsID']),sDelivery=TriSysSDK['CShowForm']['GetTextFromCombo'](ctrlSendJobSpecification['DeliveryID']);if(sError)return TriSysApex['UI']['ShowMessage'](sError),null;var mySettings={'CandidateTemplate':sCandidateTemplate,'CandidateSubject':sCandidateSubject,'Attachments':sAttachments,'Delivery':sDelivery,'NoteHistory':ctrlNoteHistory['Validation'](),'FollowUp':ctrlFollowUp['Validation']()};return mySettings;},'ReadPersistedSettingsCallback':function(mySettings){TriSysSDK['CShowForm']['SetTextInCombo'](ctrlSendJobSpecification['CandidateTemplatesID'],mySettings['CandidateTemplate']),$('#'+ctrlSendJobSpecification['CandidateSubjectID'])['val'](mySettings['CandidateSubject']),TriSysSDK['CShowForm']['SetTextInCombo'](ctrlSendJobSpecification['DeliveryID'],mySettings['Delivery']),ctrlSendJobSpecification['DeliveryComboClick'](mySettings['Delivery']),TriSysActions['PersistedSettingsSafeguard']['WaitUntilTaskControlsAreLoaded'](!![],!![],function(){ctrlNoteHistory['Reload'](mySettings['NoteHistory']),ctrlFollowUp['Reload'](mySettings['FollowUp']),TriSysSDK['CShowForm']['SetSkillsInList'](ctrlSendJobSpecification['AttachmentsID'],mySettings['Attachments']);});},'MailMergeData':function(){if(!ctrlSendJobSpecification['CandidateList'])return;var sJobDescription=TriSysSDK['Controls']['FileReference']['GetFile'](ctrlSendJobSpecification['JobDescriptionID']),actionSpecificData={'ActionName':'SendJobSpecification','ActionDisplayName':'Send\x20Job\x20Specification','Values':[{'FieldName':'JobDescription','FieldDisplayName':'Job\x20Description','Value':sJobDescription}]};return actionSpecificData;},'Finish':function(){var mySettings=ctrlSendJobSpecification['GetSettings']();if(!mySettings)return;var NoteHistoryData=ctrlNoteHistory['Validation']();if(!NoteHistoryData)return;var FollowUpData=ctrlFollowUp['Validation']();if(!FollowUpData)return;var sError=null,sJobDescription=TriSysSDK['Controls']['FileReference']['GetFile'](ctrlSendJobSpecification['JobDescriptionID']);if(!sJobDescription)sError='Please\x20specify\x20a\x20job\x20description.';if(sError)return TriSysApex['UI']['ShowMessage'](sError),null;var fnCallbackIfInvalidSMTPCredentialsWillNotCauseFailure=function(){var bAsynchronousMailMerge=![];if(ctrlSendJobSpecification['isSMTPDelivery']())bAsynchronousMailMerge=![];ctrlSendJobSpecification['SendActionDataToWebAPI'](mySettings,NoteHistoryData,FollowUpData,bAsynchronousMailMerge);};if(ctrlSendJobSpecification['isSMTPDelivery']()){var options={'callbackIfOKToProceed':fnCallbackIfInvalidSMTPCredentialsWillNotCauseFailure};TriSysActions['SMTPChecking']['PreventContinueWithoutSMTPCredentials']('Send\x20Job\x20Specification\x20Action',options);}else fnCallbackIfInvalidSMTPCredentialsWillNotCauseFailure();},'isSMTPDelivery':function(){var sDeliveryMethod=TriSysSDK['CShowForm']['GetTextFromCombo'](ctrlSendJobSpecification['DeliveryID']);return sDeliveryMethod==ctrlSendJobSpecification['Delivery_SMTP'];},'SendActionDataToWebAPI':function(mySettings,NoteHistoryData,FollowUpData,bAsynchronousMailMerge){var CSendJobSpecificationActionRequest={'CandidateTemplate':mySettings['CandidateTemplate'],'CandidateSubject':mySettings['CandidateSubject'],'Attachments':mySettings['Attachments'],'Delivery':mySettings['Delivery'],'ActionData':new TriSysActions['Invocation']['ActionData'](),'NoteHistory':NoteHistoryData,'FollowUp':FollowUpData},payloadObject={};payloadObject['URL']='Action/SendJobSpecification',payloadObject['OutboundDataPacket']=CSendJobSpecificationActionRequest,payloadObject['InboundDataFunction']=function(CSendJobSpecificationActionResponse){if(!bAsynchronousMailMerge)TriSysApex['UI']['HideWait']();if(CSendJobSpecificationActionResponse){if(!bAsynchronousMailMerge){if(CSendJobSpecificationActionResponse['Success']){TriSysActions['Invocation']['PostInvocationCompletion']();if(CSendJobSpecificationActionResponse['URL'])for(var i=0x0;i<CSendJobSpecificationActionResponse['URL']['length'];i++){var sURL=CSendJobSpecificationActionResponse['URL'][i];TriSysApex['ModalDialogue']['DocumentViewer']['DownloadAndOpen']('e-mail',sURL);}else{if(CSendJobSpecificationActionResponse['MailMessages']){if(CSendJobSpecificationActionResponse['MailMessages']['length']>0x0)TriSysActions['EMail']['SendDialogue'](CSendJobSpecificationActionResponse['MailMessages']);}}return;}else TriSysApex['UI']['ShowMessage'](CSendJobSpecificationActionResponse['ErrorMessage']);}}},payloadObject['ErrorHandlerFunction']=function(request,status,error){if(!bAsynchronousMailMerge)TriSysApex['UI']['HideWait']();TriSysApex['UI']['errorAlert']('ctrlSendJobSpecification.SendActionDataToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);};if(bAsynchronousMailMerge){var fnCloseAction=function(){return setTimeout(TriSysApex['UI']['CloseModalPopup'],0x64),!![];};TriSysApex['UI']['ShowMessage']('Mail\x20Merge\x20has\x20been\x20scheduled.','Send\x20Job\x20Specification\x20Action',fnCloseAction);}else TriSysApex['UI']['ShowWait'](null,'Mail\x20Merging...');TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'PopulateDeliveryCombo':function(){var delivery=[{'value':0x0,'text':ctrlSendJobSpecification['Delivery_Outlook']},{'value':0x1,'text':ctrlSendJobSpecification['Delivery_SMTP']}],fnDeliveryChange=function(value,sText,sFieldID){sText==ctrlSendJobSpecification['Delivery_SMTP']&&TriSysActions['SMTPChecking']['PreventContinueWithoutSMTPCredentials']('Send\x20Job\x20Specification\x20Action');};TriSysSDK['CShowForm']['populateComboFromDataSource'](ctrlSendJobSpecification['DeliveryID'],delivery,0x0,fnDeliveryChange);},'DeliveryComboClick':function(sDelivery){sDelivery==ctrlSendJobSpecification['Delivery_SMTP']&&TriSysActions['SMTPChecking']['PreventContinueWithoutSMTPCredentials']('Send\x20Job\x20Specification\x20Action');}};$(document)['ready'](function(){ctrlSendJobSpecification['Load']();});