var ctrlReject={'ClientID':'ctrlReject-Client','RequirementID':'ctrlReject-Requirement','CandidateID':'ctrlReject-Candidate','ClientTemplatesID':'ctrlReject-ClientTemplate','CandidateTemplatesID':'ctrlReject-CandidateTemplate','EditClientTemplateButtonID':'ctrlReject-EditClientTemplate','EditCandidateTemplateButtonID':'ctrlReject-EditCandidateTemplate','ClientSubjectID':'ctrlReject-ClientSubject','CandidateSubjectID':'ctrlReject-CandidateSubject','StartDateID':'ctrlReject-StartDate','EndDateID':'ctrlReject-EndDate','SalaryID':'ctrlReject-Salary','NoteHistoryID':'ctrlReject-NoteHistory','FollowUpID':'ctrlReject-FollowUp','ReasonID':'ctrlReject-Reason','ReasonSkillCategory':'','ReasonDefaultValue':'','CandidateList':null,'Load':function(){TriSysApex['LoginCredentials']['isLoggedInToSpecificCompanyAsRecruiter']('CoSector')&&($('#'+ctrlReject['ReasonID']+'-tr')['show'](),ctrlReject['ReasonSkillCategory']='CandidateRejectedReason',ctrlReject['ReasonDefaultValue']='--',TriSysSDK['CShowForm']['skillCombo'](ctrlReject['ReasonID'],ctrlReject['ReasonSkillCategory'],ctrlReject['ReasonDefaultValue']));var sReject='Rejected',sRejectFolder=sReject+'/';TriSysActions['MailMerge']['PopulateTemplates'](sReject+':\x20Client',TriSysActions['MailMerge']['MasterTemplateFolder']+sRejectFolder+TriSysActions['MailMerge']['ClientTemplatesFolder'],ctrlReject['ClientTemplatesID'],'Client\x20Rejected',ctrlReject['EditClientTemplateButtonID']),TriSysActions['MailMerge']['PopulateTemplates'](sReject+':\x20Candidate',TriSysActions['MailMerge']['MasterTemplateFolder']+sRejectFolder+TriSysActions['MailMerge']['CandidateTemplatesFolder'],ctrlReject['CandidateTemplatesID'],'Candidate\x20Rejected',ctrlReject['EditCandidateTemplateButtonID']);var defaults={'TaskType':'Letter'};TriSysActions['NoteHistory']['Load'](ctrlReject['NoteHistoryID'],defaults),TriSysSDK['CShowForm']['datePicker'](ctrlReject['StartDateID']),TriSysSDK['CShowForm']['datePicker'](ctrlReject['EndDateID']);var fSpinIncrement=0x1f4,sPeriod='Annum';TriSysSDK['Controls']['CurrencyAmountPeriod']['PopulateCurrencyAmountPeriodWidget'](ctrlReject['SalaryID'],fSpinIncrement,sPeriod);var dtFollowUp=TriSysActions['FollowUp']['FollowUpDateTomorrow']();defaults={'CreateFollowUp':!![],'StartDateTime':dtFollowUp},TriSysActions['FollowUp']['Load'](ctrlReject['FollowUpID'],defaults),ctrlReject['PopulateActionData']();},'PopulateActionData':function(){if(TriSysActions['Invocation']['SingletonContactListCheck']('Reject\x20Candidate','candidate'))return;var CReadCVSendDetailsActionRequest=new TriSysActions['Invocation']['ActionData'](),payloadObject={};payloadObject['URL']='Action/ReadCVSendDetails',payloadObject['OutboundDataPacket']=CReadCVSendDetailsActionRequest,payloadObject['InboundDataFunction']=function(CReadCVSendDetailsActionResponse){TriSysApex['UI']['HideWait']();if(CReadCVSendDetailsActionResponse){if(CReadCVSendDetailsActionResponse['Success']){ctrlReject['DisplayClientContactDetails'](CReadCVSendDetailsActionResponse['ClientContact']),ctrlReject['DisplayCandidateDetails'](CReadCVSendDetailsActionResponse['CandidateContacts']),ctrlReject['DisplayRequirementDetails'](CReadCVSendDetailsActionResponse['Requirement']);if(CReadCVSendDetailsActionResponse['Requirement']){TriSysSDK['CShowForm']['setDatePickerValue'](ctrlReject['StartDateID'],CReadCVSendDetailsActionResponse['Requirement']['EarliestStartDate']);if(CReadCVSendDetailsActionResponse['Requirement']['Type']=='Permanent')$('#'+ctrlReject['EndDateID'])['hide']();}TriSysActions['Persistence']['Read'](ctrlReject['ReadPersistedSettingsCallback']);return;}else TriSysApex['UI']['ShowMessage'](CReadCVSendDetailsActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlReject.PopulateActionData:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Contacts...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DisplayClientContactDetails':function(contact){var sContact=contact['FullName'];if(contact['CompanyName'])sContact+=',\x20'+contact['CompanyName'];$('#'+ctrlReject['ClientID'])['html'](sContact);},'DisplayCandidateDetails':function(contactList){ctrlReject['CandidateList']=contactList;var sContact='';if(contactList&&contactList['length']==0x1){var contact=contactList[0x0];sContact=contact['FullName'];if(contact['HomeAddressStreet'])sContact+=',\x20'+contact['HomeAddressStreet']['replace'](/\r\n/g,',\x20');if(contact['HomeAddressCity'])sContact+=',\x20'+contact['HomeAddressCity'];}else{if(contactList)for(var i=0x0;i<contactList['length'];i++){var contact=contactList[i];if(sContact['length']>0x0)sContact+=',\x20';sContact+=contact['FullName'];}}$('#'+ctrlReject['CandidateID'])['html'](sContact);},'DisplayRequirementDetails':function(requirement){if(requirement){$('#'+ctrlReject['RequirementID'])['html'](requirement['Reference']+':\x20'+requirement['JobTitle']);if(requirement['Type']=='Permanent')TriSysSDK['Controls']['CurrencyAmountPeriod']['SetCurrencyAmountPeriod'](ctrlReject['SalaryID'],requirement['Salary']),$('#ctrlReject-EndDate-tr')['hide']();else $('#ctrlReject-Salary-tr')['hide']();}else $('#ctrlReject-Requirement-tr')['hide']();},'Configure':function(){var mySettings=ctrlReject['GetSettings']();if(!mySettings)return;TriSysActions['Persistence']['Write'](mySettings);},'GetSettings':function(){var sError=null,sClientTemplate=TriSysActions['MailMerge']['GetTemplateFromCombo'](ctrlReject['ClientTemplatesID']),sCandidateTemplate=TriSysActions['MailMerge']['GetTemplateFromCombo'](ctrlReject['CandidateTemplatesID']),sClientSubject=$('#'+ctrlReject['ClientSubjectID'])['val'](),sCandidateSubject=$('#'+ctrlReject['CandidateSubjectID'])['val']();if(sError)return TriSysApex['UI']['ShowMessage'](sError),null;var mySettings={'ClientTemplate':sClientTemplate,'CandidateTemplate':sCandidateTemplate,'ClientSubject':sClientSubject,'CandidateSubject':sCandidateSubject,'NoteHistory':ctrlNoteHistory['Validation'](),'FollowUp':ctrlFollowUp['Validation']()};return mySettings;},'ReadPersistedSettingsCallback':function(mySettings){TriSysSDK['CShowForm']['SetTextInCombo'](ctrlReject['ClientTemplatesID'],mySettings['ClientTemplate']),TriSysSDK['CShowForm']['SetTextInCombo'](ctrlReject['CandidateTemplatesID'],mySettings['CandidateTemplate']),$('#'+ctrlReject['ClientSubjectID'])['val'](mySettings['ClientSubject']),$('#'+ctrlReject['CandidateSubjectID'])['val'](mySettings['CandidateSubject']),TriSysActions['PersistedSettingsSafeguard']['WaitUntilTaskControlsAreLoaded'](!![],!![],function(){ctrlNoteHistory['Reload'](mySettings['NoteHistory']),ctrlFollowUp['Reload'](mySettings['FollowUp']);});},'MailMergeData':function(){if(!ctrlReject['CandidateList'])return;var dtStart=TriSysSDK['CShowForm']['getDatePickerValue'](ctrlReject['StartDateID']),sFormatedStartDate=dtStart?moment(dtStart)['format']('dddd\x20DD\x20MMMM\x20YYYY'):null,dtEnd=TriSysSDK['CShowForm']['getDatePickerValue'](ctrlReject['EndDateID']),sFormatedEndDate=dtEnd?moment(dtEnd)['format']('dddd\x20DD\x20MMMM\x20YYYY'):null,sSalary=TriSysSDK['Controls']['CurrencyAmountPeriod']['GetCurrencyAmountPeriod'](ctrlReject['SalaryID'],!![]),actionSpecificData={'ActionName':'Reject','ActionDisplayName':'Offer\x20Rejected','Values':[{'FieldName':'StartDate','FieldDisplayName':'Start\x20Date','Value':sFormatedStartDate},{'FieldName':'EndDate','FieldDisplayName':'End\x20Date','Value':sFormatedEndDate},{'FieldName':'Salary','FieldDisplayName':'Salary','Value':sSalary}]};if(TriSysApex['LoginCredentials']['isLoggedInToSpecificCompanyAsRecruiter']('CoSector')){var sReason=TriSysSDK['CShowForm']['GetTextFromCombo'](ctrlReject['ReasonID']),reasonValue={'FieldName':ctrlReject['ReasonSkillCategory'],'FieldDisplayName':'Reason','Value':sReason};actionSpecificData['Values']['push'](reasonValue);}return actionSpecificData;},'Finish':function(){var mySettings=ctrlReject['GetSettings']();if(!mySettings)return;var NoteHistoryData=ctrlNoteHistory['Validation']();if(!NoteHistoryData)return;var FollowUpData=ctrlFollowUp['Validation']();if(!FollowUpData)return;var sError=null,dtStart=TriSysSDK['CShowForm']['getDatePickerValue'](ctrlReject['StartDateID']),dtEnd=TriSysSDK['CShowForm']['getDatePickerValue'](ctrlReject['EndDateID']);if(!dtStart)sError='Please\x20specify\x20a\x20start\x20date.';else{var bVisible=$('#'+ctrlReject['EndDateID'])['is'](':visible'),rowVisible=$('#ctrlReject-EndDate-tr')['is'](':visible');if(bVisible&&rowVisible){if(!dtEnd)sError='Please\x20specify\x20an\x20end\x20date.';}}if(!sError){var bReasonVisible=$('#'+ctrlReject['ReasonID']+'-tr')['is'](':visible');if(bReasonVisible){var sReason=TriSysSDK['CShowForm']['GetTextFromCombo'](ctrlReject['ReasonID']);if(sReason==ctrlReject['ReasonDefaultValue'])sError='\x20Please\x20select\x20a\x20reason.';else{var sSelectedReasonSkill=TriSysSDK['CShowForm']['GetTextFromCombo'](ctrlReject['ReasonID']),sReasonAttribute=ctrlReject['ReasonSkillCategory']+':'+sSelectedReasonSkill;NoteHistoryData['Attributes']?NoteHistoryData['Attributes']+=sReasonAttribute:NoteHistoryData['Attributes']=sReasonAttribute,FollowUpData['Attributes']?FollowUpData['Attributes']+=sReasonAttribute:FollowUpData['Attributes']=sReasonAttribute;}}}if(sError)return TriSysApex['UI']['ShowMessage'](sError),null;ctrlReject['SendActionDataToWebAPI'](mySettings,NoteHistoryData,FollowUpData);},'SendActionDataToWebAPI':function(mySettings,NoteHistoryData,FollowUpData){var CRejectActionRequest={'ClientTemplate':mySettings['ClientTemplate'],'CandidateTemplate':mySettings['CandidateTemplate'],'ClientSubject':mySettings['ClientSubject'],'CandidateSubject':mySettings['CandidateSubject'],'ActionData':new TriSysActions['Invocation']['ActionData'](),'NoteHistory':NoteHistoryData,'FollowUp':FollowUpData},payloadObject={};payloadObject['URL']='Action/Rejected',payloadObject['OutboundDataPacket']=CRejectActionRequest,payloadObject['InboundDataFunction']=function(CRejectActionResponse){TriSysApex['UI']['HideWait']();if(CRejectActionResponse){if(CRejectActionResponse['Success']){TriSysActions['Invocation']['PostInvocationCompletion']();if(CRejectActionResponse['URL'])for(var i=0x0;i<CRejectActionResponse['URL']['length'];i++){var sURL=CRejectActionResponse['URL'][i];TriSysApex['ModalDialogue']['DocumentViewer']['DownloadAndOpen']('e-mail',sURL);}return;}else TriSysApex['UI']['ShowMessage'](CRejectActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlReject.SendActionDataToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Generating\x20E-Mail...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);}};$(document)['ready'](function(){ctrlReject['Load']();});