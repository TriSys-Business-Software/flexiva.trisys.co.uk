var ctrlScreeningInterview={'ContactID':'ctrlScreeningInterview-Contact','LocationID':'ctrlScreeningInterview-Location','NewLocationID':'ctrlScreeningInterview-NewLocation','StartDateTimeID':'ctrlScreeningInterview-StartDateTime','TaskTypeID':'ctrlScreeningInterview-TaskType','TaskTypeImage':'ctrlScreeningInterview-Selected-TaskType-Image','AttributesID':'ctrlScreeningInterview-Attributes','DurationID':'ctrlScreeningInterview-Duration','SetAlarmID':'ctrlScreeningInterview-Set-Alarm','LeadTimeID':'ctrlScreeningInterview-LeadTime','FollowUpID':'ctrlScreeningInterview-FollowUp','NotesID':'ctrlScreeningInterview-Notes','TemplatesID':'ctrlScreeningInterview-Template','EditTemplateButtonID':'ctrlScreeningInterview-EditTemplate','SubjectID':'ctrlScreeningInterview-Subject','AttachmentsID':'ctrlScreeningInterview-Attachments','ManageAttachmentsButtonID':'ctrlScreeningInterview-ManageAttachmentLibrary','BlindCopyID':'ctrlScreeningInterview-BlindCopy','CompanyId':0x0,'CompanyName':null,'Load':function(){ctrlScreeningInterview['GatherInterviewDetails'](),TriSysActions['Forms']['TaskType']['Load'](ctrlScreeningInterview['TaskTypeID'],ctrlScreeningInterview['TaskTypeImage'],'Interview'),TriSysActions['Forms']['Attributes']['Load'](ctrlScreeningInterview['AttributesID'],'Interview\x20Stage'),TriSysSDK['CShowForm']['SetSkillsInList'](ctrlScreeningInterview['AttributesID'],'Interview\x20Stage:\x20Screen\x20Interview'),TriSysSDK['CShowForm']['dateTimePicker'](ctrlScreeningInterview['StartDateTimeID']),TriSysSDK['Controls']['Duration']['Initialise'](ctrlScreeningInterview['DurationID']),TriSysSDK['Controls']['Duration']['Initialise'](ctrlScreeningInterview['LeadTimeID']);var dtInterview=TriSysActions['FollowUp']['FollowUpDateTomorrow'](),dtFollowUp=new Date(moment(dtInterview)['add'](0x1,'days'));setTimeout(function(){TriSysSDK['CShowForm']['setDateTimePickerValue'](ctrlScreeningInterview['StartDateTimeID'],dtInterview),TriSysSDK['Controls']['Duration']['Set'](ctrlScreeningInterview['DurationID'],'2\x20hours'),TriSysSDK['Controls']['Duration']['Set'](ctrlScreeningInterview['LeadTimeID'],'3\x20hours');},0x3e8);var defaults={'CreateFollowUp':!![],'StartDateTime':dtFollowUp};TriSysActions['FollowUp']['Load'](ctrlScreeningInterview['FollowUpID'],defaults);var fnAlarm=function(){var bSetAlarm=$('#'+ctrlScreeningInterview['SetAlarmID'])['is'](':checked');if(bSetAlarm)$('#ctrlScreeningInterview-LeadTime-tr')['show']();else $('#ctrlScreeningInterview-LeadTime-tr')['hide']();};$('#'+ctrlScreeningInterview['SetAlarmID'])['on']('click',function(){fnAlarm();}),$('#'+ctrlScreeningInterview['NewLocationID'])['on']('click',function(){ctrlScreeningInterview['SpecifyNewInterviewLocation']();});var sFolderName='Screening\x20Interview',sFolder=sFolderName+'/';TriSysActions['MailMerge']['PopulateTemplates'](sFolderName,TriSysActions['MailMerge']['MasterTemplateFolder']+sFolder,ctrlScreeningInterview['TemplatesID'],'Location\x20Interview',ctrlScreeningInterview['EditTemplateButtonID']),TriSysActions['MailMerge']['PopulateAttachments'](ctrlScreeningInterview['AttachmentsID'],ctrlScreeningInterview['ManageAttachmentsButtonID']),TriSysActions['Persistence']['Read'](ctrlScreeningInterview['ReadPersistedSettingsCallback']);},'GatherInterviewDetails':function(){var CReadScreeningInterviewDetailsRequest=new TriSysActions['Invocation']['ActionData'](),payloadObject={};payloadObject['URL']='Action/ReadScreeningInterviewDetails',payloadObject['OutboundDataPacket']=CReadScreeningInterviewDetailsRequest,payloadObject['InboundDataFunction']=function(CReadScreeningInterviewDetailsResponse){TriSysApex['UI']['HideWait']();if(CReadScreeningInterviewDetailsResponse){if(CReadScreeningInterviewDetailsResponse['Success']){ctrlScreeningInterview['DisplayInterviewDetails'](CReadScreeningInterviewDetailsResponse);return;}else{var fnCloseActionForm=function(){return setTimeout(TriSysApex['UI']['CloseModalPopup'],0x64),!![];};TriSysApex['UI']['ShowMessage'](CReadScreeningInterviewDetailsResponse['ErrorMessage'],'Screening\x20Interview',fnCloseActionForm);}}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlScreeningInterview.GatherInterviewDetails:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Contact(s)...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DisplayInterviewDetails':function(CReadScreeningInterviewDetailsResponse){var companyAddresses=[],addresses=CReadScreeningInterviewDetailsResponse['Addresses'],iSelectedIndex=0x0;if(addresses)for(var i=0x0;i<addresses['length'];i++){var address=addresses[i],sAddressDisplay=TriSysSDK['Miscellaneous']['EllipsisText'](address['Display'],0x64);companyAddresses['push']({'value':address['AddressId'],'text':sAddressDisplay});if(address['AddressId']==CReadScreeningInterviewDetailsResponse['DefaultAddressId'])iSelectedIndex=i;}TriSysSDK['CShowForm']['populateComboFromDataSource'](ctrlScreeningInterview['LocationID'],companyAddresses,iSelectedIndex),TriSysActions['MailMerge']['DisplayContactDetails'](CReadScreeningInterviewDetailsResponse['Contacts'],ctrlScreeningInterview['ContactID']),ctrlScreeningInterview['CompanyId']=CReadScreeningInterviewDetailsResponse['CompanyId'],ctrlScreeningInterview['CompanyName']=CReadScreeningInterviewDetailsResponse['CompanyName'];},'SpecifyNewInterviewLocation':function(){var fnNewAddress=function(lCompanyId,lContactId,address){var sStreet=address['Street']['replace'](/\r\n/g,',\x20')['replace'](/\n/g,',\x20'),sAddress=sStreet+(address['City']?',\x20'+address['City']:'')+(address['County']?',\x20'+address['County']:'')+(address['PostCode']?',\x20'+address['PostCode']:'');TriSysSDK['CShowForm']['addItemToCombo'](ctrlScreeningInterview['LocationID'],sAddress,!![]),TriSysApex['UI']['CloseModalPopup']();},options={'Title':'Screening\x20Interview\x20Location','HideCompanyBlock':!![]};TriSysApex['ModalDialogue']['NewCompanyAddress']['Popup'](ctrlScreeningInterview['CompanyId'],ctrlScreeningInterview['CompanyName'],0x0,0x0,fnNewAddress,![],options);},'MailMergeData':function(){var sAttributes=TriSysSDK['CShowForm']['GetSelectedSkillsFromList'](ctrlScreeningInterview['AttributesID']),sLocation=TriSysSDK['CShowForm']['GetTextFromCombo'](ctrlScreeningInterview['LocationID']),sTaskType=TriSysSDK['CShowForm']['GetTaskTypeFromCombo'](ctrlScreeningInterview['TaskTypeID']),sStartDate=TriSysSDK['CShowForm']['getDateTimePickerValue'](ctrlScreeningInterview['StartDateTimeID'],'dddd\x20DD\x20MMMM\x20YYYY'),sStartTime=TriSysSDK['CShowForm']['getDateTimePickerValue'](ctrlScreeningInterview['StartDateTimeID'],'HH:mm'),sDuration=TriSysSDK['Controls']['Duration']['Get'](ctrlScreeningInterview['DurationID']),sNotes=$('#'+ctrlScreeningInterview['NotesID'])['val'](),lAddressId=TriSysSDK['CShowForm']['GetValueFromCombo'](ctrlScreeningInterview['LocationID']),actionSpecificData={'ActionName':'ScreeningInterview','ActionDisplayName':'Screening\x20Interview','Values':[{'FieldName':'TaskType','FieldDisplayName':'Task\x20Type','Value':sTaskType},{'FieldName':'Date','FieldDisplayName':'Date','Value':sStartDate},{'FieldName':'Time','FieldDisplayName':'Time','Value':sStartTime},{'FieldName':'AddressId','FieldDisplayName':'Address\x20ID','Value':lAddressId},{'FieldName':'Location','FieldDisplayName':'Location\x20Address','Value':sLocation},{'FieldName':'MapURL','FieldDisplayName':'Map\x20URL','Value':''},{'FieldName':'Duration','FieldDisplayName':'Duration','Value':sDuration},{'FieldName':'Notes','FieldDisplayName':'Notes','Value':sNotes}]};return actionSpecificData;},'Finish':function(){var mySettings=ctrlScreeningInterview['GetSettings']();if(!mySettings)return;var NoteHistoryData={'Scheduled':!![],'TaskType':mySettings['TaskType'],'Attributes':mySettings['Attributes'],'Notes':mySettings['Notes'],'StartDateTime':mySettings['Start'],'Duration':mySettings['Duration'],'Alarmed':mySettings['Alarmed'],'AlarmLeadTime':mySettings['AlarmLeadTime']},FollowUpData=ctrlFollowUp['Validation']();if(!FollowUpData)return;FollowUpData['Attributes']=mySettings['Attributes'],ctrlScreeningInterview['SendActionDataToWebAPI'](mySettings['Template'],mySettings['Subject'],mySettings['Attachments'],mySettings['BlindCopy'],NoteHistoryData,FollowUpData);},'SendActionDataToWebAPI':function(sTemplate,sSubject,sAttachments,bBlindCopy,NoteHistoryData,FollowUpData){var CScreeningInterviewActionRequest={'Template':sTemplate,'Subject':sSubject,'Attachments':sAttachments,'BlindCopy':bBlindCopy,'ActionData':new TriSysActions['Invocation']['ActionData'](),'NoteHistory':NoteHistoryData,'FollowUp':FollowUpData},payloadObject={};payloadObject['URL']='Action/ScreeningInterview',payloadObject['OutboundDataPacket']=CScreeningInterviewActionRequest,payloadObject['InboundDataFunction']=function(CScreeningInterviewActionResponse){TriSysApex['UI']['HideWait']();if(CScreeningInterviewActionResponse){if(CScreeningInterviewActionResponse['Success']){TriSysActions['Invocation']['PostInvocationCompletion']();if(CScreeningInterviewActionResponse['URL'])for(var i=0x0;i<CScreeningInterviewActionResponse['URL']['length'];i++){var sURL=CScreeningInterviewActionResponse['URL'][i];TriSysApex['ModalDialogue']['DocumentViewer']['DownloadAndOpen']('e-mail',sURL);}else{if(CScreeningInterviewActionResponse['MailMessages']){if(CScreeningInterviewActionResponse['MailMessages']['length']>0x0)TriSysActions['EMail']['SendDialogue'](CScreeningInterviewActionResponse['MailMessages']);}}return;}else TriSysApex['UI']['ShowMessage'](CScreeningInterviewActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlScreeningInterview.SendActionDataToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Scheduling\x20Interview...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'GetSettings':function(){var sAttributes=TriSysSDK['CShowForm']['GetSelectedSkillsFromList'](ctrlScreeningInterview['AttributesID']),sLocation=TriSysSDK['CShowForm']['GetTextFromCombo'](ctrlScreeningInterview['LocationID']),sTaskType=TriSysSDK['CShowForm']['GetTaskTypeFromCombo'](ctrlScreeningInterview['TaskTypeID']),dtStart=TriSysSDK['CShowForm']['getDateTimePickerValue'](ctrlScreeningInterview['StartDateTimeID']),sStartDate=TriSysSDK['CShowForm']['getDateTimePickerValue'](ctrlScreeningInterview['StartDateTimeID'],'dddd\x20DD\x20MMMM\x20YYYY'),sStartTime=TriSysSDK['CShowForm']['getDateTimePickerValue'](ctrlScreeningInterview['StartDateTimeID'],'HH:mm'),sDuration=TriSysSDK['Controls']['Duration']['Get'](ctrlScreeningInterview['DurationID']),bAlarmed=TriSysSDK['CShowForm']['CheckBoxValue'](ctrlScreeningInterview['SetAlarmID']),sAlarmLeadTime=TriSysSDK['Controls']['Duration']['Get'](ctrlScreeningInterview['LeadTimeID']),sNotes=$('#'+ctrlScreeningInterview['NotesID'])['val'](),sTemplate=TriSysActions['MailMerge']['GetTemplateFromCombo'](ctrlScreeningInterview['TemplatesID']),sSubject=$('#'+ctrlScreeningInterview['SubjectID'])['val'](),sAttachments=TriSysSDK['CShowForm']['GetSelectedSkillsFromList'](ctrlScreeningInterview['AttachmentsID']),bBCC=TriSysSDK['CShowForm']['GetCheckBoxValue'](ctrlScreeningInterview['BlindCopyID'],![]),sError=null;if(!sStartDate||!sStartTime)sError='Please\x20enter\x20the\x20interview\x20date/time.';else{if(!sLocation)sError='Please\x20enter\x20a\x20location\x20for\x20the\x20interview.';}if(sError)return TriSysApex['UI']['ShowMessage'](sError),null;var mySettings={'TaskType':sTaskType,'Attributes':sAttributes,'Notes':sNotes,'Start':dtStart,'Duration':sDuration,'Alarmed':bAlarmed,'AlarmLeadTime':sAlarmLeadTime,'Template':sTemplate,'Subject':sSubject,'Attachments':sAttachments,'BlindCopy':bBCC,'FollowUp':ctrlFollowUp['Validation']()};return mySettings;},'ReadPersistedSettingsCallback':function(mySettings){mySettings&&(TriSysSDK['CShowForm']['SetTaskTypeComboValue'](ctrlScreeningInterview['TaskTypeID'],mySettings['TaskType']),TriSysActions['Forms']['TaskType']['Icon'](ctrlScreeningInterview['TaskTypeID'],ctrlScreeningInterview['TaskTypeImage']),TriSysSDK['CShowForm']['SetSkillsInList'](ctrlScreeningInterview['AttributesID'],mySettings['Attributes']),TriSysSDK['CShowForm']['SetTextInCombo'](ctrlScreeningInterview['TemplatesID'],mySettings['Template']),TriSysSDK['CShowForm']['SetSkillsInList'](ctrlScreeningInterview['AttachmentsID'],mySettings['Attachments']),TriSysSDK['Controls']['Duration']['Set'](ctrlScreeningInterview['DurationID'],mySettings['Duration']),$('#'+ctrlScreeningInterview['NotesID'])['val'](mySettings['Notes']),$('#'+ctrlScreeningInterview['SubjectID'])['val'](mySettings['Subject']),TriSysSDK['CShowForm']['SetCheckBoxValue'](ctrlScreeningInterview['BlindCopyID'],mySettings['BlindCopy']),TriSysActions['PersistedSettingsSafeguard']['WaitUntilTaskControlsAreLoaded'](![],!![],function(){ctrlFollowUp['Reload'](mySettings['FollowUp']);}));},'Configure':function(){var mySettings=ctrlScreeningInterview['GetSettings']();if(!mySettings)return;TriSysActions['Persistence']['Write'](mySettings);}};$(document)['ready'](function(){ctrlScreeningInterview['Load']();});