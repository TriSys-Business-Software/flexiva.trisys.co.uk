var ctrlToDo={'TaskTypeID':'ctrlToDo-TaskType','TaskTypeImage':'ctrlToDo-Selected-TaskType-Image','StartDateID':'ctrlToDo-StartDateTime','DurationID':'ctrlToDo-Duration','AttributesID':'ctrlToDo-Attributes','SetAlarmID':'ctrlToDo-Set-Alarm','AlarmLeadTimeID':'ctrlToDo-LeadTime','DescriptionID':'ctrlToDo-Description','Load':function(){TriSysActions['Forms']['TaskType']['Load'](ctrlToDo['TaskTypeID'],ctrlToDo['TaskTypeImage'],'ToDo'),TriSysActions['Forms']['Attributes']['Load'](ctrlToDo['AttributesID']),TriSysSDK['CShowForm']['dateTimePicker'](ctrlToDo['StartDateID']),TriSysSDK['Controls']['Duration']['Initialise'](ctrlToDo['DurationID']),TriSysSDK['Controls']['Duration']['Initialise'](ctrlToDo['AlarmLeadTimeID']),$('#'+ctrlToDo['SetAlarmID'])['on']('click',function(){$('#ctrlToDo-LeadTime-tr')['toggle']();});var dtTomorrow=TriSysActions['FollowUp']['FollowUpDateTomorrow']();TriSysSDK['CShowForm']['setDateTimePickerValue'](ctrlToDo['StartDateID'],dtTomorrow),TriSysActions['Persistence']['Read'](ctrlToDo['ReadPersistedSettingsCallback']);},'Finish':function(){var mySettings=ctrlToDo['GetSettings'](!![]);if(!mySettings)return;var ToDoActionData=new TriSysActions['Invocation']['ActionData']();ToDoActionData['TaskType']=mySettings['TaskType'],ToDoActionData['Attributes']=mySettings['Attributes'],ToDoActionData['StartDateTime']=mySettings['Start'],ToDoActionData['Duration']=mySettings['Duration'],ToDoActionData['Alarmed']=mySettings['Alarmed'],ToDoActionData['AlarmLeadTime']=mySettings['AlarmLeadTime'],ToDoActionData['Description']=mySettings['Description'],ctrlToDo['SendActionDataToWebAPI'](ToDoActionData);},'SendActionDataToWebAPI':function(CToDoActionRequest){var payloadObject={};payloadObject['URL']='Action/ToDo',payloadObject['OutboundDataPacket']=CToDoActionRequest,payloadObject['InboundDataFunction']=function(CToDoActionResponse){TriSysApex['UI']['HideWait']();if(CToDoActionResponse){if(CToDoActionResponse['Success']){TriSysActions['Invocation']['PostInvocationCompletion']();return;}else TriSysApex['UI']['ShowMessage'](CToDoActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlToDo.SendActionDataToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Saving\x20ToDo...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'Configure':function(){var mySettings=ctrlToDo['GetSettings'](![]);if(!mySettings)return;TriSysActions['Persistence']['Write'](mySettings);},'GetSettings':function(bMandatoryFields){var sError=null,sTaskType=TriSysSDK['CShowForm']['GetTaskTypeFromCombo'](ctrlToDo['TaskTypeID']),sAttributes=TriSysSDK['CShowForm']['GetSelectedSkillsFromList'](ctrlToDo['AttributesID']),sDuration=TriSysSDK['Controls']['Duration']['Get'](ctrlToDo['DurationID']),dtStart=TriSysSDK['CShowForm']['getDateTimePickerValue'](ctrlToDo['StartDateID']),bAlarmed=TriSysSDK['CShowForm']['CheckBoxValue'](ctrlToDo['SetAlarmID']),sAlarmLeadTime=TriSysSDK['Controls']['Duration']['Get'](ctrlToDo['AlarmLeadTimeID']),sDescription=$('#'+ctrlToDo['DescriptionID'])['val']();if(!dtStart&&bMandatoryFields)sError='Please\x20enter\x20a\x20date/time.';else{if(!sDescription&&bMandatoryFields)sError='Please\x20enter\x20a\x20description.';}if(sError)return TriSysApex['UI']['ShowMessage'](sError),null;var mySettings={'TaskType':sTaskType,'Attributes':sAttributes,'Duration':sDuration,'Start':dtStart,'Alarmed':bAlarmed,'AlarmLeadTime':sAlarmLeadTime,'Description':sDescription};return mySettings;},'ReadPersistedSettingsCallback':function(mySettings){TriSysSDK['CShowForm']['SetTaskTypeComboValue'](ctrlToDo['TaskTypeID'],mySettings['TaskType']),TriSysActions['Forms']['TaskType']['Icon'](ctrlToDo['TaskTypeImage'],mySettings['TaskTypeImage']),TriSysSDK['CShowForm']['SetSkillsInList'](ctrlToDo['AttributesID'],mySettings['Attributes']),TriSysSDK['Controls']['Duration']['Set'](ctrlToDo['DurationID'],mySettings['Duration']),TriSysSDK['CShowForm']['SetCheckBoxValue'](ctrlToDo['SetAlarmID'],mySettings['Alarmed']);if(!mySettings['Alarmed'])$('#ctrlToDo-LeadTime-tr')['hide']();TriSysSDK['Controls']['Duration']['Set'](ctrlToDo['AlarmLeadTimeID'],mySettings['AlarmLeadTime']),$('#'+ctrlToDo['DescriptionID'])['val'](mySettings['Description']);if(mySettings['Description'])try{document['getElementById'](ctrlToDo['DescriptionID'])['focus'](),document['getElementById'](ctrlToDo['DescriptionID'])['select']();}catch(e){}}};$(document)['ready'](function(){ctrlToDo['Load']();});