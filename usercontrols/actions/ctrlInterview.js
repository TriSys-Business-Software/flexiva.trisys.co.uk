var ctrlInterview={'ClientDetailsID':'ctrlInterview-Client','CandidateDetailsID':'ctrlInterview-Candidate','StageID':'ctrlInterview-Stage','LocationID':'ctrlInterview-Location','NewLocationID':'ctrlInterview-NewLocation','StartDateTimeID':'ctrlInterview-StartDateTime','OutcomeID':'ctrlInterview-Outcome','TaskTypeID':'ctrlInterview-TaskType','TaskTypeImage':'ctrlInterview-Selected-TaskType-Image','DurationID':'ctrlInterview-Duration','SetAlarmID':'ctrlInterview-Set-Alarm','LeadTimeID':'ctrlInterview-LeadTime','FollowUpID':'ctrlInterview-FollowUp','NotesID':'ctrlInterview-Notes','ClientTemplatesID':'ctrlInterview-ClientTemplate','CandidateTemplatesID':'ctrlInterview-CandidateTemplate','EditClientTemplateButtonID':'ctrlInterview-EditClientTemplate','EditCandidateTemplateButtonID':'ctrlInterview-EditCandidateTemplate','SubjectID':'ctrlInterview-Subject','Client':null,'Candidate':null,'Load':function(){ctrlInterview['GatherNextInterviewDetails'](),TriSysSDK['CShowForm']['skillCombo'](ctrlInterview['StageID'],'Interview\x20Stage','1st\x20Interview'),TriSysActions['Forms']['TaskType']['Load'](ctrlInterview['TaskTypeID'],ctrlInterview['TaskTypeImage'],'Interview'),TriSysSDK['CShowForm']['dateTimePicker'](ctrlInterview['StartDateTimeID']),TriSysSDK['Controls']['Duration']['Initialise'](ctrlInterview['DurationID']),TriSysSDK['Controls']['Duration']['Initialise'](ctrlInterview['LeadTimeID']);var dtInterview=TriSysActions['FollowUp']['FollowUpDateTomorrow'](),dtFollowUp=new Date(moment(dtInterview)['add'](0x1,'days'));setTimeout(function(){TriSysSDK['CShowForm']['setDateTimePickerValue'](ctrlInterview['StartDateTimeID'],dtInterview),TriSysSDK['Controls']['Duration']['Set'](ctrlInterview['DurationID'],'2\x20hours');},0x3e8);var defaults={'CreateFollowUp':!![],'StartDateTime':dtFollowUp};TriSysActions['FollowUp']['Load'](ctrlInterview['FollowUpID'],defaults);var fnAlarm=function(){var bSetAlarm=$('#'+ctrlInterview['SetAlarmID'])['is'](':checked');if(bSetAlarm)$('#ctrlInterview-LeadTime-tr')['show']();else $('#ctrlInterview-LeadTime-tr')['hide']();};$('#'+ctrlInterview['SetAlarmID'])['on']('click',function(){fnAlarm();}),$('#'+ctrlInterview['NewLocationID'])['on']('click',function(){ctrlInterview['SpecifyNewInterviewLocation']();});var sInterview='Interview',sInterviewFolder=sInterview+'/';TriSysActions['MailMerge']['PopulateTemplates'](sInterview+'\x20Client',TriSysActions['MailMerge']['MasterTemplateFolder']+sInterviewFolder+TriSysActions['MailMerge']['ClientTemplatesFolder'],ctrlInterview['ClientTemplatesID'],'Location\x20Interview',ctrlInterview['EditClientTemplateButtonID']),TriSysActions['MailMerge']['PopulateTemplates'](sInterview+'\x20Candidate',TriSysActions['MailMerge']['MasterTemplateFolder']+sInterviewFolder+TriSysActions['MailMerge']['CandidateTemplatesFolder'],ctrlInterview['CandidateTemplatesID'],'Location\x20Interview',ctrlInterview['EditCandidateTemplateButtonID']);},'GatherNextInterviewDetails':function(){if(TriSysActions['Invocation']['SingletonContactListCheck']('Interview','candidate'))return;var CReadNextInterviewDetailsRequest=new TriSysActions['Invocation']['ActionData'](),payloadObject={};payloadObject['URL']='Action/ReadNextInterviewDetails',payloadObject['OutboundDataPacket']=CReadNextInterviewDetailsRequest,payloadObject['InboundDataFunction']=function(CReadNextInterviewDetailsResponse){TriSysApex['UI']['HideWait']();if(CReadNextInterviewDetailsResponse){if(CReadNextInterviewDetailsResponse['Success']){ctrlInterview['DisplayNextInterviewDetails'](CReadNextInterviewDetailsResponse);return;}else TriSysApex['UI']['ShowMessage'](CReadNextInterviewDetailsResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlInterview.GatherNextInterviewDetails:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Candidate...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DisplayNextInterviewDetails':function(CReadNextInterviewDetailsResponse){ctrlInterview['Client']=CReadNextInterviewDetailsResponse['ClientContact'],ctrlInterview['Candidate']=CReadNextInterviewDetailsResponse['CandidateContact'];var sClient=ctrlInterview['Client']['FullName'];if(ctrlInterview['Client']['CompanyName'])sClient+=',\x20'+ctrlInterview['Client']['CompanyName'];$('#'+ctrlInterview['ClientDetailsID'])['html'](sClient);var sCandidate=ctrlInterview['Candidate']['FullName'];if(ctrlInterview['Candidate']['HomeAddressStreet'])sCandidate+=',\x20'+ctrlInterview['Candidate']['HomeAddressStreet']['replace'](/\r\n/g,',\x20');if(ctrlInterview['Candidate']['HomeAddressCity'])sCandidate+=',\x20'+ctrlInterview['Candidate']['HomeAddressCity'];$('#'+ctrlInterview['CandidateDetailsID'])['html'](sCandidate);var companyAddresses=[],addresses=CReadNextInterviewDetailsResponse['Addresses'],iSelectedIndex=0x0;if(addresses)for(var i=0x0;i<addresses['length'];i++){var address=addresses[i],sAddressDisplay=TriSysSDK['Miscellaneous']['EllipsisText'](address['Display'],0x64);companyAddresses['push']({'value':address['AddressId'],'text':sAddressDisplay});if(address['AddressId']==CReadNextInterviewDetailsResponse['DefaultAddressId'])iSelectedIndex=i;}TriSysSDK['CShowForm']['populateComboFromDataSource'](ctrlInterview['LocationID'],companyAddresses,iSelectedIndex),TriSysSDK['CShowForm']['SetTextInCombo'](ctrlInterview['StageID'],CReadNextInterviewDetailsResponse['NextInterviewStage']),TriSysActions['Persistence']['Read'](ctrlInterview['ReadPersistedSettingsCallback']);},'SpecifyNewInterviewLocation':function(){var fnNewAddress=function(lCompanyId,lContactId,address){var sStreet=address['Street']['replace'](/\r\n/g,',\x20')['replace'](/\n/g,',\x20'),sAddress=sStreet+(address['City']?',\x20'+address['City']:'')+(address['County']?',\x20'+address['County']:'')+(address['PostCode']?',\x20'+address['PostCode']:'');TriSysSDK['CShowForm']['addItemToCombo'](ctrlInterview['LocationID'],sAddress,!![]),TriSysApex['UI']['CloseModalPopup']();};if(!ctrlInterview['Client']){var sError='Could\x20not\x20identify\x20a\x20client\x20contact.';TriSysApex['UI']['ShowMessage'](sError);return;}var options={'Title':'Interview\x20Location','HideCompanyBlock':!![]};TriSysApex['ModalDialogue']['NewCompanyAddress']['Popup'](ctrlInterview['Client']['CompanyId'],ctrlInterview['Client']['CompanyName'],0x0,0x0,fnNewAddress,![],options);},'MailMergeData':function(){var sStage=TriSysSDK['CShowForm']['GetTextFromCombo'](ctrlInterview['StageID']),sLocation=TriSysSDK['CShowForm']['GetTextFromCombo'](ctrlInterview['LocationID']),sTaskType=TriSysSDK['CShowForm']['GetTaskTypeFromCombo'](ctrlInterview['TaskTypeID']),sStartDate=TriSysSDK['CShowForm']['getDateTimePickerValue'](ctrlInterview['StartDateTimeID'],'dddd\x20DD\x20MMMM\x20YYYY'),sStartTime=TriSysSDK['CShowForm']['getDateTimePickerValue'](ctrlInterview['StartDateTimeID'],'HH:mm'),sDuration=TriSysSDK['Controls']['Duration']['Get'](ctrlInterview['DurationID']),sNotes=$('#'+ctrlInterview['NotesID'])['val'](),actionSpecificData={'ActionName':'Interview','ActionDisplayName':'Interview','Values':[{'FieldName':'TaskType','FieldDisplayName':'Task\x20Type','Value':sTaskType},{'FieldName':'Stage','FieldDisplayName':'Stage','Value':sStage},{'FieldName':'Date','FieldDisplayName':'Date','Value':sStartDate},{'FieldName':'Time','FieldDisplayName':'Time','Value':sStartTime},{'FieldName':'Location','FieldDisplayName':'Location\x20Address','Value':sLocation},{'FieldName':'ClientMapURL','FieldDisplayName':'Client\x20Map\x20URL','Value':''},{'FieldName':'CandidateMapURL','FieldDisplayName':'Candidate\x20Map\x20URL','Value':''},{'FieldName':'Duration','FieldDisplayName':'Duration','Value':sDuration},{'FieldName':'Notes','FieldDisplayName':'Notes','Value':sNotes}]};return actionSpecificData;},'Finish':function(){var mySettings=ctrlInterview['GetSettingsForSelectedStage']();if(!mySettings)return;var NoteHistoryData={'Scheduled':!![],'TaskType':mySettings['TaskType'],'Notes':mySettings['Notes'],'StartDateTime':mySettings['Start'],'Duration':mySettings['Duration'],'Alarmed':mySettings['Alarmed'],'AlarmLeadTime':mySettings['AlarmLeadTime']},FollowUpData=ctrlFollowUp['Validation']();if(!FollowUpData)return;ctrlInterview['SendActionDataToWebAPI'](mySettings['ClientTemplate'],mySettings['CandidateTemplate'],mySettings['Subject'],NoteHistoryData,FollowUpData);},'SendActionDataToWebAPI':function(sClientTemplate,sCandidateTemplate,sSubject,NoteHistoryData,FollowUpData){var CInterviewActionRequest={'ClientTemplate':sClientTemplate,'CandidateTemplate':sCandidateTemplate,'Subject':sSubject,'ActionData':new TriSysActions['Invocation']['ActionData'](),'NoteHistory':NoteHistoryData,'FollowUp':FollowUpData},payloadObject={};payloadObject['URL']='Action/Interview',payloadObject['OutboundDataPacket']=CInterviewActionRequest,payloadObject['InboundDataFunction']=function(CInterviewActionResponse){TriSysApex['UI']['HideWait']();if(CInterviewActionResponse){if(CInterviewActionResponse['Success']){TriSysActions['Invocation']['PostInvocationCompletion']();if(CInterviewActionResponse['URL'])for(var i=0x0;i<CInterviewActionResponse['URL']['length'];i++){var sURL=CInterviewActionResponse['URL'][i];TriSysApex['ModalDialogue']['DocumentViewer']['DownloadAndOpen']('e-mail',sURL);}return;}else TriSysApex['UI']['ShowMessage'](CInterviewActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlInterview.SendActionDataToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Scheduling\x20Interview...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'PersistedSettings':null,'ReadPersistedSettingsCallback':function(mySettings){ctrlInterview['PersistedSettings']=mySettings;var sStage=TriSysSDK['CShowForm']['GetTextFromCombo'](ctrlInterview['StageID']);ctrlInterview['ApplyPersistedSetting'](sStage);},'GetSettingsIndexForStage':function(sStage){if(ctrlInterview['PersistedSettings']&&ctrlInterview['PersistedSettings']['Stages'])for(var i=0x0;i<ctrlInterview['PersistedSettings']['Stages']['length'];i++){var settings=ctrlInterview['PersistedSettings']['Stages'][i];if(settings['Stage']==sStage)return i;}return-0x1;},'GetSettingsForStage':function(sTemplate){var iIndex=ctrlInterview['GetSettingsIndexForStage'](sTemplate);if(iIndex>=0x0)return ctrlInterview['PersistedSettings']['Stages'][iIndex];},'GetSettingsForSelectedStage':function(){var sStage=TriSysSDK['CShowForm']['GetTextFromCombo'](ctrlInterview['StageID']),sLocation=TriSysSDK['CShowForm']['GetTextFromCombo'](ctrlInterview['LocationID']),sTaskType=TriSysSDK['CShowForm']['GetTaskTypeFromCombo'](ctrlInterview['TaskTypeID']),dtStart=TriSysSDK['CShowForm']['getDateTimePickerValue'](ctrlInterview['StartDateTimeID']),sStartDate=TriSysSDK['CShowForm']['getDateTimePickerValue'](ctrlInterview['StartDateTimeID'],'dddd\x20DD\x20MMMM\x20YYYY'),sStartTime=TriSysSDK['CShowForm']['getDateTimePickerValue'](ctrlInterview['StartDateTimeID'],'HH:mm'),sDuration=TriSysSDK['Controls']['Duration']['Get'](ctrlInterview['DurationID']),bAlarmed=TriSysSDK['CShowForm']['CheckBoxValue'](ctrlInterview['SetAlarmID']),sAlarmLeadTime=TriSysSDK['Controls']['Duration']['Get'](ctrlInterview['LeadTimeID']),sNotes=$('#'+ctrlInterview['NotesID'])['val'](),sClientTemplate=TriSysActions['MailMerge']['GetTemplateFromCombo'](ctrlInterview['ClientTemplatesID']),sCandidateTemplate=TriSysActions['MailMerge']['GetTemplateFromCombo'](ctrlInterview['CandidateTemplatesID']),sSubject=$('#'+ctrlInterview['SubjectID'])['val'](),sError=null;if(!sStartDate||!sStartTime)sError='Please\x20enter\x20the\x20interview\x20date/time.';else{if(!sLocation)sError='Please\x20enter\x20a\x20location\x20for\x20the\x20interview.';else{if(!sSubject)sError='Please\x20enter\x20an\x20e-mail\x20subject\x20for\x20the\x20interview.';}}if(sError)return TriSysApex['UI']['ShowMessage'](sError),null;var mySettings={'Stage':sStage,'TaskType':sTaskType,'Notes':sNotes,'Start':dtStart,'Duration':sDuration,'Alarmed':bAlarmed,'AlarmLeadTime':sAlarmLeadTime,'ClientTemplate':sClientTemplate,'CandidateTemplate':sCandidateTemplate,'Subject':sSubject,'FollowUp':ctrlFollowUp['Validation']()};return mySettings;},'ApplyPersistedSetting':function(sStage){var mySettings=ctrlInterview['GetSettingsForStage'](sStage);if(mySettings){TriSysSDK['CShowForm']['SetTaskTypeComboValue'](ctrlInterview['TaskTypeID'],mySettings['TaskType']),TriSysActions['Forms']['TaskType']['Icon'](ctrlInterview['TaskTypeID'],ctrlInterview['TaskTypeImage']),TriSysSDK['CShowForm']['SetTextInCombo'](ctrlInterview['ClientTemplatesID'],mySettings['ClientTemplate']),TriSysSDK['CShowForm']['SetTextInCombo'](ctrlInterview['CandidateTemplatesID'],mySettings['CandidateTemplate']),$('#'+ctrlInterview['NotesID'])['val'](mySettings['Notes']),$('#'+ctrlInterview['SubjectID'])['val'](mySettings['Subject']);if(sStage=='Telephone\x20Interview')$('#'+ctrlInterview['LocationID']+'-tr')['hide']();else $('#'+ctrlInterview['LocationID']+'-tr')['show']();TriSysActions['PersistedSettingsSafeguard']['WaitUntilTaskControlsAreLoaded'](![],!![],function(){ctrlFollowUp['Reload'](mySettings['FollowUp']);});}},'GetSettings':function(){var mySettings=ctrlInterview['GetSettingsForSelectedStage']();if(!mySettings)return;if(!ctrlInterview['PersistedSettings'])ctrlInterview['PersistedSettings']={'Default':mySettings['Stage'],'Stages':[]};var iIndex=ctrlInterview['GetSettingsIndexForStage'](mySettings['Stage']);if(iIndex>=0x0)ctrlInterview['PersistedSettings']['Stages']['splice'](iIndex,0x1);return ctrlInterview['PersistedSettings']['Stages']['push'](mySettings),ctrlInterview['PersistedSettings']['Default']=mySettings['Stage'],ctrlInterview['PersistedSettings'];},'Configure':function(){var mySettings=ctrlInterview['GetSettings']();if(!mySettings)return;TriSysActions['Persistence']['Write'](mySettings);}};$(document)['ready'](function(){ctrlInterview['Load']();});