var ctrlNote={'TaskTypeID':'ctrlNote-TaskType','TaskTypeImage':'ctrlNote-Selected-TaskType-Image','DurationID':'ctrlNote-Duration','AttributesID':'ctrlNote-Attributes','FollowUpID':'ctrlNote-FollowUp','NotesID':'ctrlNote-Description','Load':function(){TriSysActions['Forms']['TaskType']['Load'](ctrlNote['TaskTypeID'],ctrlNote['TaskTypeImage'],'Note'),TriSysSDK['Controls']['Duration']['Initialise'](ctrlNote['DurationID']),TriSysActions['Forms']['Attributes']['Load'](ctrlNote['AttributesID']),TriSysActions['FollowUp']['Load'](ctrlNote['FollowUpID']),TriSysActions['Persistence']['Read'](ctrlNote['ReadPersistedSettingsCallback']);},'Finish':function(){var mySettings=ctrlNote['GetSettings']();if(!mySettings)return;var FollowUpData=ctrlFollowUp['Validation']();if(!FollowUpData)return;var noteActionData=new TriSysActions['Invocation']['ActionData']();noteActionData['TaskType']=mySettings['TaskType'],noteActionData['Attributes']=mySettings['Attributes'],noteActionData['Duration']=mySettings['Duration'],noteActionData['Notes']=mySettings['Notes'],noteActionData['FollowUp']=FollowUpData,ctrlNote['SendActionDataToWebAPI'](noteActionData);},'SendActionDataToWebAPI':function(CNoteActionRequest){var payloadObject={};payloadObject['URL']='Action/Note',payloadObject['OutboundDataPacket']=CNoteActionRequest,payloadObject['InboundDataFunction']=function(CNoteActionResponse){TriSysApex['UI']['HideWait']();if(CNoteActionResponse){if(CNoteActionResponse['Success']){TriSysActions['Invocation']['PostInvocationCompletion']();return;}else TriSysApex['UI']['ShowMessage'](CNoteActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlNote.SendActionDataToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Saving\x20Note...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'Configure':function(){var mySettings=ctrlNote['GetSettings']();if(!mySettings)return;TriSysActions['Persistence']['Write'](mySettings);},'GetSettings':function(){var sError=null,sTaskType=TriSysSDK['CShowForm']['GetTaskTypeFromCombo'](ctrlNote['TaskTypeID']),sAttributes=TriSysSDK['CShowForm']['GetSelectedSkillsFromList'](ctrlNote['AttributesID']),sDuration=TriSysSDK['Controls']['Duration']['Get'](ctrlNote['DurationID']),sNotes=$('#'+ctrlNote['NotesID'])['val']();if(!sNotes)sError='Please\x20enter\x20a\x20note.';if(sError)return TriSysApex['UI']['ShowMessage'](sError),null;var mySettings={'TaskType':sTaskType,'Attributes':sAttributes,'Duration':sDuration,'Notes':sNotes,'FollowUp':ctrlFollowUp['Validation']()};return mySettings;},'ReadPersistedSettingsCallback':function(mySettings){TriSysSDK['CShowForm']['SetTaskTypeComboValue'](ctrlNote['TaskTypeID'],mySettings['TaskType']),TriSysActions['Forms']['TaskType']['Icon'](ctrlNote['TaskTypeImage'],mySettings['TaskTypeImage']),TriSysSDK['CShowForm']['SetSkillsInList'](ctrlNote['AttributesID'],mySettings['Attributes']),TriSysSDK['Controls']['Duration']['Set'](ctrlNote['DurationID'],mySettings['Duration']),$('#'+ctrlNote['NotesID'])['val'](mySettings['Notes']),TriSysActions['PersistedSettingsSafeguard']['WaitUntilTaskControlsAreLoaded'](![],!![],function(){ctrlFollowUp['Reload'](mySettings['FollowUp']);});}};$(document)['ready'](function(){ctrlNote['Load']();});