var ctrlWithdrawn={'ClientID':'ctrlWithdrawn-Client','RequirementID':'ctrlWithdrawn-Requirement','CandidateID':'ctrlWithdrawn-Candidate','ClientTemplatesID':'ctrlWithdrawn-ClientTemplate','CandidateTemplatesID':'ctrlWithdrawn-CandidateTemplate','EditClientTemplateButtonID':'ctrlWithdrawn-EditClientTemplate','EditCandidateTemplateButtonID':'ctrlWithdrawn-EditCandidateTemplate','ClientSubjectID':'ctrlWithdrawn-ClientSubject','CandidateSubjectID':'ctrlWithdrawn-CandidateSubject','StartDateID':'ctrlWithdrawn-StartDate','EndDateID':'ctrlWithdrawn-EndDate','SalaryID':'ctrlWithdrawn-Salary','NoteHistoryID':'ctrlWithdrawn-NoteHistory','FollowUpID':'ctrlWithdrawn-FollowUp','CandidateList':null,'Load':function(){var sWithdrawn='Withdrawn',sWithdrawnFolder=sWithdrawn+'/';TriSysActions['MailMerge']['PopulateTemplates'](sWithdrawn+':\x20Client',TriSysActions['MailMerge']['MasterTemplateFolder']+sWithdrawnFolder+TriSysActions['MailMerge']['ClientTemplatesFolder'],ctrlWithdrawn['ClientTemplatesID'],'Client\x20Withdrawn',ctrlWithdrawn['EditClientTemplateButtonID']),TriSysActions['MailMerge']['PopulateTemplates'](sWithdrawn+':\x20Candidate',TriSysActions['MailMerge']['MasterTemplateFolder']+sWithdrawnFolder+TriSysActions['MailMerge']['CandidateTemplatesFolder'],ctrlWithdrawn['CandidateTemplatesID'],'Candidate\x20Withdrawn',ctrlWithdrawn['EditCandidateTemplateButtonID']);var defaults={'TaskType':'Letter'};TriSysActions['NoteHistory']['Load'](ctrlWithdrawn['NoteHistoryID'],defaults),TriSysSDK['CShowForm']['datePicker'](ctrlWithdrawn['StartDateID']),TriSysSDK['CShowForm']['datePicker'](ctrlWithdrawn['EndDateID']);var fSpinIncrement=0x1f4,sPeriod='Annum';TriSysSDK['Controls']['CurrencyAmountPeriod']['PopulateCurrencyAmountPeriodWidget'](ctrlWithdrawn['SalaryID'],fSpinIncrement,sPeriod);var dtFollowUp=TriSysActions['FollowUp']['FollowUpDateTomorrow']();defaults={'CreateFollowUp':!![],'StartDateTime':dtFollowUp},TriSysActions['FollowUp']['Load'](ctrlWithdrawn['FollowUpID'],defaults),ctrlWithdrawn['PopulateActionData']();},'PopulateActionData':function(){if(TriSysActions['Invocation']['SingletonContactListCheck']('Withdraw\x20Candidate','candidate'))return;var CReadCVSendDetailsActionRequest=new TriSysActions['Invocation']['ActionData'](),payloadObject={};payloadObject['URL']='Action/ReadCVSendDetails',payloadObject['OutboundDataPacket']=CReadCVSendDetailsActionRequest,payloadObject['InboundDataFunction']=function(CReadCVSendDetailsActionResponse){TriSysApex['UI']['HideWait']();if(CReadCVSendDetailsActionResponse){if(CReadCVSendDetailsActionResponse['Success']){ctrlWithdrawn['DisplayClientContactDetails'](CReadCVSendDetailsActionResponse['ClientContact']),ctrlWithdrawn['DisplayCandidateDetails'](CReadCVSendDetailsActionResponse['CandidateContacts']),ctrlWithdrawn['DisplayRequirementDetails'](CReadCVSendDetailsActionResponse['Requirement']);if(CReadCVSendDetailsActionResponse['Requirement'])TriSysSDK['CShowForm']['setDatePickerValue'](ctrlWithdrawn['StartDateID'],CReadCVSendDetailsActionResponse['Requirement']['EarliestStartDate']);TriSysActions['Persistence']['Read'](ctrlWithdrawn['ReadPersistedSettingsCallback']);return;}else TriSysApex['UI']['ShowMessage'](CReadCVSendDetailsActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlWithdrawn.PopulateActionData:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Reading\x20Contacts...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DisplayClientContactDetails':function(contact){var sContact=contact['FullName'];if(contact['CompanyName'])sContact+=',\x20'+contact['CompanyName'];$('#'+ctrlWithdrawn['ClientID'])['html'](sContact);},'DisplayCandidateDetails':function(contactList){ctrlWithdrawn['CandidateList']=contactList;var sContact='';if(contactList&&contactList['length']==0x1){var contact=contactList[0x0];sContact=contact['FullName'];if(contact['HomeAddressStreet'])sContact+=',\x20'+contact['HomeAddressStreet']['replace'](/\r\n/g,',\x20');if(contact['HomeAddressCity'])sContact+=',\x20'+contact['HomeAddressCity'];}else{if(contactList)for(var i=0x0;i<contactList['length'];i++){var contact=contactList[i];if(sContact['length']>0x0)sContact+=',\x20';sContact+=contact['FullName'];}}$('#'+ctrlWithdrawn['CandidateID'])['html'](sContact);},'DisplayRequirementDetails':function(requirement){if(requirement){$('#'+ctrlWithdrawn['RequirementID'])['html'](requirement['Reference']+':\x20'+requirement['JobTitle']);if(requirement['Type']=='Permanent')TriSysSDK['Controls']['CurrencyAmountPeriod']['SetCurrencyAmountPeriod'](ctrlWithdrawn['SalaryID'],requirement['Salary']),$('#ctrlWithdrawn-EndDate-tr')['hide']();else $('#ctrlWithdrawn-Salary-tr')['hide']();}else $('#ctrlWithdrawn-Requirement-tr')['hide']();},'Configure':function(){var mySettings=ctrlWithdrawn['GetSettings']();if(!mySettings)return;TriSysActions['Persistence']['Write'](mySettings);},'GetSettings':function(){var sError=null,sClientTemplate=TriSysActions['MailMerge']['GetTemplateFromCombo'](ctrlWithdrawn['ClientTemplatesID']),sCandidateTemplate=TriSysActions['MailMerge']['GetTemplateFromCombo'](ctrlWithdrawn['CandidateTemplatesID']),sClientSubject=$('#'+ctrlWithdrawn['ClientSubjectID'])['val'](),sCandidateSubject=$('#'+ctrlWithdrawn['CandidateSubjectID'])['val']();if(sError)return TriSysApex['UI']['ShowMessage'](sError),null;var mySettings={'ClientTemplate':sClientTemplate,'CandidateTemplate':sCandidateTemplate,'ClientSubject':sClientSubject,'CandidateSubject':sCandidateSubject,'NoteHistory':ctrlNoteHistory['Validation'](),'FollowUp':ctrlFollowUp['Validation']()};return mySettings;},'ReadPersistedSettingsCallback':function(mySettings){TriSysSDK['CShowForm']['SetTextInCombo'](ctrlWithdrawn['ClientTemplatesID'],mySettings['ClientTemplate']),TriSysSDK['CShowForm']['SetTextInCombo'](ctrlWithdrawn['CandidateTemplatesID'],mySettings['CandidateTemplate']),$('#'+ctrlWithdrawn['ClientSubjectID'])['val'](mySettings['ClientSubject']),$('#'+ctrlWithdrawn['CandidateSubjectID'])['val'](mySettings['CandidateSubject']),TriSysActions['PersistedSettingsSafeguard']['WaitUntilTaskControlsAreLoaded'](!![],!![],function(){ctrlNoteHistory['Reload'](mySettings['NoteHistory']),ctrlFollowUp['Reload'](mySettings['FollowUp']);});},'MailMergeData':function(){if(!ctrlWithdrawn['CandidateList'])return;var dtStart=TriSysSDK['CShowForm']['getDatePickerValue'](ctrlWithdrawn['StartDateID']),sFormatedStartDate=dtStart?moment(dtStart)['format']('dddd\x20DD\x20MMMM\x20YYYY'):null,dtEnd=TriSysSDK['CShowForm']['getDatePickerValue'](ctrlWithdrawn['EndDateID']),sFormatedEndDate=dtEnd?moment(dtEnd)['format']('dddd\x20DD\x20MMMM\x20YYYY'):null,sSalary=TriSysSDK['Controls']['CurrencyAmountPeriod']['GetCurrencyAmountPeriod'](ctrlWithdrawn['SalaryID'],!![]),actionSpecificData={'ActionName':'Withdrawn','ActionDisplayName':'Offer\x20Rejected','Values':[{'FieldName':'StartDate','FieldDisplayName':'Start\x20Date','Value':sFormatedStartDate},{'FieldName':'EndDate','FieldDisplayName':'End\x20Date','Value':sFormatedEndDate},{'FieldName':'Salary','FieldDisplayName':'Salary','Value':sSalary}]};return actionSpecificData;},'Finish':function(){var mySettings=ctrlWithdrawn['GetSettings']();if(!mySettings)return;var NoteHistoryData=ctrlNoteHistory['Validation']();if(!NoteHistoryData)return;var FollowUpData=ctrlFollowUp['Validation']();if(!FollowUpData)return;var sError=null,dtStart=TriSysSDK['CShowForm']['getDatePickerValue'](ctrlWithdrawn['StartDateID']),dtEnd=TriSysSDK['CShowForm']['getDatePickerValue'](ctrlWithdrawn['EndDateID']);if(!dtStart)sError='Please\x20specify\x20a\x20start\x20date.';else{var bVisible=$('#'+ctrlWithdrawn['EndDateID'])['is'](':visible');if(bVisible){if(!dtEnd)sError='Please\x20specify\x20an\x20end\x20date.';}}if(sError)return TriSysApex['UI']['ShowMessage'](sError),null;ctrlWithdrawn['SendActionDataToWebAPI'](mySettings,NoteHistoryData,FollowUpData);},'SendActionDataToWebAPI':function(mySettings,NoteHistoryData,FollowUpData){var CWithdrawnActionRequest={'ClientTemplate':mySettings['ClientTemplate'],'CandidateTemplate':mySettings['CandidateTemplate'],'ClientSubject':mySettings['ClientSubject'],'CandidateSubject':mySettings['CandidateSubject'],'ActionData':new TriSysActions['Invocation']['ActionData'](),'NoteHistory':NoteHistoryData,'FollowUp':FollowUpData},payloadObject={};payloadObject['URL']='Action/Withdrawn',payloadObject['OutboundDataPacket']=CWithdrawnActionRequest,payloadObject['InboundDataFunction']=function(CWithdrawnActionResponse){TriSysApex['UI']['HideWait']();if(CWithdrawnActionResponse){if(CWithdrawnActionResponse['Success']){TriSysActions['Invocation']['PostInvocationCompletion']();if(CWithdrawnActionResponse['URL'])for(var i=0x0;i<CWithdrawnActionResponse['URL']['length'];i++){var sURL=CWithdrawnActionResponse['URL'][i];TriSysApex['ModalDialogue']['DocumentViewer']['DownloadAndOpen']('e-mail',sURL);}return;}else TriSysApex['UI']['ShowMessage'](CWithdrawnActionResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlWithdrawn.SendActionDataToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysApex['UI']['ShowWait'](null,'Generating\x20E-Mail...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);}};$(document)['ready'](function(){ctrlWithdrawn['Load']();});