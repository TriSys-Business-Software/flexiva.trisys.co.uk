var ctrlContactImport={'LoadedInTile':function(sTileID,persistedSettings){var sPrefix=sTileID+'-';try{ctrlContactImport['Load'](sPrefix,persistedSettings);}catch(e){}},'Load':function(sPrefix,persistedSettings){var obj=$('#'+sPrefix+'trisys-upload-dragandrophandler-dashboard-tile-import');obj['on']('click',function(e){$('#'+sPrefix+'trisys-upload-file-picker-dashboard-tile-import')['focus']()['trigger']('click');}),obj['on']('dragenter',function(e){e['stopPropagation'](),e['preventDefault'](),$(this)['css']('border','2px\x20solid\x20#0B85A1');}),obj['on']('dragover',function(e){e['stopPropagation'](),e['preventDefault']();}),obj['on']('drop',function(e){$(this)['css']('border','2px\x20dotted\x20#0B85A1'),e['preventDefault']();var files=e['originalEvent']['dataTransfer']['files'];ctrlContactImport['ProcessHTMLFiles'](files,sPrefix);}),$('#'+sPrefix+'trisys-upload-file-picker-dashboard-tile-import')['bind']('change',function(e){var files=this['files'];ctrlContactImport['ProcessHTMLFiles'](files,sPrefix);});},'ProcessHTMLFiles':function(files,sPrefix){if(!files)return;if(files['length']<=0x0)return;var file=files[0x0],info=file['name'];if(file['size']>0x0){var MaxSizeInMb=0xa,iSizeOfFileInKb=file['size']/0x400,iSizeOfFileInMb=iSizeOfFileInKb/0x400,iSizeOfFileInGb=iSizeOfFileInMb/0x400;if(iSizeOfFileInMb>MaxSizeInMb){var sMessage='The\x20maximum\x20size\x20of\x20files\x20which\x20can\x20you\x20can\x20upload\x20is\x20currently\x20limited\x20to\x20'+MaxSizeInMb+'Mb.'+'<br\x20/>'+'If\x20you\x20wish\x20to\x20increase\x20this\x20limit,\x20please\x20contact\x20your\x20account\x20manager.';TriSysApex['UI']['errorAlert'](sMessage);return;}info+='\x20('+Math['ceil'](iSizeOfFileInKb)+'\x20KB)';}$('#'+sPrefix+'trisys-upload-file-list-dashboard-tile-import')['html'](info),ctrlContactImport['ImportFile'](files);},'ImportFile':function(files){var file=files[0x0],fnCallback=function(myFile){ctrlContactImport['UploadImportFile'](myFile);};TriSysSDK['Controls']['FileManager']['UploadFile'](file,fnCallback);},'UploadImportFile':function(sFilePath){var payloadObject={};payloadObject['URL']='Files/MoveUploadedFileReferenceDocument',payloadObject['OutboundDataPacket']={'UploadedFilePath':sFilePath,'SubFolder':'Import'},payloadObject['InboundDataFunction']=function(data){TriSysApex['UI']['HideWait']();var JSONdataset=data;if(JSONdataset){if(JSONdataset['Success']){var sFilePath=JSONdataset['FolderFilePath'];ctrlContactImport['PostUploadFile'](sFilePath);}else TriSysApex['UI']['errorAlert'](JSONdataset['ErrorMessage']);}else{}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['ErrorHandlerRedirector']('ctrlContactImport.UploadImportFile:\x20',request,status,error);};var sName=TriSysSDK['Controls']['FileManager']['GetFileNameFromPath'](sFilePath);TriSysApex['UI']['ShowWait'](null,'Importing\x20'+sName+'...'),TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'PostUploadFile':function(sFilePath){var userCredentials=TriSysApex['LoginCredentials']['UserCredentials'](),sDatabaseSummary=userCredentials['SQLServer']+'.'+userCredentials['Database'],sFileSummary='File\x20Submitted\x20for\x20Import:\x20'+sFilePath;sFileSummary+='<br\x20/><br\x20/>NAS\x20Path:\x20'+userCredentials['GDrivePath'],sFileSummary+='<br\x20/><br\x20/>Database:\x20'+sDatabaseSummary,sFileSummary+='<br\x20/><br\x20/>User:\x20'+userCredentials['LoggedInUser']['ForenameAndSurname'],sFileSummary+='<br\x20/><br\x20/>Company:\x20'+userCredentials['LoggedInUser']['Contact']['CompanyName'];var sHTML='<html><body>'+sFileSummary+'</body></html>',sSubject='Apex\x20Data\x20Import\x20Request:\x20'+userCredentials['LoggedInUser']['ForenameAndSurname']+',\x20'+userCredentials['LoggedInUser']['Contact']['CompanyName'],CSendEMailRequest={'HTML':sHTML,'Subject':sSubject,'ToRecipients':['francisco@trisys.co.uk','garry@trisys.co.uk']};ctrlContactImport['SendEMailToWebAPI'](CSendEMailRequest);var sMessage='Your\x20file\x20has\x20been\x20uploaded\x20and\x20is\x20queued\x20for\x20import.';sMessage+='<br\x20/>'+'You\x20will\x20be\x20alerted\x20once\x20import\x20has\x20been\x20completed.',TriSysApex['UI']['ShowMessage'](sMessage,'Data\x20Import');},'SendEMailToWebAPI':function(CSendEMailRequest){var payloadObject={};payloadObject['URL']='EMail/Send',payloadObject['OutboundDataPacket']=CSendEMailRequest,payloadObject['InboundDataFunction']=function(CSendEMailResponse){if(CSendEMailResponse){if(CSendEMailResponse['Success'])return;else TriSysApex['UI']['ShowMessage'](CSendEMailResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['HideWait'](),TriSysApex['UI']['errorAlert']('ctrlContactImport.SendEMailToWebAPI:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);}};