var ctrlMonthlyMarginAndFees={'LoadedInTile':function(sTileID,persistedSettings){var sPrefix=sTileID+'-';if(TriSysPhoneGap['ifPhoneHideDashboardTile'](sTileID))return;try{ctrlMonthlyMarginAndFees['Load'](sPrefix,persistedSettings);}catch(e){}},'Load':function(sPrefix,persistedSettings){var userCredentials=TriSysApex['LoginCredentials']['UserCredentials'](),lUserId=userCredentials['LoggedInUser']['UserId'],payloadObject={};payloadObject['URL']='DashboardMetric/MonthlyQuickStats',payloadObject['OutboundDataPacket']=null,payloadObject['InboundDataFunction']=function(data){var CDashboardMetricsQuickStatsResponse=data;if(CDashboardMetricsQuickStatsResponse){if(CDashboardMetricsQuickStatsResponse['Success'])ctrlMonthlyMarginAndFees['DrawChart'](CDashboardMetricsQuickStatsResponse,lUserId,sPrefix);else TriSysApex['Logging']['LogMessage'](CDashboardMetricsQuickStatsResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('ctrlMonthlyMarginAndFees.Load:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DrawChart':function(CDashboardMetricsQuickStatsResponse,lUserId,sPrefix){var chartData=ctrlMonthlyMarginAndFees['Get12MonthChartDataFromQuickStatMetric'](CDashboardMetricsQuickStatsResponse['PermanentPlacementFees'],CDashboardMetricsQuickStatsResponse['ContractPlacementMargin'],lUserId),sChart=sPrefix+'trisys-dashboard-monthly-margin-fees-chart',permanentData=[],contractData=[],categories=[],iMaxChartValue=0x0;for(var iMonth=0x0;iMonth<chartData['length'];iMonth++){var monthData=chartData[iMonth];permanentData['push'](monthData['PermanentFees']),contractData['push'](monthData['ContractMargin']),categories['push'](monthData['DateCaption']);if(monthData['PermanentFees']>iMaxChartValue)iMaxChartValue=monthData['PermanentFees'];if(monthData['ContractMargin']>iMaxChartValue)iMaxChartValue=monthData['ContractMargin'];}var labelParameters={'PreSymbol':TriSysSDK['Controls']['CurrencyAmount']['DefaultCurrencySymbol'](),'PostSymbol':null,'DecimalPlaces':0x0,'Skip':0x1,'MaxValue':iMaxChartValue,'Ticks':0x4};$('#'+sChart)['kendoChart']({'chartArea':{'height':0xfa},'legend':{'position':'top','labels':{'font':TriSysSDK['KendoUICharts']['Font']}},'seriesDefaults':{'type':'column'},'series':[{'name':'Permanent\x20Fees\x20&nbsp;','data':permanentData},{'name':'Contract\x20Margin','data':contractData}],'seriesColors':[TriSysProUI['NavBarInverseColour'](),TriSysProUI['BackColour']()],'valueAxis':TriSysSDK['KendoUICharts']['ValueAxes']['Get'](labelParameters),'categoryAxis':{'categories':categories,'line':{'visible':![]},'labels':{'padding':{'top':0x0},'font':TriSysSDK['KendoUICharts']['Font']}},'tooltip':{'visible':!![],'format':'#,0','template':'#=\x20series.name\x20#:\x20'+TriSysSDK['Controls']['CurrencyAmount']['DefaultCurrencySymbol']()+'#=\x20TriSysSDK.Numbers.Format(value,\x200)\x20#'}});},'Get12MonthChartDataFromQuickStatMetric':function(lstOfPermanentFees,lstOfContractMargin,lUserId){var dtToday=new Date(),dtEnd=dtToday,dtStart=new Date();dtStart['setFullYear'](dtToday['getFullYear']()-0x1),dtStart['setMonth'](dtToday['getMonth']()),dtStart['setDate'](0x1);var iStartYear=dtStart['getFullYear'](),iStartMonth=dtStart['getMonth'](),iEndYear=dtEnd['getFullYear'](),iEndMonth=dtEnd['getMonth']();iStartMonth+=0x1,iEndMonth+=0x1;if(lstOfPermanentFees&&lstOfContractMargin){for(var i=lstOfPermanentFees['length']-0x1;i>=0x0;i--){var stat=lstOfPermanentFees[i];if(stat['UserId']!=lUserId)lstOfPermanentFees['splice'](i,0x1);}for(var i=lstOfContractMargin['length']-0x1;i>=0x0;i--){var stat=lstOfContractMargin[i];if(stat['UserId']!=lUserId)lstOfContractMargin['splice'](i,0x1);}}var dateAndValueArray=[];for(var iMonth=0x0;iMonth<0xc;iMonth++){dtStart['setMonth'](dtStart['getMonth']()+0x1);var iMonthDb=dtStart['getMonth']()+0x1,iYearDb=dtStart['getFullYear'](),sDateCaption=moment(dtStart)['format']('MMM\x20YYYY'),dateAndValue={'DateCaption':sDateCaption,'ContractMargin':0x0,'PermanentFees':0x0};dateAndValueArray['push'](dateAndValue);if(lstOfPermanentFees)for(var i=0x0;i<lstOfPermanentFees['length'];i++){var stat=lstOfPermanentFees[i];if(stat['Year']==iYearDb&&stat['Month']==iMonthDb)dateAndValue['PermanentFees']=stat['Value'];}if(lstOfContractMargin)for(var i=0x0;i<lstOfContractMargin['length'];i++){var stat=lstOfContractMargin[i];if(stat['Year']==iYearDb&&stat['Month']==iMonthDb)dateAndValue['ContractMargin']=stat['Value'];}TriSysApex['Constants']['ShowDummyDashboardData']&&(dateAndValue['PermanentFees']+=TriSysSDK['Miscellaneous']['RandomNumber'](0x3e8,0x3a98),dateAndValue['ContractMargin']+=TriSysSDK['Miscellaneous']['RandomNumber'](0x3e8,0x3a98));}return dateAndValueArray;}};