var ctrlCandidateSourceProfits={'LoadedInTile':function(sTileID,persistedSettings){var sPrefix=sTileID+'-';try{var sSpinnerID=sPrefix+'wait-spinner';TriSysSDK['WaitSpinner']['Load'](sSpinnerID,0xc8);var fnHideSpinner=function(){$('#'+sSpinnerID)['hide']();},sPlacementType=ctrlDashboard['Persistence']['GetSettingValue'](persistedSettings,'PlacementType','All');ctrlCandidateSourceProfits['Load'](sPrefix,sPlacementType,fnHideSpinner);}catch(e){}},'Load':function(sPrefix,sPlacementType,fnCallbackAfterLoad){var payloadObject={};payloadObject['URL']='DashboardMetric/CandidateSourceProfits',payloadObject['OutboundDataPacket']=null,payloadObject['InboundDataFunction']=function(data){if(fnCallbackAfterLoad)fnCallbackAfterLoad();var CDashboardMetricsCandidateSourceProfitsResponse=data;if(CDashboardMetricsCandidateSourceProfitsResponse){if(CDashboardMetricsCandidateSourceProfitsResponse['Success'])ctrlCandidateSourceProfits['DisplayMetrics'](CDashboardMetricsCandidateSourceProfitsResponse['Source'],sPrefix,sPlacementType);else TriSysApex['Logging']['LogMessage'](CDashboardMetricsCandidateSourceProfitsResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('ctrlCandidateSourceProfits.Load:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'DisplayMetrics':function(lstCDashboardMetricCandidateSourceProfit,sPrefix,sPlacementType){if(!lstCDashboardMetricCandidateSourceProfit)return;switch(sPlacementType){case'Permanent':lstCDashboardMetricCandidateSourceProfit['sort'](function(a,b){return b['PermanentFees']-a['PermanentFees'];});break;case'Contract':lstCDashboardMetricCandidateSourceProfit['sort'](function(a,b){return b['ContractMargin']-a['ContractMargin'];});break;case'Temporary':lstCDashboardMetricCandidateSourceProfit['sort'](function(a,b){return b['TemporaryMargin']-a['TemporaryMargin'];});break;}ctrlCandidateSourceProfits['DrawTable'](lstCDashboardMetricCandidateSourceProfit,sPrefix,sPlacementType),ctrlCandidateSourceProfits['DrawChart'](lstCDashboardMetricCandidateSourceProfit,sPrefix,sPlacementType);},'DrawTable':function(lstCDashboardMetricCandidateSourceProfit,sPrefix,sPlacementType){var sDiv=sPrefix+'candidate-source-profits-ejs',sUKPoundHTMLcode='&pound;',sCurrencySymbol=TriSysSDK['Controls']['CurrencyAmount']['DefaultCurrencySymbol']();if(sCurrencySymbol==TriSysSDK['Controls']['CurrencyAmount']['UKPound'])sCurrencySymbol=sUKPoundHTMLcode;var EJSArray={'CandidateSourceProfits':[]};for(var i=0x0;i<lstCDashboardMetricCandidateSourceProfit['length'];i++){var source=lstCDashboardMetricCandidateSourceProfit[i],iProfit=source['TotalProfit'],iAverage=source['AverageProfit'],iNumberOfPlacements=source['NumberOfPermanentPlacements']+source['NumberOfContractPlacements']+source['NumberOfTemporaryPlacements'];switch(sPlacementType){case'Permanent':iProfit=source['PermanentFees'],iAverage=source['AveragePermanentFeePounds'],iNumberOfPlacements=source['NumberOfPermanentPlacements'];break;case'Contract':iProfit=source['ContractMargin'],iAverage=source['AverageContractMarginPounds'],iNumberOfPlacements=source['NumberOfContractPlacements'];break;case'Temporary':iProfit=source['TemporaryMargin'],iAverage=source['AverageTemporaryMarginPounds'],iNumberOfPlacements=source['NumberOfTemporaryPlacements'];break;}source['Position']=i+0x1,source['NumberOfPlacements']=TriSysSDK['Numbers']['Format'](iNumberOfPlacements,0x0),source['ProfitWithCurrency']=sCurrencySymbol+TriSysSDK['Numbers']['Format'](iProfit,0x0),source['AverageWithCurrency']=sCurrencySymbol+TriSysSDK['Numbers']['Format'](iAverage,0x0),EJSArray['CandidateSourceProfits']['push'](source);}try{var sTemplate=TriSysApex['Constants']['UserControlFolder']+'dashboard/templates/candidate-source-profits.ejs'+TriSysApex['FormsManager']['pageURLTimestampArgumentsToForceNoCache'](),result=new EJS({'url':sTemplate})['render'](EJSArray);result=result['replace'](/##PlacementType##/g,sPlacementType);if(sPlacementType=='All')result=result['replace']('<br\x20/>All','');document['getElementById'](sDiv)['innerHTML']=result;}catch(e){var sError=e;}},'DrawChart':function(lstCDashboardMetricCandidateSourceProfit,sPrefix,sPlacementType){var sChart=sPrefix+'candidate-source-profits-chart',profitData=[],numPlacementsData=[],categories=[],iMaxPlacements=0x0,iMaxChartValue=0x0;for(var i=0x0;i<lstCDashboardMetricCandidateSourceProfit['length'];i++){var source=lstCDashboardMetricCandidateSourceProfit[i],iProfit=source['TotalProfit'],iNumberOfPlacements=source['NumberOfPermanentPlacements']+source['NumberOfContractPlacements']+source['NumberOfTemporaryPlacements'];switch(sPlacementType){case'Permanent':iProfit=source['PermanentFees'],iNumberOfPlacements=source['NumberOfPermanentPlacements'];break;case'Contract':iProfit=source['ContractMargin'],iNumberOfPlacements=source['NumberOfContractPlacements'];break;case'Temporary':iProfit=source['TemporaryMargin'],iNumberOfPlacements=source['NumberOfTemporaryPlacements'];break;}profitData['push'](iProfit),numPlacementsData['push'](iNumberOfPlacements),categories['push'](source['CandidateSource']);if(iNumberOfPlacements>iMaxPlacements)iMaxPlacements=iNumberOfPlacements;if(iProfit>iMaxChartValue)iMaxChartValue=iProfit;}var labelParameters={'PreSymbol':TriSysSDK['Controls']['CurrencyAmount']['DefaultCurrencySymbol'](),'PostSymbol':null,'DecimalPlaces':0x0,'Skip':0x1,'MaxValue':iMaxChartValue,'Ticks':0x4},barAxes=TriSysSDK['KendoUICharts']['ValueAxes']['Get'](labelParameters);$('#'+sChart)['kendoChart']({'chartArea':{'height':0x177},'legend':{'position':'top','labels':{'font':TriSysSDK['KendoUICharts']['Font']}},'series':[{'type':'column','name':'Profit\x20To\x20Date\x20&nbsp;\x20','data':profitData},{'type':'line','name':'Number\x20of\x20Placements','data':numPlacementsData,'axis':'Number\x20of\x20Placements'}],'seriesColors':[TriSysProUI['BackColour'](),TriSysProUI['NavBarInverseColour']()],'valueAxes':[barAxes,{'name':'Number\x20of\x20Placements','title':{'text':'Number\x20of\x20Placements','font':TriSysSDK['KendoUICharts']['Font']},'labels':{'format':'{0}','font':TriSysSDK['KendoUICharts']['Font']},'line':{'visible':![]},'min':0x0,'max':iMaxPlacements+0xa}],'categoryAxis':{'categories':categories,'line':{'visible':![]},'labels':{'padding':{'top':0x0},'rotation':-0x5a,'font':TriSysSDK['KendoUICharts']['Font']},'axisCrossingValues':[0x0,lstCDashboardMetricCandidateSourceProfit['length']+0x1]},'tooltip':{'visible':!![],'template':'#=\x20category\x20#:\x20#=\x20series.name\x20#:\x20#=\x20TriSysSDK.Numbers.Format(value,\x200)\x20#'}});},'ConfigureMenuButtonClick':function(sID,sTileID){var sPrefix=sTileID+'-',persistedSetting={'Setting':'PlacementType','Value':sID};if(persistedSetting){ctrlDashboard['Persistence']['SaveTileSetting'](sTileID,persistedSetting);var persistedSettings=[persistedSetting];ctrlCandidateSourceProfits['LoadedInTile'](sTileID,persistedSettings);}}};