var ctrlMyQuickStats={'LoadedInTile':function(sTileID,persistedSettings){var sPrefix=sTileID+'-';try{ctrlMyQuickStats['Load'](sPrefix,persistedSettings);}catch(e){}},'Load':function(sPrefix,persistedSettings){var userCredentials=TriSysApex['LoginCredentials']['UserCredentials'](),lUserId=userCredentials['LoggedInUser']['UserId'],payloadObject={};payloadObject['URL']='DashboardMetric/MonthlyQuickStats',payloadObject['OutboundDataPacket']=null,payloadObject['InboundDataFunction']=function(data){var CDashboardMetricsQuickStatsResponse=data;if(CDashboardMetricsQuickStatsResponse){if(CDashboardMetricsQuickStatsResponse['Success'])ctrlMyQuickStats['CalculateAndDisplayMetrics'](CDashboardMetricsQuickStatsResponse,lUserId,sPrefix);else TriSysApex['Logging']['LogMessage'](CDashboardMetricsQuickStatsResponse['ErrorMessage']);}},payloadObject['ErrorHandlerFunction']=function(request,status,error){TriSysApex['UI']['errorAlert']('ctrlMyQuickStats.Load:\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'CalculateAndDisplayMetrics':function(CDashboardMetricsQuickStatsResponse,lUserId,sPrefix){var Period={'Year':![],'Month':!![]},TotalRequirementValueThisMonthStat=ctrlMyQuickStats['CalculateQuickStatMetric'](CDashboardMetricsQuickStatsResponse['PermanentRequirementFees'],CDashboardMetricsQuickStatsResponse['ContractRequirementMargin'],lUserId,Period);Period={'Year':!![],'Month':![]};var TotalRequirementValueThisYearStat=ctrlMyQuickStats['CalculateQuickStatMetric'](CDashboardMetricsQuickStatsResponse['PermanentRequirementFees'],CDashboardMetricsQuickStatsResponse['ContractRequirementMargin'],lUserId,Period);Period={'Year':![],'Month':!![]};var TotalPlacementValueThisMonthStat=ctrlMyQuickStats['CalculateQuickStatMetric'](CDashboardMetricsQuickStatsResponse['PermanentPlacementFees'],CDashboardMetricsQuickStatsResponse['ContractPlacementMargin'],lUserId,Period);Period={'Year':!![],'Month':![]};var TotalPlacementValueThisYearStat=ctrlMyQuickStats['CalculateQuickStatMetric'](CDashboardMetricsQuickStatsResponse['PermanentPlacementFees'],CDashboardMetricsQuickStatsResponse['ContractPlacementMargin'],lUserId,Period),sCurrencySymbol=TriSysSDK['Controls']['CurrencyAmount']['DefaultCurrencySymbol'](),sMonthlyRequirementTotal=sCurrencySymbol+TriSysSDK['Numbers']['Format'](TotalRequirementValueThisMonthStat['Total']/0x3e8,0x0)+'K',sYearlyRequirementTotal=sCurrencySymbol+TriSysSDK['Numbers']['Format'](TotalRequirementValueThisYearStat['Total']/0x3e8,0x0)+'K',sMonthlyPlacementTotal=sCurrencySymbol+TriSysSDK['Numbers']['Format'](TotalPlacementValueThisMonthStat['Total']/0x3e8,0x0)+'K',sYearlyPlacementTotal=sCurrencySymbol+TriSysSDK['Numbers']['Format'](TotalPlacementValueThisYearStat['Total']/0x3e8,0x0)+'K',JQueryPrefix='#'+sPrefix;$(JQueryPrefix+'MonthlyRequirementTotal')['html'](sMonthlyRequirementTotal),$(JQueryPrefix+'MonthlyRequirementTotalPositions')['html']('#'+TotalRequirementValueThisMonthStat['Position']+'\x20of\x20'+TotalRequirementValueThisMonthStat['NumberOfPositions']),$(JQueryPrefix+'YearlyRequirementTotal')['html'](sYearlyRequirementTotal),$(JQueryPrefix+'YearlyRequirementTotalPositions')['html']('#'+TotalRequirementValueThisYearStat['Position']+'\x20of\x20'+TotalRequirementValueThisYearStat['NumberOfPositions']),$(JQueryPrefix+'MonthlyPlacementTotal')['html'](sMonthlyPlacementTotal),$(JQueryPrefix+'MonthlyPlacementTotalPositions')['html']('#'+TotalPlacementValueThisMonthStat['Position']+'\x20of\x20'+TotalPlacementValueThisMonthStat['NumberOfPositions']),$(JQueryPrefix+'YearlyPlacementTotal')['html'](sYearlyPlacementTotal),$(JQueryPrefix+'YearlyPlacementTotalPositions')['html']('#'+TotalPlacementValueThisYearStat['Position']+'\x20of\x20'+TotalPlacementValueThisYearStat['NumberOfPositions']);},'CalculateQuickStatMetric':function(lstOfPermanent,lstOfContract,lUserId,Period){var iStartYear=0x7d0,iStartMonth=0x0,dtToday=new Date(),dtEnd=dtToday,dtStart=new Date();dtStart['setFullYear'](iStartYear),dtStart['setMonth'](iStartMonth),dtStart['setDate'](0x1);if(Period['Year'])dtStart['setFullYear'](dtToday['getFullYear']()-0x1),dtStart['setMonth'](dtToday['getMonth']()),dtStart['setDate'](dtToday['getDate']()+0x1);else Period['Month']&&(dtStart['setFullYear'](dtToday['getFullYear']()),dtStart['setMonth'](dtToday['getMonth']()));dtStart['setHours'](0x0),dtStart['setMinutes'](0x0),dtStart['setSeconds'](0x0),dtEnd['setHours'](0x17),dtEnd['setMinutes'](0x3b),dtEnd['setSeconds'](0x3b),iStartYear=dtStart['getFullYear'](),iStartMonth=dtStart['getMonth']();var iEndYear=dtEnd['getFullYear'](),iEndMonth=dtEnd['getMonth']();iStartMonth+=0x1,iEndMonth+=0x1;var mergedData=[];if(lstOfPermanent&&lstOfContract){for(var i=0x0;i<lstOfPermanent['length'];i++){var stat=lstOfPermanent[i];mergedData['push'](stat);}for(var i=0x0;i<lstOfContract['length'];i++){var stat=lstOfContract[i],bFound=![];for(var j=0x0;j<mergedData['length'];j++){var mergedStat=mergedData[j];mergedStat['UserId']==stat['UserId']&&mergedStat['Year']==stat['Year']&&mergedStat==stat['Month']&&(bFound=!![],mergedStat['Value']+=stat['Value']);}if(!bFound)mergedData['push'](stat);}}var userTotalsForTimePeriod=[];for(var i=0x0;i<mergedData['length'];i++){var stat=mergedData[i],bInPeriod=![];if(stat['Year']==iStartYear&&stat['Month']>=iStartMonth)bInPeriod=!![];if(stat['Year']>iStartYear)bInPeriod=!![];if(bInPeriod){var bFound=![];for(var j=0x0;j<userTotalsForTimePeriod['length'];j++){var userTotalForTimePeriod=userTotalsForTimePeriod[j];userTotalForTimePeriod['UserId']==stat['UserId']&&(bFound=!![],userTotalForTimePeriod['Total']+=stat['Value']);}if(!bFound){var userTotalForTimePeriod={'UserId':stat['UserId'],'Total':stat['Value']};userTotalsForTimePeriod['push'](userTotalForTimePeriod);}}}userTotalsForTimePeriod['sort'](function(a,b){return b['Total']-a['Total'];});var usersFromCache=TriSysApex['Cache']['Users'](),lNumberOfUsers=!usersFromCache?0x0:usersFromCache['length'];if(userTotalsForTimePeriod&&userTotalsForTimePeriod['length']>0x0)lNumberOfUsers=userTotalsForTimePeriod['length'];if(userTotalsForTimePeriod){for(var i=0x0;i<userTotalsForTimePeriod['length'];i++){var userTotal=userTotalsForTimePeriod[i];userTotal['Position']=i+0x1,userTotal['NumberOfPositions']=lNumberOfUsers;}for(var i=0x0;i<userTotalsForTimePeriod['length'];i++){var userTotal=userTotalsForTimePeriod[i];if(userTotal['UserId']==lUserId)return userTotal;}}var lPosition=lNumberOfUsers+0x1;if(userTotalsForTimePeriod&&userTotalsForTimePeriod['length']==0x0&&usersFromCache)lPosition=usersFromCache['length'];var userTotalLast={'UserId':lUserId,'Total':0x0,'Position':lPosition,'NumberOfPositions':lPosition};return userTotalLast;}};