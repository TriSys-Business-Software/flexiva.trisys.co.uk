var ctrlCustomVariables={'Load':function(configurator){ctrlCustomVariables['Settings']['Configurator']=configurator,TriSysSDK['CShowForm']['RemoveKendoPopup'](ctrlCustomVariables['Settings']['TypeComboID']);var sFormName='ctrlCustomVariables';TriSysSDK['CShowForm']['InitialiseFields'](sFormName),configurator['SelectionModeOnly']&&($('#ctrlCustomVariables-Buttons')['hide'](),TriSysSDK['CShowForm']['ComboEnabled'](ctrlCustomVariables['Settings']['TypeComboID'],![])),ctrlCustomVariables['Resize'](),ctrlCustomVariables['Persistence']['Load'](function(){ctrlCustomVariables['LoadGrid'](configurator['CustomVariables']['Type']);}),TriSysSDK['CShowForm']['SetValueInCombo'](ctrlCustomVariables['Settings']['TypeComboID'],configurator['CustomVariables']['Type']);},'Resize':function(){const gridBlock=$('#ctrlCustomVariables-GridBlock'),iTop=gridBlock['position']()['top'];var iHeightFactor=0x3c,lHeight=$(window)['height']()-iTop-$('#ctrlCustomVariables-Instructions')['height']()-iHeightFactor;ctrlCustomVariables['Settings']['GridBlockHeight']=lHeight,gridBlock['css']('height',lHeight+'px'),lHeight=lHeight-0x50,$('#'+ctrlCustomVariables['Settings']['GridRowID'])['css']('height',lHeight+'px');},'LoadGrid':function(sType){const lst=ctrlCustomVariables['GridDataSource'](sType);var sDivTag=ctrlCustomVariables['Settings']['GridID'],sGridName=sDivTag+'-GridInstance';const configurator=ctrlCustomVariables['Settings']['Configurator'];var fnDrillDown=null;!configurator['SelectionModeOnly']&&(fnDrillDown=function(rowData){ctrlCustomVariables['EditVariable'](sType,rowData);}),TriSysSDK['Grid']['VirtualMode']({'Div':sDivTag,'ID':sGridName,'Title':sType+'\x20Variables','RecordsPerPage':TriSysApex['UserOptions']['RecordsPerPage'](),'PopulationByObject':lst,'Columns':[{'field':'Name','title':'Name','type':'string','width':0x12c},{'field':'Source','title':'Source','type':'string','width':0x12c},{'field':'Value','title':'Value','type':'string'}],'KeyColumnName':'Name','OpenButtonCaption':'Edit','DrillDownFunction':fnDrillDown,'MultiRowSelect':!configurator['SelectionModeOnly'],'Grouping':![]});},'GridDataSource':function(sType){var lst=TriSysFlexiva['Variables']['ReadAllByType'](sType);if(!lst)lst=[];return lst['sort'](function(a,b){return a['Name']['localeCompare'](b['Name']);}),lst;},'EditVariable':function(sType,rowData){switch(sType){case TriSysFlexiva['Variables']['Constants']['System']:case TriSysFlexiva['Variables']['Constants']['User']:TriSysApex['UI']['ShowMessage']('Please\x20open\x20Administrator\x20Console\x20to\x20edit\x20the\x20values\x20of\x20these\x20variables.');break;default:debugger;const sName=rowData['Name'];var objVariable=null;const lstExisting=ctrlCustomVariables['GridDataSource'](sType);lstExisting['forEach'](function(variable){if(variable['Name']===sName){objVariable=variable;return;}});var fnUpdateValue=function(sText){return objVariable['Value']=sText,ctrlCustomVariables['Persistence']['Save'](TriSysFlexiva['Variables']['_Variables'],function(){TriSysApex['Toasters']['Success']('Variable\x20updated\x20successfully.'),ctrlCustomVariables['LoadGrid'](sType);}),!![];},options={'Instructions':'Please\x20update\x20the\x20value\x20of\x20the\x20custom\x20variable\x20<strong>'+sName+'</strong>:','ButtonLabel':'Save','Label':'Value','Value':objVariable['Value']?objVariable['Value']:'','AllowEmpty':!![]};TriSysApex['ModalDialogue']['BigEdit']['Popup']('Edit\x20Custom\x20Variable\x20Value','gi-edit',fnUpdateValue,options);break;}},'SelectedRows':function(){var lstName=TriSysSDK['Grid']['GetSelectedMultipleRowsFromGrid'](ctrlCustomVariables['Settings']['GridID'],'Name');return lstName;},'SelectedVariable':function(){const sName=TriSysSDK['Grid']['GetSelectedSingletonRowFieldValueFromGrid'](ctrlCustomVariables['Settings']['GridID'],'Name');return sName;},'SelectedSource':function(){const sSource=TriSysSDK['Grid']['GetSelectedSingletonRowFieldValueFromGrid'](ctrlCustomVariables['Settings']['GridID'],'Source');return sSource;},'TypeList':function(){var types=[TriSysFlexiva['Variables']['Constants']['Client'],TriSysFlexiva['Variables']['Constants']['Server']],lst=[];return types['forEach'](function(item){lst['push']({'text':item,'value':item});}),lst;},'SelectedType':function(sType,sText,sFieldID){ctrlCustomVariables['LoadGrid'](sType);},'Add':function(){const configurator=ctrlCustomVariables['Settings']['Configurator'],sType=TriSysSDK['CShowForm']['GetValueFromCombo'](ctrlCustomVariables['Settings']['TypeComboID']);var lst=ctrlCustomVariables['GridDataSource'](sType);const fnNewVariable=function(fields,comboFields){debugger;var sSource=fields[0x0]['Value'];const sName=TriSysSDK['Miscellaneous']['EscapeVariableName'](sSource);comboFields&&comboFields['length']==0x1&&(sSource=comboFields[0x0]['Value']);if(!sName||sName['length']===0x0)return TriSysApex['UI']['ShowMessage']('Please\x20enter\x20a\x20name\x20for\x20the\x20variable.'),![];if(!lst)lst=[];const bDuplicate=lst['some'](function(item){var bNameMatch=![],bSourceMatch=![];if(item['Name']&&item['Name']['toLowerCase']()===sName['toLowerCase']())bNameMatch=!![];if(item['Source']&&item['Source']['toLowerCase']()===sSource['toLowerCase']())bSourceMatch=!![];return bNameMatch&&bSourceMatch;});if(bDuplicate)return TriSysApex['UI']['ShowMessage']('Variable:\x20'+sName+'\x20for\x20source:\x20'+sSource+'\x20already\x20exists'),![];const lstAll=TriSysFlexiva['CustomVariables']['Management']['ListOfAllVariables']();var duplicateVariable=null;lstAll['forEach'](function(variable){if(variable['Name']['toLowerCase']()===sName['toLowerCase']()){duplicateVariable=variable;return;}});if(duplicateVariable)return TriSysApex['UI']['ShowMessage']('Variable\x20name:\x20<strong>'+sName+'</strong>\x20already\x20exists\x20in\x20<strong>'+duplicateVariable['Type']+'</strong>.\x20\x0a\x09\x09\x09\x09\x09\x09\x09\x09\x09\x09<br>You\x20are\x20not\x20permitted\x20to\x20have\x20duplicate\x20variable\x20names.'),![];const sValue=fields[0x1]['Value'];return lst['push'](TriSysFlexiva['Variables']['Item'](sName,sSource,sValue)),ctrlCustomVariables['Persistence']['Save'](TriSysFlexiva['Variables']['_Variables'],function(){TriSysApex['Toasters']['Success']('Variable\x20added\x20successfully.'),ctrlCustomVariables['LoadGrid'](sType);}),!![];},sTypeDescription=sType?sType:'Uncategorised',sMessage='New\x20'+sTypeDescription+'\x20Custom\x20Variable';var sInstructions='Enter\x20the\x20name\x20and\x20value\x20of\x20the\x20new\x20'+sTypeDescription+'\x20variable',comboSource=null,comboSelectionFunction=null,comboSourceCombined=null;switch(sType){case TriSysFlexiva['Variables']['Constants']['System']:comboSource=ctrlCustomVariables['Collections']['System'](lst),comboSelectionFunction=ctrlCustomVariables['Collections']['GetSystemSettingValue'];break;case TriSysFlexiva['Variables']['Constants']['User']:comboSource=ctrlCustomVariables['Collections']['User'](lst),comboSelectionFunction=ctrlCustomVariables['Collections']['GetUserSettingValue'];break;case TriSysFlexiva['Variables']['Constants']['Session']:comboSource=ctrlCustomVariables['Collections']['Session'](lst),comboSelectionFunction=ctrlCustomVariables['Collections']['GetSessionVariableValue'];break;case TriSysFlexiva['Variables']['Constants']['Component']:sInstructions+='\x20after\x20choosing\x20the\x20component',comboSourceCombined=ctrlCustomVariables['Collections']['Component']();break;}if(comboSource){if(comboSource['length']===0x0){TriSysApex['UI']['ShowMessage']('All\x20'+sType+'\x20variables\x20have\x20been\x20added.');return;}var fnNewSetting=function(sSetting){const fields=[{'ID':'Name','Value':sSetting},{'ID':'Value','Value':comboSelectionFunction(sSetting)}];return fnNewVariable(fields);},options={'Instructions':sInstructions,'ComboLabel':sType+'\x20Setting','ComboList':comboSource,'ComboSelectedItem':comboSource[0x0]};TriSysApex['ModalDialogue']['Combo']['Popup'](sMessage,'gi-pen',fnNewSetting,options);}else{var options={'Instructions':sInstructions,'Fields':[{'ID':'Name','Label':'Name','Required':!![],'MaxLength':0x32},{'ID':'Value','Label':'Value','MaxLength':0x64}]};comboSourceCombined&&(options['ComboFields']=[{'ID':'Component','Label':'Component','ComboList':comboSourceCombined}]),TriSysApex['ModalDialogue']['NewWithMultipleFields']['Popup'](sMessage,'gi-pen',fnNewVariable,options);}},'Delete':function(){const lst=ctrlCustomVariables['SelectedRows']();if(!lst||lst['length']===0x0){TriSysApex['UI']['ShowMessage']('Please\x20select\x20at\x20least\x20one\x20variable\x20to\x20delete');return;}var sType=TriSysSDK['CShowForm']['GetValueFromCombo'](ctrlCustomVariables['Settings']['TypeComboID']),bShowAllWhenRefreshing=![];const sMessage='Are\x20you\x20sure\x20you\x20want\x20to\x20delete\x20'+lst['length']+'\x20'+sType['toLowerCase']()+'\x20variable'+(lst['length']==0x1?'':'s')+'?';TriSysApex['UI']['questionYesNo'](sMessage,'Delete\x20'+sType+'\x20Variable'+(lst['length']==0x1?'':'s'),'Yes',function(){const lstExisting=ctrlCustomVariables['GridDataSource'](sType);return lst['forEach'](function(sName){for(var i=lstExisting['length']-0x1;i>=0x0;i--){const existingVariableObject=lstExisting[i];existingVariableObject['Name']===sName&&lstExisting['splice'](i,0x1);}}),ctrlCustomVariables['Persistence']['Save'](TriSysFlexiva['Variables']['_Variables'],function(){TriSysApex['Toasters']['Success']('Variable\x20deleted\x20successfully.'),ctrlCustomVariables['LoadGrid'](sType);}),!![];},'No');},'Persistence':{'Load':function(fnCallback){TriSysFlexiva['Variables']['Load']({'Silent':![],'Callback':fnCallback});},'Save':function(variables,fnCallback){const sJSON=JSON['stringify'](variables),sDataBase64=TriSysAPI['Encryption']['Base64']['encode'](sJSON);TriSysFlexiva['Variables']['WebAPI']['Write'](sDataBase64,function(){fnCallback();});}},'Collections':{'System':function(lstExisting){var systemSettings=TriSysApex['Cache']['cachedStandingDataInMemory']['SystemSettings'];if(systemSettings){systemSettings=JSON['parse'](JSON['stringify'](systemSettings)),systemSettings['sort'](function(a,b){return a['Name']['localeCompare'](b['Name']);});const lst=[];return systemSettings['forEach'](systemSetting=>{lst['push'](systemSetting['Name']);}),ctrlCustomVariables['Collections']['ReturnListOfNonAssignedNames'](lstExisting,lst);}},'ReturnListOfNonAssignedNames':function(lstExisting,lst,sName){return lstExisting['forEach'](function(existingVariableObject){const sExistingName=existingVariableObject['Name'];for(var i=lst['length']-0x1;i>=0x0;i--){const sNewName=TriSysSDK['Miscellaneous']['EscapeVariableName'](lst[i]);sNewName===sExistingName&&lst['splice'](i,0x1);}}),lst;},'GetSystemSettingValue':function(sSetting){const manager=TriSysApex['Cache']['SystemSettingManager'],sValue=manager['GetValue'](sSetting);return sValue;},'User':function(lstExisting){var userSettings=TriSysApex['Cache']['UserSettings']();if(userSettings){userSettings=JSON['parse'](JSON['stringify'](userSettings));var userCredentials=TriSysApex['LoginCredentials']['UserCredentials']();if(userCredentials&&userCredentials['LoggedInUser']){const fnGetAllFieldNames=function(obj,prefix=''){let fields=new Set();function traverse(current,path){if(!current||typeof current!=='object')return;Array['isArray'](current)?current['forEach'](item=>traverse(item,path)):Object['keys'](current)['forEach'](key=>{const newPath=path?path+'.'+key:key;fields['add'](newPath),current[key]&&typeof current[key]==='object'&&traverse(current[key],newPath);});}return traverse(obj,prefix),Array['from'](fields)['sort']();},lstFields=fnGetAllFieldNames(userCredentials['LoggedInUser']);lstFields&&lstFields['forEach'](function(sField){userSettings['push']({'FName':sField});});}userSettings['sort'](function(a,b){return a['FName']['localeCompare'](b['FName']);});const lst=[];return userSettings['forEach'](userSetting=>{lst['push'](userSetting['FName']);}),ctrlCustomVariables['Collections']['ReturnListOfNonAssignedNames'](lstExisting,lst);}},'GetUserSettingValue':function(sSetting){const manager=TriSysApex['Cache']['UserSettingManager'],sValue=manager['GetValue'](sSetting);return sValue;}},'Settings':{'Configurator':null,'TypeComboID':'ctrlCustomVariables-Type','GridID':'ctrlCustomVariables-Grid','GridRowID':'ctrlCustomVariables-GridContainerBlock','GridBlockHeight':0x0}};