var AppStudioNavigationBar={'LiveMenuID':'ctrlNavigationBar-LiveMenu','HiddenMenuID':'ctrlNavigationBar-HiddenMenu','TreeViewIncrementingID':0x0,'SelectedTreeViewItem':null,'SelectedNodeElement':null,'SelectedNodeTreeViewID':null,'DroppedNodeTreeViewID':null,'Load':function(configurator){AppStudioNavigationBar['InitialiseFields'](configurator),AppStudioNavigationBar['NavigationBarEditor'](),ctrlAppStudioConfigurator['MakeAllBlocksTheSameHeight']([AppStudioNavigationBar['LiveMenuID'],AppStudioNavigationBar['HiddenMenuID'],'ctrlNavigationBar-Properties']);},'InitialiseFields':function(configurator){var sFormName='ctrlNavigationBar';TriSysSDK['CShowForm']['InitialiseFields'](sFormName),$('#ctrlNavigationBar-NavBarGroup-ID')['on']('input',function(){var newText=$(this)['val']();if(AppStudioNavigationBar['SelectedTreeViewItem']){AppStudioNavigationBar['SelectedTreeViewItem']['navItem']['ID']=newText;var children=AppStudioNavigationBar['SelectedTreeViewItem']['hasChildren']?AppStudioNavigationBar['SelectedTreeViewItem']['children']['data']():[];children['forEach'](function(child){child['formPage']['ParentNavBarMenuID']=newText,child['navItem']['ID']=newText;});}}),$('#ctrlNavigationBar-NavBarGroup-Caption')['on']('input',function(){var newText=$(this)['val']();AppStudioNavigationBar['SelectedTreeViewItem']&&(AppStudioNavigationBar['SelectedTreeViewItem']['set']('text',newText),AppStudioNavigationBar['SelectedTreeViewItem']['navItem']['Caption']=newText);});var multiSelect=$('#ctrlNavigationBar-NavBarGroup-LoginTypes')['data']('kendoMultiSelect');multiSelect['bind']('change',function(e){var selectedItems=this['value']();if(AppStudioNavigationBar['SelectedTreeViewItem'])AppStudioNavigationBar['SelectedTreeViewItem']['navItem']['LoginTypes']=selectedItems;}),$('#ctrlNavigationBar-NavBarGroup-Open')['on']('input',function(){var bChecked=TriSysSDK['CShowForm']['GetCheckBoxValue'](this['id']);if(AppStudioNavigationBar['SelectedTreeViewItem'])AppStudioNavigationBar['SelectedTreeViewItem']['navItem']['Open']=bChecked;}),$('#ctrlNavigationBar-NavBarGroup-Visible')['on']('input',function(){var bChecked=TriSysSDK['CShowForm']['GetCheckBoxValue'](this['id']);if(AppStudioNavigationBar['SelectedTreeViewItem'])AppStudioNavigationBar['SelectedTreeViewItem']['navItem']['Visible']=bChecked;}),$('#ctrlNavigationBar-NavBarGroup-Phone')['on']('input',function(){var bChecked=TriSysSDK['CShowForm']['GetCheckBoxValue'](this['id']);if(AppStudioNavigationBar['SelectedTreeViewItem'])AppStudioNavigationBar['SelectedTreeViewItem']['navItem']['Phone']=bChecked;}),$('#ctrlNavigationBar-FormPage-Caption')['on']('input',function(){var newText=$(this)['val']();AppStudioNavigationBar['SelectedTreeViewItem']&&(AppStudioNavigationBar['SelectedTreeViewItem']['set']('text',newText),AppStudioNavigationBar['SelectedTreeViewItem']['formPage']['Caption']=newText);}),$('#ctrlNavigationBar-FormPage-FormName')['on']('input',function(){var newText=$(this)['val']();if(AppStudioNavigationBar['SelectedTreeViewItem'])AppStudioNavigationBar['SelectedTreeViewItem']['formPage']['FormName']=newText;}),$('#ctrlNavigationBar-FormPage-EntityName')['on']('input',function(){var newText=$(this)['val']();if(AppStudioNavigationBar['SelectedTreeViewItem'])AppStudioNavigationBar['SelectedTreeViewItem']['formPage']['EntityName']=newText;}),$('#ctrlNavigationBar-FormPage-ViewName')['on']('input',function(){var newText=$(this)['val']();if(AppStudioNavigationBar['SelectedTreeViewItem'])AppStudioNavigationBar['SelectedTreeViewItem']['formPage']['ViewName']=newText;}),$('#ctrlNavigationBar-FormPage-LoadRecordPhone')['on']('input',function(){var newText=$(this)['val']();if(AppStudioNavigationBar['SelectedTreeViewItem'])AppStudioNavigationBar['SelectedTreeViewItem']['formPage']['LoadRecordPhone']=newText;}),$('#ctrlNavigationBar-FormPage-Visible')['on']('input',function(){var bChecked=TriSysSDK['CShowForm']['GetCheckBoxValue'](this['id']);if(AppStudioNavigationBar['SelectedTreeViewItem'])AppStudioNavigationBar['SelectedTreeViewItem']['formPage']['Visible']=bChecked;}),$('#ctrlNavigationBar-FormPage-EntityForm')['on']('input',function(){var bChecked=TriSysSDK['CShowForm']['GetCheckBoxValue'](this['id']);if(AppStudioNavigationBar['SelectedTreeViewItem'])AppStudioNavigationBar['SelectedTreeViewItem']['formPage']['EntityForm']=bChecked;}),$('#ctrlNavigationBar-FormPage-Phone')['on']('input',function(){var bChecked=TriSysSDK['CShowForm']['GetCheckBoxValue'](this['id']);if(AppStudioNavigationBar['SelectedTreeViewItem'])AppStudioNavigationBar['SelectedTreeViewItem']['formPage']['Phone']=bChecked;});},'PopulateNavBarLoginTypes':function(){return TriSysApex['AccountTypes']['LoginTypes'];},'AddGroup':function(){var fnAddGroupToTreeView=function(sGroupName){const sNewNavBarID='navBar-'+TriSysSDK['Miscellaneous']['EscapeDOMid'](sGroupName,!![]);if(AppStudioNavigationBar['isDuplicateNode'](sNewNavBarID))return;var treeView=$('#'+AppStudioNavigationBar['LiveMenuID'])['data']('kendoTreeView'),rootNode=treeView['dataSource']['view']()[0x0];const navItem={'ID':sNewNavBarID,'Caption':sGroupName,'ImagePath':'gi\x20gi-warning_sign'};AppStudioNavigationBar['TreeViewIncrementingID']+=0x1;const newGroupFolder={'id':AppStudioNavigationBar['TreeViewIncrementingID'],'text':navItem['Caption'],'menuFolder':!![],'expanded':!![],'icon':TriSysApex['ModalDialogue']['IconPicker']['DisplayIcon'](navItem['ImagePath']),'navItem':navItem,'items':[]};if(rootNode['hasChildren']&&rootNode['children']['data']()['length']>0x0){var firstChildNode=treeView['findByUid'](rootNode['children']['data']()[0x0]['uid']);treeView['insertBefore'](newGroupFolder,firstChildNode);}else treeView['append'](newGroupFolder,treeView['findByUid'](rootNode['uid']));AppStudioNavigationBar['UnselectAllNodesInAllTrees']();var newNode=treeView['findByUid'](treeView['dataSource']['get'](AppStudioNavigationBar['TreeViewIncrementingID'])['uid']);return treeView['select'](newNode),treeView['trigger']('select',{'node':newNode}),!![];},sMessage='Add\x20New\x20Special\x20Menu\x20Group',options={'Label':'Group\x20Name'};TriSysApex['ModalDialogue']['New']['Popup'](sMessage,'gi-circle_plus',fnAddGroupToTreeView,options);},'AddMenuItem':function(){var treeView=$('#'+AppStudioNavigationBar['LiveMenuID'])['data']('kendoTreeView'),node=treeView['select'](),item=treeView['dataItem'](node);if(!item){TriSysApex['UI']['ShowMessage']('You\x20can\x20only\x20add\x20form\x20menu\x20items\x20to\x20selected\x20groups.');return;}var rootNode=node,bAddToGroup=!![];if(!item['navItem']){TriSysApex['UI']['ShowError']('You\x20can\x20only\x20add\x20form\x20menu\x20items\x20to\x20groups.');return;}else item['formPage']&&(bAddToGroup=![]);var sServerFormsFolder=null,fnAddItemToTreeView=function(sFormName){var fnAddFormObjectToTreeView=function(formObject){const navItem=item['navItem'],sEntityName=TriSysSDK['Miscellaneous']['EscapeDOMid'](formObject['Form']['Caption'],!![]),newFormPage={'FormName':sFormName,'EntityName':'','ImagePath':formObject['Form']['Icon'],'Caption':formObject['Form']['Caption'],'ViewName':sFormName+'.json','ParentNavBarMenuID':navItem['ID'],'Visible':!![]};AppStudioNavigationBar['TreeViewIncrementingID']+=0x1;const newItem={'id':AppStudioNavigationBar['TreeViewIncrementingID'],'text':formObject['Form']['Caption'],'menuFolder':![],'icon':TriSysApex['ModalDialogue']['IconPicker']['DisplayIcon'](formObject['Form']['Icon']),'formPage':newFormPage,'navItem':navItem};if(bAddToGroup){var selectedNode=treeView['select'](),jQueryRootNode=$(selectedNode)['children']('.k-group');jQueryRootNode['length']===0x0&&(jQueryRootNode=$('<ul\x20class=\x27k-group\x27></ul>')['appendTo'](selectedNode)),treeView['append'](newItem,jQueryRootNode),treeView['expand'](jQueryRootNode);}else{var selectedNodeDataItem=treeView['dataItem'](rootNode),parentOfRootNode=null;try{parentOfRootNode=treeView['parent'](rootNode);}catch(e){}if(parentOfRootNode){var parentOfRootNode=treeView['parent'](rootNode),parentNodeDataItem=treeView['dataItem'](parentOfRootNode);parentNodeDataItem['items']['splice'](parentNodeDataItem['items']['indexOf'](selectedNodeDataItem)+0x1,0x0,newItem);}else{TriSysApex['UI']['ShowError']('The\x20selected\x20node\x20has\x20no\x20parent.');return;}}AppStudioNavigationBar['UnselectAllNodesInAllTrees']();var newNode=treeView['findByUid'](treeView['dataSource']['get'](AppStudioNavigationBar['TreeViewIncrementingID'])['uid']);treeView['select'](newNode),treeView['trigger']('select',{'node':newNode});};const sFullPath=sServerFormsFolder+'\x5c'+sFormName+'.json';return TriSysFlexiva['Forms']['WebAPI']['ReadFile'](sFullPath,function(sJSON){if(sJSON){const formObject=JSON['parse'](sJSON);fnAddFormObjectToTreeView(formObject);}}),!![];};const fnSelectForm=function(lstForm,sServerFolder){sServerFormsFolder=sServerFolder;const lstFormName=[];lstForm&&lstForm['forEach'](function(file){lstFormName['push'](file['Name']);});AppStudioNavigationBar['RemoveAssignedFormsFromList'](lstFormName);if(lstFormName['length']===0x0){TriSysApex['UI']['ShowMessage']('All\x20forms\x20are\x20already\x20assigned\x20to\x20a\x20menu\x20item.');return;}var sDefaultFormName=null;lstFormName['forEach'](function(formName){if(!sDefaultFormName)sDefaultFormName=formName;});const sMessage='Add\x20New\x20Form\x20Menu\x20Item',options={'Instructions':'Select\x20one\x20of\x20the\x20unassigned\x20forms.','ComboLabel':'Form','ComboList':lstFormName,'ComboSelectedItem':sDefaultFormName};TriSysApex['ModalDialogue']['Combo']['Popup'](sMessage,'gi-plus',fnAddItemToTreeView,options);};TriSysFlexiva['Forms']['WebAPI']['ReadForms'](fnSelectForm);},'RemoveAssignedFormsFromList':function(lstFormName){if(lstFormName['length']>0x0){var drawOptions=AppStudioNavigationBar['Persistence']['ReadConfigurationFromLiveTreeView']();drawOptions['PagesConfiguration']['forEach'](function(page){if(page['FormName']){const iIndex=lstFormName['indexOf'](page['FormName']);if(iIndex>=0x0)lstFormName['splice'](iIndex,0x1);}});}},'Delete':function(){if(AppStudioNavigationBar['SelectedTreeViewItem']){var item=AppStudioNavigationBar['SelectedTreeViewItem'],node=AppStudioNavigationBar['SelectedNodeElement'];if(!item['navItem']){TriSysApex['UI']['ShowError']('You\x20cannot\x20delete\x20the\x20root\x20node.');return;}const sMessage='Delete:\x20'+item['text']+'?'+'<br><br><b>Warning:</b>\x20All\x20sub-nodes\x20will\x20be\x20deleted\x20also.';TriSysApex['UI']['questionYesNo'](sMessage,'Delete','Yes',function(){var treeview=$('#'+AppStudioNavigationBar['SelectedNodeTreeViewID'])['data']('kendoTreeView');AppStudioNavigationBar['DroppedNodeTreeViewID']&&(treeview=$('#'+AppStudioNavigationBar['DroppedNodeTreeViewID'])['data']('kendoTreeView'),AppStudioNavigationBar['DroppedNodeTreeViewID']=null);var selectedNode=treeview['select']();return selectedNode['length']?(treeview['remove'](selectedNode),AppStudioNavigationBar['ShowProperties'](null),AppStudioNavigationBar['SelectedTreeViewItem']=null,AppStudioNavigationBar['SelectedNodeElement']=null,AppStudioNavigationBar['SelectedNodeTreeViewID']=null,AppStudioNavigationBar['DroppedNodeTreeViewID']=null):TriSysApex['UI']['ShowError']('No\x20node\x20is\x20selected.'),!![];},'No');}},'NavigationBarEditor':function(){const sIconStyle='style=\x22width:\x2020px;\x20padding:\x204px;\x20margin:\x204px;'+'\x20color:\x20'+TriSysProUI['NavBarInverseColour']()+';\x20\x22',liveMenuConfiguration={'dataSource':AppStudioNavigationBar['Persistence']['ReadDataFromWebAPI'](!![]),'dragAndDrop':!![],'checkboxes':![],'loadOnDemand':![],'select':AppStudioNavigationBar['SelectTreeItem'],'dragstart':AppStudioNavigationBar['DragStart'],'dragend':AppStudioNavigationBar['DragEnd'],'drop':AppStudioNavigationBar['Drop'],'template':'<span\x20class=\x22k-icon\x20#=\x20item.icon\x20#\x22'+sIconStyle+'></span>\x20#:\x20item.text\x20#\x20&nbsp;'};$('#'+AppStudioNavigationBar['LiveMenuID'])['kendoTreeView'](liveMenuConfiguration);},'SelectTreeItem':function(e){AppStudioNavigationBar['SelectedTreeViewItem']=this['dataItem'](e['node']),AppStudioNavigationBar['SelectedNodeElement']=e['node'],AppStudioNavigationBar['SelectedNodeTreeViewID']=this['element']['attr']('id'),AppStudioNavigationBar['ShowProperties'](AppStudioNavigationBar['SelectedTreeViewItem']);},'ShowProperties':function(properties){const sPrefix='ctrlNavigationBar-',sNavBarGroup=sPrefix+'NavBarGroup',sFormPage=sPrefix+'FormPage';if(!properties||properties['rootFolder']){$('#'+sFormPage)['hide'](),$('#'+sNavBarGroup)['hide']();return;}if(properties['navItem']&&!properties['formPage']){$('#'+sFormPage)['hide'](),$('#'+sNavBarGroup)['show']();var sID=properties['navItem']['ID'],sCaption=properties['navItem']['Caption'];const sNavBarGroupID=sNavBarGroup+'-ID';TriSysSDK['CShowForm']['writeFieldValueToWidget'](sNavBarGroupID,sID,{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['Text']});const bLocked=properties['navItem']['Locked'];bLocked?$('#'+sNavBarGroupID)['prop']('disabled',!![]):$('#'+sNavBarGroupID)['prop']('disabled',![]),TriSysSDK['CShowForm']['writeFieldValueToWidget'](sNavBarGroup+'-Caption',sCaption,{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['Text']}),TriSysSDK['CShowForm']['writeFieldValueToWidget'](sNavBarGroup+'-Icon',properties['navItem']['ImagePath'],{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['Icon']}),TriSysSDK['CShowForm']['writeFieldValueToWidget'](sNavBarGroup+'-Open',properties['navItem']['Open'],{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['YesNo']}),TriSysSDK['CShowForm']['writeFieldValueToWidget'](sNavBarGroup+'-Visible',properties['navItem']['Visible'],{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['YesNo']}),TriSysSDK['CShowForm']['writeFieldValueToWidget'](sNavBarGroup+'-Phone',properties['navItem']['Phone'],{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['YesNo']}),TriSysSDK['CShowForm']['writeFieldValueToWidget'](sNavBarGroup+'-Locked',properties['navItem']['Locked'],{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['YesNo']});}else{if(properties['formPage']){$('#'+sNavBarGroup)['hide'](),$('#'+sFormPage)['show']();var sParentID=properties['navItem']['ID'],sCaption=properties['formPage']['Caption'];TriSysSDK['CShowForm']['writeFieldValueToWidget'](sFormPage+'-ParentID',sParentID,{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['Text']}),TriSysSDK['CShowForm']['writeFieldValueToWidget'](sFormPage+'-Caption',sCaption,{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['Text']}),TriSysSDK['CShowForm']['writeFieldValueToWidget'](sFormPage+'-Icon',properties['formPage']['ImagePath'],{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['Icon']});const sFormNameID=sFormPage+'-FormName';TriSysSDK['CShowForm']['writeFieldValueToWidget'](sFormNameID,properties['formPage']['FormName'],{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['Text']});const bSystemAdministration=properties['formPage']['FormName']=='AdminConsole',bLocked=properties['formPage']['Locked'];bLocked?$('#'+sFormNameID)['prop']('disabled',!![]):$('#'+sFormNameID)['prop']('disabled',![]),bLocked?$('#'+sFormPage+'-ViewName')['prop']('disabled',!![]):$('#'+sFormPage+'-ViewName')['prop']('disabled',![]),bLocked?$('#'+sFormPage+'-EntityName')['prop']('disabled',!![]):$('#'+sFormPage+'-EntityName')['prop']('disabled',![]),bLocked?$('#'+sFormPage+'-EntityForm')['prop']('disabled',!![]):$('#'+sFormPage+'-EntityForm')['prop']('disabled',![]),bLocked?$('#'+sFormPage+'-Phone')['prop']('disabled',!![]):$('#'+sFormPage+'-Phone')['prop']('disabled',![]),bLocked?$('#'+sFormPage+'-LoadRecordPhone')['prop']('disabled',!![]):$('#'+sFormPage+'-LoadRecordPhone')['prop']('disabled',![]),TriSysSDK['CShowForm']['writeFieldValueToWidget'](sFormPage+'-EntityName',properties['formPage']['EntityName'],{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['Text']}),TriSysSDK['CShowForm']['writeFieldValueToWidget'](sFormPage+'-ViewName',properties['formPage']['ViewName'],{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['Text']}),TriSysSDK['CShowForm']['writeFieldValueToWidget'](sFormPage+'-Visible',properties['formPage']['Visible'],{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['YesNo']}),TriSysSDK['CShowForm']['writeFieldValueToWidget'](sFormPage+'-EntityForm',properties['formPage']['EntityForm'],{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['YesNo']}),TriSysSDK['CShowForm']['writeFieldValueToWidget'](sFormPage+'-LoadRecordPhone',properties['formPage']['LoadRecordPhone'],{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['Text']}),TriSysSDK['CShowForm']['writeFieldValueToWidget'](sFormPage+'-Phone',properties['formPage']['Phone'],{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['YesNo']}),TriSysSDK['CShowForm']['writeFieldValueToWidget'](sFormPage+'-Locked',properties['formPage']['Locked'],{'FieldTypeId':TriSysSDK['Controls']['FieldTypes']['YesNo']});}}},'IconPicked':function(sFieldID,sIcon){var fnReplaceIconInTreeAndInItemData=function(sIcon){if(AppStudioNavigationBar['SelectedNodeElement']){var $selectedNode=$(AppStudioNavigationBar['SelectedNodeElement']),$selectedNodeIcon=$selectedNode['find']('span.k-treeview-leaf.k-in.k-selected\x20>\x20span.k-icon');$selectedNodeIcon['length']>0x0&&AppStudioNavigationBar['SelectedTreeViewItem']['set']('icon',TriSysApex['ModalDialogue']['IconPicker']['DisplayIcon'](sIcon));const selectedNodeDataItem=AppStudioNavigationBar['SelectedTreeViewItem'];if(selectedNodeDataItem['navItem']&&selectedNodeDataItem['formPage'])selectedNodeDataItem['formPage']['ImagePath']=sIcon;else selectedNodeDataItem['navItem']&&(selectedNodeDataItem['navItem']['ImagePath']=sIcon);}};setTimeout(function(){fnReplaceIconInTreeAndInItemData(sIcon);},0xa);},'DragStart':function(e){var draggedNode=this['dataItem'](e['sourceNode']);if(draggedNode['draggable']===![]){e['preventDefault']();return;}e['sourceNodeData']=this['dataItem'](e['sourceNode']);},'DragEnd':function(e){},'Drop':function(e){var treeView=this,draggedItem=treeView['dataItem'](e['sourceNode']),destinationItem=this['dataItem'](e['destinationNode']),rootNode=treeView['element']['find']('.k-item')['first'](),droppedNode=e['sourceNode'];if(!e['destinationNode']){e['preventDefault'](),alert('You\x20must\x20drop\x20the\x20node\x20onto\x20another\x20valid\x20node!');return;}var sourceTreeView=$(e['sourceNode'])['closest']('.k-treeview')['data']('kendoTreeView'),destinationTreeView=$(e['destinationNode'])['closest']('.k-treeview')['data']('kendoTreeView');AppStudioNavigationBar['DroppedNodeTreeViewID']=destinationTreeView['element']['attr']('id');var sourceNodeData=sourceTreeView['dataItem'](e['sourceNode']),destinationNodeData=destinationTreeView['dataItem'](e['destinationNode']),isDestinationFolder=destinationNodeData&&destinationNodeData['menuFolder']===!![],isDestinationFile=destinationNodeData&&destinationNodeData['formPage'],isSourceFolder=sourceNodeData&&sourceNodeData['menuFolder']===!![],isSourceFile=sourceNodeData&&sourceNodeData['formPage'];const bDroppedBeforeAFolder=destinationNodeData['menuFolder']&&e['dropPosition']==='before',bDroppedAfterAFolder=destinationNodeData['menuFolder']&&e['dropPosition']==='after',bDroppedAfterRootNode=destinationNodeData['rootFolder']&&e['dropPosition']==='after',bDroppedOntoFile=isDestinationFile&&e['dropPosition']==='over',bDroppedOntoRootFolder=destinationNodeData['rootFolder']&&e['dropPosition']==='over';if(isSourceFolder&&isDestinationFile)return e['preventDefault'](),![];if(isSourceFolder&&isDestinationFolder&&!bDroppedBeforeAFolder)return e['preventDefault'](),![];if(bDroppedOntoFile)return e['preventDefault'](),![];if(bDroppedOntoRootFolder&&isSourceFile)return e['preventDefault'](),![];if(bDroppedAfterAFolder&&isSourceFile)return e['preventDefault'](),![];var isRootNode=$(e['destinationNode'])['parent']()['hasClass']('k-treeview')&&$(e['destinationNode'])['parent']()[0x0]===destinationTreeView['element'][0x0],dropPosition=e['dropPosition'];if(bDroppedBeforeAFolder&&isSourceFile)return e['preventDefault'](),![];var rootNodePosition=rootNode['index'](),destinationNodeElement=$(e['destinationNode']),isRootNode=destinationNodeElement['closest']('.k-treeview')['find']('.k-item')['first']()[0x0]===e['destinationNode'],firstRootNode=treeView['element']['find']('.k-item')['first'](),firstRootNodePosition=firstRootNode['index'](),destinationNodePosition=destinationNodeElement['index']();if(e['dropPosition']==='before'&&isRootNode&&destinationNodePosition===firstRootNodePosition){e['preventDefault'](),TriSysApex['UI']['ShowMessage']('You\x20cannot\x20drop\x20the\x20node\x20before\x20the\x20root\x20menu');return;}if(e['dropPosition']==='after'&&isRootNode&&destinationNodePosition===firstRootNodePosition){e['preventDefault'](),TriSysApex['UI']['ShowMessage']('You\x20cannot\x20drop\x20the\x20node\x20after\x20the\x20root\x20menu');return;}var targetItem=treeView['dataItem'](e['destinationNode']),parentNode=e['destinationNode']['parentNode'];if(e['dropPosition']==='before'||e['dropPosition']==='after'){if(!parentNode||parentNode['id']['indexOf']('ctrlNavigationBar-')==0x0){e['preventDefault'](),TriSysApex['UI']['ShowMessage']('Cannot\x20drop\x20the\x20node\x20at\x20the\x20root\x20level!');return;}}if(draggedItem['formPage']){var sourceTreeView=$(e['sourceNode'])['closest']('.k-treeview')['data']('kendoTreeView'),destinationTreeView=$(e['destinationNode'])['closest']('.k-treeview')['data']('kendoTreeView'),parentItem;if(sourceTreeView!==destinationTreeView){var draggedItem=sourceTreeView['dataItem'](e['sourceNode']);parentItem=destinationTreeView['dataItem'](e['destinationNode']),console['log']('Dragged\x20Item:\x20',draggedItem),console['log']('Parent\x20Item:\x20',parentItem);}else{var draggedItemSameTree=destinationTreeView['dataItem'](e['sourceNode']);parentItem=destinationTreeView['dataItem'](e['destinationNode']),console['log']('Dragged\x20Item\x20(Same\x20Tree):\x20Caption:\x20',draggedItemSameTree['formPage']['Caption']+',\x20ParentID:\x20'+draggedItemSameTree['navItem']['ID']),console['log']('Parent\x20Item\x20(Same\x20Tree):\x20',parentItem['navItem']['ID']),draggedItemSameTree['formPage']['ParentNavBarMenuID']=parentItem['navItem']['ID'],draggedItemSameTree['navItem']=parentItem['navItem'],AppStudioNavigationBar['SelectedTreeViewItem']=this['dataItem'](e['sourceNode']),AppStudioNavigationBar['SelectedNodeElement']=e['sourceNode'],AppStudioNavigationBar['SelectedNodeTreeViewID']=destinationTreeView['element'][0x0]['id'],treeView['select'](null),treeView['select'](e['sourceNode']),AppStudioNavigationBar['ShowProperties'](AppStudioNavigationBar['SelectedTreeViewItem']);}return;return;}else draggedItem['navItem']&&(treeView['select'](null),treeView['select'](e['sourceNode']));},'UnselectAllNodesInAllTrees':function(){var treeView1=$('#'+AppStudioNavigationBar['LiveMenuID'])['data']('kendoTreeView');treeView1['select'](null);},'isDuplicateNode':function(sID){var bDuplicate=![],treeViewHierarchyLive=AppStudioNavigationBar['ReadTreeView'](AppStudioNavigationBar['LiveMenuID']),fnGroupComparison=function(node){if(node['navItem']&&node['navItem']){if(node['navItem']['ID']['toLowerCase']()==sID['toLowerCase']()){bDuplicate=!![];return;}}},fnPageComparison=function(node){node['items']&&node['items']['forEach'](function(childNode){if(childNode['formPage'])var bDuplicateEntity=childNode['formPage']['EntityName']&&childNode['formPage']['EntityName']['toLowerCase']()==sID['toLowerCase'](),bDuplicateForm=childNode['formPage']['FormName']&&childNode['formPage']['FormName']['toLowerCase']()==sID['toLowerCase'](),bDuplicateView=childNode['formPage']['ViewName']&&childNode['formPage']['ViewName']['toLowerCase']()==sID['toLowerCase']();});};treeViewHierarchyLive&&treeViewHierarchyLive['length']==0x1&&!bDuplicate&&treeViewHierarchyLive[0x0]['items']['forEach'](function(node){fnGroupComparison(node),fnPageComparison(node);});if(bDuplicate)TriSysApex['UI']['ShowMessage']('A\x20node\x20with\x20the\x20ID\x20\x27'+sID+'\x27\x20already\x20exists\x20in\x20the\x20navigation\x20bar.');return bDuplicate;},'getTreeViewHierarchy':function(treeView){var hierarchy=[];function traverseNodes(nodes){return nodes['map'](function(node){var item={'id':node['id'],'text':node['text'],'formPage':node['formPage'],'navItem':node['navItem'],'items':[]};return node['items']&&node['items']['length']>0x0&&(item['items']=traverseNodes(node['items'])),item;});}var rootNodes=treeView['dataSource']['view']();return hierarchy=traverseNodes(rootNodes),hierarchy;},'DebugTreeViewNodes':function(sID){var treeViewHierarchy=AppStudioNavigationBar['ReadTreeView'](sID);console['log'](JSON['stringify'](treeViewHierarchy,null,0x2));},'ReadTreeView':function(sID){var treeView=$('#'+sID)['data']('kendoTreeView'),treeViewHierarchy=AppStudioNavigationBar['getTreeViewHierarchy'](treeView);return treeViewHierarchy;},'Persistence':{'Save':function(bApplyChanges){AppStudioNavigationBar['DebugTreeViewNodes'](AppStudioNavigationBar['LiveMenuID']);const navBar=AppStudioNavigationBar['Persistence']['ReadConfigurationFromTreeViews'](!![],![]),forms=AppStudioNavigationBar['Persistence']['ReadConfigurationFromTreeViews'](![],!![]);AppStudioNavigationBar['Persistence']['WriteDataToWebAPI'](navBar,forms,AppStudioNavigationBar['Persistence']['PropagateChangesToRunningApp']);var drawOptions=AppStudioNavigationBar['Persistence']['ReadConfigurationFromLiveTreeView']();AppStudioNavigationBar['Persistence']['ApplyChangesToRunningApp'](drawOptions);},'PropagateChangesToRunningApp':function(CWriteNavBarConfigurationResponse){if(CWriteNavBarConfigurationResponse['NewlyCachedCustomSecurityObjects']){var userCredentials=TriSysApex['LoginCredentials']['UserCredentials'](),customForms=userCredentials['LoggedInUser']['CRMContact']['CustomForms'],sCustomerID=userCredentials['LoggedInUser']['CRMContact']['CompanyName']['replace'](/ /g,'-')['toLowerCase']();const securityObject={'FileName':'custom-security-objects.json','FilePath':'custom/'+sCustomerID+'/custom-security-objects.json'};customForms['push'](securityObject);}TriSysApex['Cache']['ApplicationSettingsManager']['Security']['_CachedSecurityObjectsJson']=null;},'ReadConfigurationFromLiveTreeView':function(){var navBarConfig=[],pagesConfig=[],treeViewHierarchyLive=AppStudioNavigationBar['ReadTreeView'](AppStudioNavigationBar['LiveMenuID']);if(!treeViewHierarchyLive)return;const liveRoot=treeViewHierarchyLive[0x0];liveRoot['items']['forEach'](function(groupNode){const navItem=groupNode['navItem'];navBarConfig['push'](navItem),groupNode['items']&&groupNode['items']['forEach'](function(pageNode){const formPage=pageNode['formPage'];pagesConfig['push'](formPage);});});var drawOptions={'NavigationBarConfiguration':navBarConfig,'PagesConfiguration':pagesConfig};return drawOptions;},'ReadConfigurationFromTreeViews':function(bNavBar,bForms){var navBarConfig=[],pagesConfig=[],treeViewHierarchyLive=AppStudioNavigationBar['ReadTreeView'](AppStudioNavigationBar['LiveMenuID']);const liveRoot=treeViewHierarchyLive[0x0];return liveRoot['items']['forEach'](function(groupNode){const navItem=groupNode['navItem'];navBarConfig['push'](navItem),groupNode['items']&&groupNode['items']['forEach'](function(pageNode){const formPage=pageNode['formPage'];pagesConfig['push'](formPage);});}),bNavBar?navBarConfig:pagesConfig;},'ApplyChangesToRunningApp':function(drawOptions){TriSysApex['NavigationBar']['Draw']('scrollNavBar',!![],drawOptions),TriSysApex['NavigationBar']['ApplyVisibility'](!![]);},'ReadDataFromWebAPI':function(bLive){var lstNavBar=TriSysApex['NavigationBar']['ConfigurationFileJSON'],lstFormsPages=TriSysApex['Forms']['Configuration']['Pages'];const navBar=TriSysApex['NavigationBar'];navBar['AppStudioConfiguration']&&(lstNavBar=navBar['AppStudioConfiguration']['NavBar'],lstFormsPages=navBar['AppStudioConfiguration']['Forms']);const bCustomConfiguration=TriSysApex['CustomFormsAndComponents']['isCustomForm']('navbar.json');return!bCustomConfiguration&&lstNavBar&&lstNavBar['forEach'](function(group){group['Visible']=!![];}),AppStudioNavigationBar['Persistence']['GetTreeViewMenuDataSource'](lstNavBar,lstFormsPages,bLive,!bLive);},'WriteDataToWebAPI':function(navBarItems,formItems,fnCallback){const navBar=TriSysApex['NavigationBar'];if(!navBar['AppStudioConfiguration'])navBar['AppStudioConfiguration']={'NavBar':null,'Forms':null};navBar['AppStudioConfiguration']['NavBar']=navBarItems,navBar['AppStudioConfiguration']['Forms']=formItems;const securityItems=AppStudioNavigationBar['Persistence']['GatherNonLockedSecurityObjects'](navBarItems,formItems);var payloadObject={};payloadObject['URL']='AppStudio/WriteNavBarConfiguration',payloadObject['OutboundDataPacket']={'NavBarJSON':JSON['stringify'](navBarItems),'FormsJSON':JSON['stringify'](formItems),'SecurityItems':securityItems},payloadObject['InboundDataFunction']=function(CWriteNavBarConfigurationResponse){if(CWriteNavBarConfigurationResponse&&CWriteNavBarConfigurationResponse['Success']&&fnCallback)fnCallback(CWriteNavBarConfigurationResponse);},payloadObject['ErrorHandlerFunction']=function(request,status,error){console['log'](TriSysAPI['Data']['BaseAddress']()+':\x20'+status+':\x20'+error+'.\x20responseText:\x20'+request['responseText']);},TriSysAPI['Data']['PostToWebAPI'](payloadObject);},'GatherNonLockedSecurityObjects':function(navBarItems,formItems){const lstSecurityItems=[];return navBarItems&&navBarItems['forEach'](function(group){if(!group['Locked']){var item={'Name':group['Caption']['replace'](/ /g,''),'Description':['Visibility\x20of\x20'+group['Caption']+'\x20menu\x20group'],'Category':'NavBar','Type':'Boolean','Default':group['Visible']?'true':'false','DOMidList':[group['ID']+'-MenuItem']};lstSecurityItems['push'](item);}}),formItems&&formItems['forEach'](function(formPage){if(!formPage['Locked']){var item={'Name':formPage['Caption'],'Description':['Visibility\x20of\x20'+formPage['Caption']+'\x20menu\x20item'],'Category':'NavBar','Type':'Boolean','Default':formPage['Visible']?'true':'false','DOMidList':[TriSysSDK['Miscellaneous']['EscapeDOMid'](formPage['FormName'])+'-MenuItem']};lstSecurityItems['push'](item);}}),lstSecurityItems;},'GetTreeViewMenuDataSource':function(lstNavBar,lstFormsPages,bLiveItemsOnly,bHiddenItemsOnly){var lstItems=[];lstNavBar['forEach'](function(navItem){var bAddGroup=!![];const iSubscriber=0x0;if(bAddGroup){const lstGroupItems=[];lstFormsPages['forEach'](function(formPage){var bAddPage=navItem['ID']==formPage['ParentNavBarMenuID'];if(bAddPage){AppStudioNavigationBar['TreeViewIncrementingID']+=0x1;const item={'id':AppStudioNavigationBar['TreeViewIncrementingID'],'text':formPage['Caption'],'icon':TriSysApex['ModalDialogue']['IconPicker']['DisplayIcon'](formPage['ImagePath']),'formPage':formPage,'navItem':navItem};lstGroupItems['push'](item);}}),AppStudioNavigationBar['TreeViewIncrementingID']+=0x1;const group={'id':AppStudioNavigationBar['TreeViewIncrementingID'],'text':navItem['Caption'],'menuFolder':!![],'expanded':![],'icon':TriSysApex['ModalDialogue']['IconPicker']['DisplayIcon'](navItem['ImagePath']),'navItem':navItem,'items':lstGroupItems};lstItems['push'](group);}}),AppStudioNavigationBar['TreeViewIncrementingID']+=0x1;const menuDataSource=[{'id':AppStudioNavigationBar['TreeViewIncrementingID'],'text':(bLiveItemsOnly?'Live':'Hidden')+'\x20Navigation\x20Bar\x20Menu','rootFolder':!![],'expanded':!![],'draggable':![],'icon':'fa\x20fa-bars','items':lstItems}];return menuDataSource;}}};